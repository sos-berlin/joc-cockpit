<div class="modal-header">
  <h4 class="modal-title">
    @if ((type === 'Delete' || type === 'Remove') && !resetProfiles) {
      <span>
        <span>{{'common.label.' + title | translate}}</span>
        @if (objectName) {
          <span>:
            {{objectName}} ?
          </span>
        }
      </span>
    }
    @if (updateFromJobTemplate) {
      <span>{{'inventory.button.updateFromJobTemplate' | translate}}
        :
        {{updateFromJobTemplate}}
      </span>
    }
    @if (type && (type !== 'Delete' && type !== 'Remove') || resetProfiles) {
      <span>
        @if (title) {
          <span>{{'common.label.' + title | translate}}</span>
        }
        @if (resetProfiles) {
          <span>?</span>
        }
        @if (title2) {
          <span>{{'workflow.button.' + title2 | translate}}</span>
        }
        @if (objectName) {
          <span>
            {{objectName}}
          </span>
        }
      </span>
    }
    @if (lossNode || title == 'confirm') {
      <span>{{'common.label.confirm' | translate}}</span>
    }
  </h4>
  <button (click)="activeModal.destroy()" aria-label="Close" class="close" type="button">
    <span aria-hidden="true" class="fa fa-times-circle"></span>
  </button>
</div>
<div class="modal-body p-a">
  <div class="row text-center">
    <div class="col-sm-12 m-t m-b">
      @if (lossNode) {
        <span class="text">
          <span [translateParams]="{lossNode: lossNode}" class="text"
                translate>dashboard.message.confirmNodeLoss</span>
        </span>
      }
      @if (updateFromJobTemplate) {
        <span class="text" translate>inventory.message.updateFromJobTemplate</span>
      }
      @if (message === 'closedPlanType') {
        <span class="text"  [translateParams]="{planId: planId}" translate>common.message.closedPlanType</span>
      }
      @if (question) {
        <span class="text">{{question | translate}}</span>
      }
      @if (message2) {
        <span class="text">
          {{'workflow.message.' + message2 | translate}}
        </span>
      }
      @if (!countMessage && message && !planId) {
        <span class="text">
          {{(message === 'deleteGitCredentials' ? 'profile.gitManagement.message.' : 'common.message.') + message | translate}}
        </span>
      }
      @if (countMessage && count > 0) {
        <span [translateParams]="{count: count}" class="text"
              translate>{{'common.message.' + countMessage}}</span>
      }
      @if (countMessage && count === 0) {
        <span class="text">
          <app-empty-data [title]="'common.message.noObjectFoundToDelete'"></app-empty-data>
        </span>
      }
    </div>
    @if (document) {
      <div class="col-sm-12 text-left m-t">
        @for (doc of document.usedIn; track doc.path || doc.type) {
          <div class="row">
            <label class="col-md-3 _600">
              {{doc.type | translate}} :
            </label>
            <div class="col-md-9">
              <a>{{doc.path}}</a>
            </div>
          </div>
        }
      </div>
    }
    @if (documentArr && documentArr.length>0) {
      <div class="col-sm-12 text-left m-t">
        @for (document of documentArr; track document.name || $index; let i = $index) {
          <div [ngClass]="{'b-t p-t': i !=0}" class="row">
            <div class="col-sm-12">
              <span class="col-md-3" translate>resource.documentation.label.documentation</span>
              <label class="col-md-9">{{document.name}}</label>
            </div>
            <div class="col-sm-12">
              @for (doc of document.usedIn; track doc.path || doc.type) {
                <div class="row">
                  <label class="col-md-3 _600">
                    {{doc.type | translate}} :
                  </label>
                  <div class="col-md-9">
                    <a>{{doc.path}}</a>
                  </div>
                </div>
              }
            </div>
          </div>
        }
      </div>
    }
    @if (resetProfiles && resetProfiles.length>0) {
      <div class="col-sm-12 text-left m-t-sm">
        <div class="row">
          <label class="col-md-3 col-md-offset-3" translate>
            user.label.account
          </label>
          <div class="col-md-6  text-left">
            @for (profile of resetProfiles; track profile; let i = $index) {
              <div>
                {{i + 1}} - {{profile}}
              </div>
            }
          </div>
        </div>
      </div>
    }
  </div>
  <div class="form-group row m-t-md">
    @if (affectedObjectTypes.length > 0 || referencedObjectTypes.length || filteredAffectedItems?.length > 0) {
      <div class="m-b-sm opacity-0_5 p-sm-0">
        <label><span nz-icon nzType="exclamation-circle" class="m-r-sm" nzTheme="outline"></span>{{'inventory.message.remove' | translate}}</label>
      </div>
    }
    @if (affectedObjectTypes.length > 0) {
      <div class="col-md-6" [class.col-md-12]="referencedObjectTypes.length === 0">
        <i class="cursor text-16 fa" [ngClass]="{'fa-caret-right': !isAffectedCollapsed, 'fa-caret-down': isAffectedCollapsed}"
           (click)="toggleAllAffectedCollapse()"></i>
        <label class="m-l-sm" translate>inventory.label.affectedObjects</label>
        <i class="cursor text-16 fa fa-angle-double-down m-l-sm"
           (click)="expandAllAffected()"></i>
        <i class="cursor text-16 fa fa-angle-double-up m-l-xs"
           (click)="collapseAllAffected()"></i>
        @if (isAffectedCollapsed) {
          <div class="m-t-sm m-l-sm">
            @for (objectType of affectedObjectTypes; track objectType) {
              @if (affectedObjectsByType[objectType]?.length) {
                <div class="m-t-sm">
                  <i class="cursor text-16 fa" [ngClass]="{'fa-caret-right': !affectedCollapsed[objectType], 'fa-caret-down': affectedCollapsed[objectType]}"
                     (click)="toggleAffectedCollapse(objectType)"></i>
                  <label class="m-l-sm" >
                    @if (!isCustomIcon(objectType)) {
                      <span class="icon-color">
                        <i nz-icon nzTheme="outline" [nzType]="getIcon(objectType)"></i>
                      </span>
                    }
                    @if (isCustomIcon(objectType)) {
                      <span class="icon-color" [ngClass]="getIcon(objectType)"></span>
                    }
                    {{ getObjectTypeLabel(objectType) | translate }}
                  </label>
                  @if (affectedCollapsed[objectType]) {
                    <div class="m-t-sm m-l-md">
                      @for (obj of affectedObjectsByType[objectType]; track obj.path) {
                        <div>
                          <label class="m-l-sm" nz-checkbox [(ngModel)]="obj.selected" [name]="'checkbox-' + obj.path"
                                 [disabled]="obj.disabled" (ngModelChange)="updateParentCheckboxAffected(objectType)">
                            <span [ngClass]="{
                                'fa-circle-o': !obj.valid,
                                'fa-circle dark-blue': obj.deployed || obj.released,
                                'opacity7': obj.syncState
                            }" class="fa fa-check-circle-o orange text-xs p-l-xs m-l-xs"></span>
                            {{ obj.path }}
                          </label>
                        </div>
                      }
                    </div>
                  }
                </div>
              }
            }
          </div>
        }
      </div>
    }

    @if (referencedObjectTypes.length > 0) {
      <div class="col-md-6" [class.col-md-12]="affectedObjectTypes.length === 0">
        <i class="cursor text-16 fa" [ngClass]="{'fa-caret-right': !isReferencedCollapsed, 'fa-caret-down': isReferencedCollapsed}"
           (click)="toggleAllReferencedCollapse()"></i>
        <label class="m-l-sm" translate>inventory.label.referencedObjects</label>
        <i class="cursor text-16 fa fa-angle-double-down m-l-sm"
           (click)="expandAllReferenced()"></i>
        <i class="cursor text-16 fa fa-angle-double-up m-l-xs"
           (click)="collapseAllReferenced()"></i>
        @if (isReferencedCollapsed) {
          <div class="m-t-sm m-l-sm">
            @for (objectType of referencedObjectTypes; track objectType) {
              @if (referencedObjectsByType[objectType]?.length) {
                <div class="m-t-sm">
                  <i class="cursor text-16 fa" [ngClass]="{'fa-caret-right': !referencedCollapsed[objectType], 'fa-caret-down': referencedCollapsed[objectType]}"
                     (click)="toggleReferencedCollapse(objectType)"></i>
                  <label class="m-l-sm" >
                    @if (!isCustomIcon(objectType)) {
                      <span class="icon-color">
                        <i nz-icon nzTheme="outline" [nzType]="getIcon(objectType)"></i>
                      </span>
                    }
                    @if (isCustomIcon(objectType)) {
                      <span class="icon-color" [ngClass]="getIcon(objectType)"></span>
                    }
                    {{ getObjectTypeLabel(objectType) | translate }}
                  </label>
                  @if (referencedCollapsed[objectType]) {
                    <div class="m-t-sm m-l-md">
                      @for (obj of referencedObjectsByType[objectType]; track obj.path) {
                        <div>
                          <label class="m-l-sm" nz-checkbox [(ngModel)]="obj.selected" [name]="'checkbox-' + obj.path"
                                 [disabled]="obj.disabled" (ngModelChange)="updateParentCheckboxReferenced(objectType)">
                            <span [ngClass]="{
                                'fa-circle-o': !obj.valid,
                                'fa-circle dark-blue': obj.deployed || obj.released,
                                'opacity7': obj.syncState
                            }" class="fa fa-check-circle-o orange text-xs p-l-xs m-l-xs"></span>
                            {{ obj.path }}
                          </label>
                        </div>
                      }
                    </div>
                  }
                </div>
              }
            }
          </div>
        }
      </div>
    }
  </div>
  @if (filteredAffectedItems?.length > 0) {
    <div class="form-group row m-t-sm m-l-sm" style="justify-content: space-between">
      <!-- Filtered Affected Objects -->
      <div class="form-group">
        <i class="cursor text-16 fa"
           [ngClass]="{'fa-caret-right': !filteredAffectedCollapsed, 'fa-caret-down': filteredAffectedCollapsed}"
           (click)="filteredAffectedCollapsed = !filteredAffectedCollapsed"></i>
        <label class="m-l-sm">{{ 'inventory.label.filteredAffectedItems' | translate }}</label>
        @if (filteredAffectedCollapsed) {
          <div class="m-t-sm m-l-md">
            @for (objectType of getUniqueObjectTypes(filteredAffectedItems); track objectType) {
              @if (getObjectsByType(filteredAffectedItems, objectType)?.length) {
                <div class="m-t-sm">
                  <label nz-checkbox [(ngModel)]="selectAllFilteredAffected[objectType]" [name]="'checkbox--' + objectType"
                         (ngModelChange)="toggleAllFilteredAffected(objectType, $event)">
                    @if (!isCustomIcon(objectType)) {
                      <span class="icon-color">
                        <i nz-icon nzTheme="outline" [nzType]="getIcon(objectType)"></i>
                      </span>
                    }
                    @if (isCustomIcon(objectType)) {
                      <span class="icon-color" [ngClass]="getIcon(objectType)"></span>
                    }
                    {{ getObjectTypeLabel(objectType) | translate }}
                  </label>
                  @if (filteredAffectedCollapsed) {
                    <div class="m-t-sm m-l-md">
                      @for (obj of getObjectsByType(filteredAffectedItems, objectType); track obj.path) {
                        <div>
                          <label nz-checkbox [(ngModel)]="obj.selected" [name]="'checkbox--'+ objectType + obj.path" [disabled]="obj.disabled"
                                 (ngModelChange)="updateParentCheckboxFilteredAffected(objectType)">
                            <span [ngClass]="{
                                'fa-circle-o': !obj.valid,
                                'fa-circle dark-blue': obj.deployed || obj.released
                            }" class="fa fa-check-circle-o orange text-xs m-t-xs m-l-xs"></span>
                            {{ obj.path }}
                          </label>
                        </div>
                      }
                    </div>
                  }
                </div>
              }
            }
          </div>
        }
      </div>
    </div>
  }
</div>
<div class="modal-footer">
  <button (click)="submit()" [disabled]="count == 0"
          [ngClass]="{'btn-primary' : type !== 'Delete' && type !== 'Remove'}" class="btn btn-danger btn-sm"
          type="button">
    @if (type === 'Delete') {
      <span>{{'common.button.delete' | translate}}</span>
    }
    @if (type === 'Remove') {
      <span>{{'common.button.remove' | translate}}</span>
    }
    @if (type !== 'Delete' && type !== 'Remove') {
      <span>{{'common.button.confirm' | translate}}</span>
    }
  </button>
  <button (click)="activeModal.destroy()" class="btn btn-grey btn-sm" translate type="button">
    common.button.cancel
  </button>
</div>
