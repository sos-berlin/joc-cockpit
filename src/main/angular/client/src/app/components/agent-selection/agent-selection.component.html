<div class="w-full"
     [ngClass]="{'has-error' : (obj.agent || (agentName.dirty || agentName.touched) && agentName.invalid)}">
  <input [required]="required" name="agentName" [placeholder]="(type === 'replace' ? 'workflow.findAndReplace.placeholder.selectReplace' : 'workflow.placeholder.selectAgentName') | translate" id="agentId"
         class="form-control" [(ngModel)]="data[type]" #agentName="ngModel" (click)="checkClick()" (blur)="onAgentChange('');" (ngModelChange)="onAgentChange($event)"
         [nzAutocomplete]="auto"/>
  <nz-autocomplete #auto>
    @if (favorite.list.length > 0) {
      <div class="text-right text-sm m-r-12">
        @if (!favorite.show) {
          <a class="primary-text-hover-color cursor" (click)="showFav(true);generateFavList()" translate>favorite.button.filterByFavorites</a>
        }
        @if (favorite.show) {
          <a class="primary-text-hover-color cursor" (click)="showFav(false);" translate>favorite.button.backToList</a>
        }
      </div>
    }
    @for (agent of nonExistAgents; track agent) {
      <nz-auto-option (click)="selectAgent(null)" [nzValue]="agent" [nzLabel]="agent">
        <span class="p-l-xs">{{agent}}</span> <span class="m-l-sm label bg-danger" translate>inventory.label.objectNotExist</span>
      </nz-auto-option>
    }
    @if (favorite.show) {
      <ng-container>
        @for (group of favorite.agents; track group.title || group) {
          <nz-auto-optgroup [nzLabel]="groupTitle">
            <ng-template #groupTitle>
              @if (group.isStandalone) {
                <span class="_600">{{ 'agent.label.' + group.title | translate }}</span>
              }
              @if (!group.isStandalone) {
                <span class="_600">{{ group.title}}</span>
              }
            </ng-template>
            @for (agent of group.children; track agent) {
              <nz-auto-option (click)="selectAgent(group.isStandalone ? null : group)" [nzLabel]="agent" [nzValue]="agent">
                <div class="fav-icon-on-hover">
                  {{ agent }}
                </div>
              </nz-auto-option>
            }
          </nz-auto-optgroup>
        }
      </ng-container>
    }
    @if (agentList[0] && agentList[0].title == 'agents' && !favorite.show && !skipStandaloneAgent) {
      @for (group of [agentList[0]]; track group.title) {
        <nz-auto-optgroup [nzLabel]="groupTitle">
          <ng-template #groupTitle>
            <span class="_600 cursor" (click)="expandCollapse($event, group);">
              {{ 'agent.label.' + group.title | translate }}
              <i class="fa p-r-xs  text-16"  [ngClass]="group.hide ? 'fa-caret-down' : 'fa-caret-up'" ></i>
            </span>
          </ng-template>
          @for (agent of group.children; track agent) {
            <nz-auto-option (click)="selectAgent(null)" [hidden]="group.hide" [nzLabel]="agent" [nzValue]="agent">
              <div class="fav-icon-on-hover">
                {{ agent }}
                <i class="pos-abt r-12 t-6 cursor font14 primary-text-hover-color" [hidden]="isFavCheck(agent, null)" nz-icon nzType="star" (click)="setFavorite($event, agent, null , true)" nzTheme="outline"></i>
                <i class="pos-abt r-12 t-6 cursor font14 text-primary" [hidden]="!isFavCheck(agent, null)" nz-icon nzType="star" (click)="setFavorite($event, agent, null , false)" nzTheme="fill"></i>
              </div>
            </nz-auto-option>
          }
        </nz-auto-optgroup>
      }
    }
    @if (((agentList[1] && agentList[1].title == 'agentGroups') || (agentList[0] && agentList[0].title == 'agentGroups')) && !favorite.show && !skipSubagents) {
      <nz-auto-option nzDisabled nzValue="" class="ant-select-item-group not-disabled">
        <span class="_600 cursor" style="font-size: 12px;" (click)="expandCollapse($event, agentList[agentList.length - 1]);">
          {{'agent.label.' + agentList[agentList.length - 1].title | translate}}
          <i class="fa p-r-xs  text-16"  [ngClass]="agentList[agentList.length - 1].hide ? 'fa-caret-down' : 'fa-caret-up'" ></i>
        </span>
      </nz-auto-option>
      @for (group of agentList[agentList.length - 1].children; track group.title) {
        <nz-auto-optgroup [hidden]="agentList[agentList.length - 1].hide" [nzLabel]="groupTitle">
          <ng-template #groupTitle>
            <span class="_600 pl-20 cursor" (click)="expandCollapse($event, group, true);">
              {{ group.title }}
              @if (group.children && group.children.length > 0) {
                <i class="fa p-r-xs text-16"  [ngClass]="group.hide ? 'fa-caret-down' : 'fa-caret-up'" ></i>
              }
            </span>
          </ng-template>
          @for (agent of group.children; track agent) {
            <nz-auto-option (click)="selectAgent(group)" [hidden]="group.hide" [nzLabel]="agent" [nzValue]="agent">
              <div class="pl-20 fav-icon-on-hover">{{ agent }}
                <i class="pos-abt r-12 t-6 cursor font14 primary-text-hover-color" [hidden]="isFavCheck(agent, group.title)" nz-icon nzType="star" (click)="setFavorite($event, agent, group.title, true)" nzTheme="outline"></i>
                <i class="pos-abt r-12 t-6 cursor font14 text-primary" [hidden]="!isFavCheck(agent, group.title)" nz-icon nzType="star" (click)="setFavorite($event, agent, group.title, false)" nzTheme="fill"></i>
              </div>
            </nz-auto-option>
          }
        </nz-auto-optgroup>
      }
    }
    @if (((agentList[1] && agentList[1].title == 'agentGroups') || (agentList[0] && agentList[0].title == 'agentGroups')) && !favorite.show && skipSubagents) {
      @for (group of [agentList[1]]; track group?.title) {
        <nz-auto-optgroup [nzLabel]="groupTitle">
          <ng-template #groupTitle>
            <span class="_600 cursor"  (click)="expandCollapse($event, group);">
              {{ 'agent.label.' + group?.title | translate }}
              <i class="fa p-r-xs text-16"  [ngClass]="group?.hide ? 'fa-caret-down' : 'fa-caret-up'"></i>
            </span>
          </ng-template>
          @for (agent of group?.children; track agent?.title || agent) {
            <nz-auto-option (click)="selectAgent(null)" [hidden]="group?.hide" [nzLabel]="agent.title" [nzValue]="agent.title">
              <div class="fav-icon-on-hover">
                {{ agent.title }}
              </div>
            </nz-auto-option>
          }
        </nz-auto-optgroup>
      }
    }
  </nz-autocomplete>
  <a class="pos-abt r-24 refresh-icon" style="top: 5px" [ngClass]="{'disabled-link': isReloading}" (click)="refreshAgents()"><i
    class="fa fa-refresh" [ngClass]="{'fa-spin': isReloading}"></i></a>
  @if (obj.agent || agentName.invalid && (agentName.dirty || agentName.touched)) {
    <div class="text-danger help-block">
      @if ((agentName.errors && agentName.errors.required) || obj.agent) {
        <div translate>common.message.requiredError</div>
      }
    </div>
  }
</div>
