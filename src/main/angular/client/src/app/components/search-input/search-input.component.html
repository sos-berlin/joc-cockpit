<div class="pos-rel">
  <nz-input-group class="pos-abt" style="z-index: 1;">
    <input #changeFocusInput (blur)="closeDropdown($event)" (input)="onSearchInput($event.target.value); handleSelectionChange($event)"
           [ngClass]="{'b-t-0' : !isDisplay}" [value]="obj.name" class="form-control white"
           id="changeFocus" nz-input placeholder="{{'common.placeholder.search' | translate}}" type="text"/>
  </nz-input-group>
  <nz-tree-select (nzExpandChange)="onExpand($event)" (nzOpenChange)="onDropdownOpenChange($event)" [nzAllowClear]="true" [nzDropdownStyle]="{ 'max-height': '300px' }"
                  [nzNodes]="nodes" [nzShowExpand]="false"
                  nzNoAnimation>
    <ng-template #nzTreeTemplate let-node>
      <div class="node-wrapper w-full">
        @if ((node.origin.loading || (!node.origin.type && !node.origin.objectType)) && type != 'TAG') {
          <span (click)="openFolder(node);$event.stopPropagation()"
                [class.toggle-children-wrapper-collapsed]="!node.isExpanded"
                [class.toggle-children-wrapper-expanded]="node.isExpanded"
                [ngClass]="{'m-l-0': node.origin.path === '/'}" class="cursor w-14 m-l-xxs m-t-n-1">
            @if (!node.isExpanded && !node.origin.loading) {
              <i nz-icon nzTheme="outline" nzType="caret-right"></i>
            }
            @if (node.isExpanded && !node.origin.loading) {
              <i nz-icon nzTheme="outline" nzType="caret-down"></i>
            }
            @if (node.origin.loading) {
              <i><nz-spin [nzSize]="'small'" nzSimple></nz-spin></i>
            }
          </span>
        }
        @if (!node.origin.loading && node.origin.type) {
          <span class="w-16">
            <span class="fa fa-lg p-r-sm"></span>
          </span>
        }
        <div (click)="loadData(node, $event);"
             [class.node-content-wrapper-active]="(list && (list.includes(node.origin.name) || list.includes(node.origin.path)))"
             [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="node.origin.path?.substring(0, node.origin.path?.lastIndexOf('/')) || '/'" class="node-content-wrapper p-l-xs w-full"
             nzTooltipPlacement="right">
          @if (!node.origin.type && !node.origin.objectType && type != 'TAG') {
            <i [nzType]="node.isExpanded ? 'folder-open' : 'folder'"
               class="w-14" nz-icon></i>
          }
          @if (node.origin.type || node.origin.objectType) {
            <i [ngClass]="{'p-l-xs': node.origin.objectType}"
               class="fa fa-circle-o text-xs w-11 m-t-xs"></i>
          }
          @if (type == 'TAG') {
            <i nz-icon nzType="tag" nzTheme="outline"
               class="text-xs w-11 m-t-xs"></i>
          }
          <span class="p-l-sm">{{node.origin.name}}</span>
          @if (addFolderPossible && !node.origin.type && !node.origin.objectType && folders[pathAttribute]?.indexOf(node.origin.path) === -1) {
            <i (click)="addFolder(node.origin.path);$event.stopPropagation()"
              [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'user.button.addFolder' | translate" [nzType]="'plus'" class="p-l-sm" nz-icon></i>
          }
          @if (addFolderPossible && !node.origin.type && !node.origin.objectType && folders[pathAttribute]?.indexOf(node.origin.path) > -1) {
            <i (click)="remove(node.origin.path);$event.stopPropagation()"
              [nzType]="'delete'" class="p-l-sm" nz-icon></i>
          }
        </div>
      </div>
    </ng-template>
  </nz-tree-select>
</div>
