<div class="modal-header">
  <h4 class="modal-title">
    <span translate>dailyPlan.label.setStartTime</span>
    <span *ngIf="(order || plan) && !orders">:</span>
    <i *ngIf="order" class="text-muted p-l-xs text">{{order.orderId}}</i>
    <i *ngIf="plan" class="text-muted p-l-xs text">{{plan.key}}</i>
  </h4>
  <button (click)="cancel()" aria-label="Close" class="close" type="button">
    <span aria-hidden="true" class="fa fa-times-circle"></span>
  </button>
</div>
<form #myForm="ngForm" (ngSubmit)="onSubmit()">
  <div class="modal-body p-a">
    <div [ngClass]="{'show': display}" class="hide">
      <app-audit-log-input [comments]="comments" [sizeX]="3" [sizeY]="6"></app-audit-log-input>
    </div>
    <div class="row">
      <div class="col-sm-12">
        <div *ngIf="(plan && !errorMsg) || orders" class="form-group row">
          <div class="col-md-12 font14">
            <span *ngIf="n2 === 0" [translateParams]="{n1}" translate>dailyPlan.popup.modifyOrdersCount</span>
            <span *ngIf="n2>0" [translateParams]="{n1, n2}" translate>dailyPlan.popup.modifyCyclicOrdersCount</span>
          </div>
        </div>
        <div *ngIf="order && order.orderId" class="form-group row">
          <label class="col-md-3" translate>dailyPlan.label.plannedStart</label>
          <div class="col-md-9">
            <span *ngIf="order.plannedStartTime">{{order.plannedStartTime}}</span>
            <span *ngIf="!order.plannedStartTime && !order.scheduledNever">{{order.scheduledFor | stringToDate}}</span>
          </div>
        </div>
        <div *ngIf="plan && !errorMsg" class="form-group row">
          <label class="col-md-3" translate>dailyPlan.label.plannedStart</label>
          <div class="col-md-9">
            <span
              *ngIf="plan.value.length ==1 && plan.value[0].plannedStartTime">{{plan.value[0].plannedStartTime}}</span>
            <span *ngIf="plan.value.length > 1" [translateParams]="{n1}" translate>dailyPlan.popup.differentModifyStartTime</span>
          </div>
        </div>
        <ng-container *ngIf="order && !order.cyclicOrder">
          <div class="form-group row">
            <label class="col-md-3 " translate>order.label.ignoreAdmissionTimes</label>
            <div class="col-md-8">
              <label [(ngModel)]="dateType.forceJobAdmission" name="ignoreAdmissionTimes" nz-checkbox>
              </label>
            </div>
          </div>
          <div class="form-group row">
            <label class="col-md-3" translate>common.label.startTime</label>
            <div class="col-md-9">
              <nz-radio-group [(ngModel)]="dateType.at" name="at">
                <label nz-radio nzValue="now"><span translate>common.label.now</span></label>
                <label nz-radio nzValue="date"><span translate>common.label.specificDate</span></label>
                <label nz-radio nzValue="later"><span translate>common.label.relativeDate</span></label>
                <label *ngIf="!isDailyPlan" nz-radio nzValue="never"><span translate>common.label.never</span></label>
              </nz-radio-group>
            </div>
          </div>
          <div *ngIf="dateType.at == 'later'" class="form-group row">
            <label class="col-md-3 form-control-label" translate>common.label.time
              <sup class="text-danger text-sm">*</sup>
            </label>
            <div [ngClass]="{ 'has-error' : (time.dirty || time.touched) && time.invalid}" class="col-sm-6">
              <input #time="ngModel" [(ngModel)]="order.atTime" class="form-control" name="atTime" placeholder="{{'common.placeholder.enterSecond' | translate}}"
                     required type="text"
                     validTimeReqex>
              <div *ngIf="time.errors && (time.dirty || time.touched)" class="help-block text-danger">
                <div *ngIf="!time.valid" translate>common.message.invalid</div>
              </div>
            </div>
          </div>
          <div *ngIf="dateType.at == 'date'" class="form-group row">
            <label class="col-md-3 form-control-label" translate>workflow.label.enterDateAndTime
              <sup class="text-danger text-sm">*</sup>
            </label>
            <div [ngClass]="{ 'has-error' : (((from.dirty || from.touched) && from.invalid))}" class="col-sm-6">
              <nz-date-picker #from="ngModel" [(ngModel)]="order.fromDate" [nzDisabledDate]="disabledDate"
                              [nzFormat]="dateFormat" [nzPlaceHolder]="dateFormat | uppercase"
                              name="from"
                              required></nz-date-picker>
              <div *ngIf="from.invalid && (from.dirty || from.touched)" class="text-danger help-block">
                <div *ngIf="from.errors.required">
                  <div translate>common.message.requiredError</div>
                </div>
              </div>
              <div [ngClass]="{ 'has-error' : (((fromTime.dirty || fromTime.touched) && fromTime.invalid))}"
                   class="time-picker">
                <input #fromTime="ngModel" (ngModelChange)="selectTime(order.fromTime, true)" [(ngModel)]="order.fromTime" [disabled]="!order.fromDate" class="form-control"
                       name="fromTime"
                       placeholder="HH:MM:SS" timevalidator type="text"
                       validTimeReqex>
                <nz-time-picker (ngModelChange)="selectTime($event)" [(ngModel)]="order.fromTime1"
                                [nzAllowEmpty]="false" name="fromTimeIcon"></nz-time-picker>
              </div>
            </div>
          </div>
        </ng-container>
        <ng-container *ngIf="order && order.cyclicOrder">
          <div class="form-group row">
            <label class="col-md-3 " translate>order.label.ignoreAdmissionTimes</label>
            <div class="col-md-8">
              <label [(ngModel)]="order.forceJobAdmission" name="ignoreAdmissionTimes" nz-checkbox>
              </label>
            </div>
          </div>
          <div class="form-group row">
            <label class="col-md-3 form-control-label" translate>runtime.label.repeatTime
              <sup class="text-danger text-sm">*</sup>
            </label>
            <div [ngClass]="{ 'has-error' : (((repeat.dirty || repeat.touched) && repeat.invalid))}" class="col-md-2">
              <input #repeat="ngModel" [(ngModel)]="period.repeat" class="form-control" maxlength="8" name="repeat" placeholder="HH:MM:SS"
                     required
                     timevalidator
                     type="text" validTimeReqex>
            </div>
          </div>
          <div class="form-group row">
            <label class="col-md-3 form-control-label" translate>runtime.label.begin
              <sup class="text-danger text-sm">*</sup>
            </label>
            <div [ngClass]="{'has-error': (begin.dirty || begin.touched) && begin.invalid}" class="col-md-2">
              <input #begin="ngModel" [(ngModel)]="period.begin" class="form-control" maxlength="8" name="begin" placeholder="HH:MM:SS"
                     required
                     timevalidator
                     type="text" validTimeReqex>
            </div>
            <label class="col-md-2 form-control-label text-right" translate>runtime.label.end
              <sup class="text-danger text-sm">*</sup>
            </label>
            <div [ngClass]="{'has-error': (end.dirty || end.touched) && end.invalid}" class="col-md-2">
              <input #end="ngModel" [(ngModel)]="period.end" class="form-control" maxlength="8" name="end" placeholder="HH:MM:SS" required
                     timevalidator
                     type="text" validTimeReqex>
            </div>
          </div>
        </ng-container>
        <div *ngIf="errorMsg" class="form-group row">
          <div [translateParams]="{n1, n2}" class="col-md-12 text-center p-a" translate>
            dailyPlan.popup.cannotModifyStartTime
          </div>
        </div>
        <div *ngIf="!errorMsg" [hidden]="!(dateType.at =='date')" class="form-group row">
          <div class="col-md-3 form-control-label" translate>common.label.timeZone</div>
          <div class="col-sm-6">
            <nz-select [(ngModel)]="dateType.timeZone" name="timeZone" nzAllowClear nzShowSearch>
              <nz-option *ngFor="let zone of zones" [nzLabel]="zone" [nzValue]="zone"></nz-option>
            </nz-select>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button *ngIf="order" [disabled]="!myForm.form.valid || submitted || (required && !comments.comment)" class="btn btn-primary btn-sm"
            type="submit">
      <i *ngIf="submitted" class="fa fa-spin fa-spinner p-r-xs"></i>
      {{'common.button.submit' | translate}}
    </button>
    <button (click)="cancel()" class="btn btn-grey btn-sm" translate type="button">
      common.button.cancel
    </button>
  </div>
</form>
