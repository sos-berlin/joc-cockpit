<div class="modal-header">
  <div class="header-content">
    <h4 class="modal-title">{{ title || 'Help' }}</h4>

    <div class="header-search">
      @if (showSearchBar) {
        <div class="help-search-bar-inline">
          <div class="search-input-wrapper m-r-1">
            <i class="fa fa-search search-icon"></i>
            <input
              id="help-search-input"
              type="text"
              class="form-control form-control-sm"
              [(ngModel)]="searchText"
              (ngModelChange)="performSearch()"
              (keydown)="handleSearchKeyDown($event)"
              [placeholder]="'helpSearch.placeholder' | translate"
              autocomplete="off"
            />
            <span class="search-status">{{ getSearchStatus() }}</span>
          </div>

          <div class="search-controls-inline">
            <button
              type="button"
              class="btn btn-sm btn-icon"
              (click)="findPrevious()"
              [disabled]="totalMatches === 0"
              [title]="'helpSearch.tooltip.previous' | translate"
            >
              <i class="fa fa-chevron-up"></i>
            </button>

            <button
              type="button"
              class="btn btn-sm btn-icon"
              (click)="findNext()"
              [disabled]="totalMatches === 0"
              [title]="'helpSearch.tooltip.next' | translate"
            >
              <i class="fa fa-chevron-down"></i>
            </button>

            <label class="search-option" [title]="'helpSearch.tooltip.matchCase' | translate">
              <input
                type="checkbox"
                [(ngModel)]="searchCaseSensitive"
                (ngModelChange)="performSearch()"
              />
              <span>Aa</span>
            </label>

            <label class="search-option" [title]="'helpSearch.tooltip.wholeWord' | translate">
              <input
                type="checkbox"
                [(ngModel)]="searchWholeWord"
                (ngModelChange)="performSearch()"
              />
              <span>Ab|</span>
            </label>

            <button
              type="button"
              class="btn btn-sm btn-icon"
              (click)="toggleSearchBar()"
              [title]="'helpSearch.tooltip.close' | translate"
            >
              <i class="fa fa-times"></i>
            </button>
          </div>
        </div>
      } @else {
        <button
          type="button"
          class="btn btn-sm btn-grey"
          (click)="toggleSearchBar()"
          [title]="'helpSearch.tooltip.search' | translate"
        >
          <i class="fa fa-search"></i>&nbsp;
          <span translate>common.button.search</span>
        </button>
      }
    </div>
  </div>

  <button type="button" class="close" aria-label="Close" (click)="cancel()">
    <span aria-hidden="true" class="fa fa-times-circle"></span>
  </button>
</div>

<div class="modal-body p-a">
  <div class="help-content-wrapper">
    @if (isLoading) {
      <div class="col-md-12 text-center">
        <div class="loading-center text-primary text ht-260">
          <div><i class="fa fa-refresh fa-lg fa-spin"></i></div>
        </div>
      </div>
    }
    @if (!hasError) {
      <ng-container>
        @if (!isLoading) {
          <div [innerHTML]="html" class="help-md"></div>

          @if (showValidationResults) {
            <div class="link-validation-results" style="margin-top: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 4px;">
              <h4>Link Validation Results</h4>
              <div style="margin-bottom: 10px;">
                <strong>Total Links:</strong> {{ linkValidationResults.length }} |
                <strong style="color: green;">Valid:</strong> {{ getValidLinks().length }} |
                <strong style="color: red;">Broken:</strong> {{ getBrokenLinks().length }}
              </div>

              @if (getBrokenLinks().length > 0) {
                <div style="margin-top: 15px;">
                  <h5 style="color: red;">Broken Links:</h5>
                  <ul style="list-style: none; padding-left: 0;">
                    @for (link of getBrokenLinks(); track link.url) {
                      <li style="padding: 5px; border-bottom: 1px solid #eee;">
                        <span [class]="link.type === 'internal' ? 'badge badge-warning' : 'badge badge-danger'">
                          {{ link.type }}
                        </span>
                        <code style="margin-left: 10px; color: red;">{{ link.url }}</code>
                      </li>
                    }
                  </ul>
                </div>
              }
            </div>
          }
        }
      </ng-container>
    } @else {
      <nz-result nzStatus="404" nzTitle="404" nzSubTitle="{{ 'common.message.noHelpData' | translate}}">
      </nz-result>
    }
  </div>
</div>
<div class="modal-footer">

  @if (history.length > 0) {
    <button type="button" class="btn btn-grey btn-sm" (click)="goBack()">
      <span translate>common.button.back</span>
    </button>
  }

  @if(isValidate){
    <button
      type="button"
      class="btn btn-primary btn-sm"
      (click)="validateLinks()"
      [disabled]="isValidatingLinks || isLoading"
      style="margin-right: 10px;">
      @if (isValidatingLinks) {
        <i class="fa fa-spinner fa-spin"></i> Validating...
      } @else {
        <i class="fa fa-check-circle"></i> Validate Links
      }
    </button>
  }

  <button type="button" class="btn btn-grey btn-sm" (click)="cancel()">
    <span translate>common.button.close</span>
  </button>

  @if (fallbackNotice) {
    <small class="text-muted m-l" style="white-space: nowrap;">
      {{ fallbackNotice }}
    </small>
  }
</div>
