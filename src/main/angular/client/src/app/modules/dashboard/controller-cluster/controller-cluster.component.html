<div id="controllerClusterStatus1">
  <div class="box-header b-b remove">
    <h3>
      @if (selectedController.role && selectedController.role !== 'STANDALONE') {
        <span translate>dashboard.label.productStatus</span>
      }
      @if (selectedController.role === 'STANDALONE' || !selectedController.role) {
        <span translate>dashboard.label.productStatus</span>
      }
      @if (preferences.showHelpPages) {
        <span><i (click)="helpPage()" [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'common.tooltip.help' | translate" class="help-info-dashboard cur-point fa fa-info-circle text-20"></i></span>
      }
    </h3>
  </div>
  <div [hidden]="!isLoaded || !clusterStatusData" [ngStyle]="{'height': (clusterStatusData ? (ybody * 55 + ((ybody -1) *20 -50)) : 0)+'px'}"
       class="box-body overflow-y">
    <div [ngStyle]="{'height':(ybody * 55 + ((ybody -1) *20 -80)) +'px'}" id="clusterStatus"></div>
    <nz-dropdown-menu #menu="nzDropdownMenu">
      <ul nz-menu>
        @if (permission.currentController && permission.currentController.terminate && controller && controller.role !== 'STANDALONE' && controller.clusterNodeState._text === 'active') {
          <li nz-submenu nzTitle="{{'dashboard.button.terminate' | translate}}">
            <ul>
              <li (click)="clusterAction('terminate', controller,true)" [nzDisabled]="!controller.isCoupled"
                  nz-menu-item>
                <a translate>dashboard.button.withSwitchover</a>
              </li>
              <li (click)="clusterAction('terminate', controller,false)" nz-menu-item>
                <a translate>dashboard.button.withOutSwitchover</a>
              </li>
            </ul>
          </li>
        }
        @if (permission.currentController && permission.currentController.restart && permission.currentController.terminate && controller && controller.role !== 'STANDALONE' && controller.clusterNodeState._text === 'active') {
          <li nz-submenu nzTitle="{{'dashboard.button.terminateAndRestart' | translate}}">
            <ul>
              <li (click)="clusterAction('terminateAndRestart', controller,true)" [nzDisabled]="!controller.isCoupled"
                  nz-menu-item>
                <a translate>dashboard.button.withSwitchover</a>
              </li>
              <li (click)="clusterAction('terminateAndRestart', controller,false)" nz-menu-item>
                <a translate>dashboard.button.withOutSwitchover</a>
              </li>
            </ul>
          </li>
        }
        @if (permission.currentController && permission.currentController.terminate && controller && controller.role !== 'STANDALONE' && controller.clusterNodeState._text === 'active') {
          <li nz-submenu nzTitle="{{'dashboard.button.abort' | translate}}">
            <ul>
              <li (click)="clusterAction('abort', controller,true)" [nzDisabled]="!controller.isCoupled"
                  nz-menu-item>
                <a translate>dashboard.button.withFailover</a>
              </li>
            </ul>
          </li>
        }
        @if (permission.currentController && permission.currentController.restart && permission.currentController.terminate && controller && controller.role !== 'STANDALONE' && controller.clusterNodeState._text === 'active') {
          <li nz-submenu nzTitle="{{'dashboard.button.abortAndRestart' | translate}}">
            <ul>
              <li (click)="clusterAction('abortAndRestart', controller,true)" [nzDisabled]="!controller.isCoupled"
                  nz-menu-item>
                <a translate>dashboard.button.withApplicableFailover</a>
              </li>
            </ul>
          </li>
        }
        @if (permission.currentController && permission.currentController.terminate && controller && (controller.role === 'STANDALONE' || controller.clusterNodeState._text !== 'active')) {
          <li (click)="clusterAction('terminate', controller,false)"
              [nzDisabled]="controller.componentState._text !== 'operational'"
              nz-menu-item>
            <a translate>dashboard.button.terminate</a>
          </li>
        }
        @if (permission.currentController && (permission.currentController.restart && permission.currentController.terminate) && controller && (controller.role === 'STANDALONE' || controller.clusterNodeState._text !== 'active')) {
          <li (click)="clusterAction('terminateAndRestart', controller,false)"
              [nzDisabled]="controller.componentState._text !== 'operational'"
              nz-menu-item>
            <a translate>dashboard.button.terminateAndRestart</a>
          </li>
        }
        @if (permission.currentController && permission.currentController.terminate && controller && (controller.role === 'STANDALONE' || controller.clusterNodeState._text !== 'active')) {
          <li (click)="clusterAction('abort', controller, false)"
              [nzDisabled]="controller.componentState._text !== 'operational'"
              nz-menu-item>
            <a translate>dashboard.button.abort</a>
          </li>
        }
        @if (permission.currentController && (permission.currentController.restart && permission.currentController.terminate) && controller && (controller.role === 'STANDALONE' || controller.clusterNodeState._text !== 'active')) {
          <li (click)="clusterAction('abortAndRestart', controller, false)"
              [nzDisabled]="controller && controller.componentState._text !== 'operational'"
              nz-menu-item>
            <a translate>dashboard.button.abortAndRestart</a>
          </li>
        }
        @if (controller && permission.currentController && permission.currentController.getLog) {
          <li (click)="clusterAction('download', controller, false)"
              [nzDisabled]="controller && controller.componentState._text !== 'operational'"
              nz-menu-item>
            <a translate>dashboard.button.downloadLog</a>
          </li>
        }
        @if (permission.currentController && permission.currentController.switchOver && cluster) {
          <li (click)="clusterAction('switchover',cluster, false)"
              [nzDisabled]="controller && controller.componentState._text !== 'operational'"
              nz-menu-item>
            <a>{{'dashboard.button.switchOver' | translate}}</a>
          </li>
        }
        @if (permission.currentController && permission.currentController.switchOver && cluster) {
          <li (click)="confirmLossNode()" [nzDisabled]="!clusterStatusData?.clusterState?.lossNode"
              nz-menu-item>
            <a translate>dashboard.button.confirmNodeLoss</a>
          </li>
        }
        @if (joc && joc.current && joc.clusterNodeState && joc.clusterNodeState._text == 'active' && permission.joc.cluster.manage) {
          <li (click)="restartService('cluster')" nz-menu-item>
            <a translate>dashboard.button.restartCluster</a>
          </li>
        }
        @if (joc && joc.current && (!joc.clusterNodeState || joc.clusterNodeState._text == 'active') && permission.joc.administration.controllers.manage) {
          <li nz-submenu nzTitle="{{'dashboard.button.restartService' | translate}}">
            <ul>
              <li (click)="restartService('cleanup')" nz-menu-item>
                <a>{{'dashboard.button.cleanupService' | translate}}</a>
              </li>
              <li (click)="restartService('dailyplan')" nz-menu-item>
                <a>{{'dashboard.button.dailyPlanService' | translate}}</a>
              </li>
              <li (click)="restartService('history')" nz-menu-item>
                <a>{{'dashboard.button.historyService' | translate}}</a>
              </li>
              <li (click)="restartService('lognotification')" nz-menu-item>
                <a>{{'dashboard.button.lognotification' | translate}}</a>
              </li>
              <li (click)="restartService('monitor')" nz-menu-item>
                <a>{{'dashboard.button.monitorService' | translate}}</a>
              </li>
              <li (click)="proxyService()" nz-menu-item>
                <a>{{'dashboard.button.proxyService' | translate}}</a>
              </li>
            </ul>
          </li>
        }
        @if (joc && joc.current && (!joc.clusterNodeState || joc.clusterNodeState._text == 'active') && permission.joc.administration.controllers.manage) {
          <li nz-submenu nzTitle="{{'dashboard.button.runService' | translate}}">
            <ul>
              <li (click)="runService('cleanup')" nz-menu-item>
                <a>{{'dashboard.button.cleanupService' | translate}}</a>
              </li>
              <li (click)="runService('dailyplan')" nz-menu-item>
                <a>{{'dashboard.button.dailyPlanService' | translate}}</a>
              </li>
            </ul>
          </li>
        }
        @if (joc && joc.clusterNodeState && joc.clusterNodeState._text !== 'active' && permission.joc && permission.joc.cluster.manage) {
          <li (click)="switchOver()" nz-menu-item>
            <a translate>dashboard.button.switchOver</a>
          </li>
        }
        @if (joc && !joc.current && joc.clusterNodeState._text !== 'active' && joc.componentState._text === 'unknown' && permission.joc && permission.joc.cluster.manage) {
          <li (click)="removeFromInventory()" nz-menu-item>
            <a translate>dashboard.button.removeFromInventory</a>
          </li>
        }
        @if (joc && permission.joc && permission.joc.administration.settings.manage) {
          <li (click)="updateURL()" nz-menu-item>
            <a translate>dashboard.button.updateURL</a>
          </li>
        }
        @if (joc && joc.current && permission.joc && permission.joc.getLog) {
          <li (click)="downloadJocLog()" nz-menu-item>
            <a translate>dashboard.button.downloadLog</a>
          </li>
        }
      </ul>
    </nz-dropdown-menu>
  </div>
  <div [ngClass]="{'show': !isLoaded}" class="hide text-center text-primary text p-t-140">
    <div><i class="fa fa-refresh fa-lg fa-spin"></i></div>
  </div>
  @if (isLoaded && !clusterStatusData) {
    <div [ngStyle]="{'height':(ybody * 55 + ((ybody -1) *20 -50)) +'px'}" class="vert-middle">
      <div>
        <app-empty-data></app-empty-data>
      </div>
    </div>
  }
</div>
