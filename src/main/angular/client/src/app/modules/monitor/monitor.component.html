<div class="white box-shadow sub-header">
  <div class="row">
    <div class="col-md-12">
      <div class="padding">
        <div class="text-right ">
          <div class="pull-left">
            <app-breadcrumbs></app-breadcrumbs>
          </div>
          <div class="inline valign">
            @if (monitorFilters.tabIndex == 0) {
              <label [(ngModel)]="monitorFilters.controller.current"
                     name="current" nz-checkbox  (nzCheckedChange)="controllerChange()" >
                {{'common.label.currentController' | translate}}
              </label>
            }
            @if (monitorFilters.tabIndex == 1) {
              <label [(ngModel)]="monitorFilters.agent.current"
                     name="current" nz-checkbox (nzCheckedChange)="controllerChange()" >
                {{'common.label.currentController' | translate}}
              </label>
            }
            @if (monitorFilters.tabIndex == 2 && monitorFilters.orderNotification.mapOfCheckedId.size ===0) {
              <label [(ngModel)]="monitorFilters.orderNotification.current" name="current"
                     nz-checkbox (nzCheckedChange)="controllerChange()">
                {{'common.label.currentController' | translate}}
              </label>
            }
          </div>
          @if (monitorFilters.tabIndex == 2 && monitorFilters.orderNotification.mapOfCheckedId.size ===0) {
            <div class="inline">
              <div class="btn-group m-l-12">
                <button (click)="changeTypes('SUCCESS')" [ngClass]="{'btn-primary': monitorFilters.orderNotification.filter.types.includes('SUCCESS')}"
                        class="btn btn-grey btn-sm"
                        translate>monitor.notification.button.success
                </button>
                <button (click)="changeTypes('ERROR')" [ngClass]="{'btn-primary': monitorFilters.orderNotification.filter.types.includes('ERROR')}"
                        class="btn btn-grey btn-sm"
                        translate>monitor.notification.button.error
                </button>
                <button (click)="changeTypes('WARNING')" [ngClass]="{'btn-primary': monitorFilters.orderNotification.filter.types.includes('WARNING')}"
                        class="btn btn-grey btn-sm"
                        translate>monitor.notification.button.warning
                </button>
                <button (click)="changeTypes('RECOVERED')" [ngClass]="{'btn-primary': monitorFilters.orderNotification.filter.types.includes('RECOVERED')}"
                        class="btn btn-grey btn-sm"
                        translate>monitor.notification.button.recovered
                </button>
                <button (click)="changeTypes('ACKNOWLEDGED')" [ngClass]="{'btn-primary': monitorFilters.orderNotification.filter.types.includes('ACKNOWLEDGED')}"
                        class="btn btn-grey btn-sm"
                        translate>monitor.notification.button.acknowledge
                </button>
              </div>
              <div class="btn-group m-l-12 hidden-btn-group">
                <button (click)="changeDate('ALL')" [ngClass]="{'btn-primary': monitorFilters.orderNotification.filter.date=='ALL'}"
                        class="btn btn-grey btn-sm" translate>
                  filters.button.all
                </button>
                <button (click)="changeDate('0d')" [ngClass]="{'btn-primary': monitorFilters.orderNotification.filter.date=='0d'}"
                        class="btn btn-grey btn-sm" translate>
                  filters.button.today
                </button>
                <button (click)="changeDate('-1h')" [ngClass]="{'btn-primary': monitorFilters.orderNotification.filter.date=='-1h'}"
                        class="btn btn-grey btn-sm" translate>
                  filters.button.last1
                </button>
                <button (click)="changeDate('-6h')" [ngClass]="{'btn-primary': monitorFilters.orderNotification.filter.date=='-6h'}"
                        class="btn btn-grey btn-sm" translate>
                  filters.button.last6
                </button>
                <button (click)="changeDate('-12h')" [ngClass]="{'btn-primary': monitorFilters.orderNotification.filter.date=='-12h'}"
                        class="btn btn-grey btn-sm" translate>
                  filters.button.last12
                </button>
              </div>
              <div class="btn-group dropdown hidden-dropdown">
                <button [nzDropdownMenu]="menu" [nzPlacement]="'bottomRight'" class="btn-drop btn btn-grey btn-sm m-l-12" nz-dropdown
                        nzTrigger="click" translate type="button">
                  common.label.anyDate
                  <i class="caretDownIcon" nz-icon nzTheme="outline" nzType="caret-down"></i>
                </button>
                <nz-dropdown-menu #menu="nzDropdownMenu">
                  <ul nz-menu>
                    <li [ngClass]="{'ant-select-dropdown-menu-item-active': monitorFilters.orderNotification.filter.date=='ALL'}"
                        nz-menu-item>
                      <a (click)="changeDate('ALL')" translate>filters.button.all</a>
                    </li>
                    <li [ngClass]="{'ant-select-dropdown-menu-item-active': monitorFilters.orderNotification.filter.date=='0d'}"
                        nz-menu-item>
                      <a (click)="changeDate('0d')" translate>filters.button.today</a>
                    </li>
                    <li [ngClass]="{'ant-select-dropdown-menu-item-active': monitorFilters.orderNotification.filter.date=='-1h'}"
                        nz-menu-item>
                      <a (click)="changeDate('-1h')" translate>filters.button.last1</a>
                    </li>
                    <li [ngClass]="{'ant-select-dropdown-menu-item-active': monitorFilters.orderNotification.filter.date=='-6h'}"
                        nz-menu-item>
                      <a (click)="changeDate('-6h')" translate>filters.button.last6</a>
                    </li>
                    <li [ngClass]="{'ant-select-dropdown-menu-item-active': monitorFilters.orderNotification.filter.date=='-12h'}"
                        nz-menu-item>
                      <a (click)="changeDate('-12h')" translate>filters.button.last12</a>
                    </li>
                  </ul>
                </nz-dropdown-menu>
              </div>
            </div>
          }
          @if (monitorFilters.tabIndex == 3 && monitorFilters.systemNotification.mapOfCheckedId.size ===0) {
            <div class="inline">
              <div class="btn-group m-l-12">
                <button (click)="changeCategories('ALL')" [ngClass]="{'btn-primary': monitorFilters.systemNotification.filter.categories == 'ALL'}"
                        class="btn btn-grey btn-sm"
                        translate>monitor.notification.button.all
                </button>
                <button (click)="changeCategories('SYSTEM')" [ngClass]="{'btn-primary': monitorFilters.systemNotification.filter.categories == 'SYSTEM'}"
                        class="btn btn-grey btn-sm"
                        translate>monitor.notification.button.system
                </button>
                <button (click)="changeCategories('JOC')" [ngClass]="{'btn-primary': monitorFilters.systemNotification.filter.categories == 'JOC'}"
                        class="btn btn-grey btn-sm"
                        translate>monitor.notification.button.joc
                </button>
                <button (click)="changeCategories('CONTROLLER')" [ngClass]="{'btn-primary': monitorFilters.systemNotification.filter.categories == 'CONTROLLER'}"
                        class="btn btn-grey btn-sm"
                        translate>monitor.notification.button.controller
                </button>
                <button (click)="changeCategories('AGENT')" [ngClass]="{'btn-primary': monitorFilters.systemNotification.filter.categories == 'AGENT'}"
                        class="btn btn-grey btn-sm"
                        translate>monitor.notification.button.agent
                </button>
              </div>
            </div>
          }
          @if (monitorFilters.tabIndex == 3 && monitorFilters.systemNotification.mapOfCheckedId.size ===0) {
            <div class="inline">
              <div class="btn-group m-l-12">
                <button (click)="changeSystemType('ERROR')" [ngClass]="{'btn-primary': monitorFilters.systemNotification.filter.types.includes('ERROR')}"
                        class="btn btn-grey btn-sm"
                        translate>monitor.notification.button.error
                </button>
                <button (click)="changeSystemType('WARNING')" [ngClass]="{'btn-primary': monitorFilters.systemNotification.filter.types.includes('WARNING')}"
                        class="btn btn-grey btn-sm"
                        translate>monitor.notification.button.warning
                </button>
                <button (click)="changeSystemType('ACKNOWLEDGED')" [ngClass]="{'btn-primary': monitorFilters.systemNotification.filter.types.includes('ACKNOWLEDGED')}"
                        class="btn btn-grey btn-sm"
                        translate>monitor.notification.button.acknowledge
                </button>
              </div>
              <div class="btn-group m-l-12 hidden-btn-group">
                <button (click)="changeDate('ALL')" [ngClass]="{'btn-primary': monitorFilters.systemNotification.filter.date=='ALL'}"
                        class="btn btn-grey btn-sm" translate>
                  filters.button.all
                </button>
                <button (click)="changeDate('0d')" [ngClass]="{'btn-primary': monitorFilters.systemNotification.filter.date=='0d'}"
                        class="btn btn-grey btn-sm" translate>
                  filters.button.today
                </button>
                <button (click)="changeDate('-1h')" [ngClass]="{'btn-primary': monitorFilters.systemNotification.filter.date=='-1h'}"
                        class="btn btn-grey btn-sm" translate>
                  filters.button.last1
                </button>
                <button (click)="changeDate('-6h')" [ngClass]="{'btn-primary': monitorFilters.systemNotification.filter.date=='-6h'}"
                        class="btn btn-grey btn-sm" translate>
                  filters.button.last6
                </button>
                <button (click)="changeDate('-12h')" [ngClass]="{'btn-primary': monitorFilters.systemNotification.filter.date=='-12h'}"
                        class="btn btn-grey btn-sm" translate>
                  filters.button.last12
                </button>
              </div>
              <div class="btn-group dropdown hidden-dropdown">
                <button [nzDropdownMenu]="menu" [nzPlacement]="'bottomRight'" class="btn-drop btn btn-grey btn-sm m-l-12" nz-dropdown
                        nzTrigger="click" translate type="button">
                  common.label.anyDate
                  <i class="caretDownIcon" nz-icon nzTheme="outline" nzType="caret-down"></i>
                </button>
                <nz-dropdown-menu #menu="nzDropdownMenu">
                  <ul nz-menu>
                    <li [ngClass]="{'ant-select-dropdown-menu-item-active': monitorFilters.systemNotification.filter.date=='ALL'}"
                        nz-menu-item>
                      <a (click)="changeDate('ALL')" translate>filters.button.all</a>
                    </li>
                    <li [ngClass]="{'ant-select-dropdown-menu-item-active': monitorFilters.systemNotification.filter.date=='0d'}"
                        nz-menu-item>
                      <a (click)="changeDate('0d')" translate>filters.button.today</a>
                    </li>
                    <li [ngClass]="{'ant-select-dropdown-menu-item-active': monitorFilters.systemNotification.filter.date=='-1h'}"
                        nz-menu-item>
                      <a (click)="changeDate('-1h')" translate>filters.button.last1</a>
                    </li>
                    <li [ngClass]="{'ant-select-dropdown-menu-item-active': monitorFilters.systemNotification.filter.date=='-6h'}"
                        nz-menu-item>
                      <a (click)="changeDate('-6h')" translate>filters.button.last6</a>
                    </li>
                    <li [ngClass]="{'ant-select-dropdown-menu-item-active': monitorFilters.systemNotification.filter.date=='-12h'}"
                        nz-menu-item>
                      <a (click)="changeDate('-12h')" translate>filters.button.last12</a>
                    </li>
                  </ul>
                </nz-dropdown-menu>
              </div>
            </div>
          }
          @if (monitorFilters.tabIndex == 2 && monitorFilters.orderNotification.mapOfCheckedId.size > 0) {
            <div class="inline">
              <button (click)="acknowledge()" class="btn btn-grey btn-sm" translate>
                monitor.notification.menu.bulkAcknowledge
              </button>
            </div>
          }
          @if (monitorFilters.tabIndex == 3 && monitorFilters.systemNotification.mapOfCheckedId.size > 0) {
            <div class="inline">
              <button (click)="acknowledge()" class="btn btn-grey btn-sm" translate>
                monitor.notification.menu.bulkAcknowledge
              </button>
            </div>
          }
          @if (monitorFilters.tabIndex == 2 || monitorFilters.tabIndex == 3) {
            <button (click)="exportToExcel()"
                    [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'common.tooltip.exportInXLS' | translate"
                    class="btn btn-grey btn-sm m-l-12"><i class="fa fa fa-share-square-o"></i></button>
          }
        </div>
      </div>
    </div>
  </div>
</div>
<div class="scroll-y max-ht">
  @if (loading) {
    <div class="padding p-b-0">
      <nz-tabset (nzSelectChange)="tabChange($event)" [(nzSelectedIndex)]="index">
        @if (permission && permission.currentController && permission.currentController.view) {
          <nz-tab [nzTitle]="'monitor.label.controllerAvailability' | translate">
            @if (index === 0) {
              <div>
                <app-controller-monitor [filters]="monitorFilters.controller" [permission]="permission"
                                        [preferences]="preferences"
                                        [schedulerIds]="schedulerIds"></app-controller-monitor>
              </div>
            }
          </nz-tab>
        }
        @if (permission && permission.currentController && permission.currentController.agents.view) {
          <nz-tab [nzTitle]="'monitor.label.agentAvailability' | translate">
            @if (index === 1 || (!permission.currentController.view && index === 0)) {
              <div>
                <app-agent-monitor [filters]="monitorFilters.agent" [permission]="permission"
                                   [preferences]="preferences" [schedulerIds]="schedulerIds"></app-agent-monitor>
              </div>
            }
          </nz-tab>
        }
        @if (permission && permission.currentController && permission.currentController.orders.view) {
          <nz-tab [nzTitle]="'monitor.label.orderNotification' | translate">
            @if (index === 2 || (!permission.currentController.view && permission.currentController.agents.view && index === 1) || (!permission.currentController.agents.view && permission.currentController.view && index === 1) ||
            (!permission.currentController.view && !permission.currentController.agents.view && index === 0)) {
              <div>
                <app-order-notification [filters]="monitorFilters.orderNotification" [permission]="permission"
                                        [preferences]="preferences"
                                        [schedulerIds]="schedulerIds"></app-order-notification>
              </div>
            }
          </nz-tab>
        }
        @if (permission && permission.currentController && permission.currentController.orders.view) {
          <nz-tab [nzTitle]="'monitor.label.systemNotification' | translate">
            @if (index === 3 || (!permission.currentController.view && permission.currentController.agents.view && index === 1) || (!permission.currentController.agents.view && permission.currentController.view && index === 1) ||
            (!permission.currentController.view && !permission.currentController.agents.view && index === 0)) {
              <div>
                <app-system-notification [filters]="monitorFilters.systemNotification" [permission]="permission"
                                         [preferences]="preferences"></app-system-notification>
              </div>
            }
          </nz-tab>
        }
      </nz-tabset>
    </div>
  }
  @if (!loading) {
    <div class="text-center m-t-lg m-b-md">
      <nz-spin nzSimple></nz-spin>
    </div>
  }
</div>
