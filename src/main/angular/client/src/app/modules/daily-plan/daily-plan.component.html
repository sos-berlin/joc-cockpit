<div *ngIf="isProcessing" class="operation-status-info">
  <div id='prog-bar-cont'>
    <div id="prog-bar">
      <div id="background"></div>
    </div>
  </div>
</div>
<ng-template #orderTemplate let-order let-plan="plan">
  <ng-container *ngFor="let value of order">
    <ng-template #tooltipTemplate>
      <div *ngIf="value.cyclicOrder" class="m-a-sm">
        <div class="_600 m-b-xs" translate>dailyPlan.label.cyclicOrder</div>
        <span class="_600 p-l-sm" translate>dailyPlan.label.begin</span>:
        {{value.cyclicOrder.firstStart | stringToDate}}
        <br>
        <span class="_600 p-l-sm" translate>dailyPlan.label.end</span>:
        {{value.cyclicOrder.lastStart | stringToDate}}
        <br>
        <span class="_600 p-l-sm" translate>order.label.orders</span>:
        {{value.cyclicOrder.count}}
      </div>
    </ng-template>
    <tr>
      <td [nzChecked]="object.mapOfCheckedId.has(value.orderId)"
          (nzCheckedChange)="onItemChecked(value, plan, $event)"
          [nzShowCheckbox]="true">
      </td>
      <td>
        <div class="btn-group dropdown">
          <button (nzVisibleChange)="change($event)" [nzDisabled]="object.checked || object.indeterminate"
                  [nzDropdownMenu]="export5" class="btn-drop more-option-h"
                  nz-dropdown nzTrigger="click" type="button">
            <i class="fa fa-ellipsis-h"></i>
          </button>
          <nz-dropdown-menu #export5="nzDropdownMenu" role="menu">
            <ul *ngIf="permission.currentController" nz-menu>
              <li (click)="continueOrder(value.orderId)" *ngIf="permission && permission.currentController && permission.currentController.orders.modify && value.state._text === 'SUBMITTED' && !value.cyclicOrder"
                  nz-menu-item>
                <a>{{'dailyPlan.button.continueOrder' | translate}} ..</a>
              </li>
              <li (click)="submitOrder(value, false)" *ngIf="permission.currentController && permission.currentController.orders.create"
                  [nzDisabled]="value.state && (value.state._text === 'FINISHED' || value.state._text === 'SUBMITTED')"
                  nz-menu-item>
                <a>{{'dailyPlan.button.submitOrder' | translate}} ..</a>
              </li>
              <li (click)="removeOrder(value, false)" *ngIf="permission.currentController.orders.cancel" [nzDisabled]="value.state && (value.state._text === 'FINISHED' || value.state._text === 'SUBMITTED')"
                  class="bg-hover-color"
                  nz-menu-item>
                <a>{{'dailyPlan.button.removeOrder' | translate}} ..</a>
              </li>
              <li (click)="cancelOrder(value, null )" *ngIf="permission.currentController && permission.currentController.orders.cancel"
                  [nzDisabled]="value.state && (value.state._text === 'FINISHED' || value.state._text === 'PLANNED')"
                  nz-menu-item>
                <a translate>dailyPlan.button.cancel</a>
              </li>
              <li (click)="modifyOrder(value, null)" *ngIf="permission.currentController.orders.modify"
                  [nzDisabled]="(value.state && value.state._text === 'FINISHED')"
                  nz-menu-item>
                <a>{{'dailyPlan.button.setStartTime' | translate}} ..</a>
              </li>
              <li (click)="changeParameter(null, value)" *ngIf="permission.currentController.orders.modify"
                  [nzDisabled]="value.state && value.state._text === 'FINISHED'"
                  nz-menu-item>
                <a translate>{{'dailyPlan.button.setParameters' | translate}} ..</a>
              </li>
              <li (click)="copyOrder(value, null)" *ngIf="permission.currentController.orders.modify"
                  nz-menu-item>
                <a translate>{{'common.button.copy' | translate}} ..</a>
              </li>
              <li (click)="coreService.copyArguments(value, 'variables', message)" nz-menu-item [nzDisabled]="!value.variables || value.variables?.length == 0">
                <a translate>common.button.copyArguments</a>
              </li>
              <li nz-menu-divider></li>
              <li (click)="coreService.copyLink('order',value.orderId, value.workflowPath)" [nzDisabled]="value.state && value.state._text !== 'FINISHED'"
                  nz-menu-item>
                <a translate>common.button.copyLinkToObject</a>
              </li>
              <li (click)="copyOrderId(value.orderId)" nz-menu-item>
                <a translate>common.button.copyOrderId</a>
              </li>
            </ul>
          </nz-dropdown-menu>
        </div>
      </td>
      <td>
        <span [ngClass]="dailyPlanFilters.filter.groupBy === '' ? '' :  'p-l-sm'" class="show-in-single-line">
          <i (click)="addDetailsOfOrder(value)" *ngIf="!value.show"
             aria-hidden="true"
             class="fa fa-caret-down cursor fa-lg p-r-xs"></i>
          <i (click)="addDetailsOfOrder(value)" *ngIf="value.show"
             aria-hidden="true" class="fa fa-caret-up cursor fa-lg p-r-xs"></i>
          <span *ngIf="value.state && (value.state._text !== 'FINISHED')"
                [innerHtml]="coreService.getModifiedOrderId(value, dailyPlanFilters.searchText)"></span>
          <a (click)="navToOrderHistory(value)"
             *ngIf="value.state && (value.state._text === 'FINISHED')"
             [innerHtml]="coreService.getModifiedOrderId(value, dailyPlanFilters.searchText)" class="text-hover-primary">
          </a>
          <i *ngIf="value.cyclicOrder" [nzTooltipPlacement]="'left'" [nzTooltipTitle]="tooltipTemplate" aria-hidden="true"
             class="fa fa-repeat p-l-xs" nz-tooltip></i>
        </span>
      </td>
      <td *ngIf="dailyPlanFilters.filter.groupBy === ''">
        <span class="show-in-single-line">
          <i (click)="coreService.navToInventoryTab(value?.schedulePath, 'SCHEDULE');"
             *ngIf="permission.joc && permission.joc.inventory.view"
             class="cursor fa fa-pencil text-hover-primary p-r-xs"></i>
          <span *ngIf="isPathDisplay" [innerHtml]="value?.schedulePath | highlight : dailyPlanFilters.searchText"></span>
          <span *ngIf="!isPathDisplay" [innerHtml]="value?.schedulePath.substring(value?.schedulePath.lastIndexOf('/') + 1) | highlight : dailyPlanFilters.searchText"></span>
        </span>
      </td>
      <td *ngIf="dailyPlanFilters.filter.groupBy !== 'WORKFLOW'">
         <span class="show-in-single-line">
          <i (click)="coreService.navToInventoryTab(value.workflowPath, 'WORKFLOW');"
             *ngIf="permission.joc && permission.joc.inventory.view"
             class="cursor fa fa-pencil text-hover-primary p-r-xs"></i>
          <a *ngIf="isPathDisplay" (click)="coreService.showWorkflow(value?.workflowPath);"
             [innerHtml]="value?.workflowPath | highlight : dailyPlanFilters.searchText"
             class="text-hover-primary"></a>
           <a *ngIf="!isPathDisplay" (click)="coreService.showWorkflow(value?.workflowPath);"
              [innerHtml]="value?.workflowPath.substring(value?.workflowPath.lastIndexOf('/') + 1) | highlight : dailyPlanFilters.searchText"
              class="text-hover-primary"></a>
          <span
            *ngIf="workflowTagsPerWorkflow && value?.workflowPath && workflowTagsPerWorkflow[getLastPartOfWorkflow(value.workflowPath)]?.length > 0"
            [innerHtml]="coreService.getModifiedWorkflowTags(workflowTagsPerWorkflow[getLastPartOfWorkflow(value.workflowPath)], dailyPlanFilters.searchText)"
            class="m-l-sm">
          </span>

         </span>
      </td>
      <td class="combine-two-label" nowrap>
        <span *ngIf="value.state" [innerHtml]="value.state._text | translate  | highlight : dailyPlanFilters.searchText"
              [ngClass]="[coreService.getColor(value.state.severity, 'bg'),value.marked ? 'label1' : '']"
              class="label"></span>
        <span *ngIf="value.marked" [innerHtml]="value.marked._text | translate" [ngClass]="coreService.getColor(value.marked.severity, 'bg')"
              class="label label2"></span>
      </td>
      <td><span *ngIf="value.late==true" translate>dailyPlan.label.late</span></td>
      <td><span [innerHtml]="value.plannedStartTime | highlight : dailyPlanFilters.searchText"></span></td>
      <td><span [innerHtml]="value.expectedEndTime | highlight : dailyPlanFilters.searchText"></span></td>
      <td><span
        [innerHtml]="value.expectedDuration"></span>
      </td>
      <td><span [innerHtml]="value.startTime"></span></td>
      <td><span [innerHtml]="value.endTime"></span></td>
      <td><span [innerHtml]="value.duration"></span>
      </td>
      <td>
        <div *ngIf="value.period.repeat">
          <span [nzTooltipPlacement]="'left'" [nzTooltipTitle]="tooltipTemplate" nz-tooltip>
            {{'dailyPlan.label.repeatEvery' | translate}}
            {{value.period.repeat}}s
          </span>
        </div>
      </td>
    </tr>
    <tr *ngIf="value.show">
      <td colspan="2"></td>
      <td colspan="12">
        <app-order-variable [order]="value" [schedulerId]="schedulerIds.selected"
                            [type]="'variables'"></app-order-variable>
      </td>
    </tr>
    <tr *ngIf="value.seperate">
      <td class="td-border" colspan="13"></td>
    </tr>
  </ng-container>
</ng-template>
<ng-template #planTemplate let-ajaxTable>
  <ng-template [ngForOf]="ajaxTable?.data" let-plan ngFor>
    <ng-template #tooltipTemplate>
      <div *ngIf="plan?.value[0]?.cyclicOrder" class="m-a-sm">
        <div class="_600 m-b-xs" translate>dailyPlan.label.cyclicOrder</div>
        <span class="_600 p-l-sm" translate>dailyPlan.label.begin</span>:
        {{plan?.value[0]?.cyclicOrder.firstStart | stringToDate}}
        <br>
        <span class="_600 p-l-sm" translate>dailyPlan.label.end</span>:
        {{plan?.value[0]?.cyclicOrder.lastStart | stringToDate}}
        <br>
        <span class="_600 p-l-sm" translate>order.label.orders</span>:
        {{plan?.value[0]?.cyclicOrder.count}}
      </div>
    </ng-template>
    <tr>
      <td [(nzChecked)]="plan.checked"
          [nzIndeterminate]="plan.indeterminate"
          [nzShowCheckbox]="true"
          (nzCheckedChange)="checkOrderTemplate(plan)"
      >
      </td>
      <td>
        <div class="btn-group dropdown">
          <button (nzVisibleChange)="change($event)" [nzDisabled]="object.checked || object.indeterminate" [nzDropdownMenu]="export2"
                  class="btn-drop more-option-h"
                  nz-dropdown nzTrigger="click" type="button">
            <i class="fa fa-ellipsis-h"></i>
          </button>
          <nz-dropdown-menu #export2="nzDropdownMenu" role="menu">
            <ul *ngIf="permission.currentController" nz-menu>
              <li (click)="submitOrder(plan, this.dailyPlanFilters.filter.groupBy === 'WORKFLOW')" *ngIf="permission.currentController.orders.create"
                  [nzDisabled]="!plan.isPlanned" nz-menu-item>
                <a>
                  {{'dailyPlan.button.submitOrder' | translate}} ..
                </a>
              </li>
              <li (click)="removeOrder(plan, this.dailyPlanFilters.filter.groupBy === 'WORKFLOW' )" *ngIf="permission.currentController.orders.cancel"
                  [nzDisabled]="!plan.isPlanned" class="bg-hover-color"
                  nz-menu-item>
                <a>
                  {{'dailyPlan.button.removeOrder' | translate}} ..
                </a>
              </li>
              <li (click)="cancelOrder(null, plan )" *ngIf="permission.currentController.orders.cancel" [nzDisabled]="plan.isCancel"
                  nz-menu-item>
                <a translate>dailyPlan.button.cancel</a>
              </li>
              <li (click)="modifyOrder(null, plan)" *ngIf="permission.currentController.orders.modify" [nzDisabled]="!plan.isModify"
                  nz-menu-item>
                <a>{{'dailyPlan.button.setStartTime' | translate}} ..</a>
              </li>
              <li (click)="changeParameter(plan, null)" *ngIf="permission.currentController.orders.modify" [nzDisabled]="!plan.isModify"
                  nz-menu-item>
                <a>
                  {{'dailyPlan.button.setParameters' | translate}} ..
                </a>
              </li>
              <li (click)="copyOrder(plan, null)" *ngIf="permission.currentController.orders.modify"
                  nz-menu-item>
                <a translate>{{'common.button.copy' | translate}} ..</a>
              </li>
            </ul>
          </nz-dropdown-menu>
        </div>
      </td>
      <td
        [colSpan]="(plan?.value?.length === 1 && !plan?.order) ? 1 : dailyPlanFilters.filter.groupBy === 'WORKFLOW' ? 10 : 11">
        <span class="show-in-single-line">
          <i (click)="expandCollapseOrder(plan)" *ngIf="plan?.order"
             aria-hidden="true" class="fa fa-angle-down cursor fa-lg p-r-xs"></i>
          <i (click)="expandCollapseOrder(plan)" *ngIf="!plan?.order"
             aria-hidden="true" class="fa fa-angle-right cursor fa-lg p-r-xs"></i>
          <span *ngIf="dailyPlanFilters.filter.groupBy === 'WORKFLOW'">
             <i (click)="coreService.navToInventoryTab(plan?.value[0]?.workflowPath, 'WORKFLOW');"
                *ngIf="permission.joc && permission.joc.inventory.view"
                class="cursor fa fa-pencil text-hover-primary p-l-xs p-r-xs"></i>
            <a *ngIf="isPathDisplay" (click)="coreService.showWorkflow(plan?.value[0]?.workflowPath);"
               class="text-hover-primary">
              <span [innerHtml]="plan?.value[0]?.workflowPath | highlight : dailyPlanFilters.searchText"></span>
            </a>
            <a *ngIf="!isPathDisplay" (click)="coreService.showWorkflow(plan.value[0]?.workflowPath);"
               [innerHtml]="plan.value[0]?.workflowPath.substring(plan.value[0]?.workflowPath.lastIndexOf('/') + 1) | highlight : dailyPlanFilters.searchText"
               class="text-hover-primary"></a>
            <span *ngIf="workflowTagsPerWorkflow[getLastPartOfWorkflow(plan.value[0]?.workflowPath)]?.length > 0" [innerHtml]="coreService.getModifiedWorkflowTags(workflowTagsPerWorkflow[getLastPartOfWorkflow(plan.value[0]?.workflowPath)], dailyPlanFilters.searchText)" class="m-l-sm">
           </span>
          </span>
          <span *ngIf="dailyPlanFilters.filter.groupBy !== 'WORKFLOW'">
            <i (click)="coreService.navToInventoryTab(plan.value[0]?.schedulePath, 'SCHEDULE');"
               *ngIf="permission.joc && permission.joc.inventory.view"
               class="cursor fa fa-pencil text-hover-primary p-l-xs p-r-xs"></i>
            <span *ngIf="isPathDisplay" [innerHtml]="plan?.value[0]?.schedulePath | highlight : dailyPlanFilters.searchText"></span>
            <span *ngIf="!isPathDisplay" [innerHtml]="plan?.value[0]?.schedulePath.substring(plan?.value[0]?.schedulePath.lastIndexOf('/') + 1) | highlight : dailyPlanFilters.searchText"></span>
          </span>
          <i *ngIf="!plan?.order && plan?.value?.length === 1 && plan.value[0] && plan.value[0].cyclicOrder" [nzTooltipPlacement]="'left'"
             [nzTooltipTitle]="tooltipTemplate" aria-hidden="true"
             class="fa fa-repeat p-l-xs" nz-tooltip></i>
        </span>
      </td>
      <td
        *ngIf="!plan?.order && plan?.value?.length === 1 && plan?.value[0] && dailyPlanFilters.filter.groupBy !== 'WORKFLOW'">
         <span class="show-in-single-line">
            <i (click)="coreService.navToInventoryTab(plan.value[0]?.workflowPath, 'WORKFLOW');"
               *ngIf="permission.joc && permission.joc.inventory.view"
               class="cursor fa fa-pencil text-hover-primary p-r-xs"></i>
            <a *ngIf="isPathDisplay" (click)="coreService.showWorkflow(plan.value[0]?.workflowPath);"
               class="text-hover-primary">
               <span [innerHtml]="plan.value[0]?.workflowPath | highlight : dailyPlanFilters.searchText"></span>
            </a>
           <a *ngIf="!isPathDisplay" (click)="coreService.showWorkflow(plan.value[0]?.workflowPath);"
              [innerHtml]="plan.value[0]?.workflowPath.substring(plan.value[0]?.workflowPath.lastIndexOf('/') + 1) | highlight : dailyPlanFilters.searchText"
              class="text-hover-primary"></a>
         </span>
      </td>
      <td *ngIf="!plan.order && plan?.value?.length === 1 && plan.value[0]" class="combine-two-label" nowrap>
        <span *ngIf="plan.value[0].state" [innerHtml]="plan.value[0].state._text | translate  | highlight : dailyPlanFilters.searchText"
              [ngClass]="[coreService.getColor(plan.value[0].state.severity, 'bg'),plan.value[0].marked ? 'label1' : '']"
              class="label"></span>
        <span *ngIf="plan.value[0].marked" [innerHtml]="plan.value[0].marked._text | translate"
              [ngClass]="coreService.getColor(plan.value[0].marked.severity, 'bg')"
              class="label label2"></span>
      </td>
      <td *ngIf="!plan.order && plan?.value?.length === 1 && plan.value[0]"><span
        *ngIf="plan.value[0].late==true" translate>dailyPlan.label.late</span></td>
      <td *ngIf="!plan.order && plan?.value?.length === 1 && plan.value[0]"><span
        [innerHtml]="plan.value[0].plannedStartTime | highlight : dailyPlanFilters.searchText"></span></td>
      <td *ngIf="!plan.order && plan?.value?.length === 1 && plan.value[0]"><span
        [innerHtml]="plan.value[0].expectedEndTime | highlight : dailyPlanFilters.searchText"></span></td>
      <td *ngIf="!plan.order && plan?.value?.length === 1 && plan.value[0]"><span
        [innerHtml]="plan.value[0].expectedDuration"></span>
      </td>
      <td *ngIf="!plan.order && plan?.value?.length === 1 && plan.value[0]"><span
        [innerHtml]="plan.value[0].startTime"></span></td>
      <td *ngIf="!plan.order && plan?.value?.length === 1 && plan.value[0]"><span
        [innerHtml]="plan.value[0].endTime"></span></td>
      <td *ngIf="!plan.order && plan?.value?.length === 1 && plan.value[0]"><span
        [innerHtml]="plan.value[0].duration"></span>
      </td>
      <td *ngIf="!plan.order && plan?.value?.length === 1 && plan.value[0]">
        <div *ngIf="plan.value[0].period.repeat">
             <span [nzTooltipPlacement]="'left'" [nzTooltipTitle]="tooltipTemplate" nz-tooltip>
            {{'dailyPlan.label.repeatEvery' | translate}}
               {{plan.value[0].period.repeat}}s
          </span>
        </div>
      </td>
    </tr>
    <ng-container *ngIf="plan.order" [ngTemplateOutletContext]="{ $implicit: plan.value, plan: plan}"
                  [ngTemplateOutlet]="orderTemplate"></ng-container>
  </ng-template>
</ng-template>
<div class="white box-shadow sub-header">
  <div class="row">
    <div class="col-md-12">
      <div class="padding p-b-sm">
        <div class="text-right ">
          <div class="pull-left">
            <app-breadcrumbs></app-breadcrumbs>
          </div>
          <div *ngIf="dailyPlanFilters.tabIndex == 0" [ngClass]="{'hide':object.mapOfCheckedId.size>0 || dateRanges.length > 0}" class="inline m-b-xs">
            <div class="btn-group m-l-12 hidden-btn-group">
              <ng-container *ngFor="let btn of filterBtn">
                <button (click)="getPlans(btn.status)" [disabled]="savedFilter.selected"
                        [ngClass]="{'btn-primary': dailyPlanFilters.filter.status===btn.status}"
                        class="btn btn-grey btn-sm button-group-ellipsis" translate>common.button.{{btn.text}}
                </button>
              </ng-container>
            </div>
            <div class="btn-group dropdown hidden-dropdown">
              <button [nzDropdownMenu]="state" [nzPlacement]="'bottomRight'" class="btn-drop btn btn-grey btn-sm m-l-12"
                      nz-dropdown nzTrigger="click" translate type="button">
                common.label.state
                <i class="caretDownIcon" nz-icon nzTheme="outline" nzType="caret-down"></i>
              </button>
              <nz-dropdown-menu #state="nzDropdownMenu">
                <ul nz-menu>
                  <ng-container *ngFor="let btn of filterBtn">
                    <li (click)="getPlans(btn.status)" [ngClass]="{'ant-select-dropdown-menu-item-active': dailyPlanFilters.filter.status=== btn.status, 'disable-link':savedFilter.selected}"
                        nz-menu-item>
                      <a translate>common.button.{{btn.text}}</a>
                    </li>
                  </ng-container>
                </ul>
              </nz-dropdown-menu>
            </div>
          </div>
          <div [ngClass]="{'hide':object.mapOfCheckedId.size>0 || dateRanges.length > 0}" class="inline">
            <div class="btn-group m-l-12" *ngIf="dailyPlanFilters.tabIndex == 0">
              <button (click)="changeLate()" [disabled]="savedFilter.selected"
                      [ngClass]="{'btn-primary': dailyPlanFilters.filter.late}" class="btn btn-grey btn-sm button-group-ellipsis">
                <span translate>dailyPlan.button.late</span>
              </button>
            </div>
            <div class="inline valign" *ngIf="dailyPlanFilters.tabIndex !== 0">
              <label [(ngModel)]="dailyPlanFilters.current"
                     name="current" nz-checkbox  (nzCheckedChange)="loadProjectionForCalendar()" >
                {{'common.label.currentController' | translate}}
              </label>
            </div>
            <div class="btn-group dropdown" *ngIf="dailyPlanFilters.tabIndex == 0">
              <button [nzDropdownMenu]="sortBy" [nzPlacement]="'bottomRight'" class="btn btn-grey btn-sm m-l-12"
                      nz-dropdown nzTrigger="click" translate type="button">
                <span translate>common.label.sortBy</span>
                <span class="text-primary">
                  <span *ngIf="dailyPlanFilters.filter.sortBy ==='orderId'">
                    {{'dailyPlan.label.order' | translate}}
                    <i *ngIf="!dailyPlanFilters.reverse" class="fa fa-caret-up"></i>
                    <i *ngIf="dailyPlanFilters.reverse" class="fa fa-caret-down"></i>
                  </span>
                  <span *ngIf="dailyPlanFilters.filter.sortBy ==='workflowPath'">
                    {{'dailyPlan.label.workflow' | translate}}
                    <i *ngIf="!dailyPlanFilters.reverse" class="fa fa-caret-up"></i>
                    <i *ngIf="dailyPlanFilters.reverse" class="fa fa-caret-down"></i>
                  </span>
                  <span *ngIf="dailyPlanFilters.filter.sortBy ==='plannedStartTime'">
                    {{'dailyPlan.label.plannedStart' | translate}}
                    <i *ngIf="!dailyPlanFilters.reverse" class="fa fa-caret-up"></i>
                    <i *ngIf="dailyPlanFilters.reverse" class="fa fa-caret-down"></i>
                  </span>
                  <span *ngIf="dailyPlanFilters.filter.sortBy ==='status'">
                    {{'dailyPlan.label.state' | translate}}
                    <i *ngIf="!dailyPlanFilters.reverse" class="fa fa-caret-up"></i>
                    <i *ngIf="dailyPlanFilters.reverse" class="fa fa-caret-down"></i>
                  </span>
                </span>
              </button>
              <nz-dropdown-menu #sortBy="nzDropdownMenu">
                <ul nz-menu>
                  <li (click)="sort('orderId')" nz-menu-item>
                    <a translate>dailyPlan.label.order</a>
                  </li>
                  <li (click)="sort('workflowPath')" nz-menu-item>
                    <a translate>dailyPlan.label.workflow</a>
                  </li>
                  <li (click)="sort( 'plannedStartTime')" nz-menu-item>
                    <a translate>dailyPlan.label.plannedStart</a>
                  </li>
                  <li (click)="sort('status')" nz-menu-item>
                    <a translate>dailyPlan.label.state</a>
                  </li>
                </ul>
              </nz-dropdown-menu>
            </div>
            <div *ngIf="permission.joc && permission.joc.administration.customization.view && dailyPlanFilters.tabIndex == 0" class="btn-group dropdown">
              <button [ngClass]="{'btn-primary': selectedFiltered.name}" [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="selectedFiltered.account" [nzDropdownMenu]="customization"
                      [nzPlacement]="'bottomRight'"
                      class="btn btn-grey btn-sm m-l-12" nz-dropdown
                      nzTrigger="click" translate type="button">
                {{'customization.label.customizations' | translate}}
                <span>{{selectedFiltered.name}}</span>
                <i class="caretDownIcon" nz-icon nzTheme="outline" nzType="caret-down"></i>
              </button>
              <nz-dropdown-menu #customization="nzDropdownMenu">
                <ul nz-menu>
                  <li (click)="createCustomization()" *ngIf="permission.joc && permission.joc.administration.customization.manage"
                      nz-menu-item>
                    <a translate>customization.label.createCustomization</a>
                  </li>
                  <li (click)="editFilters()" *ngIf="filterList.length>0" nz-menu-item>
                    <a translate>customization.label.editExistingCustomizations</a>
                  </li>
                  <li *ngIf="filterList.length>0" nz-menu-divider></li>
                  <li (click)="changeFilter(filter)" *ngFor="let filter of filterList | orderBy: 'name'"
                      [ngClass]="{'ant-select-dropdown-menu-item-active': (savedFilter.selected === filter.id)}"
                      nz-menu-item>
                    <a>
                      <span [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="filter.account">{{filter.name}}</span>
                      <i (click)="changeFilter(null);$event.stopPropagation();"
                         *ngIf="savedFilter.selected === filter.id"
                         [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'customization.tooltip.deactivateCustomization' | translate"
                         class="fa fa-times-circle-o remove"></i>
                    </a>
                  </li>
                </ul>
              </nz-dropdown-menu>
            </div>
            <button (click)="exportToExcel()" [disabled]="(dailyPlanFilters.tabIndex == 0 && planOrders?.length===0) || (dailyPlanFilters.tabIndex !== 0 && projectionData?.length===0)"
                    [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'common.tooltip.exportInXLS' | translate"
                    class="btn btn-grey btn-sm m-l-12">
              <i class="fa fa-share-square-o"></i>
            </button>
            <button (click)="exportObject(null)" *ngIf="dailyPlanFilters.tabIndex !== 0"
                    class="btn btn-sm btn-grey m-l-12">
              <i nz-icon nzTheme="outline" nzType="export"></i>&nbsp;
              <span translate>inventory.button.export</span>
            </button>
            <app-toggle *ngIf="dailyPlanFilters.tabIndex == 0" (messageEvent)="receiveMessage($event)"></app-toggle>
          </div>
          <div *ngIf="dailyPlanFilters.tabIndex == 0" [ngClass]="{'show-block':object.mapOfCheckedId.size>0}" class="hide">
            <button (click)="modifyOrderStartTime()"
                    *ngIf="permission.currentController && permission.currentController.orders.modify"
                    [disabled]="!object.isModifyStartTime" class="btn btn-grey btn-sm m-l-12"><i
              class="fa fa-clock-o"></i>&nbsp;
              <span class="hidden-sm-down" translate>dailyPlan.button.setStartTime</span>
            </button>
            <button (click)="modifySelectedOrder()"
                    *ngIf="permission.currentController && permission.currentController.orders.modify"
                    [disabled]="!object.isModify" class="btn btn-grey btn-sm m-l-12"><i
              class="fa fa-edit"></i>&nbsp;
              <span class="hidden-sm-down" translate>dailyPlan.button.setParameters</span>
            </button>
            <button (click)="copySelectedOrder()" *ngIf="permission.currentController && permission.currentController.orders.modify"
                    class="btn btn-grey btn-sm m-l-12"><i
              class="fa fa-copy"></i>&nbsp;
              <span class="hidden-sm-down" translate>common.button.copy</span>
            </button>
            <button (click)="submitSelectedOrder()"
                    *ngIf="permission.currentController && permission.currentController.orders.create"
                    [disabled]="!object.isPlanned" class="btn btn-grey btn-sm m-l-12"><i
              class="fa fa-rocket"></i>&nbsp;
              <span class="hidden-sm-down" translate>dailyPlan.button.submitOrder</span>
            </button>
            <button (click)="removeSelectedOrder()"
                    *ngIf="permission.currentController && permission.currentController.orders.cancel"
                    [disabled]="!object.isPlanned" class="btn btn-grey btn-sm m-l-12 bg-hover-color"><i
              class="fa fa-trash"></i>&nbsp;
              <span class="hidden-sm-down" translate>dailyPlan.button.removeOrder</span>
            </button>
            <button (click)="continueOrder()"
                    *ngIf="permission && permission.currentController && permission.currentController.orders.modify"
                    [disabled]="!object.isLetRun" class="btn btn-grey btn-sm m-l-12"><i
              class="fa fa-refresh"></i>&nbsp;
              <span class="hidden-sm-down" translate>dailyPlan.button.continueOrder</span>
            </button>
            <button (click)="cancelSelectedOrder()"
                    *ngIf="permission.currentController && permission.currentController.orders.cancel"
                    [disabled]="object.isCancel" class="btn btn-grey btn-sm m-l-12"><i class="fa fa-times"></i>&nbsp;
              <span class="hidden-sm-down" translate>dailyPlan.button.cancel</span>
            </button>
          </div>
          <div [ngClass]="{'show-block':dateRanges.length > 0}" class="hide">
            <button (click)="removeSelectedOrder()"
                    class="btn btn-grey btn-sm m-l-12 bg-hover-color"><i
              class="fa fa-trash"></i>&nbsp;
              <span class="hidden-sm-down" translate>dailyPlan.button.removeOrder</span>
            </button>
            <button (click)="cancelSelectedOrder()"
                    *ngIf="permission.currentController && permission.currentController.orders.cancel"
                    class="btn btn-grey btn-sm m-l-12"><i
              class="fa fa-times"></i>&nbsp;
              <span class="hidden-sm-down" translate>dailyPlan.button.cancel</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class='scroll-y max-ht'>
  <div class="padding p-t-sm p-b-0">
    <nz-tabset (nzSelectChange)="tabChange($event)" [(nzSelectedIndex)]="dailyPlanFilters.tabIndex" >
      <nz-tab [nzTitle]="'dailyPlan.tab.dailyPlan' | translate">
        <div class="row">
          <div class="col-lg-12">
            <div class="sticky leftPanel daily-plan" id="leftPanel">
              <div class="box m-b-0 overflow-y" style="height: 97.4%">
                <div class="p-b b-b icon-hover">
                  <ng-template #tooltipTemplate>
                    <div class="m-a-xs">
                      <i class="fa fa-circle circle daily-plan-step-icon"></i><span translate>dailyPlan.tooltip.dateRangeSelectStep1</span><br>
                      <i class="fa fa-circle circle daily-plan-step-icon"></i><span translate>dailyPlan.tooltip.dateRangeSelectStep2</span><br>
                      <i class="fa fa-circle circle daily-plan-step-icon"></i><span translate>dailyPlan.tooltip.dateRangeSelectStep3</span>
                    </div>
                  </ng-template>
                  <i [nzTooltipPlacement]="'left'" [nzTooltipTitle]="tooltipTemplate" class="fa fa-info-circle pos-abt r-t-8"
                     nz-tooltip></i>
                  <i (click)="selectDateRange(true)" [ngClass]="{'text-primary' :isCalendarClick }"
                     class="fa fa-calendar-plus-o pos-abt cursor l-t-8"></i>
                  <div [ngClass]="{'grab' :isCalendarClick }" class="calendar-sm m-t-0" id="full-calendar"></div>
                </div>
                <div class="text-center m-t">
                  <button (click)="createPlan()" *ngIf="permission.joc && permission.joc.dailyPlan.manage"
                          [disabled]="isPastDate" class="btn btn-grey btn-sm m-b-sm">
                    <i class="fa fa-plus"></i>&nbsp;
                    <span translate>dailyPlan.button.createPlan</span>
                  </button>
                  <button (click)="deleteSubmission()"
                          *ngIf="permission.joc && permission.joc.dailyPlan.manage"
                          class="btn btn-grey btn-sm m-l-xs m-b-sm">
                    <i class="fa fa-trash"></i>&nbsp;
                    <span translate>dailyPlan.button.deleteSubmissions</span>
                  </button>
                  <div *ngIf="submissionHistory.length > 0 && dateRanges.length == 0" class="m-t-sm p-a-sm p-l-0">
                    <div class="_600 m-b-sm text-left p-l font14">
                      <a (click)="navToHistory()" class="text-hover-primary"
                         translate>dailyPlan.label.submissionHistory</a>
                    </div>
                    <ul class="text-left p-l max-ht-n-560">
                      <li *ngFor="let history of submissionHistory">
                        <a (click)="selectSubmissionHistory(history.submissionHistoryId)"
                           [ngClass]="{ 'text-primary' : selectedSubmissionId === history.submissionHistoryId }">
                          <i class="fa fa-circle p-r-xs"></i>
                          <span translate>dailyPlan.label.created</span> -
                          <i class="text-muted">{{history.submissionTime | stringToDate}}</i>
                        </a>
                      </li>
                    </ul>
                  </div>
                  <div *ngIf="dateRanges.length > 0" class="m-t-sm p-a-sm p-l-0">
                    <div class="_600 m-b-sm text-left p-l font14">
                      <a translate>common.label.dateRange</a>
                    </div>
                    <ul class="text-left p-l">
                      <li>
                        <a>
                          <div class="w inline">
                            <span translate>common.label.from</span>
                            <i> -</i>
                          </div>
                          <i class="text-muted pos-rel t-n-xs">{{dateRanges[0] | stringToDate1: true}}</i>
                        </a>
                      </li>
                      <li>
                        <a>
                          <div class="w inline">
                            <span translate>common.label.to</span>
                            <i> -</i>
                          </div>
                          <i class="text-muted pos-rel t-n-xs">{{dateRanges[1] | stringToDate1: true}}</i>
                        </a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            <div id="rightPanel">
              <div class="row">
                <div class="col-lg-2 col-sm-3 p-r-xs">
                  <div class="box m-b-0" [style.height]="pageView === 'grid' ? 'calc(100% - 2px)' : 'calc(100% - 20px)'">
                    <nz-tabset class="custom-tab p-t-sm p-l-sm p-r-sm" [nzAnimated]="false"  [nzType]="'line'" [(nzSelectedIndex)]="dailyPlanFilters.selectedIndex">
                      <nz-tab (nzClick)="switchToTagging('workflowTags');dailyPlanFilters.selectedIndex = 0;" [nzTitle]="workflowTagsTitle">
                        <ng-template #workflowTagsTitle>
                          <span>{{ 'inventory.tab.workflowTagging' | translate }}</span>
                        </ng-template>
                      </nz-tab>
                      <nz-tab (nzClick)="switchToTagging('orderTags');dailyPlanFilters.selectedIndex = 1;" [nzTitle]="orderTagsTitle">
                        <ng-template #orderTagsTitle>
                          <span>{{ 'inventory.tab.orderTagging' | translate }}</span>
                        </ng-template>
                      </nz-tab>
                    </nz-tabset>
                    <div *ngIf="dailyPlanFilters.tagType === 'workflowTags'">
                      <perfect-scrollbar class="p-b-sm p-t-xs p-l-sm p-r-sm daily-plan-tag" [style.height]="pageView === 'grid' ? 'calc(100% - 0)' : 'calc(100% - 20px)'">
                      <div class="fade-in">
                          <div class="p-l-xs m-b-sm">
                            <a (click)="selectTags()" nz-tooltip="{{'workflow.label.selectTags' | translate}}">
                              <i class="font14" [nzType]="'plus'" nz-icon nzTheme="outline"></i>
                            </a>
                            <a (click)="selectAllTags();" class="p-l-12" nz-tooltip="{{'workflow.label.selectAllTags' | translate}}">
                              <i class="font14" nz-icon nzTheme="outline" nzType="plus-square"></i>
                            </a>
                            <a (click)="removeAllTags();" class="p-l-12" nz-tooltip="{{'workflow.label.removeAllTags' | translate}}">
                              <i class="font14" nz-icon nzTheme="outline" nzType="minus-square"></i>
                            </a>
                            <a (click)="objectTreeSearch()" class="tree-search workflow-tree-search" style="right: 16px">
                              <i [nzType]="'search'" nz-icon nzTheme="outline"></i>
                            </a>
                            <div class="dailyTagSearch">
                              <input (blur)="clearSearchInput()" (ngModelChange)="onSearchInput($event)"
                                     [(ngModel)]="searchTag.text"
                                     [nzAutocomplete]="auto" [placeholder]="'workflow.placeholder.findNode' | translate"
                                     class="input-tree-search"
                                     id="dailyTagSearch"
                                     nz-input
                              />
                              <label *ngIf="coreService.selectedTags && coreService.selectedTags.length > 0" nz-checkbox [(ngModel)]="coreService.allTagsSelected" (ngModelChange)="toggleSelectAllTags($event)" class="m-l-xs m-b-15 m-t-sm1">
                                {{ 'profile.label.selectAll' | translate }}
                              </label>
                              <i [nzType]="searchTag.loading ? 'loading' : 'search'" class="tree-search-icon" nz-icon nzTheme="outline"></i>
                              <nz-autocomplete #auto>
                                <nz-auto-option (click)="selectTagOnSearch(tag)" *ngFor="let tag of searchTag.tags | orderBy: 'ordering'"
                                                [nzValue]="tag.name" class="min-ht-opt">
                                  <div class="node-wrapper p-l-xs">
                                    <div class="node-content-wrapper2"
                                         nzTooltipPlacement="right">
                                      <span class="icon-color text-xs" nz-icon nzType="tag" nzTheme="outline"></span>
                                      <span class="p-l-sm">{{tag.name}}</span>
                                    </div>
                                  </div>
                                </nz-auto-option>
                              </nz-autocomplete>
                            </div>
                          </div>
                          <div class="w-full" *ngFor="let tag of coreService.selectedTags | orderBy: 'ordering'">
                            <div class="node-wrapper p-l-xxs p-b-xxs">
                              <span class="w-14 m-l-xs m-r-12">
                                <label nz-checkbox [nzChecked]="coreService.checkedTags.has(tag.name)"
                                       (nzCheckedChange)="onTagChecked(tag.name, $event)"></label>
                              </span>
                              <div class="node-content-wrapper"
                                   [ngClass]="{'node-content-wrapper-active': coreService.checkedTags.has(tag.name)}"
                                   (click)="selectTag(tag.name)">
                                <span class="icon-color" nz-icon nzType="tag" nzTheme="outline"></span>
                                <span class="p-l-xs">{{tag.name}}</span>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div *ngIf="coreService.selectedTags && coreService.selectedTags.length === 0"
                             class="m-top-50" style="margin-bottom: 60px">
                          <app-empty-data></app-empty-data>
                        </div>
                      </perfect-scrollbar>
                    </div>
                    <div *ngIf="dailyPlanFilters.tagType === 'orderTags'">
                      <perfect-scrollbar class="p-b-sm p-t-xs p-l-sm p-r-sm daily-plan-tag" [style.height]="pageView === 'grid' ? 'calc(100% - 0)' : 'calc(100% - 20px)'">
                      <div class="fade-in">
                          <div class="p-l-xs m-b-sm">
                            <a (click)="selectOrderTags()" nz-tooltip="{{'workflow.label.selectTags' | translate}}">
                              <i class="font14" [nzType]="'plus'" nz-icon nzTheme="outline"></i>
                            </a>
                            <a (click)="selectAllOrderTags();" class="p-l-12" nz-tooltip="{{'workflow.label.selectAllTags' | translate}}">
                              <i class="font14" nz-icon nzTheme="outline" nzType="plus-square"></i>
                            </a>
                            <a (click)="removeAllOrderTags();" class="p-l-12" nz-tooltip="{{'workflow.label.removeAllTags' | translate}}">
                              <i class="font14" nz-icon nzTheme="outline" nzType="minus-square"></i>
                            </a>
                            <a (click)="objectOrderTreeSearch()" class="tree-search workflow-tree-search" style="right: 16px">
                              <i [nzType]="'search'" nz-icon nzTheme="outline"></i>
                            </a>
                            <div class="dailyTagSearch">
                              <input (blur)="clearOrderSearchInput()" (ngModelChange)="onOrderSearchInput($event)"
                                     [(ngModel)]="searchOrderTag.text"
                                     [nzAutocomplete]="auto" [placeholder]="'workflow.placeholder.findNode' | translate"
                                     class="input-tree-search"
                                     id="dailyOrderTagSearch"
                                     nz-input
                              />
                              <label *ngIf="coreService.selectedOrderTags && coreService.selectedOrderTags.length > 0" nz-checkbox [(ngModel)]="coreService.allOrderTagsSelected" (ngModelChange)="toggleSelectAllOrderTags($event)" class="m-l-xs m-b-15 m-t-sm1">
                                {{ 'profile.label.selectAll' | translate }}
                              </label>
                              <i [nzType]="searchOrderTag.loading ? 'loading' : 'search'" class="tree-search-icon" nz-icon nzTheme="outline"></i>
                              <nz-autocomplete #auto>
                                <nz-auto-option (click)="selectOrderTagOnSearch(tag)" *ngFor="let tag of searchOrderTag.tags | orderBy: 'ordering'"
                                                [nzValue]="tag.name" class="min-ht-opt">
                                  <div class="node-wrapper p-l-xs">
                                    <div class="node-content-wrapper2"
                                         nzTooltipPlacement="right">
                                      <span class="icon-color text-xs" nz-icon nzType="tag" nzTheme="outline"></span>
                                      <span class="p-l-sm">{{tag.name}}</span>
                                    </div>
                                  </div>
                                </nz-auto-option>
                              </nz-autocomplete>
                            </div>
                          </div>
                          <div class="w-full" *ngFor="let tag of coreService.selectedOrderTags | orderBy: 'ordering'">
                            <div class="node-wrapper p-l-xxs p-b-xxs">
                              <span class="w-14 m-l-xs m-r-12">
                                <label nz-checkbox [nzChecked]="coreService.checkedOrderTags.has(tag.name)"
                                       (nzCheckedChange)="onOrderTagChecked(tag.name, $event)"></label>
                              </span>
                              <div class="node-content-wrapper"
                                   [ngClass]="{'node-content-wrapper-active': coreService.checkedOrderTags.has(tag.name)}"
                                   (click)="selectOrderTag(tag.name)">
                                <span class="icon-color" nz-icon nzType="tag" nzTheme="outline"></span>
                                <span class="p-l-xs">{{tag.name}}</span>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div *ngIf="coreService.selectedOrderTags && coreService.selectedOrderTags.length === 0"
                             class="m-top-50" style="margin-bottom: 60px">
                          <app-empty-data></app-empty-data>
                        </div>
                      </perfect-scrollbar>
                    </div>
                  </div>
                </div>
                <div class="col-lg-10 col-sm-9">
                    <div
                      *ngIf="!(object.checked && object.mapOfCheckedId.size > 0 && planOrders.length > (dailyPlanFilters.entryPerPage || preferences.entryPerPage))"
                      class="row m-b-12">
                      <div class="col-lg-12">
                        <button (click)="expandCollapseDetails(true)" [disabled]="planOrders.length === 0"
                                class="btn btn-sm btn-grey" nz-tooltip="{{'common.button.expandDetails' | translate}}">
                          <i class="fa fa-expand text"></i>
                        </button>
                        <button (click)="expandCollapseDetails(false)"
                                [disabled]="planOrders.length === 0"
                                class="btn btn-sm btn-grey m-l-sm m-r-sm"
                                nz-tooltip="{{'common.button.collapseDetails' | translate}}">
                          <i class="fa fa-compress text"></i>
                        </button>
                        <button (click)="groupByWorkflow('')"
                                [ngClass]="{'btn-primary': dailyPlanFilters.filter.groupBy===''}"
                                class="btn btn-grey btn-sm hidden-btn-text">
                          <i class="icon icon-orders-icon"></i>
                          <span translate>dailyPlan.button.groupByOrder</span>
                        </button>
                        <button (click)="groupByWorkflow('ORDER')"
                                [ngClass]="{'btn-primary': dailyPlanFilters.filter.groupBy==='ORDER'}"
                                class="btn btn-grey btn-sm hidden-btn-text">
                          <i class="icon icon-calendar-icon"></i>
                          <span translate>dailyPlan.button.groupByScheduleTemplate</span>
                        </button>
                        <button (click)="groupByWorkflow('WORKFLOW')"
                                [ngClass]="{'btn-primary': dailyPlanFilters.filter.groupBy==='WORKFLOW'}"
                                class="btn btn-grey btn-sm hidden-btn-text">
                          <i class="icon icon-workflows-icon"></i>
                          <span translate>dailyPlan.button.groupByWorkflow</span>
                        </button>
                        <button (click)="filterByOrders('')"
                                [ngClass]="{'btn-primary': dailyPlanFilters.filter.filterBy===''}"
                                class="btn btn-grey btn-sm hidden-btn-text m-l-12">
                          <i class="icon icon-orders-icon"></i>
                          <span translate>dailyPlan.label.all</span>
                        </button>
                        <button (click)="filterByOrders('ONETIMEORDERS')"
                                [ngClass]="{'btn-primary': dailyPlanFilters.filter.filterBy==='ONETIMEORDERS'}"
                                class="btn btn-grey btn-sm hidden-btn-text">
                          <i class="icon icon-calendar-icon"></i>
                          <span translate>dailyPlan.label.oneTimeOrders</span>
                        </button>
                        <button (click)="filterByOrders('CYCLICORDER')"
                                [ngClass]="{'btn-primary': dailyPlanFilters.filter.filterBy==='CYCLICORDER'}"
                                class="btn btn-grey btn-sm hidden-btn-text">
                          <i class="icon icon-workflows-icon"></i>
                          <span translate>dailyPlan.label.cyclicOrders</span>
                        </button>
                        <button (click)="showSearchPanel ? cancel() : advancedSearch()"
                                class="btn btn-sm inline pull-right m-l btn-grey">
                          <span translate>common.button.advancedSearch</span>
                          <i class="fa p-l-xs" [ngClass]="!showSearchPanel ? 'fa-caret-down' : 'fa-caret-up'"></i>
                        </button>
                        <div class="search-box-field pull-right">
                          <label>
                            <input (keyup)="searchInResult()" [(ngModel)]="dailyPlanFilters.searchText"
                                   placeholder="{{'common.placeholder.search' | translate}}"
                                   type="search">
                          </label>
                          <i (click)="dailyPlanFilters.searchText = '';searchInResult()"
                             [hidden]="!dailyPlanFilters.searchText"
                             class="fa fa-times search-close"></i>
                        </div>
                      </div>
                    </div>
                    <div *ngIf="showSearchPanel" class="row">
                      <div class="col-md-12">
                        <div class="box p-a m-b p-t-md">
                          <app-form-template (onCancel)="cancel()" (onSearch)="search()" [allFilter]="filterList"
                                             [filter]="searchFilter" [isSearch]="true"
                                             [permission]="permission" [preferences]="preferences"
                                             [schedulerIds]="schedulerIds"></app-form-template>
                        </div>
                      </div>
                    </div>
                    <div *ngIf="pageView==='grid' && plans.length>0">
                      <div class="box p-a m-b-0 max-ht-n-252">
                        <div class="row">
                          <div class="col-md-12">
                            <app-gantt [data]="planOrders" [groupBy]="dailyPlanFilters.filter.groupBy"
                                       [preferences]="preferences"
                                       [toggle]="isToggle"></app-gantt>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div *ngIf="pageView =='grid' && planOrders.length==0 && isLoaded"
                         class="text-center m-t text-uppercase max-ht-n-252">
                      <app-empty-data></app-empty-data>
                    </div>
                    <div
                      *ngIf="object.checked && object.mapOfCheckedId.size > 0 && planOrders.length > (dailyPlanFilters.entryPerPage || preferences.entryPerPage)"
                      class="text-center font14 box p-a-sm m-b-12">
                      <span *ngIf="object.mapOfCheckedId.size !== (totalOrders - totalFinishedOrders)"
                            [translateParams]="{count: object.mapOfCheckedId.size}"
                            translate>common.label.selectAllEntriesOfCurrentPage</span>
                      <span *ngIf="object.mapOfCheckedId.size === (totalOrders - totalFinishedOrders)"
                            [translateParams]="{count: (totalOrders - totalFinishedOrders)}"
                            translate>common.label.allEntriesSelected</span>
                      <a (click)="selectAll()"
                         *ngIf="object.mapOfCheckedId.size !== (totalOrders - totalFinishedOrders)"
                         [translateParams]="{count: (totalOrders - totalFinishedOrders)}" class="text-primary p-l-xs"
                         translate>common.label.selectAllEntries</a>
                      <a (click)="isAllSelected = false;resetCheckBox()"
                         *ngIf="object.mapOfCheckedId.size === (totalOrders - totalFinishedOrders)"
                         class="text-primary p-l-xs" translate>common.label.clearSelection</a>
                    </div>
                    <div *ngIf="pageView !=='grid'" class="box p-a max-ht-n-252" style="overflow: auto;">
                      <div class="table-responsive" id="dailyPlanTableId">
                        <nz-table
                          #ajaxTable
                          (nzPageIndexChange)="pageIndexChange($event)"
                          (nzPageSizeChange)="pageSizeChange($event)"
                          [nzBordered]="true"
                          [nzData]="planOrders"
                          [nzLoading]="!isLoaded"
                          [nzPageIndex]="dailyPlanFilters.currentPage"
                          [nzPageSizeOptions]="[10, 25, 50, 100 , +(preferences.maxEntryPerPage)]"
                          [nzPageSize]="dailyPlanFilters.entryPerPage || preferences.entryPerPage || 25"
                          [nzShowPagination]="planOrders.length > 0"
                          [nzShowSizeChanger]="true"
                          [nzSize]="'small'"
                        >
                          <thead>
                          <tr>
                            <th [(nzChecked)]="object.checked"
                                [nzIndeterminate]="object.indeterminate"
                                [nzShowCheckbox]="true"
                                (nzCheckedChange)="checkAll()"
                                class="chk">
                            </th>
                            <th class="menu"><span translate>common.label.action</span></th>
                            <th (click)="sort('orderId')" *ngIf="dailyPlanFilters.filter.groupBy === 'ORDER'">
                              <a><span class="p-r-xs" translate>dailyPlan.label.scheduleAndOrder</span>
                                <i *ngIf="dailyPlanFilters.filter.sortBy == 'orderId' && !dailyPlanFilters.reverse"
                                   class="fa fa-caret-up "></i>
                                <i *ngIf="dailyPlanFilters.filter.sortBy == 'orderId' && dailyPlanFilters.reverse"
                                   class="fa fa-caret-down"></i></a>
                            </th>
                            <th (click)="sort('orderId')" *ngIf="dailyPlanFilters.filter.groupBy === ''">
                              <a>
                                <span class="p-r-xs" translate>dailyPlan.label.order</span>
                                <i *ngIf="dailyPlanFilters.filter.sortBy == 'orderId' && !dailyPlanFilters.reverse"
                                   class="fa fa-caret-up "></i>
                                <i *ngIf="dailyPlanFilters.filter.sortBy == 'orderId' && dailyPlanFilters.reverse"
                                   class="fa fa-caret-down"></i></a>
                            </th>
                            <th (click)="sort('schedulePath')" *ngIf="dailyPlanFilters.filter.groupBy === ''">
                              <a>
                                <span class="p-r-xs" translate>dailyPlan.label.schedule</span>
                                <i *ngIf="dailyPlanFilters.filter.sortBy == 'schedulePath' && !dailyPlanFilters.reverse"
                                   class="fa fa-caret-up "></i>
                                <i *ngIf="dailyPlanFilters.filter.sortBy == 'schedulePath' && dailyPlanFilters.reverse"
                                   class="fa fa-caret-down"></i></a>
                            </th>
                            <th (click)="sort('workflowPath')">
                              <a>
                                <span *ngIf="dailyPlanFilters.filter.groupBy !== 'WORKFLOW'" class="p-r-xs" translate>dailyPlan.label.workflow</span>
                                <span *ngIf="dailyPlanFilters.filter.groupBy === 'WORKFLOW'" class="p-r-xs" translate>dailyPlan.label.workflowAndOrder</span>
                                <i *ngIf="dailyPlanFilters.filter.sortBy == 'workflowPath' && !dailyPlanFilters.reverse"
                                   class="fa fa-caret-up "></i>
                                <i *ngIf="dailyPlanFilters.filter.sortBy == 'workflowPath' && dailyPlanFilters.reverse"
                                   class="fa fa-caret-down"></i></a>
                            </th>
                            <th (click)="sort('status')">
                              <a><span class="p-r-xs" translate>dailyPlan.label.state</span>
                                <i *ngIf="dailyPlanFilters.filter.sortBy == 'status' && !dailyPlanFilters.reverse"
                                   class="fa fa-caret-up "></i>
                                <i *ngIf="dailyPlanFilters.filter.sortBy == 'status' && dailyPlanFilters.reverse"
                                   class="fa fa-caret-down"></i></a>
                            </th>
                            <th (click)="sort('late')">
                              <a><span class="p-r-xs" translate>dailyPlan.label.late</span>
                                <i *ngIf="dailyPlanFilters.filter.sortBy == 'late' && !dailyPlanFilters.reverse"
                                   class="fa fa-caret-up "></i>
                                <i *ngIf="dailyPlanFilters.filter.sortBy == 'late' && dailyPlanFilters.reverse"
                                   class="fa fa-caret-down"></i></a>
                            </th>
                            <th (click)="sort('plannedStartTime')">
                              <a><span class="p-r-xs" translate>dailyPlan.label.plannedStart</span>
                                <i
                                  *ngIf="dailyPlanFilters.filter.sortBy == 'plannedStartTime' && !dailyPlanFilters.reverse"
                                  class="fa fa-caret-up "></i>
                                <i
                                  *ngIf="dailyPlanFilters.filter.sortBy == 'plannedStartTime' && dailyPlanFilters.reverse"
                                  class="fa fa-caret-down"></i></a>
                            </th>
                            <th (click)="sort('expectedEndTime')">
                              <a><span class="p-r-xs" translate>dailyPlan.label.expectedEnd</span>
                                <i
                                  *ngIf="dailyPlanFilters.filter.sortBy == 'expectedEndTime' && !dailyPlanFilters.reverse"
                                  class="fa fa-caret-up "></i>
                                <i
                                  *ngIf="dailyPlanFilters.filter.sortBy == 'expectedEndTime' && dailyPlanFilters.reverse"
                                  class="fa fa-caret-down"></i></a>
                            </th>
                            <th (click)="sort('expectedDuration')">
                              <a><span class="p-r-xs" translate>dailyPlan.label.expectedDuration</span>
                                <i *ngIf="dailyPlanFilters.filter.sortBy == 'duration' && !dailyPlanFilters.reverse"
                                   class="fa fa-caret-up "></i>
                                <i *ngIf="dailyPlanFilters.filter.sortBy == 'duration' && dailyPlanFilters.reverse"
                                   class="fa fa-caret-down "></i></a>
                            </th>
                            <th (click)="sort('startTime')">
                              <a><span class="p-r-xs" translate>dailyPlan.label.startTime</span>
                                <i *ngIf="dailyPlanFilters.filter.sortBy == 'startTime' && !dailyPlanFilters.reverse"
                                   class="fa fa-caret-up "></i>
                                <i *ngIf="dailyPlanFilters.filter.sortBy == 'startTime' && dailyPlanFilters.reverse"
                                   class="fa fa-caret-down "></i></a>
                            </th>
                            <th (click)="sort('endTime')">
                              <a><span class="p-r-xs" translate>dailyPlan.label.endTime</span>
                                <i *ngIf="dailyPlanFilters.filter.sortBy == 'endTime' && !dailyPlanFilters.reverse"
                                   class="fa fa-caret-up "></i>
                                <i *ngIf="dailyPlanFilters.filter.sortBy == 'endTime' && dailyPlanFilters.reverse"
                                   class="fa fa-caret-down "></i></a>
                            </th>
                            <th (click)="sort('duration')">
                              <a><span class="p-r-xs" translate>common.label.duration</span>
                                <i *ngIf="dailyPlanFilters.filter.sortBy == 'duration1' && !dailyPlanFilters.reverse"
                                   class="fa fa-caret-up "></i>
                                <i *ngIf="dailyPlanFilters.filter.sortBy == 'duration1' && dailyPlanFilters.reverse"
                                   class="fa fa-caret-down"></i></a>
                            </th>
                            <th (click)="sort('period.repeat')">
                              <a><span class="p-r-xs" translate>dailyPlan.label.repeatInterval</span>
                                <i
                                  *ngIf="dailyPlanFilters.filter.sortBy == 'period.repeat' && !dailyPlanFilters.reverse"
                                  class="fa fa-caret-up "></i>
                                <i *ngIf="dailyPlanFilters.filter.sortBy == 'period.repeat' && dailyPlanFilters.reverse"
                                   class="fa fa-caret-down"></i></a>
                            </th>
                          </tr>
                          </thead>
                          <ng-container>
                            <tbody>
                            <ng-container *ngIf="dailyPlanFilters.filter.groupBy"
                                          [ngTemplateOutletContext]="{ $implicit: ajaxTable}"
                                          [ngTemplateOutlet]="planTemplate"></ng-container>
                            <ng-container *ngIf="!dailyPlanFilters.filter.groupBy"
                                          [ngTemplateOutletContext]="{ $implicit: ajaxTable.data, plan: null}"
                                          [ngTemplateOutlet]="orderTemplate"></ng-container>
                            </tbody>
                          </ng-container>
                        </nz-table>
                      </div>
                      <div *ngIf="ajaxTable.data.length >0" class="w-half label-top">
                        <span *ngIf="dailyPlanFilters.filter.groupBy === 'ORDER'"
                              [translateParams]="{total: planOrders.length, orderCount: totalOrders}"
                              translate>dailyPlan.label.totalEntry</span>
                        <span *ngIf="dailyPlanFilters.filter.groupBy === 'WORKFLOW'"
                              [translateParams]="{total: planOrders.length, orderCount: totalOrders}"
                              translate>dailyPlan.label.totalWorkflowEntry</span>
                        <span *ngIf="dailyPlanFilters.filter.groupBy === ''"
                              [translateParams]="{total: planOrders.length}"
                              translate>dailyPlan.label.totalOrderEntry</span>
                      </div>
                    </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nz-tab>
      <nz-tab [nzTitle]="'dailyPlan.tab.projection' | translate">
        <div class="row m-t-n-xxs">
          <div class="col-md-12 m-b">
            <div class="inline btn-group">
              <div (click)="setView('Month')"
                   [class.primary]="dailyPlanFilters.projection.calView === 'Month'"
                   class="btn btn-default btn-sm" translate>
                runtime.label.monthly
              </div>
              <div (click)="setView('Year')"
                   [class.primary]="dailyPlanFilters.projection.calView === 'Year'"
                   class="btn btn-default btn-sm" translate>
                runtime.label.yearly
              </div>
            </div>
            <div class="inline m-l-12 b-l p-l-12" style="height: 26px">
              <div class="pos-rel t-xxs">
                <i class="fa fa-stop date-planned"></i>
                {{'common.label.planned' | translate}}
                <i class="fa fa-stop date-unplanned p-l-sm"></i>
                {{'dailyPlan.label.projected' | translate}}
              </div>
            </div>
            <button (click)="showSearchPanel ? cancel() : advancedSearch()" class="btn btn-sm inline pull-right m-l-12 btn-grey">
              <span translate>common.button.advancedSearch</span>
              <i class="fa p-l-xs" [ngClass]="!showSearchPanel ? 'fa-caret-down' : 'fa-caret-up'"></i>
            </button>
            <button (click)="recreateProjection()" class="btn btn-grey btn-sm button-group-ellipsis pull-right">
              <span translate>dailyPlan.button.recreate</span>
            </button>
            <div class="inline pull-right m-r-12 pos-rel t-xxs">
              <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'dailyPlan.tooltip.invertProjection' | translate" (nzCheckedChange)="loadProjectionForCalendar()" [(ngModel)]="dailyPlanFilters.projection.withoutStartTime" name="withoutStartTime1" nz-checkbox>
              {{'dailyPlan.label.invertProjection' | translate}}
              </label>
            </div>
            <div class="inline pull-right b-r m-r-12" style="height: 26px" *ngIf="projectionData && surveyDate">
              <div class="m-r-12 pos-rel t-3">
                <label translate>dashboard.label.surveyDate</label>:
                <label class="text-muted p-l-xs" translate>{{surveyDate | stringToDate}}</label>
              </div>
            </div>
          </div>
          <div class="col-md-12 ">
            <app-projection [projectionData]="projectionData" [permission]="permission" [schedulerId]="schedulerIds.selected"
                            [showSearchPanel]="showSearchPanel" (onCancel)="cancelCal()" (onSearch)="searchCal($event)"
                            [filters]="dailyPlanFilters.projection" [isCurrentController]="dailyPlanFilters.current"
                            [preferences]="preferences"
                            (onChange)="changeInCalendar($event)"></app-projection>
          </div>
        </div>
      </nz-tab>
      <nz-tab [nzTitle]="'dailyPlan.tab.dependencies' | translate">
        <div class="row m-t-n-xxs">
          <div class="col-md-12 ">
            <app-dependencies  [parentLoaded]="isParentLoaded" [schedulerId]="schedulerIds.selected" [preferences]="preferences"></app-dependencies>
          </div>
        </div>
      </nz-tab>
    </nz-tabset>
  </div>
</div>
<div *ngIf="!isLoaded && pageView ==='grid'" class="spinner">
  <div class="cssload-inner cssload-one"></div>
  <div class="cssload-inner cssload-two"></div>
  <div class="cssload-inner cssload-three"></div>
</div>
<div *ngIf="(!isLoaded || reloadState == 'yes') && dailyPlanFilters.tabIndex == 0">
  <div (click)="reload()" class="bottom-btn">
    <i *ngIf="reloadState == 'no'" class="fa fa-times"></i>
    <i *ngIf="reloadState == 'yes'" class="fa fa-refresh"></i>
  </div>
</div>
