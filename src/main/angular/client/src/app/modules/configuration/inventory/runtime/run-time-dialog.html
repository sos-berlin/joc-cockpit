<div class="text-left">
  <form>
    <div class="modal-body p-a cal-modal-body">
      @if (!editor.showPlanned) {
        <div>
          <div class="row">
            <div class="col-md-12 m-t-n-8">
              <button (click)="assignCalendar()" [disabled]="isTrash"
                      class="btn btn-sm btn-grey m-r-sm m-t-sm"
                      translate type="button">runtime.button.assignWorkingDayCalendar
              </button>
              <button (click)="assignHolidayCalendar()" [disabled]="isTrash"
                      class="btn btn-sm btn-grey m-r-sm m-t-sm"
                      translate type="button">runtime.button.assignNonWorkingDayCalendar
              </button>
              <button (click)="planFromRuntime()"
                      [disabled]="!canShowPreview()"
                      [nz-tooltip]="hasUnreleasedCalendars() ? ('runtime.message.calendarNotReleased' | translate) : (!calendars || calendars.length === 0 ? ('runtime.message.noCalendarsAssigned' | translate) : null)"
                      class="btn btn-sm btn-grey m-t-sm"
                      translate type="button">runtime.button.showYearView
              </button>
            </div>
            <div class="row col-md-12 m-t m-b-sm">
              <div class="col-sm-3 form-control-label" translate>runtime.label.timeZone</div>
              <div class="col-sm-6">
                <nz-select [(ngModel)]="timeZone" [nzDisabled]="isTrash" name="timeZone" nzAllowClear nzShowSearch>
                  @for (zone of zones; track zone) {
                    <nz-option [nzLabel]="zone" [nzValue]="zone"></nz-option>
                  }
                </nz-select>
              </div>
            </div>
            <div class="col-md-12">
              <div class="form-group row m-t">
                <div class="col-sm-12 import-set-table">
                  <div class="table-responsive">
                    <table class="table table-hover table-bordered ">
                      <thead>
                      <tr>
                        <th><span translate>runtime.label.listOfCalendars</span></th>
                        <th><span translate>runtime.label.period</span></th>
                        <th><span translate>runtime.label.restrictions</span></th>
                      </tr>
                      </thead>
                      <tbody>
                        @for (calendar of calendars; track $index; let i =$index) {
                          <tr [ngClass]="{'disable-link' : isTrash}">
                            <td class="cursor">
                              <a (click)="calendar.released !== false && previewCalendar(calendar, 'WORKINGDAYSCALENDAR')"
                                 [ngClass]="{'text-muted': calendar.released === false}"
                                 [nz-tooltip]="calendar.released === false ? ('runtime.label.notReleased' | translate) : null">
                                <i class="fa fa-calendar text-success"></i>&nbsp;
                                {{calendar.calendarName}} @if (calendar.title) {<i>-</i>} {{calendar.title}}
                                @if (calendar.released === false) {
                                  <span class="text-warning text-xs"> (Draft)</span>
                                }
                              </a>
                              <a (click)="editWorkingCal(calendar)"
                                 class="text-xs text-hover-primary m-l-sm"><i class="fa fa-pencil"></i>
                              </a>
                              <a (click)="removeWorkingCal(i)"
                                 class="text-xs text-hover-primary m-l-sm"><i class="fa fa-times text-hover-color"></i>
                              </a>
                            </td>
                            <td>
                              @for (p of calendar.periods; track $index; let x = $index) {
                                <div>
                                  <a (click)="updatePeriodInCalendar(calendar, x, p)">{{getPeriodStr(p)}}</a>
                                  <a (click)="updatePeriodInCalendar(calendar, x, p)" class="text-xs text-hover-primary m-l-sm">
                                    <i class="fa fa-pencil"></i></a>
                                  <a (click)="removePeriodInCalendar(calendar, x)" class="text-xs text-hover-color m-l-sm">
                                    <i class="fa fa-times text-hover-color"></i></a>
                                </div>
                              }
                              <div class="text-xs cursor text-hover-primary">
                                <i (click)="addPeriodInCalendar(calendar)" class="fa fa-plus"></i>
                              </div>
                            </td>
                            <td>
                              @for (list of calendar.frequencyList; track $index; let i = $index) {
                                <div>
                                  <a (click)="editRestrictionInCalendar(calendar,list, i);">{{list.str}}</a>
                                  <a (click)="editRestrictionInCalendar(calendar,list, i)"
                                     class="text-xs text-hover-primary m-l-sm"><i class="fa fa-pencil"></i></a>
                                  <a (click)="deleteRestrictionInCalendar(calendar,list)"
                                     class="text-xs text-hover-color m-l-sm"><i class="fa fa-times"></i></a>
                                </div>
                              }
                              <div class="text-xs cursor text-hover-primary"><i
                                (click)="addRestrictionInCalendar(calendar)" class="fa fa-plus"></i>
                              </div>
                            </td>
                          </tr>
                        }
                        @for (holiday of nonWorkingDayCalendars; track $index; let i =$index) {
                          <tr [ngClass]="{'disable-link' : isTrash}">
                            <td>
                              <a (click)="holiday.released !== false && previewCalendar(holiday, 'NONWORKINGDAYSCALENDAR')"
                                 [ngClass]="{'text-muted': holiday.released === false}"
                                 [nz-tooltip]="holiday.released === false ? ('runtime.label.notReleased' | translate) : null">
                                <i class="fa fa-calendar text-danger"></i>&nbsp;
                                {{holiday.calendarName}}
                                @if (holiday.released === false) {
                                  <span class="text-warning text-xs"> (Draft)</span>
                                }
                              </a>&nbsp;
                              <a (click)="removeNonWorkingCal(i)"
                                 class="text-xs text-hover-primary m-l-sm"><i class="fa fa-times text-hover-color"></i>
                              </a>
                            </td>
                            <td class="b-r-0"></td>
                            <td></td>
                          </tr>
                        }
                      </tbody>
                    </table>
                  </div>
                  @if (calendars.length==0 && nonWorkingDayCalendars.length==0) {
                    <div class="text-center">
                      <app-empty-data title="runtime.message.noFrequencyCalendarFound"></app-empty-data>
                    </div>
                  }
                </div>
              </div>
            </div>
          </div>
        </div>
      }
      @if (editor.showPlanned) {
        <div class="min-ht-500">
          <div class="row">
            <div class="col-md-12">
              @if (calendar) {
                <label class="pull-left text">
                  <i [ngClass]="calendar.type === 'WORKINGDAYSCALENDAR' ? 'text-success' : 'text-warning'"
                     class="p-r-xs fa fa-calendar"></i>
                  {{calendar.calendarName }}
                </label>
                  <span class="text-muted text-xs m-l-sm">
                    <i class="fa fa-info-circle m-r-xs"></i> <span translate>runtime.label.usingReleasedCalendars</span>
                  </span>
              }
              <ul class="nav navbar-nav navbar-nav-inline pull-right nav-active-border nav-active-border2 b-primary">
                <li class="nav-item">
                  <a (click)="viewCalObj.calendarView = 'month';getPlan()"
                     [ngClass]="{'active' : viewCalObj.calendarView=='month'}"
                     class="nav-link">
                    <span class="nav-text text-dark p-b-sm" translate>runtime.label.monthly</span>
                  </a>
                </li>
                <li class="nav-item dropdown-separator">
                  <span class="separator"></span>
                </li>
                <li class="nav-item">
                  <a (click)="viewCalObj.calendarView = 'year';getPlan()"
                     [ngClass]="{'active' : viewCalObj.calendarView=='year'}"
                     class="nav-link">
                    <span class="nav-text text-dark p-b-sm" translate>runtime.label.yearly</span>
                  </a>
                </li>
              </ul>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12 min-ht-500">
              <div id="full-calendar"></div>
            </div>
          </div>
        </div>
      }
    </div>
    @if (editor.showPlanned) {
      <div class="modal-footer border-top-0 text-left">
        <button (click)="back()" class="btn btn-grey btn-sm" translate type="button">common.button.close</button>
      </div>
    }
  </form>
</div>
