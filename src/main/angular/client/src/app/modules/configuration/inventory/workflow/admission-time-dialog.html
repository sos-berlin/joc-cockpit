<form #myForm="ngForm" novalidate>
  <div class="form-group row">
    <div [nz-tooltip]="isTooltipVisible ? ('inventory.tooltips.workflow.timeZone' | translate) : ''" [nzTooltipMouseEnterDelay]="0.5"
         class="col-md-4 col-lg-3 form-control-label"
         title="{{'workflow.label.timeZone' | translate}}" translate>workflow.label.timeZone
    </div>
    <div class="col-md-8 col-lg-9">
      <input [(ngModel)]="timeZone" class="form-control" name="timeZone"
             readonly type="text">

    </div>
  </div>
  <div *ngIf="repeatObject">
    <div class="form-group row">
      <label [nz-tooltip]="isTooltipVisible ? ('inventory.tooltips.workflow.admissionTime.cycleType' | translate) : ''" [nzTooltipMouseEnterDelay]="0.5"
             class="col-sm-3 form-control-label"
             title="{{'workflow.repeat.label.cycleType' | translate}}" translate>workflow.repeat.label.cycleType</label>
      <div class="col-sm-9">
        <nz-select [(ngModel)]="repeatObject.TYPE" name="_value">
          <nz-option [nzLabel]="'workflow.repeat.label.periodical' | translate" nzValue="Periodic"></nz-option>
          <nz-option [nzLabel]="'workflow.repeat.label.continuous' | translate" nzValue="Continuous"></nz-option>
          <nz-option [nzLabel]="'workflow.repeat.label.ticking' | translate" nzValue="Ticking"></nz-option>
        </nz-select>
      </div>
    </div>
    <div *ngIf="repeatObject.TYPE === 'Periodic'" class="form-group row">
      <label [nz-tooltip]="isTooltipVisible ? ('inventory.tooltips.workflow.admissionTime.period' | translate) : ''" [nzTooltipMouseEnterDelay]="0.5"
             class="col-sm-3 form-control-label"
             title="{{'workflow.repeat.label.period' | translate}}" translate>workflow.repeat.label.period
        <sup class="text-danger text-sm">*</sup>
      </label>
      <div [ngClass]="{ 'has-error' : (((period.dirty || period.touched) && period.invalid))}" class="col-sm-9">
        <input #period="ngModel" [(ngModel)]="repeatObject.period" [appAutofocus]="true" appValidateDuration class="form-control"
               name="period" placeholder="{{'workflow.placeholder.durationPeriod' | translate}}"
               required type="text">
        <div *ngIf="period.invalid && (period.dirty || period.touched)" class="text-danger help-block">
          <div *ngIf="period.errors['required']">
            <div translate>common.message.requiredError</div>
          </div>
          <div *ngIf="period.errors['invalidDuration']" translate>common.message.invalid</div>
        </div>
      </div>
    </div>
    <div *ngIf="repeatObject.TYPE === 'Periodic'" class="form-group row">
      <label [nz-tooltip]="isTooltipVisible ? ('inventory.tooltips.workflow.admissionTime.offsets' | translate) : ''" [nzTooltipMouseEnterDelay]="0.5"
             class="col-sm-3 form-control-label"
             title="{{'workflow.repeat.label.offsets' | translate}}" translate>workflow.repeat.label.offsets
        <sup class="text-danger text-sm">*</sup>
      </label>
      <div [ngClass]="{ 'has-error' : (((offsets.dirty || offsets.touched) && offsets.invalid))}" class="col-sm-9">
        <input #offsets="ngModel" [(ngModel)]="repeatObject.offsets" appValidateOffset class="form-control"
               name="offsets" placeholder="{{'workflow.placeholder.offset' | translate}}"
               required type="text">
        <div *ngIf="offsets.invalid && (offsets.dirty || offsets.touched)" class="text-danger help-block">
          <div *ngIf="offsets.errors['required']">
            <div translate>common.message.requiredError</div>
          </div>
          <div *ngIf="offsets.errors['invalidOffset']" translate>common.message.invalid</div>
        </div>
      </div>
    </div>
    <div *ngIf="repeatObject.TYPE === 'Continuous'" class="form-group row">
      <label [nz-tooltip]="isTooltipVisible ? ('inventory.tooltips.workflow.admissionTime.pause' | translate) : ''" [nzTooltipMouseEnterDelay]="0.5"
             class="col-sm-3 form-control-label"
             title="{{'workflow.repeat.label.pause' | translate}}" translate>workflow.repeat.label.pause
        <sup class="text-danger text-sm">*</sup>
      </label>
      <div [ngClass]="{ 'has-error' : (((pause.dirty || pause.touched) && pause.invalid))}" class="col-sm-9">
        <input #pause="ngModel" [(ngModel)]="repeatObject.pause" appValidateDuration class="form-control"
               name="pause" placeholder="{{'workflow.placeholder.durationPeriod' | translate}}"
               required type="text">
        <div *ngIf="pause.invalid && (pause.dirty || pause.touched)" class="text-danger help-block">
          <div *ngIf="pause.errors['required']">
            <div translate>common.message.requiredError</div>
          </div>
          <div *ngIf="pause.errors['invalidDuration']" translate>common.message.invalid</div>
        </div>
      </div>
    </div>
    <div *ngIf="repeatObject.TYPE === 'Continuous'" class="form-group row">
      <label [nz-tooltip]="isTooltipVisible ? ('inventory.tooltips.workflow.admissionTime.limit' | translate) : ''" [nzTooltipMouseEnterDelay]="0.5"
             class="col-sm-3 form-control-label"
             title="{{'workflow.repeat.label.limit' | translate}}" translate>workflow.repeat.label.limit</label>
      <div class="col-sm-9">
        <nz-input-number [(ngModel)]="repeatObject.limit" [nzMin]="1" [nzStep]="1"
                         name="limit"></nz-input-number>
      </div>
    </div>
    <div *ngIf="repeatObject.TYPE === 'Ticking'" class="form-group row">
      <label [nz-tooltip]="isTooltipVisible ? ('inventory.tooltips.workflow.admissionTime.interval' | translate) : ''" [nzTooltipMouseEnterDelay]="0.5"
             class="col-sm-3 form-control-label"
             title="{{'workflow.repeat.label.interval' | translate}}" translate>workflow.repeat.label.interval
        <sup class="text-danger text-sm">*</sup>
      </label>
      <div [ngClass]="{ 'has-error' : (((interval.dirty || interval.touched) && interval.invalid))}" class="col-sm-9">
        <input #interval="ngModel" [(ngModel)]="repeatObject.interval" appValidateDuration class="form-control"
               name="interval" placeholder="{{'workflow.placeholder.durationPeriod' | translate}}"
               required type="text">
        <div *ngIf="interval.invalid && (interval.dirty || interval.touched)" class="text-danger help-block">
          <div *ngIf="interval.errors['required']">
            <div translate>common.message.requiredError</div>
          </div>
          <div *ngIf="interval.errors['invalidDuration']" translate>common.message.invalid</div>
        </div>
      </div>
    </div>
  </div>
  <div class="m-b">
    <div class="form-group row">
      <label [nz-tooltip]="isTooltipVisible ? ('inventory.tooltips.workflow.admissionTime.admissionType' | translate) : ''" [nzTooltipMouseEnterDelay]="0.5"
             class="col-sm-3 form-control-label"
             title="{{'workflow.label.admissionType' | translate}}" translate>workflow.label.admissionType</label>
      <div class="col-sm-9">
        <nz-select (ngModelChange)="changeFrequency()" [(ngModel)]="frequency.tab" name="frequencyTab" nzShowSearch>
          <nz-option [nzLabel]="'runtime.label.weekDays' | translate" nzValue="weekDays"></nz-option>
          <nz-option [nzLabel]="'runtime.label.specificWeekDays' | translate" nzValue="specificWeekDays"></nz-option>
          <nz-option [nzLabel]="'runtime.label.specificDays' | translate" nzValue="specificDays"></nz-option>
          <nz-option [nzLabel]="'runtime.label.monthDays' | translate" nzValue="monthDays"></nz-option>
        </nz-select>
      </div>
    </div>
  </div>
  <div [ngClass]="{'p-a':frequency.tab !== 'specificDays' }" class="tab-content b-t b-l b-r b-b p-a p-b-0 m-b">
    <div [ngClass]="{'active':frequency.tab == 'weekDays'}" class="tab-pane animated fadeIn" id="tab1">
      <div class="form-group row">
        <label [nz-tooltip]="isTooltipVisible ? ('inventory.tooltips.workflow.admissionTime.weekDays' | translate) : ''" [nzTooltipMouseEnterDelay]="0.5"
               class="col-sm-3"
               title="{{'workflow.admissionTime.label.weekDays' | translate}}" translate>workflow.admissionTime.label.weekDays</label>
        <div class="col-sm-9">
          <label (nzCheckedChange)="selectAllWeek()" [(ngModel)]="frequency.all" class="w m-b-xxs" name="week"
                 nz-checkbox>
            <span translate>workflow.admissionTime.label.everyDay</span>
          </label><br>
          <nz-checkbox-wrapper (nzOnChange)="dayChange($event)">
            <ng-container *ngFor="let option of daysOptions">
              <label [(ngModel)]="option.checked" [nzValue]="option.value" name="{{option.label}}"
                     nz-checkbox><span translate>runtime.label.{{option.label}}</span></label>
            </ng-container>
          </nz-checkbox-wrapper>
        </div>
      </div>
    </div>
    <div [ngClass]="{'active':frequency.tab == 'specificWeekDays'}" class="tab-pane animated fadeIn" id="tab2">
      <div class="form-group row">
        <label [nz-tooltip]="isTooltipVisible ? ('inventory.tooltips.workflow.admissionTime.dayNumber' | translate) : ''" [nzTooltipMouseEnterDelay]="0.5"
               class="col-sm-3 form-control-label"
               title="{{'runtime.label.dayNumber' | translate}}" translate>runtime.label.dayNumber</label>
        <div class="col-sm-9">
          <nz-select (ngModelChange)="onFrequencyChange()" [(ngModel)]="frequency.specificWeek" name="specificWeek">
            <nz-option [nzLabel]="'runtime.label.first' | translate" nzValue="1"></nz-option>
            <nz-option [nzLabel]="'runtime.label.second' | translate" nzValue="2"></nz-option>
            <nz-option [nzLabel]="'runtime.label.third' | translate" nzValue="3"></nz-option>
            <nz-option [nzLabel]="'runtime.label.fourth' | translate" nzValue="4"></nz-option>
            <nz-option [nzLabel]="'runtime.label.last' | translate" nzValue="-1"></nz-option>
            <nz-option [nzLabel]="'runtime.label.secondLast' | translate" nzValue="-2"></nz-option>
            <nz-option [nzLabel]="'runtime.label.thirdLast' | translate" nzValue="-3"></nz-option>
            <nz-option [nzLabel]="'runtime.label.fourthLast' | translate" nzValue="-4"></nz-option>
          </nz-select>
        </div>
      </div>
      <div class="form-group row">
        <label [nz-tooltip]="isTooltipVisible ? ('inventory.tooltips.workflow.admissionTime.weekDays' | translate) : ''" [nzTooltipMouseEnterDelay]="0.5"
               class="col-sm-3 form-control-label"
               title="{{'runtime.label.weekDays' | translate}}" translate>runtime.label.weekDays</label>
        <div class="col-sm-9">
          <nz-select (ngModelChange)="onFrequencyChange()" [(ngModel)]="frequency.specificWeekDay"
                     name="specificWeekDay">
            <nz-option [nzLabel]="'runtime.label.monday' | translate" nzValue="0"></nz-option>
            <nz-option [nzLabel]="'runtime.label.tuesday' | translate" nzValue="1"></nz-option>
            <nz-option [nzLabel]="'runtime.label.wednesday' | translate" nzValue="2"></nz-option>
            <nz-option [nzLabel]="'runtime.label.thursday' | translate" nzValue="3"></nz-option>
            <nz-option [nzLabel]="'runtime.label.friday' | translate" nzValue="4"></nz-option>
            <nz-option [nzLabel]="'runtime.label.saturday' | translate" nzValue="5"></nz-option>
            <nz-option [nzLabel]="'runtime.label.sunday' | translate" nzValue="6"></nz-option>
          </nz-select>
        </div>
      </div>
    </div>
    <div [ngClass]="{'active':frequency.tab == 'monthDays'}" class="tab-pane animated fadeIn" id="tab3">
      <div class="form-group row">
        <label [nz-tooltip]="isTooltipVisible ? ('inventory.tooltips.workflow.admissionTime.monthDays' | translate) : ''" [nzTooltipMouseEnterDelay]="0.5"
               class="col-sm-3"
               title="{{'runtime.label.monthDays' | translate}}" translate>runtime.label.monthDays</label>
        <div class="col-sm-9">
          <nz-radio-group [(ngModel)]="frequency.isUltimos" name="radio">
            <label nz-radio nzValue="months"><span translate>runtime.label.countFromFirstDay</span></label>
            <label nz-radio nzValue="ultimos"><span translate>runtime.label.countFromTheLastDay</span></label>
          </nz-radio-group>
        </div>
        <div class="col-sm-offset-3 col-sm-6 m-t-sm p-t-xs">
          <table [hidden]="frequency.isUltimos!=='months'"
                 class="table table-bordered table-striped text-center m-b-xs w ">
            <tbody>
            <tr *ngFor="let count of countArr;">
              <td (click)="selectMonthDaysFunc(((7 * count) + 1) +'')"
                  [ngClass]="{'primary': getSelectedMonthDays(((7 * count) + 1) +'')}"><a
              >{{(7 * count) + 1 }}</a></td>
              <td (click)="selectMonthDaysFunc(((7 * count) + 2) +'')"
                  [ngClass]="{'primary': getSelectedMonthDays(((7 * count) + 2) +'')}"><a
              >{{(7 * count) + 2 }}</a></td>
              <td (click)="selectMonthDaysFunc(((7 * count) + 3) +'')"
                  [ngClass]="{'primary': getSelectedMonthDays(((7 * count) + 3) +'')}"><a
              >{{(7 * count) + 3 }}</a></td>
              <td (click)="selectMonthDaysFunc(((7 * count) + 4) +'')" *ngIf="count !== 4"
                  [ngClass]="{'primary': getSelectedMonthDays(((7 * count) + 4) +'')}"><a
              >{{(7 * count) + 4 }}</a></td>
              <td (click)="selectMonthDaysFunc(((7 * count) + 5) +'')" *ngIf="count !== 4"
                  [ngClass]="{'primary': getSelectedMonthDays(((7 * count) + 5) +'')}"><a
              >{{(7 * count) + 5 }}</a></td>
              <td (click)="selectMonthDaysFunc(((7 * count) + 6) +'')" *ngIf="count !== 4"
                  [ngClass]="{'primary': getSelectedMonthDays(((7 * count) + 6) +'')}"><a
              >{{(7 * count) + 6 }}</a></td>
              <td (click)="selectMonthDaysFunc(((7 * count) + 7) +'')" *ngIf="count !== 4"
                  [ngClass]="{'primary': getSelectedMonthDays(((7 * count) + 7) +'')}"><a
              >{{(7 * count) + 7 }}</a></td>
            </tr>
            </tbody>
          </table>
          <table [hidden]="frequency.isUltimos=='months'"
                 class="table table-bordered table-striped text-center m-b-xs w ">
            <tbody>
            <tr>
              <td (click)="selectMonthDaysUFunc('1')" [ngClass]="{'primary': getSelectedMonthDaysU('1')}" colspan="2"><a
                translate>runtime.label.lastDay</a></td>
              <td (click)="selectMonthDaysUFunc('2')" [ngClass]="{'primary': getSelectedMonthDaysU('2')}"><a
              >-1</a></td>
              <td (click)="selectMonthDaysUFunc('3')" [ngClass]="{'primary': getSelectedMonthDaysU('3')}"><a
              >-2</a></td>
              <td (click)="selectMonthDaysUFunc('4')" [ngClass]="{'primary': getSelectedMonthDaysU('4')}"><a
              >-3</a></td>
              <td (click)="selectMonthDaysUFunc('5')" [ngClass]="{'primary': getSelectedMonthDaysU('5')}"><a
              >-4</a></td>
            </tr>
            <tr *ngFor="let count of countUArr;">
              <td (click)="selectMonthDaysUFunc(((6 * count)) +'')"
                  [ngClass]="{'primary': getSelectedMonthDaysU(((6 * count)) +'')}">
                <a>-{{(6 * count) + 1 - 2 }}</a></td>
              <td (click)="selectMonthDaysUFunc(((6 * count) + 1) + '')"
                  [ngClass]="{'primary': getSelectedMonthDaysU(((6 * count) + 1) + '')}">
                <a>-{{(6 * count) + 2 - 2 }}</a>
              </td>
              <td (click)="selectMonthDaysUFunc(((6 * count) + 2) +'')"
                  [ngClass]="{'primary': getSelectedMonthDaysU(((6 * count) + 2) +'')}">
                <a>-{{(6 * count) + 3 - 2 }}</a>
              </td>
              <td (click)="selectMonthDaysUFunc(((6 * count) + 3) +'')"
                  [ngClass]="{'primary': getSelectedMonthDaysU(((6 * count) + 3) +'')}">
                <a>-{{(6 * count) + 4 - 2 }}</a>
              </td>
              <td (click)="selectMonthDaysUFunc(((6 * count) + 4) +'')"
                  [ngClass]="{'primary': getSelectedMonthDaysU(((6 * count) + 4) +'')}">
                <a>-{{(6 * count) + 5 - 2 }}</a>
              </td>
              <td (click)="selectMonthDaysUFunc(((6 * count) + 5) +'')" *ngIf="count !== 4"
                  [ngClass]="{'primary': getSelectedMonthDaysU(((6 * count) + 5) +'')}">
                <a>-{{(6 * count) + 6 - 2 }}</a>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div [ngClass]="{'active':frequency.tab == 'specificDays'}" class="tab-pane animated fadeIn" id="tab4">
      <div [ngClass]="{'specific-day-ht':frequency.tab == 'specificDays' }">
        <div id="calendar"></div>
      </div>
    </div>
  </div>
  <div *ngIf="!_temp" class="row">
    <div class="col-sm-12">
      <div class="form-group row">
        <label [nz-tooltip]="isTooltipVisible ? ((!repeatObject ? 'inventory.tooltips.workflow.admissionTime.periodBeginOfAdmissionTime' : 'inventory.tooltips.workflow.admissionTime.startTime') | translate) : ''" [nzTooltipMouseEnterDelay]="0.5"
               class="col-sm-3 form-control-label"
               title="{{'workflow.admissionTime.label.startTime' | translate}}" translate>
          workflow.admissionTime.label.startTime
          <sup class="text-danger text-sm">*</sup>
        </label>
        <div [ngClass]="{ 'has-error' : (((timePicker.dirty || timePicker.touched) && timePicker.invalid))}"
             class="col-sm-9">
          <div class="time-picker m-l-0">
            <input #timePicker="ngModel" (ngModelChange)="selectTime(object.startTime, true)" [(ngModel)]="object.startTime" class="form-control" name="startTime"
                   placeholder="HH:MM:SS" required timevalidator
                   type="text">
            <nz-time-picker (keydown.Tab)="onTab()" (ngModelChange)="selectTime($event)" [(ngModel)]="object.startTime1"
                            [nzAllowEmpty]="false" name="fromTimeIcon"></nz-time-picker>
          </div>
          <div *ngIf="timePicker.invalid && (timePicker.dirty || timePicker.touched)" class="text-danger help-block">
            <div *ngIf="timePicker.errors['required']">
              <div translate>common.message.requiredError</div>
            </div>
          </div>
        </div>
      </div>
      <div class="form-group row">
        <label [nz-tooltip]="isTooltipVisible ? ((!repeatObject ? 'inventory.tooltips.workflow.admissionTime.durationOfAdmissionTime' : 'inventory.tooltips.workflow.admissionTime.duration') | translate) : ''" [nzTooltipMouseEnterDelay]="0.5"
               class="col-sm-3 form-control-label"
               title="{{'common.label.duration' | translate}}" translate>common.label.duration
          <sup class="text-danger text-sm">*</sup>
        </label>
        <div [ngClass]="{ 'has-error' : (((duration.dirty || duration.touched) && duration.invalid))}" class="col-sm-9">
          <input #duration="ngModel" [(ngModel)]="object.duration" appValidateDuration class="form-control"
                 name="duration" placeholder="{{'workflow.placeholder.durationPeriod' | translate}}"
                 required type="text">
          <div *ngIf="duration.invalid && (duration.dirty || duration.touched)" class="text-danger help-block">
            <div *ngIf="duration.errors['required']">
              <div translate>common.message.requiredError</div>
            </div>
            <div *ngIf="duration.errors['invalidDuration']" translate>common.message.invalid</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="form-group row ">
    <div class="col-sm-12 b-b p-t p-b">
      <button (click)="addFrequency(myForm)" [disabled]="!myForm.form.valid || !editor.isEnable"
              class="btn btn-sm btn-primary">
        <span *ngIf="isEdit" translate>workflow.admissionTime.button.update</span>
        <span *ngIf="!isEdit" translate>runtime.button.addNewFrequency</span>
      </button>
      <button (click)="closeRuntime()" *ngIf="!_temp" class="btn btn-grey m-l-12 btn-sm" translate type="button">
        workflow.admissionTime.button.back
      </button>
      <button (click)="resetTab()" *ngIf="_temp" class="btn btn-grey m-l-12 btn-sm" translate type="button">
        common.button.cancel
      </button>
    </div>
  </div>
  <div class="row m-t">
    <div class="col-sm-12 max-ht-n528 text-overflow">
      <div class="table-responsive">
        <table class="table table-hover table-bordered ">
          <thead>
          <tr>
            <th><span translate>workflow.admissionTime.label.frequency</span></th>
            <th><span translate>workflow.admissionTime.label.period</span></th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let item of data.periodList; let i = index"
              [ngClass]="{'light-bg': _temp && _temp.frequency == item.frequency}">
            <td>
              <span (click)="editFrequency(item)" *ngIf="item.frequency" class="cursor"><span *ngIf="item.day"
                                                                                              translate>workflow.admissionTime.label.on</span> {{item.frequency}}</span>
              <span (click)="editFrequency(item)" *ngIf="!item.frequency" class="cursor" translate>workflow.admissionTime.label.everyDay</span>
              <a (click)="editFrequency(item)"
                 class="text-xs primary-text-hover-color m-l-sm"><i class="fa fa-pencil"></i></a>
              <a (click)="removeFrequency(item, i)"
                 class="text-xs text-hover-color m-l-sm"><i class="fa fa-times"></i></a>
            </td>
            <td>
              <div *ngFor="let p of item.periods;">
                <a (click)="editPeriod(p, item)">{{p.text}}</a>
                <a (click)="editPeriod(p, item)" class="text-xs text-hover-primary m-l-sm">
                  <i class="fa fa-pencil"></i></a>
                <a (click)="removePeriod(item, p)" class="text-xs text-hover-color m-l-sm">
                  <i class="fa fa-times text-hover-color"></i></a>
              </div>
              <div class="text-xs cursor text-hover-primary">
                <i (click)="addPeriod(item)" class="fa fa-plus"></i>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
      <div *ngIf="data.periodList.length==0" class="text-center m-b-sm">
        <app-empty-data></app-empty-data>
      </div>
    </div>
  </div>
</form>
