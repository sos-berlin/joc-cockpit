<div>
  <div class="row">
    @if (data.type) {
      <div class="col-md-12">
        <perfect-scrollbar id="toolbar-scrollbar">
          <div [ngClass]="{'disable-link': isTrash || !(permission.joc && permission.joc.inventory.manage)}" class="bg-white"
               id="toolbar"></div>
        </perfect-scrollbar>
        <div class="row toolbar b-b m-b-12" style="padding-bottom: 6px">
          <div class="col-md-12" id="search-container">
            @if (searchNode.isVisible) {
              <ng-container>
                <nz-tree-select [(ngModel)]="searchNode.text" [nzDropdownClassName]="'custom-dropdown'"
                                [nzDropdownStyle]="{ 'max-height': '340px' }" [nzNodes]="allNodes"
                                [nzPlaceHolder]="'workflow.placeholder.findNode' | translate" [nzShowSearch]="true"
                                (ngModelChange)="selectSearchNode($event)" class="input-search"
                                id="searchTree" name="searchNode">
                </nz-tree-select>
              </ng-container>
            }
            <i class="search-icon" nz-icon nzTheme="outline" nzType="search"></i>
            <div id="workflowHeader">
              @if (workflow.path) {
                <div class="inline m-b-sm m-l-sm">
                  <div style="position: relative; top: 3px">
                    <a (click)="backToListView()"><i class="fa fa-arrow-circle-left config-back-btn"
                                                     nz-tooltip="{{'inventory.button.backToList' | translate}}"></i></a>
                    <span (click)="navToWorkflowTab()" [ngClass]="{'cursor text-hover-primary': workflow.hasDeployments || data.deployed}"
                          class="_600">{{data.path}}
                      @if (data.path !=='/') {
                        <span>/</span>
                      }
                      {{data.name}}
                  </span>
                    @if (title) {
                      <span class="text-muted _400"> - {{title}}</span>
                    }
                    @if (jobs.length) {
                      <span class="text-dark text-sm _400"> -
                      <b translate>inventory.label.uniqueJobs</b>
                      <span class="text-primary _600 m-l-xs ">{{jobs.length}}</span>
                    </span>
                    }
                    @if (lastModified) {
                      <span class="text-dark text-sm _400">
                       <span class="p-l-sm p-r-sm">|</span>
                      <b translate>inventory.label.lastModified</b>
                      <i class="text-muted p-l-xs">{{lastModified | stringToDate}}</i>
                    </span>
                    }
                    <i (click)="helpPage('configuration-inventory-workflows')" [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'common.tooltip.help' | translate" class="help-info-inv cur-point fa fa-info-circle text-20 m-r-sm"></i>
                    <i (click)="notes()"
                       [nzTooltipMouseEnterDelay]="0.5"
                       [nz-tooltip]="'inventory.notes.tooltip.notes' | translate"
                       nz-icon
                       nzType="paper-clip"
                       nzTheme="outline"
                       class="cur-point text-16 m-r-sm"
                       [style.color]="coreService.getColorByNoteSeverity(workflow?.hasNote)"></i>
                  </div>
                </div>
              }
              @if (!isTrash) {
                <div class="inline pull-right">
                  @if (!isLoading) {
                    <span (click)="recursiveUpdate()" class="btn-search">
                    <i nz-icon nzTheme="outline" nzType="search"></i>
                  </span>
                  }
                  @if (!isLoading) {
                    <span>
                    <span (click)="validate()" [ngClass]="!workflow.valid ? 'cursor badge-danger':'badge-success'"
                          class="badge m-r-12">
                      @if (!workflow.valid) {
                        <span>
                          <span translate>inventory.label.notValid</span>
                          @if (invalidMsg) {
                            <i class="fa fa-info-circle p-l-xs" nz-tooltip="{{invalidMsg | translate}}"></i>
                          }
                        </span>
                      }
                      @if (workflow.valid) {
                        <span translate>inventory.label.valid</span>
                      }
                    </span>
                    <span [ngClass]="!data.deployed ? 'badge-danger':'badge-success'" class="badge">
                      @if (!data.deployed) {
                        <span translate>inventory.label.notDeployed</span>
                      }
                      @if (data.deployed) {
                        <span translate>inventory.label.deployed</span>
                      }
                    </span>
                      @if (data.syncState && inventoryService.checkDeploymentStatus.isChecked) {
                        <span [hidden]="(data.syncState._text == 'NOT_DEPLOYED' && !data.deployed)"
                              [ngClass]="coreService.getColor(data.syncState.severity, 'bg')" class="badge badge-sync m-l-12">
                        {{data.syncState._text | translate}}
                      </span>
                      }
                  </span>
                  }
                  @if (isLoading) {
                    <span>
                    <i class="fa fa-spin fa-spinner"></i>
                    <i class="fa fa-spin fa-spinner m-l-12"></i>
                  </span>
                  }
                  @if (permission.joc && permission.joc.inventory.deploy && securityLevel !== 'HIGH' && (permission.controllerDefaults.deployments.deploy || permission.currentController.deployments.deploy)) {
                    <button
                      (click)="deploy()"
                      [disabled]="!workflow.valid && !workflow.hasDeployments"
                      class="btn btn-sm btn-grey m-l-12 m-t-n-xs" type="button">
                      <i class="fa fa-rocket p-r-xs"></i>
                      <span translate>inventory.button.deploy</span>
                    </button>
                  }
                </div>
              }
            </div>
          </div>
        </div>
        <div class="graph-container">
          <div class="inline" id="toolbar-icons">
            <ul class="nav navbar-nav navbar-nav-inline nav-active-border3 ">
              <li class="nav-item">
                <a (click)="zoomIn()" [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'workflow.button.zoomIn' | translate" class="nav-link">
                  <span class="nav-text"> <i nz-icon nzTheme="outline" nzType="zoom-in"></i></span>
                </a>
              </li>
              <li class="nav-item">
                <a (click)="zoomOut()" [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'workflow.button.zoomOut' | translate" class="nav-link">
                  <span class="nav-text"> <i nz-icon nzTheme="outline" nzType="zoom-out"></i></span>
                </a>
              </li>
              <li class="nav-item dropdown-separator">
                <span class="separator"></span>
              </li>
              <li class="nav-item">
                <a (click)="actual()" [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'workflow.button.actual' | translate" class="nav-link">
                  <span class="nav-text"> <i nz-icon nzTheme="outline" nzType="fullscreen-exit"></i></span>
                </a>
              </li>
              <li class="nav-item">
                <a (click)="fit()" [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'workflow.button.fit' | translate" class="nav-link">
                  <span class="nav-text"> <i nz-icon nzTheme="outline" nzType="column-width"></i></span>
                </a>
              </li>
              @if (!isTrash && permission.joc && permission.joc.inventory.manage) {
                <li class="nav-item dropdown-separator">
                  <span class="separator"></span>
                </li>
              }
              @if (!isTrash && permission.joc && permission.joc.inventory.manage) {
                <li [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'workflow.button.undo' | translate"
                    class="nav-item">
                  <a (click)="undo()" [ngClass]="{'disable-link': history.past.length === 0}" class="nav-link">
                    <span class="nav-text"> <i nz-icon nzTheme="outline" nzType="undo"></i></span>
                  </a>
                </li>
              }
              @if (!isTrash && permission.joc && permission.joc.inventory.manage) {
                <li [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'workflow.button.redo' | translate"
                    class="nav-item">
                  <a (click)="redo()" [ngClass]="{'disable-link': history.future.length === 0}" class="nav-link">
                    <span class="nav-text"> <i nz-icon nzTheme="outline" nzType="redo"></i></span>
                  </a>
                </li>
              }
              @if (!isTrash && permission.joc && permission.joc.inventory.manage) {
                <li class="nav-item dropdown-separator">
                  <span class="separator"></span>
                </li>
              }
              @if (permission.joc && permission.joc.inventory.manage) {
                <li [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'inventory.button.download' | translate"
                    class="nav-item">
                  <a (click)="exportJSON()" class="nav-link">
                    <span class="nav-text"> <i nz-icon nzTheme="outline" nzType="download"></i></span>
                  </a>
                </li>
              }
              @if (!isTrash && permission.joc && permission.joc.inventory.manage) {
                <li [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'inventory.button.upload' | translate"
                    class="nav-item">
                  <a (click)="importJSON()" class="nav-link">
                    <span class="nav-text"> <i nz-icon nzTheme="outline" nzType="upload"></i></span>
                  </a>
                </li>
              }
              <li class="nav-item dropdown-separator">
                <span class="separator"></span>
              </li>
              <li [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'workflow.button.exportInPng' | translate" class="nav-item">
                <a (click)="workflowService.exportInPng(data.name)" class="nav-link">
                  <span class="nav-text"> <i nz-icon nzTheme="outline" nzType="export"></i></span>
                </a>
              </li>
              <li class="nav-item">
                <a [nzTooltipPlacement]="'left'" [nzTooltipTitle]="tooltipTemplate" class="nav-link" nz-tooltip>
                  <span class="nav-text"> <i nz-icon nzTheme="outline" nzType="info-circle"></i></span>
                </a>
              </li>

              <ng-template #tooltipTemplate>
                <div class="m-a-xs">
                  <i class="fa fa-circle circle daily-plan-step-icon"></i><span translate>workflow.tooltip.singleClickToSelect</span><br>
                  <i class="fa fa-circle circle daily-plan-step-icon"></i><span translate>workflow.tooltip.doubleClickToSelect</span>
                </div>
              </ng-template>

            </ul>
          </div>
          <div id="outlineContainer"></div>
          <div id="graph"></div>
          <div class="card p-a pos-abt text-18 prev-next-icon" [hidden]="!editor?.graph || !editor?.graph.getSelectionCell()">
            <a (click)="prev()" class="text-primary-hover"><span nz-icon nzType="left-circle" nzTheme="outline"></span></a>
            <a (click)="next()" class="text-primary-hover m-l-12"><span nz-icon nzType="right-circle" nzTheme="outline"></span></a>
          </div>
          <div class="dropContainer" id="dropContainer2">
            <div class="dropContainer" translate>workflow.message.dropHereToRemoveInstruction</div>
          </div>
          <!-- Creates a container for the outline -->
        </div>
      </div>
    }
    @if (data.object) {
      <div class="col-md-12">
        <app-table [copyObj]="copyObj" [dataObj]="data" [isTrash]="isTrash" [objectType]="objectType" [securityLevel]="securityLevel"
                   [permission]="permission" [preferences]="preferences" [schedulerId]="schedulerId"></app-table>
      </div>
    }
  </div>

  <!-- BEGIN SLIDER -->
  <div [hidden]="!data.type" class="property-panel hidden-sm">
    <div class="sidebar-open">
      <i class="fa fa-caret-left"></i>
    </div>
    <div class="sidebar-close">
      <i class="fa fa-caret-right"></i>
    </div>
    <div appResizable class="sidebar sidebar-property-panel bg-white" id="property-panel">
      <div class="b-b m-a">
        <h5 class="p-b-xs">
          <span translate>workflow.label.properties</span>
          @if (selectedNode) {
            <span class="font14 text-primary p-l-xs">({{selectedNode.type | translate}})</span>
          }
          @if (!selectedNode) {
            <span class="font14 text-primary p-l-xs">({{'WORKFLOW' | translate}})</span>
          }
          @if (selectedNode && selectedNode.type === 'StickySubagent') {
            <a [nzTooltipTitle]="titleTemplate" class="p-l-sm" nz-tooltip>
              <i class="fa fa-info-circle"></i>
            </a>
          }
          <ng-template #titleTemplate>
            <span [innerHTML]="info3"></span>
          </ng-template>
        </h5>
      </div>
      @if (selectedNode) {
        <div class="m-l-sm m-r-12 text-left">
          @if (selectedNode.type === 'Job') {
            <div class="box-body p-t-0">
              <app-job-content (updateFromJobTemplateFn)="updateFromJobTemplate($event)" [workflowPath]="workflowPath" (jobTagsEvent)="onJobTags($event)" [agents]="inventoryService.agentList"
                               [documentationTree]="documentationTree"
                               [isTooltipVisible]="!preferences.showTooltipInfo" [jobResourcesTree]="jobResourcesTree"
                               [jobs]="jobs"
                               [orderPreparation]="orderPreparation" [preferences]="preferences"
                               [schedulerId]="schedulerId" [scriptTree]="scriptTree" [selectedNode]="selectedNode"
                               [timeZone]="extraConfiguration.timeZone"></app-job-content>
            </div>
          }
          <div class="box-body">
            @if (selectedNode.type !== 'Job' && selectedNode.type !== 'Cycle') {
              <div class="form-group row">
                <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.job.label' | translate) : ''"
                       class="col-md-4 col-lg-3 form-control-label"
                       translate>workflow.label.label
                </label>
                <div class="col-md-8 col-lg-9">
                  <label class="w-full">
                    <input #label="ngModel" [(ngModel)]="selectedNode.obj.label" autocomplete="off" class="form-control"
                           labelValidation maxlength="30"
                           name="label" required type="text">
                  </label>
                  @if (label.invalid && (label.dirty || label.touched)) {
                    <div class="text-danger help-block">
                      @if (label.errors && label.errors.invalidIdentifier) {
                        <div translate>common.message.invalid</div>
                      }
                    </div>
                  }
                </div>
              </div>
            }

            @if (selectedNode.type === 'If') {
              <div>
                <app-expression-content [error]="error" [tabSize]="preferences.tabSize" [isTooltipVisible]="!preferences.showTooltipInfo"
                                        [selectedNode]="selectedNode"></app-expression-content>
              </div>
            }

            @if (selectedNode.type === 'When') {
              <div>
                <app-expression-content [error]="error" [tabSize]="preferences.tabSize" [isTooltipVisible]="!preferences.showTooltipInfo"
                                        [selectedNode]="selectedNode"></app-expression-content>
              </div>
            }

            @if (selectedNode.type === 'Fork') {
              <div>
                <div class="form-group row">
                  <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.fork.joinIfFailed' | translate) : ''"
                         class="col-md-4 col-lg-3 block-ellipsis-job"
                         title="{{'workflow.label.joinIfFailed' | translate}}" translate>workflow.label.joinIfFailed</label>
                  <div class="col-md-8 col-lg-9">
                    <label [(ngModel)]="selectedNode.obj.joinIfFailed" name="joinIfFailed" nz-checkbox></label>
                  </div>
                </div>
                <div class="row">
                  <label class="col-md-12 _600 m-b-sm" translate>workflow.label.branches</label>
                </div>
                <nz-tabset [nzAnimated]="false" [nzType]="'line'">
                  @for (branch of selectedNode.obj.branches; track $index; let index = $index) {
                    <nz-tab [nzForceRender]="true" [nzTitle]="titleTemplate">
                      <ng-template #titleTemplate>
                        <div>
                          <span translate>workflow.label.branch</span>{{index + 1}}
                        </div>
                      </ng-template>
                      <div class="form-group row">
                        <label class="col-md-4 col-lg-3 form-control-label"
                               nz-tooltip="{{'workflow.label.branchId' | translate}}({{index + 1}})">
                          <span translate>workflow.label.branchId</span> ({{index + 1}})
                          <sup class="text-danger text-sm">*</sup>
                        </label>
                        <div [ngClass]="{'has-error' : ((branchs.dirty || branchs.touched) && branchs.invalid)}"
                             class="col-md-8 col-lg-9">
                          <input #branchs="ngModel" [(ngModel)]="branch.displayLabel" [appAutofocus]="true" [maxLength]="10" class="form-control"
                                 identifierValidation name="branchs{{index}}" required
                                 type="text">
                          @if (branchs.invalid && branchs.errors && (branchs.dirty || branchs.touched)) {
                            <div class="text-danger help-block">
                              @if (branchs.errors.required) {
                                <div translate>common.message.requiredError</div>
                              }
                              @if (branchs.errors.invalidIdentifier) {
                                <div translate>common.message.invalid</div>
                              }
                            </div>
                          }
                        </div>
                      </div>
                      <div class="form-group row">
                        @if (branch.result && branch.result.length > 0) {
                          <div class="col-md-12">
                            <div class="form-group row m-b-0">
                              <div class="col-md-4 col-lg-5 m-b-sm" translate>common.label.name</div>
                              <div class="col-md-8 col-lg-6 m-b-sm" translate>common.label.value</div>
                            </div>
                          </div>
                        }
                        <div class="col-md-12" style="max-height: calc(100vh - 332px); overflow: auto;min-height: 200px">
                          @for (item of branch.result; track $index; let i = $index) {
                            <div class="form-group row m-b-0">
                              <div [ngClass]="{'has-error' : ((aname.dirty || aname.touched) && aname.invalid)}"
                                   class="col-md-5 col-lg-5 m-b-sm">
                                <label class="w-full">
                                  <input #aname="ngModel" (blur)="isStringValid(item, aname)" [(ngModel)]="item.name" [appAutofocus]="i == branch.result.length -1"
                                         autocomplete="off" class="form-control"
                                         identifierValidation name="name{{index}}{{i}}"
                                         placeholder="{{'common.placeholder.name' | translate}} {{i+1}}"
                                         type="text">
                                </label>
                                @if (aname.invalid && aname.errors && (aname.dirty || aname.touched)) {
                                  <div class="text-danger help-block">
                                    @if (aname.errors.invalidIdentifier) {
                                      <div translate>common.message.invalid</div>
                                    }
                                  </div>
                                }
                              </div>
                              <div class="col-md-6 col-lg-6 m-b-sm">
                                <input [(ngModel)]="item.value" autocomplete="off" class="form-control" name="value{{index}}{{i}}"
                                       placeholder="{{'common.placeholder.value' | translate}} {{i+1}}"
                                       type="text"/>
                              </div>
                              <div class="col-md-1 col-lg-1 p-l-0">
                                <a><i (click)="removeResult(i, branch)" class="fa fa-times m-t-sm text-hover-color"></i></a>
                              </div>
                            </div>
                          }
                          <div class="form-group row">
                            @if (branch.result) {
                              <div class="col-sm-12">
                                <a (click)="addResult(branch);" class="text-u-l" translate>workflow.button.addResult</a>
                              </div>
                            }
                          </div>
                        </div>
                      </div>
                    </nz-tab>
                  }
                </nz-tabset>
                @if (selectedNode.obj.branches.length === 0) {
                  <div class="row">
                    <div class="col-md-12">
                      <app-empty-data [title]="'workflow.message.noBranchFound'"></app-empty-data>
                    </div>
                  </div>
                }
              </div>
            }

            @if (selectedNode.type === 'ForkList') {
              <div>
                <nz-collapse [hidden]="fullScreen" [nzBordered]="false">
                  <nz-collapse-panel (click)="selectedNode.radio1 = 'byListVariable'" [nzActive]="selectedNode.radio1 == 'byListVariable'"
                                     [nzDisabled]="selectedNode.radio1 == 'byListVariable'"
                                     [nzHeader]="headerTemplate"
                                     class="m-b">
                    <ng-template #headerTemplate>
                      <span translate>workflow.label.byListVariable</span>
                      <a [nzTooltipTitle]="titleTemplate" class="p-l-sm" nz-tooltip>
                        <i class="fa fa-info-circle"></i></a>
                      <ng-template #titleTemplate>
                        <span [innerHTML]="info1"></span>
                      </ng-template>
                    </ng-template>
                    <div class="p-a b-a m-t">
                      <div [ngClass]="{'has-error' : ((children.dirty || children.touched) && children.invalid)}"
                           class="form-group row">
                        <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.forkList.children' | translate) : ''"
                               class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.children
                          <sup class="text-danger text-sm">*</sup>
                        </label>
                        <div class="col-md-8 col-lg-9">
                          <nz-select #children="ngModel" [(ngModel)]="selectedNode.obj.children" name="children"
                                     nzShowSearch (ngModelChange)="selectListForForkList($event)"
                                     required>
                            @for (item of forkListVariables; track item) {
                              <ng-container>
                                <nz-option [nzLabel]="item.name" [nzValue]="item.name" nzCustomContent>
                                  {{item.name}}<i (click)="editForkListVariables(item);$event.stopPropagation()"
                                                  class="fa fa-pencil text-hover-primary p-l-sm"></i>
                                  <i (click)="deleteForkListVariables(item);$event.stopPropagation()"
                                     class="fa fa-times text-danger-hover pull-right" style="margin-top: 5px"></i>
                                </nz-option>
                              </ng-container>
                            }
                          </nz-select>
                          @if (children.invalid && (children.dirty || children.touched)) {
                            <div class="text-danger help-block">
                              @if (children.errors.required) {
                                <div translate>common.message.requiredError</div>
                              }
                            </div>
                          }
                        </div>
                      </div>
                      <div class="form-group row">
                        <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.forkList.childToId' | translate) : ''"
                               class="col-md-4 col-lg-3 form-control-label" title="{{'workflow.label.childToId' | translate}}"
                               translate>workflow.label.childToId</label>
                        <div class="col-md-8 col-lg-9">
                          <nz-select [(ngModel)]="selectedNode.obj.childToId" name="childToId" nzAllowClear>
                            @for (item of listOfParams; track item) {
                              <nz-option [nzLabel]="item.name" [nzValue]="item.name"></nz-option>
                            }
                          </nz-select>
                        </div>
                      </div>
                    </div>
                  </nz-collapse-panel>
                </nz-collapse>
                @if (hasLicense) {
                  <nz-collapse [hidden]="fullScreen" [nzBordered]="false">
                    <nz-collapse-panel (click)="selectedNode.radio1 = 'bySubagentCluster'" [nzActive]="selectedNode.radio1 == 'bySubagentCluster'"
                                       [nzDisabled]="selectedNode.radio1 == 'bySubagentCluster'" [nzHeader]="headerTemplate2"
                                       class="m-b">
                      <ng-template #headerTemplate2>
                        <span translate>workflow.label.bySubagentCluster</span>
                        <a [nzTooltipTitle]="titleTemplate" class="p-l-sm" nz-tooltip>
                          <i class="fa fa-info-circle"></i></a>
                        <ng-template #titleTemplate>
                          <span [innerHTML]="info2"></span>
                        </ng-template>
                      </ng-template>
                      <div class="p-a b-a m-t">
                        <div class="form-group row">
                          <div [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? (titleTemplate) : ''"
                               class="col-md-4 col-lg-3 block-ellipsis-job" translate>
                            workflow.label.agentAssignment
                            <sup class="text-danger text-sm">*</sup>
                          </div>
                          <ng-template #titleTemplate>
                            <span [innerHTML]="forkListAgentAssignment"></span>
                          </ng-template>
                          <div class="col-md-8 col-lg-9">
                            <nz-radio-group [(ngModel)]="selectedNode.radio" (ngModelChange)="changeAgentSelection($event)" >
                              <label nz-radio nzValue="agent"><span translate>workflow.label.agentSelectFromList</span></label>
                              <label nz-radio nzValue="expression"><span translate>workflow.label.agentAsExpression</span></label>
                            </nz-radio-group>
                          </div>
                        </div>
                        <div class="form-group row">
                          @if (selectedNode.radio == 'agent') {
                            <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.forkList.subagent' | translate) : ''"
                                   class="col-md-4 col-lg-3 form-control-label">
                              <span translate>workflow.label.subagentCluster</span>
                              <sup class="text-danger text-sm">*</sup>
                            </label>
                          }
                          @if (selectedNode.radio == 'expression') {
                            <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.forkList.agentCluster' | translate) : ''"
                                   class="col-md-4 col-lg-3 form-control-label">
                              <span translate>workflow.label.agentCluster</span>
                              <sup class="text-danger text-sm">*</sup>
                            </label>
                          }
                          @if (selectedNode.radio == 'agent') {
                            <div class="col-md-8 col-lg-9">
                              <app-agent-selection (selectSubagentCluster)="selectSubagentCluster($event)" [agents]="inventoryService.agentList"
                                                   [data]="selectedNode.obj"
                                                   [preferences]="preferences"
                                                   [skipStandaloneAgent]="true"></app-agent-selection>
                            </div>
                          }
                          @if (selectedNode.radio == 'expression') {
                            <div class="col-md-8 col-lg-9">
                              <app-agent-selection [agents]="inventoryService.agentList" [data]="selectedNode.obj"
                                                   [preferences]="preferences" [skipStandaloneAgent]="true"
                                                   [skipSubagents]="true"></app-agent-selection>
                            </div>
                          }
                        </div>
                        @if (selectedNode.radio == 'expression') {
                          <div class="form-group row">
                            <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.forkList.subagentClusterIdExpr' | translate) : ''"
                                   class="col-md-4 col-lg-3 form-control-label"
                                   translate>workflow.label.subagentClusterIdExpr
                              <sup class="text-danger text-sm">*</sup>
                            </label>
                            <div [ngClass]="{'has-error' : ((subagentClusterIdExpr.dirty || subagentClusterIdExpr.touched) && subagentClusterIdExpr.invalid)}"
                                 class="col-md-8 col-lg-9">
                          <textarea #subagentClusterIdExpr="ngModel" [(ngModel)]="selectedNode.obj.subagentClusterIdExpr" [attr.placeholder]="'workflow.placeholder.enterSubagentClusterIdExpr' | translate"
                                    class="form-control"
                                    name="subagentClusterIdExpr"
                                    required></textarea>
                            </div>
                          </div>
                        }
                        @if (coreService.expertMode) {
                          <div class="form-group row">
                            <div class="col-md-12">
                              <button (click)="propagateJobs()" class="btn btn-grey btn-sm" translate
                                      type="button">inventory.search.button.propagateJob
                              </button>
                            </div>
                          </div>
                        }
                      </div>
                    </nz-collapse-panel>
                  </nz-collapse>
                }

                <div class="form-group row">
                  <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.forkList.joinIfFailed' | translate) : ''"
                         class="col-md-4 col-lg-3 block-ellipsis-job"
                         title="{{'workflow.label.joinIfFailed' | translate}}" translate>workflow.label.joinIfFailed</label>
                  <div class="col-md-8 col-lg-9">
                    <label [(ngModel)]="selectedNode.obj.joinIfFailed" name="joinIfFailed" nz-checkbox></label>
                  </div>
                </div>
                <div class="form-group row m-b-0">
                  @if (selectedNode.obj.result && selectedNode.obj.result.length > 0) {
                    <div class="col-md-12">
                      <div class="form-group row m-b-0">
                        <div class="col-md-4 col-lg-5 m-b-sm p-r-0" translate>common.label.name</div>
                        <div class="col-md-8 col-lg-6 m-b-sm" translate>common.label.value</div>
                      </div>
                    </div>
                  }
                  <div class="col-md-12" style="max-height: calc(100vh - 396px); overflow: auto;">
                    @for (item of selectedNode.obj.result; track $index; let i = $index) {
                      <div class="form-group row m-b-0">
                        <div [ngClass]="{'has-error' : ((bname.dirty || bname.touched) && bname.invalid)}"
                             class="col-md-5 col-lg-5 m-b-sm p-r-0">
                          <label class="w-full">
                            <input #bname="ngModel" (blur)="isForklistStringValid(item, bname)" [(ngModel)]="item.name" [appAutofocus]="i == selectedNode.obj.result.length -1" autocomplete="off"
                                   class="form-control" identifierValidation
                                   name="name{{i}}"
                                   placeholder="{{'common.placeholder.name' | translate}} {{i+1}}"
                                   type="text">
                          </label>
                          @if (bname.invalid && bname.errors && (bname.dirty || bname.touched)) {
                            <div class="text-danger help-block">
                              @if (bname.errors.invalidIdentifier) {
                                <div translate>common.message.invalid</div>
                              }
                            </div>
                          }
                        </div>
                        <div class="col-md-6 col-lg-6 m-b-sm">
                          <input [(ngModel)]="item.value" autocomplete="off" class="form-control" name="value{{i}}"
                                 placeholder="{{'common.placeholder.value' | translate}} {{i+1}}"
                                 type="text"/>
                        </div>
                        <div class="col-md-1 col-lg-1 p-l-0">
                          <a><i (click)="removeResult(i, selectedNode.obj)"
                                class="fa fa-times m-t-sm text-hover-color"></i></a>
                        </div>
                      </div>
                    }
                    <div class="form-group row">
                      <div class="col-sm-12">
                        <a (click)="addResult(selectedNode.obj);" class="text-u-l" translate>workflow.button.addResult</a>
                      </div>
                    </div>
                  </div>
                </div>
                @if (selectedNode.radio1 == 'byListVariable') {
                  <div [hidden]="forkListVariableObj && forkListVariableObj.value" class="form-group row">
                    <div class="col-md-12">
                      <a (click)="createForkListVariables();" class="text-hover-primary"><i
                        class="fa fa-plus p-r-sm"></i>{{'workflow.button.createForkListVariables' | translate}}</a>
                    </div>
                  </div>
                }
                @if (forkListVariableObj && forkListVariableObj.value && selectedNode.radio1 == 'byListVariable') {
                  <div class="b-a p-a">
                    <div class="form-group row">
                      @if (forkListVariableObj.create) {
                        <div class="col-md-12 _600" translate>
                          workflow.label.createForkListVariable
                        </div>
                      }
                      @if (!forkListVariableObj.create) {
                        <div class="col-md-12 _600" translate>
                          workflow.label.updateForkListVariable
                        </div>
                      }
                    </div>
                    <form #myForm="ngForm" (ngSubmit)="onSubmit()">
                      <div class="form-group row">
                        <label class="col-md-4 col-lg-3 form-control-label" translate>common.label.name
                          <sup class="text-danger text-sm">*</sup>
                        </label>
                        <div [ngClass]="{'has-error' : ((name.dirty || name.touched) && name.invalid)}"
                             class="col-md-8 col-lg-9">
                          <input #name="ngModel" [(ngModel)]="forkListVariableObj.name" autocomplete="off" class="form-control" identifierValidation
                                 name="name" placeholder="{{'common.placeholder.name' | translate}}" required
                                 type="text">
                          @if (name.invalid && name.errors && (name.dirty || name.touched)) {
                            <div class="text-danger help-block">
                              @if (name.errors.required) {
                                <div translate>common.message.requiredError</div>
                              }
                              @if (name.errors.invalidIdentifier) {
                                <div translate>common.message.invalid</div>
                              }
                            </div>
                          }
                        </div>
                      </div>
                      <div class="form-group row">
                        <label class="col-md-12 _600" translate>order.label.variables</label>
                      </div>
                      <div class="form-group row m-b-0">
                        <div class="col-md-5 col-lg-5 m-b-sm" translate>common.label.name</div>
                        <div class="col-md-7 col-lg-7 m-b-sm" translate>common.label.type</div>
                      </div>
                      @for (param of forkListVariableObj.value.listParameters; track $index; let j = $index) {
                        <div class="row">
                          <div [ngClass]="{'has-error' : ((name.dirty || name.touched) && name.invalid)}"
                               class="col-md-5 col-lg-5 m-b-sm p-r-0">
                            <input #name="ngModel" (blur)="checkDuplicateEntries(param, j, forkListVariableObj.value.listParameters)" [(ngModel)]="param.name" [readonly]="isTrash" autocomplete="off"
                                   class="form-control" identifierValidation name="name{{j}}"
                                   placeholder="{{'common.placeholder.name' | translate}}"
                                   type="text">
                            @if (name.invalid && name.errors && (name.dirty || name.touched)) {
                              <div class="text-danger help-block">
                                @if (name.errors.invalidIdentifier) {
                                  <div translate>common.message.invalid</div>
                                }
                              </div>
                            }
                          </div>
                          <div class="col-md-6 col-lg-6 m-b-sm p-r-0">
                            <nz-select [(ngModel)]="param.value.type" [nzDisabled]="isTrash" name="type{{j}}">
                              <nz-option [nzLabel]="'String' | translate" [nzValue]="'String'"></nz-option>
                              <nz-option [nzLabel]="'Number' | translate" [nzValue]="'Number'"></nz-option>
                              <nz-option [nzLabel]="'Boolean' | translate" [nzValue]="'Boolean'"></nz-option>
                            </nz-select>
                          </div>
                          @if (forkListVariableObj.value.listParameters.length > 1) {
                            <div class="col-md-1 col-lg-1">
                              <a><i (click)="removeVariableFromList(forkListVariableObj.value.listParameters, j, false)"
                                    class="fa fa-times m-t-sm text-hover-color"></i></a>
                            </div>
                          }
                        </div>
                      }
                      <div class="form-group row">
                        <div class="col-sm-12">
                          <a (click)="addVariableToList(forkListVariableObj.value)" class="text-u-l"
                             translate>order.button.addVariable</a>
                        </div>
                      </div>
                      <div class="form-group row m-b-sm">
                        <div class="col-md-12 m-t-xs">
                          <button [disabled]="!myForm.form.valid" class="btn btn-primary btn-sm" type="submit">
                            {{'common.button.submit' | translate}}
                          </button>
                          <button (click)="cancel()" class="btn btn-grey btn-sm m-l-12" translate
                                  type="button">common.button.cancel
                          </button>
                        </div>
                      </div>
                    </form>
                  </div>
                }
              </div>
            }

            @if (selectedNode.type === 'PostNotices') {
              <div>
                <div class="form-group row">
                  <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.board.boardNames' | translate) : ''"
                         class="col-md-4 col-lg-3 form-control-label"
                         title="{{'workflow.label.boardNames' | translate}}" translate>workflow.label.boardNames
                    <sup class="text-danger text-sm">*</sup>
                  </label>
                  <div class="col-md-8 col-lg-9">
                    <app-multi-select [attribute]="'noticeBoardNames'" [list]="selectedNode.obj" [nodes]="boardTree"
                                      [type]="'NOTICEBOARD'"></app-multi-select>
                  </div>
                </div>
              </div>
            }

            @if (selectedNode.type === 'ExpectNotices' || selectedNode.type === 'ConsumeNotices') {
              <div>
                <div class="form-group row">
                  @if (selectedNode.type === 'ExpectNotices') {
                    <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.board.expectBoardExpression' | translate) : ''"
                           class="col-md-4 col-lg-3 form-control-label"
                           title="{{'workflow.label.expectBoardExpression' | translate}}" translate>workflow.label.expectBoardExpression
                      <sup class="text-danger text-sm">*</sup>
                    </label>
                  }
                  @if (selectedNode.type === 'ConsumeNotices') {
                    <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.board.consumeBoardExpression' | translate) : ''"
                           class="col-md-4 col-lg-3 form-control-label"
                           title="{{'workflow.label.consumeBoardExpression' | translate}}" translate>workflow.label.consumeBoardExpression
                      <sup class="text-danger text-sm">*</sup>
                    </label>
                  }
                  @if (isDisplay) {
                    <div class="col-md-8 col-lg-9">
                      @if (selectedNode.isTreeShow) {
                        <div class="z-index-9999 pos-abt opacity0" id="show-tree"
                             style="min-width: 150px;">
                          <app-search-input (onBlur)="onBlur($event)" (onSelect)="checkExpectNoticeExp($event)" [changeDetect]="true"
                                            [nodes]="boardTree" [type]="'NOTICEBOARD'"></app-search-input>
                        </div>
                      }
                      <i (click)="openEditor(selectedNode.obj, 'noticeBoardNames')" class="pos-abt z-index-9999 text-20 r-15 t-1" nz-icon nzTheme="outline"
                         nzType="form"></i>
                      <div [ngClass]="{'invalid': (expectBoardExpression.invalid && (expectBoardExpression.dirty && expectBoardExpression.touched))}" class="b-a"
                           id="boardId">
                        <app-codemirror-editor #codeEditor #expectBoardExpression="ngModel"
                                        [(ngModel)]="selectedNode.obj.noticeBoardNames" [options]="{
                                    lineNumbers: false, autoRefresh: true, scrollbarStyle: 'simple',
                                    tabSize: preferences.tabSize,
                                    mode: 'shell'}"
                                        required
                        ></app-codemirror-editor>
                      </div>
                      <div class="text-sm text-muted" translate>workflow.label.showNoticeBoardNames</div>
                    </div>
                  }
                </div>
              </div>
            }

            @if (selectedNode.type === 'ConsumeNotices' || selectedNode.type === 'ExpectNotices') {
              <div>
                <div class="form-group row">
                  <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.board.whenNotAnnounced' | translate) : ''"
                         class="col-md-4 col-lg-3 form-control-label"
                         title="{{'workflow.label.whenNotAnnounced' | translate}}" translate>workflow.label.whenNotAnnounced
                    <sup class="text-danger text-sm">*</sup>
                  </label>
                  <div class="col-md-8 col-lg-9">
                    <nz-select
                      #whenNotAnnounced="ngModel"
                      [(ngModel)]="selectedNode.obj.whenNotAnnounced"
                      [nzPlaceHolder]="'common.placeholder.selectValue' | translate"
                      name="whenNotAnnounced"
                    >
                      <nz-option [nzLabel]="('workflow.label.wait') | translate" [nzValue]="'Wait'"></nz-option>
                      @if (selectedNode.type === 'ConsumeNotices') {
                        <nz-option [nzLabel]="('workflow.label.dontWait') | translate" [nzValue]="'DontWait'"></nz-option>
                      }
                      <nz-option [nzLabel]="('workflow.label.skipWhenNoNotice') | translate" [nzValue]="'SkipWhenNoNotice'"></nz-option>
                    </nz-select>
                  </div>
                </div>
              </div>
            }

            @if (selectedNode.type === 'Prompt') {
              <div>
                <div class="form-group row">
                  <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.prompt.question' | translate) : ''"
                         class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.question</label>
                  <div class="col-md-8 col-lg-9">
                <textarea [(ngModel)]="selectedNode.obj.question" [appAutofocus]="true" class="form-control" name="question"
                          rows="2"></textarea>
                  </div>
                </div>
              </div>
            }

            @if (selectedNode.type === 'Finish') {
              <div>
                <div class="m-b-12 row">
                  <label class="col-md-4 col-lg-3"
                         translate>
                  </label>
                  <div class="col-md-8 col-lg-9">
                    <nz-radio-group [(ngModel)]="selectedNode.obj.type" (ngModelChange)="changeSettings($event)"
                                    name="type">
                      <label
                        [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.finish.unchanged' | translate) : ''"
                        nz-radio nzValue="unchanged"><span translate>workflow.label.unchanged</span></label>
                      <label
                        [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.finish.unsuccessful' | translate) : ''"
                        nz-radio nzValue="unsuccessful"><span translate>workflow.label.unsuccessful</span></label>
                      <label
                        [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.finish.successful' | translate) : ''"
                        nz-radio nzValue="successful"><span translate>workflow.label.successful</span></label>
                    </nz-radio-group>
                  </div>
                </div>
                @if (selectedNode.obj.type == 'unsuccessful') {
                  <div class="form-group row">
                    <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.finish.message' | translate) : ''"
                           class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.message</label>
                    <div class="col-md-8 col-lg-9">
                  <textarea [(ngModel)]="selectedNode.obj.message" [appAutofocus]="true" class="form-control" name="message"
                            rows="3"></textarea>
                    </div>
                  </div>
                }
              </div>
            }

            @if (selectedNode.type === 'Options') {
              <div>
                <div class="form-group row">
                  <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.options.stopOnFailure' | translate) : ''"
                         class="col-md-4 col-lg-3 block-ellipsis-job" translate>workflow.label.stopOnFailure</label>
                  <div class="col-md-8 col-lg-9">
                    <label [(ngModel)]="selectedNode.obj.stopOnFailure" name="stopOnFailure" nz-checkbox></label>
                  </div>
                </div>
              </div>
            }

            @if (selectedNode.type === 'AdmissionTime') {
              <div>
                <div class="form-group row">
                  <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.job.skipIfNoAdmissionForOrderDayForInstruction' | translate) : ''"
                         class="col-md-4 col-lg-3 block-ellipsis-job" translate>workflow.label.skipIfNoAdmissionForOrderDayForInstruction</label>
                  <div class="col-md-8 col-lg-9">
                    <label [(ngModel)]="selectedNode.obj.skipIfNoAdmissionForOrderDay" name="stopOnFailure" nz-checkbox></label>
                  </div>
                </div>
                <app-admission-time
                  [data]="selectedNode.data"
                  [job]="selectedNode.obj"
                  [timeZone]="preferences.zone"
                  [isTooltipVisible]="!preferences.showTooltipInfo">
                </app-admission-time>
              </div>
            }

            @if (selectedNode.type === 'Fail') {
              <div>
                <div class="form-group row">
                  <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.fail.message' | translate) : ''"
                         class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.message</label>
                  <div class="col-md-8 col-lg-9">
                <textarea [(ngModel)]="selectedNode.obj.message" [appAutofocus]="true" class="form-control" name="message"
                          rows="2"></textarea>
                  </div>
                </div>
                <div class="form-group row">
                  <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.fail.returnCode' | translate) : ''"
                         class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.returnCode</label>
                  <div class="col-md-8 col-lg-9">
                    <nz-input-number [(ngModel)]="selectedNode.obj.outcome.returnCode" [nzMin]="0" [nzStep]="1"
                                     name="returnCode"></nz-input-number>
                  </div>
                </div>
                <div class="form-group row">
                  <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.fail.uncatchable' | translate) : ''"
                         class="col-md-4 col-lg-3 block-ellipsis-job" translate>workflow.label.uncatchable</label>
                  <div class="col-md-8 col-lg-9">
                    <label [(ngModel)]="selectedNode.obj.uncatchable" name="uncatchable" nz-checkbox></label>
                  </div>
                </div>
              </div>
            }

            @if (selectedNode.type === 'Sleep') {
              <div>
                <div class="form-group row">
                  <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.duration' | translate) : ''"
                         class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.duration
                    <sup class="text-danger text-sm">*</sup>
                  </label>
                  <div class="col-md-8 col-lg-9">
                    <input #duration="ngModel"  [(ngModel)]="selectedNode.obj.duration"  autocomplete="off"
                           class="form-control"  name="name" required
                           type="text"/>
                    @if (duration.invalid && duration.errors && (duration.dirty || duration.touched)) {
                      <div class="text-danger help-block">
                        @if (duration.errors.required) {
                          <div translate>common.message.requiredError</div>
                        }
                        @if (duration.errors.invalidIdentifier) {
                          <div translate>common.message.invalid</div>
                        }
                      </div>
                    }
                  </div>
                </div>
              </div>
            }

            @if (selectedNode.type === 'Retry') {
              <div>
                <div class="form-group row">
                  <div class="col-md-4 col-lg-3" translate>workflow.label.tries</div>
                  <div  class="col-md-6 col-lg-8">
                    <nz-radio-group [(ngModel)]="selectedNode.obj.tries" >
                      <label nz-radio nzValue="limited"><span translate>workflow.label.limited</span></label>
                      <label nz-radio nzValue="unlimited"><span translate>workflow.label.unlimited</span></label>
                    </nz-radio-group>
                  </div>
                </div>
                @if (selectedNode.obj.tries == 'limited') {
                  <ng-container>
                    <div class="form-group row">
                      <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.retry.maxTries' | translate) : ''"
                             class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.maxTries
                        <sup class="text-danger text-sm">*</sup>
                      </label>
                      <div class="col-md-8 col-lg-9" [ngClass]="{'has-error' : ((maxTries.dirty || maxTries.touched) && maxTries.invalid)}">
                        <nz-input-number #maxTries="ngModel" (nzBlur)="checkDelayEntries()" [(ngModel)]="selectedNode.obj.maxTries" [appAutofocus]="true"
                                         [nzMin]="0" [nzStep]="1" name="maxTries" [required]="selectedNode.obj.tries == 'limited'">
                        </nz-input-number>
                        @if (maxTries.invalid && (maxTries.dirty || maxTries.touched)) {
                          <div class="text-danger help-block">
                            @if (maxTries.errors.required) {
                              <div translate>common.message.requiredError</div>
                            }
                          </div>
                        }
                      </div>
                    </div>
                    @if (selectedNode.obj.retryDelays?.length > 0) {
                      <div class="form-group row">
                        <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.retry.delay' | translate) : ''"
                               class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.delay</label>
                        <div class="col-md-8 col-lg-9">
                          <div (cdkDropListDropped)="dropDelay($event, selectedNode.obj.retryDelays)" cdkDropList>
                            @for (argument of selectedNode.obj.retryDelays; track $index; let i = $index) {
                              <div cdkDrag class="form-group row m-b-0 move-on-hover">
                                <div cdkDragHandle class="pos-abt move-icon m-l-n-13"
                                     style="font-size: 18px;margin-top: 2px;cursor: move;">
                                  <i aria-hidden="true" class="fa fa-bars"></i>
                                </div>
                                <div [ngClass]="{'has-error' : ((duration.dirty || duration.touched) && duration.invalid)}"
                                     class="col-md-12 m-b-sm">
                                  <label class="w-full">
                                    <input #duration="ngModel" [(ngModel)]="argument.value" appValidateOffset autocomplete="off" class="form-control"
                                           name="value{{i}}" placeholder="{{'workflow.placeholder.retryDelay' | translate}}"
                                           type="text">
                                  </label>
                                </div>
                                <div class="pos-abt r-n-xs">
                                  <a><i (click)="removeDelay(i, selectedNode.obj.retryDelays)"
                                        class="fa fa-times m-t-sm text-hover-color"></i></a>
                                </div>
                              </div>
                            }
                          </div>
                        </div>
                      </div>
                    }
                    @if (selectedNode.obj.maxTries > 0) {
                      <div class="form-group row">
                        @if (selectedNode.obj.retryDelays && selectedNode.obj.maxTries > (selectedNode.obj.retryDelays.length + 1)) {
                          <div class="col-sm-12 m-b-sm">
                            <a (click)="addDelay(selectedNode.obj.retryDelays);" class="text-u-l"
                               translate>workflow.button.addDelay</a>
                          </div>
                        }
                        @if (selectedNode.obj.maxTries > (selectedNode.obj.retryDelays.length + 1)) {
                          <div class="col-sm-12">
                            <a (click)="addAllDelay();" class="text-u-l" translate>workflow.button.addAllDelay</a>
                          </div>
                        }
                      </div>
                    }
                  </ng-container>
                }
              </div>
            }

            @if (selectedNode.type === 'StickySubagent') {
              <div>
                @if (hasLicense) {
                  <div class="form-group row">
                    <div [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? (titleTemplate) : ''"
                         class="col-md-4 col-lg-3" translate>workflow.label.agentAssignment
                      <sup class="text-danger text-sm">*</sup>
                    </div>
                    <ng-template #titleTemplate>
                      <span [innerHTML]="stickySubagentAgentAssignment"></span>
                    </ng-template>
                    <div class="col-md-8 col-lg-9">
                      <nz-radio-group [(ngModel)]="selectedNode.radio" (ngModelChange)="changeAgentSelection($event)">
                        <label nz-radio nzValue="agent"><span translate>workflow.label.subagentCluster</span></label>
                        <label nz-radio nzValue="expression"><span translate>workflow.label.agentAsExpression</span></label>
                      </nz-radio-group>
                    </div>
                  </div>
                }
                <div class="form-group row">
                  @if (selectedNode.radio == 'agent') {
                    <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.stickySubagent.subagent' | translate) : ''"
                           class="col-md-4 col-lg-3 form-control-label">
                      <span translate>workflow.label.subagentCluster</span>
                      <sup class="text-danger text-sm">*</sup>
                    </label>
                  }
                  @if (selectedNode.radio == 'expression') {
                    <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.stickySubagent.agentCluster' | translate) : ''"
                           class="col-md-4 col-lg-3 form-control-label">
                      <span translate>workflow.label.agentCluster</span>
                      <sup class="text-danger text-sm">*</sup>
                    </label>
                  }
                  @if (selectedNode.radio == 'agent') {
                    <div class="col-md-8 col-lg-9">
                      <app-agent-selection (selectSubagentCluster)="selectSubagentCluster($event)" [agents]="inventoryService.agentList"
                                           [data]="selectedNode.obj"
                                           [preferences]="preferences"
                                           [skipStandaloneAgent]="true"></app-agent-selection>
                    </div>
                  }
                  @if (selectedNode.radio == 'expression') {
                    <div class="col-md-8 col-lg-9">
                      <app-agent-selection [agents]="inventoryService.agentList" [data]="selectedNode.obj"
                                           [preferences]="preferences" [skipStandaloneAgent]="true"
                                           [skipSubagents]="true"></app-agent-selection>
                    </div>
                  }
                </div>
                @if (selectedNode.radio == 'expression') {
                  <div class="form-group row">
                    <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.stickySubagent.subagentClusterIdExpr' | translate) : ''"
                           class="col-md-4 col-lg-3 form-control-label"
                           translate>workflow.label.subagentClusterIdExpr
                    </label>
                    <div class="col-md-8 col-lg-9">
                  <textarea [(ngModel)]="selectedNode.obj.subagentClusterIdExpr" [attr.placeholder]="'workflow.placeholder.enterSubagentClusterIdExpr' | translate"
                            class="form-control"
                            name="subagentClusterIdExpr"></textarea>
                    </div>
                  </div>
                }
                @if (coreService.expertMode) {
                  <div class="form-group row">
                    <div class="col-md-12">
                      <button (click)="propagateJobs()" class="btn btn-grey btn-sm" translate
                              type="button">inventory.search.button.propagateJob
                      </button>
                    </div>
                  </div>
                }
              </div>
            }

            @if (selectedNode.type === 'Lock') {
              <div>
                <div class="form-group row">
                  <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.lock.name' | translate) : ''"
                         class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.name
                    <sup class="text-danger text-sm">*</sup>
                  </label>
                  <div class="col-md-8 col-lg-9">
                    <app-multi-select [attribute]="'lockNames'" [list]="selectedNode.obj" [nodes]="lockTree"
                                      [type]="'LOCK'"></app-multi-select>
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-md-4 col-lg-3"></label>
                  <div class="col-md-8 col-lg-9">
                    <nz-radio-group [(ngModel)]="selectedNode.obj.countProperty">
                      <label nz-radio nzValue="exclusive"><span translate>workflow.label.exclusive</span></label>
                      <label (click)="selectedNode.obj.count = 1" nz-radio nzValue="shared"><span
                        translate>workflow.label.shared</span></label>
                    </nz-radio-group>
                  </div>
                </div>
                @if (selectedNode.obj.countProperty === 'shared') {
                  <div>
                    @for (item of selectedNode.obj.lockNames; track $index; let i = $index) {
                      <div class="form-group row">
                        <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.lock.count' | translate) : ''"
                               class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.count</label>
                        <div class="col-md-8 col-lg-9">
                          <nz-input-number [(ngModel)]="selectedNode.obj[item]" [nzMin]="1" [nzStep]="1"
                                           name="count{{i}}"></nz-input-number>
                        </div>
                      </div>
                    }
                  </div>
                }
              </div>
            }

            @if (selectedNode.type === 'Cycle') {
              <div>
                <app-cycle-instruction [isTooltipVisible]="!preferences.showTooltipInfo"
                                       [selectedNode]="selectedNode" [timeZone]="extraConfiguration.timeZone">
                </app-cycle-instruction>
              </div>
            }

            @if (selectedNode.type === 'AddOrder') {
              <div>
                <div class="form-group row">
                  <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.addOrder.workflowName' | translate) : ''"
                         class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.workflowName
                    <sup class="text-danger text-sm">*</sup>
                  </label>
                  <div [ngClass]="{'has-error' : (error && !selectedNode.obj.workflowName) || ((workflowName.dirty || workflowName.touched) && workflowName.invalid)}"
                       class="col-md-8 col-lg-9">
                    <input #workflowName="ngModel" (click)="selectedNode.isTreeShow = true;" [(ngModel)]="selectedNode.obj.workflowName" autocomplete="off"
                           class="form-control"
                           name="workflowName" placeholder="{{'inventory.placeholder.workflowName' | translate}}"
                           required type="text">
                    @if (selectedNode.isTreeShow) {
                      <div [ngStyle]="{'margin-top': '-29px'}" class="z-index-9999 w-full">
                        <app-search-input (onBlur)="onSelectBlur()" (onSelect)="onSelect($event)" [changeDetect]="true"
                                          [isDisplay]="true" [nodes]="workflowTree"
                                          [type]="'WORKFLOW'"></app-search-input>
                      </div>
                    }
                    @if ((error && !selectedNode.obj.workflowName) || (workflowName.invalid && (workflowName.dirty || workflowName.touched))) {
                      <div class="text-danger help-block">
                        @if ((error && !selectedNode.obj.workflowName) || (workflowName.errors && workflowName.errors.required)) {
                          <div translate>common.message.requiredError</div>
                        }
                      </div>
                    }
                    @if (selectedNode.obj.workflowName) {
                      <div class="pos-abt" style="right: -8px;margin-top: -25px">
                        <i (click)="navToObj(selectedNode.obj.workflowName, 'WORKFLOW')" class="fa fa-pencil cursor"></i>
                      </div>
                    }
                  </div>
                </div>

                <div class="form-group row">
                  <label class="col-lg-3 col-xl-3 col-xxl-3 form-control-label" translate>inventory.label.tagName</label>
                  <div class="col-md-8 col-lg-9">
                    <div class="b-a p-l-sm p-r-sm p-t-xs p-b-xs">
                      @for (tag of selectedNode.obj.tags; track $index; let i = $index) {
                        <nz-tag
                          [nzMode]="'closeable'"
                          (nzOnClose)="handleClose(tag)"
                        >
                          {{ sliceTagName(tag) }}
                        </nz-tag>
                      }
                      @if (!inputVisible) {
                        <nz-tag class="editable-tag" nzNoAnimation (click)="showInput()">
                          <span nz-icon nzType="plus"></span>
                          {{'inventory.button.newTag' | translate}}
                        </nz-tag>
                      }
                      @if (inputVisible) {
                        <div class="d-inline-block" [ngClass]="{'has-error' : ((name.dirty || name.touched) && name.invalid)}">
                          <input
                            #name="ngModel"
                            #inputElement
                            tagValidation
                            [nzAutocomplete]="auto"
                            nz-input
                            name="tag"
                            type="text"
                            [(ngModel)]="inputValue"
                            (ngModelChange)="onChange($event)"
                            style="width: 128px;"
                            (blur)="handleInputConfirm()"
                            (keydown.enter)="handleInputConfirm()"
                          />
                          <nz-autocomplete [nzDataSource]="filteredOptions" #auto></nz-autocomplete>
                        </div>
                      }
                    </div>
                  </div>
                </div>

                <div class="form-group row" [hidden]="!blockPositions || blockPositions?.size == 0">
                  <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.addOrder.blockPosition' | translate) : ''"
                         class="col-md-4 col-lg-3 form-control-label"
                         title="{{'workflow.label.blockPosition' | translate}}" translate>workflow.label.blockPosition</label>
                  @if (positions) {
                    <div class="col-md-8 col-lg-9">
                      <app-node-position [obj]="selectedNode.obj" [blockPositions]="blockPositions" [blockPositionList]="blockPositionList" (onBlur)="getNewPositions($event)"
                                         [type]="'BLOCK_POSITION'" [workflow]="selectedNode.obj.workflow"></app-node-position>
                    </div>
                  }
                </div>

                <div class="form-group row">
                  <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.addOrder.startPosition' | translate) : ''"
                         class="col-md-4 col-lg-3 form-control-label"
                         title="{{'workflow.label.startPosition' | translate}}" translate>workflow.label.startPosition</label>
                  @if (positions) {
                    <div class="col-md-8 col-lg-9">
                      <app-node-position [obj]="selectedNode.obj" [newPositions]="newPositions" [positions]="positions"
                                         [type]="'START'" [workflow]="selectedNode.obj.workflow"></app-node-position>
                    </div>
                  }
                </div>

                <div class="form-group row">
                  <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.addOrder.endPositions' | translate) : ''"
                         class="col-md-4 col-lg-3 form-control-label"
                         title="{{'workflow.label.endPositions' | translate}}" translate>workflow.label.endPositions</label>
                  @if (positions) {
                    <div class="col-md-8 col-lg-9">
                      <app-node-position (onBlur)="updateEndNode(selectedNode.obj)" [newPositions]="newPositions" [obj]="selectedNode.obj" [position]="selectedNode.obj.startPosition"
                                         [positions]="positions" [type]="'END'"
                                         [workflow]="selectedNode.obj.workflow"></app-node-position>
                    </div>
                  }
                </div>

                <div class="form-group row">
                  <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.addOrder.ignoreAdmissionTimes' | translate) : ''"
                         class="col-md-4 col-lg-3 block-ellipsis-job"
                         title="{{'order.label.ignoreAdmissionTimes' | translate}}" translate>order.label.ignoreAdmissionTimes</label>
                  <div class="col-md-8 col-lg-9">
                    <label [(ngModel)]="selectedNode.obj.forceJobAdmission" name="ignoreAdmissionTimes" nz-checkbox></label>
                  </div>
                </div>

                <div class="form-group row">
                  <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.addOrder.remainWhenTerminated' | translate) : ''"
                         class="col-md-4 col-lg-3 block-ellipsis-job"
                         title="{{'workflow.label.remainWhenTerminated' | translate}}" translate>workflow.label.remainWhenTerminated</label>
                  <div class="col-md-8 col-lg-9">
                    <label [(ngModel)]="selectedNode.obj.remainWhenTerminated" name="remainWhenTerminated"
                           nz-checkbox></label>
                  </div>
                </div>

                @if ((selectedNode.obj.arguments && selectedNode.obj.arguments.length > 0) || (selectedNode.obj.forkListArguments && selectedNode.obj.forkListArguments.length > 0) || (selectedNode.obj.argumentList && selectedNode.obj.argumentList.length > 0)) {
                  <div class="row">
                    <div class="col-md-12">
                      <div class="form-group row">
                        <div class="col-md-12">
                          <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.addOrder.arguments' | translate) : ''"
                                 class="_600" translate>workflow.label.arguments</label>
                        </div>
                      </div>
                    </div>

                    @if (selectedNode.obj.forkListArguments && selectedNode.obj.forkListArguments.length > 0) {
                      <div class="col-md-12">
                        @for (listVariables of selectedNode.obj.forkListArguments; track $index; let x = $index) {
                          <div>
                            @if (listVariables.list) {
                              <div class="m-b-sm">{{'order.label.variableList' | translate}}:
                                <b>{{listVariables.name}}</b>
                              </div>
                            }
                            @if (listVariables.list) {
                              <div class="p-a-sm b-a m-b">
                                <div class="form-group row m-b-0 m-l-12">
                                  <div class="col-md-6 col-lg-6 m-b-sm" translate>common.label.name</div>
                                  <div class="col-md-6 col-lg-6 m-b-sm" style="margin-left: -23px" translate>common.label.value</div>
                                </div>
                                @for (actualListArr of listVariables.actualList; track $index; let i = $index) {
                                  <div [ngClass]="{'b-2b m-b-sm': i !== listVariables.actualList.length - 1}"
                                       class="form-group row m-b-0 m-l-12">
                                    @if (listVariables.actualList && (i === listVariables.actualList.length - 1)) {
                                      <div (click)="addArgumentToList(listVariables)" class="pos-abt cursor"
                                           style="margin-left: -13px;font-size: 16px;margin-top: 3px;z-index: 999">
                                        <i aria-hidden="true" class="fa fa-plus"></i>
                                      </div>
                                    }
                                    @for (argument of actualListArr; track $index; let k = $index) {
                                      <div class="col-md-12">
                                        <div class="form-group row m-b-0">
                                          <div class="col-md-6 col-lg-6 m-b-sm" style="padding-right: 34px">
                                            <input [(ngModel)]="argument.name" class="form-control" name="_name{{i}}{{k}}{{x}}" readonly
                                                   type="text">
                                          </div>
                                          @switch (argument.type) {
                                            @case ('Number') {
                                              <ng-container>
                                                <div [ngClass]="{'has-error' : ((value.dirty || value.touched) && value.invalid)}"
                                                     class="col-md-6 col-lg-6 m-b-sm">
                                                  <nz-input-number #value="ngModel" [(ngModel)]="argument.value"
                                                                   [nzStep]="1"
                                                                   [required]="argument.isRequired"
                                                                   name="_value{{i}}{{k}}{{x}}" nzPlaceHolder="{{'common.placeholder.enterNumber' | translate}}" style="margin-left: -23px;width: 103%">
                                                  </nz-input-number>
                                                  @if (value.invalid && value.errors && (value.dirty || value.touched)) {
                                                    <div class="text-danger help-block" style="margin-left: -23px;">
                                                      @if (value.errors.required) {
                                                        <div translate>common.message.requiredError</div>
                                                      }
                                                    </div>
                                                  }
                                                  @if (listVariables.actualList && listVariables.actualList.length > 1 && k === actualListArr.length - 1) {
                                                    <div class="pos-abt" style="right: 7px; margin-top: -28px">
                                                      <a><i (click)="removeVariableFromList(listVariables.actualList, i, false)"
                                                            class="fa fa-times m-t-sm text-muted"></i></a>
                                                    </div>
                                                  }
                                                </div>
                                              </ng-container>
                                            }
                                            @case ('Boolean') {
                                              <ng-container>
                                                <div [ngClass]="{'has-error' : ((value.dirty || value.touched) && value.invalid)}"
                                                     class="col-md-6 col-lg-6 m-b-sm">
                                                  <nz-select #value="ngModel" [(ngModel)]="argument.value"
                                                             [nzPlaceHolder]="'common.placeholder.selectValue' | translate" [required]="argument.isRequired" name="_value{{i}}{{k}}{{x}}"
                                                             nzAllowClear style="margin-left: -23px;width: 103%">
                                                    <nz-option [nzLabel]="'True' | translate" [nzValue]="true"></nz-option>
                                                    <nz-option [nzLabel]="'False' | translate" [nzValue]="false"></nz-option>
                                                  </nz-select>
                                                  @if (value.invalid && value.errors && (value.dirty || value.touched)) {
                                                    <div class="text-danger help-block" style="margin-left: -23px;">
                                                      @if (value.errors.required) {
                                                        <div translate>common.message.requiredError</div>
                                                      }
                                                    </div>
                                                  }
                                                  @if (listVariables.actualList && listVariables.actualList.length > 1 && k === actualListArr.length - 1) {
                                                    <div class="pos-abt" style="right: 7px; margin-top: -28px">
                                                      <a><i (click)="removeVariableFromList(listVariables.actualList, i, false)"
                                                            class="fa fa-times m-t-sm text-muted"></i></a>
                                                    </div>
                                                  }
                                                </div>
                                              </ng-container>
                                            }
                                            @default {
                                              <ng-container>
                                                <div [ngClass]="{'has-error' : ((value.dirty || value.touched) && value.invalid)}"
                                                     class="col-md-6 col-lg-6 m-b-sm">
                                                  <input #value="ngModel" [(ngModel)]="argument.value" [required]="argument.isRequired" autocomplete="off"
                                                         class="form-control" name="_value{{i}}{{k}}{{x}}"
                                                         placeholder="{{'common.placeholder.value' | translate}}"
                                                         style="margin-left: -23px;width: 103%"
                                                         type="text">
                                                  @if (value.invalid && value.errors && (value.dirty || value.touched)) {
                                                    <div class="text-danger help-block" style="margin-left: -23px;">
                                                      @if (value.errors.required) {
                                                        <div translate>common.message.requiredError</div>
                                                      }
                                                    </div>
                                                  }
                                                  @if (listVariables.actualList && listVariables.actualList.length > 1 && k === actualListArr.length - 1) {
                                                    <div class="pos-abt" style="right: 7px; margin-top: -28px">
                                                      <a><i (click)="removeVariableFromList(listVariables.actualList, i, false)"
                                                            class="fa fa-times m-t-sm text-muted"></i></a>
                                                    </div>
                                                  }
                                                </div>
                                              </ng-container>
                                            }
                                          }
                                        </div>
                                      </div>
                                    }
                                  </div>
                                }
                              </div>
                            }
                          </div>
                        }
                      </div>
                    }

                    @if (selectedNode.obj.mapArguments && selectedNode.obj.mapArguments.length > 0) {
                      <div class="col-md-12">
                        @for (listVariables of selectedNode.obj.mapArguments; track $index; let x = $index) {
                          <div>
                            @if (listVariables.map) {
                              <div class="m-b-sm">{{'order.label.variableMap' | translate}}:
                                <b>{{listVariables.name}}</b>
                              </div>
                            }
                            @if (listVariables.map) {
                              <div class="p-a-sm b-a m-b">
                                <div class="form-group row m-b-0 m-l-12">
                                  <div class="col-md-6 col-lg-6 m-b-sm" translate>common.label.name</div>
                                  <div class="col-md-6 col-lg-6 m-b-sm" style="margin-left: -23px" translate>common.label.value</div>
                                </div>
                                @for (actualMapArr of listVariables.actualMap; track $index; let i = $index) {
                                  <div [ngClass]="{'b-2b m-b-sm': i !== listVariables.actualMap.length - 1}"
                                       class="form-group row m-b-0 m-l-12">
                                    @for (argument of actualMapArr; track $index; let k = $index) {
                                      <div class="col-md-12">
                                        <div class="form-group row m-b-0">
                                          <div class="col-md-6 col-lg-6 m-b-sm" style="padding-right: 34px">
                                            <input [(ngModel)]="argument.name" class="form-control" name="_name{{i}}{{k}}{{x}}" readonly
                                                   type="text">
                                          </div>
                                          @switch (argument.type) {
                                            @case ('Number') {
                                              <ng-container>
                                                <div [ngClass]="{'has-error' : ((value.dirty || value.touched) && value.invalid)}"
                                                     class="col-md-6 col-lg-6 m-b-sm">
                                                  <nz-input-number #value="ngModel" [(ngModel)]="argument.value"
                                                                   [nzStep]="1"
                                                                   [required]="argument.isRequired"
                                                                   name="_value{{i}}{{k}}{{x}}" nzPlaceHolder="{{'common.placeholder.enterNumber' | translate}}" style="margin-left: -23px;width: 103%">
                                                  </nz-input-number>
                                                  @if (value.invalid && value.errors && (value.dirty || value.touched)) {
                                                    <div class="text-danger help-block" style="margin-left: -23px;">
                                                      @if (value.errors.required) {
                                                        <div translate>common.message.requiredError</div>
                                                      }
                                                    </div>
                                                  }
                                                  @if (listVariables.actualMap && listVariables.actualMap.length > 1 && k === actualMapArr.length - 1) {
                                                    <div class="pos-abt" style="right: 7px; margin-top: -28px">
                                                      <a><i (click)="removeVariableFromList(listVariables.actualMap, i, false)"
                                                            class="fa fa-times m-t-sm text-muted"></i></a>
                                                    </div>
                                                  }
                                                </div>
                                              </ng-container>
                                            }
                                            @case ('Boolean') {
                                              <ng-container>
                                                <div [ngClass]="{'has-error' : ((value.dirty || value.touched) && value.invalid)}"
                                                     class="col-md-6 col-lg-6 m-b-sm">
                                                  <nz-select #value="ngModel" [(ngModel)]="argument.value"
                                                             [nzPlaceHolder]="'common.placeholder.selectValue' | translate" [required]="argument.isRequired" name="_value{{i}}{{k}}{{x}}"
                                                             nzAllowClear style="margin-left: -23px;width: 103%">
                                                    <nz-option [nzLabel]="'True' | translate" [nzValue]="true"></nz-option>
                                                    <nz-option [nzLabel]="'False' | translate" [nzValue]="false"></nz-option>
                                                  </nz-select>
                                                  @if (value.invalid && value.errors && (value.dirty || value.touched)) {
                                                    <div class="text-danger help-block" style="margin-left: -23px;">
                                                      @if (value.errors.required) {
                                                        <div translate>common.message.requiredError</div>
                                                      }
                                                    </div>
                                                  }
                                                  @if (listVariables.actualMap && listVariables.actualMap.length > 1 && k === actualMapArr.length - 1) {
                                                    <div class="pos-abt" style="right: 7px; margin-top: -28px">
                                                      <a><i (click)="removeVariableFromList(listVariables.actualMap, i, false)"
                                                            class="fa fa-times m-t-sm text-muted"></i></a>
                                                    </div>
                                                  }
                                                </div>
                                              </ng-container>
                                            }
                                            @default {
                                              <ng-container>
                                                <div [ngClass]="{'has-error' : ((value.dirty || value.touched) && value.invalid)}"
                                                     class="col-md-6 col-lg-6 m-b-sm">
                                                  <input #value="ngModel" [(ngModel)]="argument.value" [required]="argument.isRequired" autocomplete="off"
                                                         class="form-control" name="_value{{i}}{{k}}{{x}}"
                                                         placeholder="{{'common.placeholder.value' | translate}}"
                                                         style="margin-left: -23px;width: 103%"
                                                         type="text">
                                                  @if (value.invalid && value.errors && (value.dirty || value.touched)) {
                                                    <div class="text-danger help-block" style="margin-left: -23px;">
                                                      @if (value.errors.required) {
                                                        <div translate>common.message.requiredError</div>
                                                      }
                                                    </div>
                                                  }
                                                  @if (listVariables.actualMap && listVariables.actualMap.length > 1 && k === actualMapArr.length - 1) {
                                                    <div class="pos-abt" style="right: 7px; margin-top: -28px">
                                                      <a><i (click)="removeVariableFromList(listVariables.actualMap, i, false)"
                                                            class="fa fa-times m-t-sm text-muted"></i></a>
                                                    </div>
                                                  }
                                                </div>
                                              </ng-container>
                                            }
                                          }
                                        </div>
                                      </div>
                                    }
                                  </div>
                                }
                              </div>
                            }
                          </div>
                        }
                      </div>
                    }

                    <div class="col-md-12">
                      @if (selectedNode.obj.arguments && selectedNode.obj.arguments.length > 0) {
                        <div class="form-group row m-b-0" style="width: 101.3%;">
                          <div class="col-md-6 col-lg-6 m-b-sm" translate>common.label.name</div>
                          <div class="col-md-6 col-lg-6 m-b-sm" translate>common.label.value</div>
                        </div>
                      }
                      @for (variable of selectedNode.obj.arguments; track $index; let i = $index) {
                        <div class="form-group row m-b-0" style="width: 101.3%;">
                          @if (variable.isTextField) {
                            <div [ngClass]="{'has-error' : ((name.dirty || name.touched) && name.invalid)}"
                                 class="col-md-6 col-lg-6 m-b-sm">
                              <input #name="ngModel" [(ngModel)]="variable.name" autocomplete="off" class="form-control" name="name_{{i}}"
                                     placeholder="{{'common.placeholder.name' | translate}}"
                                     required type="text">
                            </div>
                          }
                          @if (!variable.isTextField) {
                            <div class="col-md-6 col-lg-6 m-b-sm">
                              <nz-select [(ngModel)]="variable.name"
                                         [nzDisabled]="isTrash || !permission.joc.inventory.manage || variable.isRequired"
                                         name="name{{i}}"
                                         (ngModelChange)="checkVariableType(variable);"
                                         nzPlaceHolder="{{'common.placeholder.selectVariable' | translate}}"
                                         nzShowSearch>
                                @for (list of selectedNode.obj.argumentList; track list) {
                                  <nz-option [nzDisabled]="list.isSelected"
                                             [nzLabel]="list.name" [nzValue]="list.name"></nz-option>
                                }
                              </nz-select>
                            </div>
                          }
                          @switch (variable.type) {
                            @case ('Number') {
                              <ng-container>
                                <div [ngClass]="{'has-error' : ((value.dirty || value.touched) && value.invalid)}"
                                     class="col-md-6 col-lg-6 m-b-sm">
                                  <nz-input-number #value="ngModel"
                                                   (keydown)="onKeyPress($event, true)" [(ngModel)]="variable.value"
                                                   [nzDisabled]="isTrash || !permission.joc.inventory.manage"
                                                   [nzStep]="1"
                                                   [required]="variable.isRequired" name="value{{i}}"
                                                   nzPlaceHolder="{{'common.placeholder.enterNumber' | translate}}">
                                  </nz-input-number>
                                  @if (value.invalid && value.errors && (value.dirty || value.touched)) {
                                    <div class="text-danger help-block">
                                      @if (value.errors.required) {
                                        <div translate>common.message.requiredError</div>
                                      }
                                    </div>
                                  }
                                  @if (!variable.isRequired) {
                                    <div class="pos-abt" style="right: -6px; margin-top: -28px">
                                      <a [ngClass]="{'disable-link': isTrash || !permission.joc.inventory.manage}"><i
                                        (click)="removeArgument(variable)" class="fa fa-times m-t-sm text-hover-color"></i></a>
                                    </div>
                                  }
                                </div>
                              </ng-container>
                            }
                            @case ('Boolean') {
                              <ng-container>
                                <div [ngClass]="{'has-error' : ((value.dirty || value.touched) && value.invalid)}"
                                     class="col-md-6 col-lg-6 m-b-sm">
                                  @if (variable.value != false && variable.value != true && variable.value != undefined && variable.value != null) {
                                    <input [(ngModel)]="variable.value" autocomplete="off" class="form-control pos-rel z-index-99" name="bool_value_{{i}}"
                                           placeholder="$var"
                                           type="text">
                                  }
                                  <nz-select #value="ngModel" [(ngModel)]="variable.value" [ngClass]="{'overlap-box' : variable.value != false && variable.value != true && variable.value != undefined && variable.value != null}"
                                             [nzDisabled]="isTrash || !permission.joc.inventory.manage" [nzPlaceHolder]="(variable.value != false && variable.value != true && variable.value != undefined && variable.value != null) ? '' : ('common.placeholder.selectValue' | translate)"
                                             [required]="variable.isRequired" name="value{{i}}" [nzAllowClear]="(variable.value != false && variable.value != true && variable.value != undefined && variable.value != null) ? false : true">
                                    <nz-option [nzLabel]="'$var'" [nzValue]="'$'"></nz-option>
                                    <nz-option [nzLabel]="'True' | translate" [nzValue]="true"></nz-option>
                                    <nz-option [nzLabel]="'False' | translate" [nzValue]="false"></nz-option>
                                  </nz-select>
                                  @if (value.invalid && value.errors && (value.dirty || value.touched)) {
                                    <div class="text-danger help-block">
                                      @if (value.errors.required) {
                                        <div translate>common.message.requiredError</div>
                                      }
                                    </div>
                                  }
                                  @if (!variable.isRequired) {
                                    <div class="pos-abt" style="right: -6px; margin-top: -28px">
                                      <a [ngClass]="{'disable-link': isTrash || !permission.joc.inventory.manage}"><i
                                        (click)="removeArgument(variable)" class="fa fa-times m-t-sm text-hover-color"></i></a>
                                    </div>
                                  }
                                </div>
                              </ng-container>
                            }
                            @default {
                              <ng-container>
                                <div [ngClass]="{'has-error' : ((value.dirty || value.touched) && value.invalid)}"
                                     class="col-md-6 col-lg-6 m-b-sm">
                                  <input #value="ngModel" (keydown)="onKeyPress($event, true)"
                                         [(ngModel)]="variable.value" [readOnly]="isTrash || !permission.joc.inventory.manage" [required]="variable.isRequired" autocomplete="off"
                                         class="form-control" name="value{{i}}" placeholder="{{'common.placeholder.value' | translate}}"
                                         type="text">
                                  @if (value.invalid && value.errors && (value.dirty || value.touched)) {
                                    <div class="text-danger help-block">
                                      @if (value.errors.required) {
                                        <div translate>common.message.requiredError</div>
                                      }
                                    </div>
                                  }
                                  @if (!variable.isRequired) {
                                    <div class="pos-abt" style="right: -6px; margin-top: -28px">
                                      <a [ngClass]="{'disable-link': isTrash || !permission.joc.inventory.manage}"><i
                                        (click)="removeArgument(variable)" class="fa fa-times m-t-sm text-hover-color"></i></a>
                                    </div>
                                  }
                                </div>
                              </ng-container>
                            }
                          }
                        </div>
                      }
                      <div class="form-group row">
                        @if (selectedNode.obj.argumentList.length || (selectedNode.obj.forkListArguments && selectedNode.obj.forkListArguments.length > 0)) {
                          <div class="col-sm-12 m-t-sm">
                            <a (click)="addAllArguments()" class="text-u-l" translate>workflow.button.addAllArguments</a>
                          </div>
                        }
                      </div>
                    </div>
                  </div>
                }

                <div class="form-group row">
                  @if (allowUndeclaredVariables && selectedNode.obj.workflow?.orderPreparation?.allowUndeclared) {
                    <div class="col-sm-12">
                      <a class="text-u-l" (click)="addUndeclaredArgument()" translate>order.button.addVariable</a>
                    </div>
                  }
                </div>
              </div>
            }

          </div>
        </div>
      }

      @if (workflow.id && !selectedNode) {
        <div class="m-l-sm m-r-sm text-left">
          <div class="box-body p-b-0">
            @if (jobs && jobs.length > 0) {
              <div class="pos-abt" style="top: 8px; right: 22px">
                <button (click)="findAndReplace()" class="btn btn-default btn-sm">
                  <i aria-hidden="true" class="fa fa-search-plus"></i>
                  {{'workflow.findAndReplace.button.findAndReplace' | translate}}
                </button>
              </div>
            }
            <div [ngClass]="{'has-error' : ((name.dirty || name.touched) && name.invalid), 'hide': fullScreen}"
                 class="form-group row">
              <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.name' | translate) : ''"
                     class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.name
                <sup class="text-danger text-sm">*</sup>
              </label>
              <div class="col-md-8 col-lg-9">
                <input #name="ngModel" (blur)="rename(name.invalid)" [(ngModel)]="workflow.name" [readonly]="isTrash" autocomplete="off"
                       class="form-control" identifierValidation name="name" required
                       type="text"/>
                @if (name.invalid && name.errors && (name.dirty || name.touched)) {
                  <div class="text-danger help-block">
                    @if (name.errors.required) {
                      <div translate>common.message.requiredError</div>
                    }
                    @if (name.errors.invalidIdentifier) {
                      <div translate>common.message.invalid</div>
                    }
                  </div>
                }
              </div>
            </div>
            <div [ngClass]="{'hide': fullScreen}" class="form-group row">
              <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.title' | translate) : ''"
                     class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.title</label>
              <div class="col-md-8 col-lg-9">
                <input (blur)="updateOtherProperties('title')" [(ngModel)]="extraConfiguration.title" [readonly]="isTrash" autocomplete="off"
                       class="form-control" name="title"
                       placeholder="{{'common.placeholder.title' | translate}}" type="text"/>
              </div>
            </div>
            @if (coreService.expertMode) {
              <div [ngClass]="{'hide': fullScreen}" class="form-group row">
                <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.documentation' | translate) : ''"
                       class="col-md-4 col-lg-3 form-control-label"
                       title="{{'inventory.label.documentation' | translate}}" translate>inventory.label.documentation</label>
                <div class="col-md-8 col-lg-9">
                  <app-select-document (funcCall)="updateOtherProperties('documentation')" [data]="extraConfiguration"
                                       [documentationTree]="documentationTree"></app-select-document>
                </div>
              </div>
            }
            <div [ngClass]="{'hide': fullScreen}" class="form-group row">
              <label [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.jobResourceNames' | translate) : ''"
                     class="col-md-4 col-lg-3 form-control-label"
                     title="{{'workflow.label.jobResourceNames' | translate}}" translate>workflow.label.jobResourceNames</label>
              <div class="col-md-8 col-lg-9">
                <app-multi-select (funcCall)="updateOtherProperties('jobResourceNames')" [attribute]="'jobResourceNames'" [list]="extraConfiguration"
                                  [nodes]="jobResourcesTree"
                                  [type]="'JOBRESOURCE'"></app-multi-select>
              </div>
            </div>
            <div [ngClass]="{'hide': fullScreen}" class="form-group row">
              <div [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.timeZone' | translate) : ''"
                   class="col-md-4 col-lg-3 form-control-label"
                   title="{{'workflow.label.timeZone' | translate}}" translate>workflow.label.timeZone
              </div>
              <div class="col-md-8 col-lg-9">
                <nz-select [(ngModel)]="extraConfiguration.timeZone" name="timeZone" (ngModelChange)="updateOtherProperties('timeZone')"
                           nzShowSearch>
                  @for (zone of zones; track zone) {
                    <nz-option [nzLabel]="zone" [nzValue]="zone"></nz-option>
                  }
                </nz-select>
              </div>
            </div>
            @if (allowUndeclaredVariables || variableDeclarations.allowUndeclared) {
              <div class="form-group row">
                <label class="col-md-4 col-lg-3 block-ellipsis-job" title="{{'workflow.label.allowUndeclared' | translate}}" [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="!preferences.showTooltipInfo ? ('inventory.tooltips.workflow.allowUndeclared' | translate) : ''"
                       translate>workflow.label.allowUndeclared</label>
                <div class="col-md-8 col-lg-9">
                  <label nz-checkbox [(ngModel)]="variableDeclarations.allowUndeclared" (nzCheckedChange)="updateOtherProperties('allowUndeclared')"
                         name="allowUndeclared"></label>
                </div>
              </div>
            }
            <div class="form-group row">
              <ng-template #contentTemplate>
                @for (item of storedArguments; track item) {
                  <div class="p-a-sm b-a m-b-sm cursor" (click)="handlePaste(item)">
                    <div class="truncate">{{item}}</div>
                  </div>
                }
                <div class="pull-right">
                  <a class="text-hover-primary" (click)="removeClipboard()" translate>common.button.clear</a>
                </div>
              </ng-template>
              <label class="col-md-12 _600 font14">
                <span translate>order.label.variables</span>
                <i (click)="expandCollapseVariable()" class="cursor fa fa-lg p-l-sm"
                   [ngClass]="isExpandVariable ? 'fa-angle-up' : 'fa-angle-down' "></i>
              </label>

              @if (variableDeclarations.parameters?.length > 0) {
                <a (click)="copyArguments()" class="anchor-with-icon pos-abt m-t-n-1" [ngStyle]="{'right': storedArguments?.length > 0 ? '90px' : '42px'}"
                   nz-tooltip="{{'common.button.copyArguments' | translate}}">
                  <i class="fa fa-copy"></i>
                </a>
              }
              @if (storedArguments?.length > 0 || storedIndlArguments?.length > 0) {
                <a (click)="handleIndlPaste()" class="anchor-with-icon pos-abt m-t-n-1"
                   nz-tooltip="{{'common.button.paste' | translate}}"  [ngStyle]="{'right': ((storedArguments?.length > 0 || storedIndlArguments) && variableDeclarations.parameters?.length > 0) ? '66px' : (storedArguments?.length > 0 && !variableDeclarations.parameters?.length > 0) ? '66px' : '42px'}">
                  <i class="fa fa-paste"></i>
                </a>
              }
              @if (storedArguments?.length > 0) {
                <a nz-popover [nzPopoverTitle]="'common.label.clipboard' | translate" [nzPopoverContent]="contentTemplate"
                   nzPopoverTrigger="click" [nzPopoverOverlayClassName]="'clipboard-list'"
                   class="anchor-with-icon pos-abt m-t-n-1"
                   nz-tooltip="{{'common.button.showClipboard' | translate}}" style="right: 42px;">
                  <i class="fa fa-list"></i>
                </a>
              }
              <a (click)="fitToScreen()" class="anchor-with-icon pos-abt m-t-n-1"
                 nz-tooltip="{{'workflow.button.fitToScreen' | translate}}" style="right: 18px;" translate>
                @if (!fullScreen) {
                  <i class="fa fa-arrows-alt"></i>
                }
                @if (fullScreen) {
                  <i class="fa fa-minus-square-o"></i>
                }
              </a>
            </div>
            @if (isExpandVariable) {
              <ng-container>
                @if (variableDeclarations.parameters.length > 0) {
                  <div class="form-group row m-b-0 m-l-sm">
                    <div class="col-md-4 col-lg-4 m-b-sm" translate>common.label.name</div>
                    <div class="col-md-3 col-lg-3 p-l-18 m-b-sm" translate>common.label.type</div>
                    <div class="col-md-5 col-lg-5 p-l-18 m-b-sm" translate>common.label.value</div>
                  </div>
                }
                <div id="declare-var" (cdkDropListDropped)="drop($event)" cdkDropList>
                  @for (variable of variableDeclarations.parameters; track $index; let i = $index) {
                    <ng-container>
                      @if (variable.value.type === 'List' || variable.value.type === 'Map') {
                        <div class="form-group row m-b-0 m-l-sm m-r-n-30">
                          @if (variable.value.type === 'List' || variable.value.type === 'Map') {
                            <div class="col-md-12 m-b-sm">
                              <label>
                                @if (variable.value.type === 'List') {
                                  <span class="p-r-xs _600" translate>workflow.label.children</span>
                                }
                                @if (variable.value.type === 'Map') {
                                  <span class="p-r-xs _600" translate>workflow.label.childrenMap</span>
                                }
                                :
                                {{variable.name}}
                                <i (click)="variable.isCollapse = !variable.isCollapse" class="cursor fa fa-lg p-l-sm"
                                   [ngClass]="!variable.isCollapse ? 'fa-angle-up' : 'fa-angle-down' "></i>
                              </label>
                              @if (variableDeclarations.parameters?.length > 0) {
                                <a (click)="copyIndlArguments(i)" class="anchor-with-icon pos-abt m-t-n-1"
                                   [ngStyle]="{'right': '50px'}"
                                   nz-tooltip="{{'common.button.copyArguments' | translate}}">
                                  <i class="fa fa-copy"></i>
                                </a>
                              }
                              @if (storedArguments?.length > 0) {
                                <a (click)="handleIndlPaste()"
                                   class="anchor-with-icon pos-abt m-t-n-1"
                                   nz-tooltip="{{'common.button.paste' | translate}}"
                                   style="right: 27px;">
                                  <i class="fa fa-paste"></i>
                                </a>
                              }
                            </div>
                          }
                        </div>
                      }
                      @if (!variable.isCollapse || (variable.value.type !== 'List' && variable.value.type !== 'Map')) {
                        <div cdkDrag class="form-group row m-b-0 m-l-sm m-r-n-30">
                          <div cdkDragHandle class="pos-abt"
                               style="margin-left: -9px;font-size: 18px;margin-top: 2px;cursor: move">
                            <i aria-hidden="true" class="fa fa-bars"></i>
                          </div>
                          <div [ngClass]="{'has-error' : ((name.dirty || name.touched) && name.invalid)}"
                               class="col-md-3 col-lg-3 m-b-sm p-r-0">
                            <input #name="ngModel" (input)="onInput(variable.name);" (blur)="checkDuplicateEntries(variable, i, variableDeclarations.parameters)" [(ngModel)]="variable.name" [readonly]="isTrash" autocomplete="off"
                                   class="form-control" identifierValidation name="name{{i}}"
                                   placeholder="{{'common.placeholder.name' | translate}}"
                                   type="text">
                            @if (name.invalid && name.errors && (name.dirty || name.touched)) {
                              <div class="text-danger help-block">
                                @if (name.errors.invalidIdentifier) {
                                  <div translate>common.message.invalid</div>
                                }
                              </div>
                            }
                          </div>
                          <div class="col-md-3 col-lg-3 m-b-sm p-r-0">
                            <nz-select [(ngModel)]="variable.value.type" [nzDisabled]="isTrash"
                                       name="type{{i}}" (ngModelChange)="changeDataType($event, variable); onInput(variable.value.type)">
                              @for (dataType of allowedDatatype; track dataType) {
                                <nz-option [nzLabel]="dataType | translate" [nzValue]="dataType"></nz-option>
                              }
                            </nz-select>
                          </div>
                          @if (variable.value.type !== 'Final') {
                            @switch (variable.value.type) {
                              @case ('Number') {
                                <div class="col-md-4 col-lg-4 m-b-sm p-r-0">
                                  <nz-input-number (input)="onInput(variable.value.default)" (nzBlur)="updateOtherProperties('variable')" [(ngModel)]="variable.value.default" [nzDisabled]="isTrash"
                                                   [nzStep]="1" name="value{{i}}"
                                                   nzPlaceHolder="{{'common.placeholder.enterNumber' | translate}}"></nz-input-number>
                                  @if (variable.value.type === 'Number' || variable.value.type === 'Boolean') {
                                    <i (click)="addList(variable)"
                                       [ngClass]="{'text-primary': variable.value.list && variable.value.list.length > 0}"
                                       [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'workflow.tooltip.listEntryMode' | translate"
                                       class="pos-abt cursor text-primary-hover"
                                       nz-icon nzTheme="outline" nzType="unordered-list" style="right: 1px;top:0px;"></i>
                                  }
                                </div>
                              }
                              @case ('Boolean') {
                                <div class="col-md-4 col-lg-4 m-b-sm p-r-0">
                                  <nz-select [(ngModel)]="variable.value.default" [nzDisabled]="isTrash" [nzPlaceHolder]="'common.placeholder.selectValue' | translate"
                                             name="value{{i}}" nzAllowClear  (ngModelChange)="updateOtherProperties('variable'); onInput(variable.value.default)">
                                    <nz-option [nzLabel]="'True' | translate" [nzValue]="true"></nz-option>
                                    <nz-option [nzLabel]="'False' | translate" [nzValue]="false"></nz-option>
                                  </nz-select>
                                  @if (variable.value.type === 'Number' || variable.value.type === 'Boolean') {
                                    <i (click)="addList(variable)"
                                       [ngClass]="{'text-primary': variable.value.list && variable.value.list.length > 0}"
                                       [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'workflow.tooltip.listEntryMode' | translate"
                                       class="pos-abt cursor text-primary-hover"
                                       nz-icon nzTheme="outline" nzType="unordered-list" style="right: 1px;top:0px;"></i>
                                  }
                                </div>
                              }
                              @default {
                                <div class="col-md-4 col-lg-4 m-b-sm p-r-0">
                                  <input #value="ngModel" (input)="onInput(variable.value.default)" (blur)="updateOtherProperties('variable')"
                                         (keydown)="onKeyPress($event)" [(ngModel)]="variable.value.default" [disabled]="variable.value.type === 'List' || variable.value.type === 'Map'" [facetValidation]="variable.value.facet"
                                         autocomplete="off" class="form-control" name="value{{i}}"
                                         placeholder="{{'common.placeholder.value' | translate}}" type="text">
                                  @if (variable.value.type === 'String') {
                                    <i (click)="addFacet(variable);"
                                       [ngClass]="{'text-primary': variable.value.facet}"
                                       [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'workflow.tooltip.facetEntryMode' | translate" class="pos-abt cursor text-primary-hover" nz-icon
                                       nzTheme="outline" nzType="snippets" style="right: 36px;top:1px;"></i>
                                  }
                                  @if (variable.value.type === 'String') {
                                    <i (click)="addList(variable);"
                                       [ngClass]="{'text-primary': variable.value.list && variable.value.list.length > 0}"
                                       [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'workflow.tooltip.listEntryMode' | translate" class="pos-abt cursor text-primary-hover" nz-icon
                                       nzTheme="outline" nzType="unordered-list" style="right: 18px;top:1px;"></i>
                                  }
                                  <i (click)="openEditor(variable.value);"
                                     [hidden]="variable.value.type === 'List' || variable.value.type === 'Map'" [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'workflow.tooltip.editorEntryMode' | translate" class="pos-abt cursor" nz-icon
                                     nzTheme="outline" nzType="form" style="right: 1px;top:1px;"></i>
                                  @if (value.invalid && value.errors && (value.dirty || value.touched)) {
                                    <div class="text-danger help-block">
                                      @if (value.errors.invalidFacet) {
                                        <div translate>common.message.invalid</div>
                                      }
                                    </div>
                                  }
                                </div>
                              }
                            }
                          }
                          @if (variable.value.type === 'Final') {
                            <div [ngClass]="{'has-error' : ((final.dirty || final.touched) && final.invalid)}"
                                 class="col-md-4 col-lg-4 m-b-sm p-r-0">
                              <input #final="ngModel" (input)="onInput(variable.value.final)" (blur)="updateOtherProperties('variable')" (keydown)="onKeyPress($event)" [(ngModel)]="variable.value.final" autocomplete="off" class="form-control"
                                     name="final{{i}}" placeholder="{{'workflow.placeholder.final' | translate}}"
                                     required type="text">
                              <i (click)="openEditor(variable.value, 'final')" class="pos-abt cursor" nz-icon nzTheme="outline"
                                 nzType="form" style="right: 1px;top:1px;"></i>
                              @if (final.invalid && final.errors && (final.dirty || final.touched)) {
                                <div class="text-danger help-block">
                                  @if (final.errors.required) {
                                    <div translate>common.message.requiredError</div>
                                  }
                                </div>
                              }
                            </div>
                          }
                          <div class="col-md-2 col-lg-2 d-flex flex-lg-row flex-md-column gap-5 justify-content-around">
                            @if (variable.name && variable.value.type === 'String') {
                              <a><i (click)="encryptValue(variable, variable, 'jobTemplate')" class="m-t-sm text-hover-color" nz-icon nzType="property-safety" nzTheme="outline"></i></a>
                            }
                            <a><i (click)="removeVariable(i)" class="fa fa-times m-t-sm text-hover-color"></i></a>
                          </div>
                          @if (variable.value.type === 'List' || variable.value.type === 'Map') {
                            <ng-container class="b-b p-b-sm">
                              <div class="row col-md-12">
                                <div class="col-md-4 col-lg-4 m-b-sm" translate>
                                  common.label.name
                                  <i class="fa fa-caret-down cursor text-16 p-l-xxs"
                                     (click)="sortDescending(variable)">
                                  </i>
                                  <i class="fa fa-caret-up cursor text-16 p-l-sm"
                                     (click)="sortAscending(variable)">
                                  </i>
                                </div>
                                <div class="col-md-3 col-lg-3 m-b-sm" style="padding-left: 20px" translate>
                                  common.label.type
                                </div>
                                <div class="col-md-5 col-lg-5 m-b-sm" style="padding-left: 26px" translate>common.label.value</div>
                              </div>
                              <div class="col-md-12" (cdkDropListDropped)="nestedDrop($event,variable)" cdkDropList>
                                @for (param of variable.value.listParameters; track $index; let j = $index) {
                                  <div [ngClass]="{'b-2b m-b-sm': j === variable.value.listParameters.length - 1}"
                                       class=" row p-r-0" cdkDrag>
                                    @if (j === variable.value.listParameters.length - 1) {
                                      <div (click)="addVariableToList(variable.value)"
                                           class="pos-abt cursor" style="margin-top: 7px;left:-24px;font-size:15px;z-index: 999">
                                        <a class="text-primary-hover cursor"><i class="fa fa-plus"></i></a>
                                      </div>
                                    }
                                    <!-- Drag Handle -->
                                    <div cdkDragHandle class="pos-abt" style="margin-left: -8px;font-size: 15px;margin-top: 6px;cursor: move">
                                      <i aria-hidden="true" class="fa fa-bars"></i>
                                    </div>
                                    <div [ngClass]="{'has-error' : ((name.dirty || name.touched) && name.invalid)}"
                                         class="col-md-3 col-lg-3 m-b-sm p-r-0">
                                      <input #name="ngModel" (input)="onInput(param.name)" (blur)="checkDuplicateEntries(param, j, variable.value.listParameters)" [(ngModel)]="param.name" [readonly]="isTrash" autocomplete="off"
                                             class="form-control" identifierValidation name="name{{i}}{{j}}"
                                             placeholder="{{'common.placeholder.name' | translate}}"
                                             type="text">
                                      @if (name.invalid && name.errors && (name.dirty || name.touched)) {
                                        <div class="text-danger help-block">
                                          @if (name.errors.invalidIdentifier) {
                                            <div translate>common.message.invalid</div>
                                          }
                                        </div>
                                      }
                                    </div>
                                    <div class="col-md-3 col-lg-3 m-b-sm p-r-0">
                                      <nz-select [(ngModel)]="param.value.type" [nzDisabled]="isTrash"
                                                 name="type{{i}}{{j}}" (ngModelChange)="changeSubDataType($event,param);onInput(param.value.type)">
                                        <nz-option [nzLabel]="'String' | translate" [nzValue]="'String'"></nz-option>
                                        <nz-option [nzLabel]="'Number' | translate" [nzValue]="'Number'"></nz-option>
                                        <nz-option [nzLabel]="'Boolean' | translate" [nzValue]="'Boolean'"></nz-option>
                                      </nz-select>
                                    </div>
                                    @switch (param.value.type) {
                                      @case ('Number') {
                                        <div class="col-md-4 col-lg-4 m-b-sm p-r-0">
                                          <nz-input-number (input)="onInput(param.value.default)" (nzBlur)="updateOtherProperties('variable')" [(ngModel)]="param.value.default" [nzDisabled]="isTrash"
                                                           [nzStep]="1" name="value{{i}}{{j}}"
                                                           nzPlaceHolder="{{'common.placeholder.enterNumber' | translate}}"></nz-input-number>
                                        </div>
                                      }
                                      @case ('Boolean') {
                                        <div class="col-md-4 col-lg-4 m-b-sm p-r-0">
                                          <nz-select [(ngModel)]="param.value.default" [nzDisabled]="isTrash" [nzPlaceHolder]="'common.placeholder.selectValue' | translate"
                                                     name="value{{i}}{{j}}" nzAllowClear  (ngModelChange)="updateOtherProperties('variable');onInput(param.value.default)">
                                            <nz-option [nzLabel]="'True' | translate" [nzValue]="true"></nz-option>
                                            <nz-option [nzLabel]="'False' | translate" [nzValue]="false"></nz-option>
                                          </nz-select>
                                        </div>
                                      }
                                      @default {
                                        <div class="col-md-4 col-lg-4 m-b-sm p-r-0">
                                          <input (blur)="updateOtherProperties('variable')"
                                                 (keydown)="onKeyPress($event);" (input)="onInput(param.value.default)" [(ngModel)]="param.value.default"
                                                 autocomplete="off" class="form-control" name="value{{i}}{{j}}"
                                                 placeholder="{{'common.placeholder.value' | translate}}" type="text">
                                          <i (click)="openEditor(param.value)"
                                             [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'workflow.tooltip.editorEntryMode' | translate" class="pos-abt cursor" nz-icon
                                             nzTheme="outline" nzType="form" style="right: 1px;top:1px;"></i>
                                        </div>
                                      }
                                    }
                                    @if (variable.value.listParameters.length > 0) {
                                      <div class="col-md-2 col-lg-2 d-flex flex-lg-row flex-md-column gap-5 justify-content-around">
                                        @if (param.name && param.value.type === 'String') {
                                          <a><i (click)="encryptValue(param, variable, 'jobTemplate')" class="m-t-sm text-hover-color" nz-icon nzType="property-safety" nzTheme="outline"></i></a>
                                        }
                                        @if (variable.value.listParameters.length > 1) {
                                          <a><i  (click)="removeVariableFromList(variable.value.listParameters, j);"
                                                 class="fa fa-times m-t-sm text-hover-color"></i></a>
                                        }
                                      </div>
                                    }
                                  </div>
                                }
                              </div>
                            </ng-container>
                          }
                        </div>
                      }
                    </ng-container>
                  }
                </div>
                <div class="form-group row">
                  <div class="col-sm-12">
                    <a (click)="addVariable();" class="text-u-l" translate>order.button.addVariable</a>
                  </div>
                </div>
              </ng-container>
            }
          </div>
          @if (isReferencedBy && (isReferencedBy.fileOrderSources || isReferencedBy.schedules || isReferencedBy.workflows)) {
            <div class="box-body p-t-0">
              <div class="b-t p-t-sm font14 _500" translate>
                workflow.label.references
                <i (click)="expandCollapseReferences()" class="cursor fa fa-lg p-l-sm"
                   [ngClass]="isExpandReference ? 'fa-angle-up' : 'fa-angle-down' "></i>
              </div>
              @if (isExpandReference) {
                <div>
                  @if (isReferencedBy.fileOrderSources) {
                    <div class="p-l-sm p-t-sm">
                      <i class="icon-orders-icon icon-color tree-icon"></i>
                      <a (click)="getReferences('FILEORDERSOURCE')"
                         class="text-hover-primary p-l-6">{{'inventory.label.fileOrderSources' | translate}} :
                        <b>{{isReferencedBy.fileOrderSources}}</b></a>
                    </div>
                  }
                  @if (isReferencedBy.schedules) {
                    <div class="p-l-sm p-t-sm">
                      <i class="icon-color" nz-icon nzTheme="outline" nzType="schedule"></i>
                      <a (click)="getReferences('SCHEDULE')"
                         class="text-hover-primary p-l-6">{{'inventory.label.orders' | translate}} :
                        <b>{{isReferencedBy.schedules}}</b></a>
                    </div>
                  }
                  @if (isReferencedBy.workflows) {
                    <div class="p-l-sm p-t-sm">
                      <i class="icon-color" nz-icon nzTheme="outline" nzType="apartment"></i>
                      <a (click)="getReferences('WORKFLOW')"
                         class="text-hover-primary p-l-6">{{'inventory.label.workflows' | translate}} :
                        <b>{{isReferencedBy.workflows}}</b></a>
                    </div>
                  }
                </div>
              }
            </div>
          }
          @if (!isTrash) {
            <div class="box-body p-t-0">
              <div class="b-t p-t-sm font14 _500" translate>
                inventory.label.workflowTags
                <i (click)="expandCollapseTags()" class="cursor fa fa-lg p-l-sm"
                   [ngClass]="isExpandTag ? 'fa-angle-up' : 'fa-angle-down' "></i>
              </div>
              @if (isExpandTag) {
                <div>
                  @for (tag of tags; track tag) {
                    <div class="p-l-sm p-t-sm">
                      <span class="icon-color" nz-icon nzType="tag" nzTheme="outline"></span>
                      <span class="p-l-6">{{tag}}</span>
                    </div>
                  }
                </div>
              }
              <div class="m-t-sm p-l-sm">
                <a (click)="addTags()" class="text-primary" translate>inventory.button.manageTags</a>
              </div>
            </div>
          }
        </div>
      }

      <div class="rg-right"><span></span></div>
    </div>
  </div>
</div>

<!-- END SLIDER -->
<nz-dropdown-menu #menu="nzDropdownMenu">
  <ul nz-menu>
    <li (click)="copy(node);closeMenu()" nz-menu-item>
      <a><i nz-icon nzTheme="outline" nzType="copy"></i>&nbsp;
        <span translate>common.button.copy</span>
      </a>
    </li>
    <li (click)="cut(node);closeMenu()" nz-menu-item>
      <a><i nz-icon nzTheme="outline" nzType="scissor"></i>&nbsp;
        <span translate>common.button.cut</span>
      </a>
    </li>
    <li nz-menu-divider></li>
    @if (node && node.hasTemplate) {
      <li (click)="updateFromJobTemplate(node);closeMenu()" nz-menu-item>
        <a><i nz-icon nzTheme="outline" nzType="reload"></i>&nbsp;
          <span translate>inventory.button.updateFromJobTemplate</span>
        </a>
      </li>
    }
    @if (node && node.isJob) {
      <li (click)="makeJobTemplate(node);closeMenu()" nz-menu-item>
        <a><i nz-icon nzTheme="outline" nzType="plus"></i>&nbsp;
          <span translate>inventory.button.makeJobTemplate</span>
        </a>
      </li>
    }
    @if (node && node.isJob) {
      <li nz-menu-divider></li>
    }
    <li (click)="delete();closeMenu()" nz-menu-item>
      <a><i nz-icon nzTheme="outline" nzType="delete"></i>&nbsp;
        <span translate>common.button.remove</span>
      </a>
    </li>
    @if (node && node.isCloseable) {
      <li (click)="deleteAll();closeMenu()" nz-menu-item>
        <a><i nz-icon nzTheme="outline" nzType="delete"></i>&nbsp;
          <span translate>common.button.removeAll</span>
        </a>
      </li>
    }
  </ul>
</nz-dropdown-menu>
@if (isLoading) {
  <div class="spinner">
    <div class="cssload-inner cssload-one"></div>
    <div class="cssload-inner cssload-two"></div>
    <div class="cssload-inner cssload-three"></div>
  </div>
}
