<div class="modal-header">
  <h4 class="modal-title">
    <span translate>inventory.updateObject.label.updateObject</span>: {{type | translate}}
  </h4>
  <button type="button" class="close" aria-label="Close"
          (click)="step === 3 ? activeModal.close('Close') : activeModal.destroy()">
    <span aria-hidden="true" class="fa fa-times-circle"></span>
  </button>
</div>
<form #myForm="ngForm" (ngSubmit)="onSubmit()" spellcheck="false">
  <div class="modal-body p-a min-ht-150">
    <div class="row">
      <div class="col-md-12" *ngIf="step === 1">
        <div class="form-group row">
          <label class="col-md-4 col-lg-3 form-control-label"
                 translate>workflow.label.title</label>
          <div class="col-md-8 col-lg-9">
            <input type="text" class="form-control" name="title" placeholder="{{'common.placeholder.title' | translate}}"
                   [(ngModel)]="object.title" autocomplete="off"/>
          </div>
        </div>
        <div class="form-group row">
          <label class="col-md-4 col-lg-3 form-control-label" title="{{'inventory.label.documentation' | translate}}"
                 translate>inventory.label.documentation</label>
          <div class="col-md-8 col-lg-9">
            <nz-tree-select
              name="documentationName"
              nzNoAnimation
              [nzNodes]="documentationTree"
              [nzHideUnMatched]="true"
              [nzDropdownStyle]="{ 'max-height': '300px' }"
              nzShowSearch
              nzAllowClear
              [nzPlaceHolder]="'inventory.placeholder.documentationName' | translate"
              [(ngModel)]="object.documentationName"
              (nzExpandChange)="onExpand($event, 'DOCUMENTATION')"
            >
              <ng-template #nzTreeTemplate2 let-node>
                <div class="node-wrapper w-93" (click)="loadData(node, 'DOCUMENTATION', $event);">
                  <div class="node-content-wrapper"
                       [class.node-content-wrapper-active]="node.origin.assignReference == object.documentationName && object.documentationName">
                    <i *ngIf="!node.origin.type" nz-icon [nzType]="node.isExpanded ? 'folder-open' : 'folder'"
                       class="w-14"></i>
                    <i *ngIf="node.origin.type" class="fa fa-circle-o text-xs w-11 m-t-xs"></i>
                    {{node.origin.key}}
                  </div>
                </div>
              </ng-template>
            </nz-tree-select>
          </div>
        </div>
        <ng-container *ngIf="type === 'WORKFLOW'">
          <div class="form-group row">
            <label class="col-md-4 col-lg-3 form-control-label"
                   translate>workflow.label.jobResourceNames</label>
            <div class="col-md-8 col-lg-9">
              <nz-tree-select
                name="jobResource"
                nzNoAnimation
                nzMultiple
                nzAllowClear
                [nzNodes]="jobResourcesTree"
                [nzHideUnMatched]="true"
                [nzDropdownStyle]="{ 'max-height': '300px' }"
                nzShowSearch
                [nzPlaceHolder]="'workflow.placeholder.selectJobResources' | translate"
                [(ngModel)]="object.jobResourceNames"
              >
                <ng-template #nzTreeTemplate let-node>
                  <div class="node-wrapper w-93" (click)="loadData(node, 'JOBRESOURCE', $event);">
                    <div class="node-content-wrapper" [class.node-content-wrapper-active]="node.isSelected">
                      <i *ngIf="!node.origin.type" nz-icon [nzType]="node.isExpanded ? 'folder-open' : 'folder'"
                         class="w-14"></i>
                      <i *ngIf="node.origin.type" class="fa fa-circle-o text-xs w-11 m-t-xs"></i>
                      {{node.origin.key}}
                    </div>
                  </div>
                </ng-template>
              </nz-tree-select>
            </div>
          </div>
          <div class="form-group row">
            <div class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.timeZone</div>
            <div class="col-md-8 col-lg-9">
              <nz-select nzAllowClear nzShowSearch name="timeZone" [(ngModel)]="object.timeZone">
                <nz-option *ngFor="let zone of zones" [nzValue]="zone" [nzLabel]="zone"></nz-option>
              </nz-select>
            </div>
          </div>
        </ng-container>
        <ng-container *ngIf="type === 'FILEORDERSOURCE'">
          <div class="form-group row">
            <label class="col-md-4 col-lg-3 form-control-label" translate>inventory.label.workflowName</label>
            <div class="col-md-8 col-lg-9">
              <nz-tree-select
                name="workflowName"
                nzNoAnimation
                [nzAllowClear]="false"
                [nzNodes]="workflowTree"
                [nzHideUnMatched]="true"
                [nzDropdownStyle]="{ 'max-height': '300px' }"
                nzShowSearch
                nzAllowClear
                [(ngModel)]="object.workflowName"
                (nzExpandChange)="onExpand($event, 'WORKFLOW')"
              >
                <ng-template #nzTreeTemplate let-node>
                  <div class="node-wrapper w-93" (click)="loadData(node, 'WORKFLOW', $event);">
                    <div class="node-content-wrapper"
                         [class.node-content-wrapper-active]="node.origin.key == object.workflowName && object.workflowName">
                      <i *ngIf="!node.origin.type" nz-icon [nzType]="node.isExpanded ? 'folder-open' : 'folder'"
                         class="w-14"></i>
                      <i *ngIf="node.origin.type" class="fa fa-circle-o text-xs w-11 m-t-xs"></i>
                      {{node.origin.name}}
                    </div>
                  </div>
                </ng-template>
              </nz-tree-select>
            </div>
          </div>
          <div class="form-group row">
            <label class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.agent</label>
            <div class="col-md-8 col-lg-9">
              <nz-select nzAllowClear nzShowSearch name="agentName" nzPlaceHolder="{{'workflow.placeholder.selectAgentName' | translate}}"
                         [(ngModel)]="object.agentName">
                <nz-option *ngFor="let agent of agents" [nzLabel]="agent" [nzValue]="agent"></nz-option>
              </nz-select>
            </div>
          </div>
          <div class="form-group row">
            <label class="col-md-4 col-lg-3 form-control-label" translate>inventory.label.directory</label>
            <div class="col-md-8 col-lg-9">
              <input type="text" class="form-control" autocomplete="off" maxlength="255"
                     placeholder="{{'inventory.placeholder.directory' | translate}}"
                     name="directory" [(ngModel)]="object.directoryExpr">
            </div>
          </div>
          <div class="form-group row">
            <label class="col-md-4 col-lg-3 form-control-label" translate>inventory.label.pattern</label>
            <div class="col-md-8 col-lg-9">
              <input type="text" class="form-control" autocomplete="off" maxlength="255"
                     placeholder="{{'inventory.placeholder.pattern' | translate}}"
                     name="pattern" [(ngModel)]="object.pattern">
            </div>
          </div>
          <div class="form-group row">
            <label class="col-md-4 col-lg-3 form-control-label" translate>common.label.timeZone</label>
            <div class="col-md-8 col-lg-9">
              <nz-select nzShowSearch name="timeZone" nzAllowClear [(ngModel)]="object.timeZone">
                <nz-option *ngFor="let zone of zones" [nzValue]="zone" [nzLabel]="zone"></nz-option>
              </nz-select>
            </div>
          </div>
          <div class="form-group row">
            <label class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.delay</label>
            <div class="col-md-8 col-lg-9">
              <nz-input-number [nzMin]="1" [nzStep]="1" name="delay" [(ngModel)]="object.delay"></nz-input-number>
            </div>
          </div>
        </ng-container>
        <ng-container *ngIf="type === 'NOTICEBOARD'">
          <div class="form-group row">
            <label class="col-md-4 col-lg-3 form-control-label" translate>inventory.label.toNotice</label>
            <div class="col-md-8 col-lg-9">
              <nz-input-group [nzAddOnAfter]="addOnAfterTemplate">
                <input autocomplete="off" nz-input type="text" name="toNotice"
                       placeholder="{{'inventory.placeholder.toNotice' | translate}}"
                       [(ngModel)]="object.postOrderToNoticeId">
              </nz-input-group>
              <ng-template #addOnAfterTemplate>
                <nz-select [nzAllowClear]="true" nzPlaceHolder="{{'inventory.placeholder.selectPredefinedExpression' | translate}}" (ngModelChange)="changeExp($event, 'toNotice')" name="toNoticeMsg" [(ngModel)]="object.toNoticeMsg" style="width: 220px">
                  <nz-option [nzLabel]="'inventory.label.matchingDailyPlanDate' | translate" nzValue="replaceAll($js7OrderId, '^#([0-9]{4}-[0-9]{2}-[0-9]{2})#.*$', '$1')"></nz-option>
                  <nz-option [nzLabel]="'inventory.label.matchingDailyPlanDateAndOrderName' | translate" nzValue="replaceAll($js7OrderId, '^#([0-9]{4}-[0-9]{2}-[0-9]{2})#.*-(.*)$', '$1$2')"></nz-option>
                </nz-select>
              </ng-template>
            </div>
          </div>
          <div class="form-group row">
            <label class="col-md-4 col-lg-3 form-control-label" translate>inventory.label.readingOrderToNoticeId</label>
            <div class="col-md-8 col-lg-9">
              <nz-input-group [nzAddOnAfter]="addOnAfterTemplate3">
                <input autocomplete="off" nz-input type="text" name="readingOrderToNoticeId"
                       placeholder="{{'inventory.placeholder.readingOrderToNoticeId' | translate}}"
                       [(ngModel)]="object.expectOrderToNoticeId">
              </nz-input-group>
              <ng-template #addOnAfterTemplate3>
                <nz-select [nzAllowClear]="true" nzPlaceHolder="{{'inventory.placeholder.selectPredefinedExpression' | translate}}" (ngModelChange)="changeExp($event, 'NoticeId')" name="readingOrderToNoticeIdMsg" [(ngModel)]="object.readingOrderToNoticeIdMsg" style="width: 220px">
                  <nz-option [nzLabel]="'inventory.label.matchingDailyPlanDate' | translate" nzValue="replaceAll($js7OrderId, '^#([0-9]{4}-[0-9]{2}-[0-9]{2})#.*$', '$1')"></nz-option>
                  <nz-option [nzLabel]="'inventory.label.matchingDailyPlanDateAndOrderName' | translate" nzValue="replaceAll($js7OrderId, '^#([0-9]{4}-[0-9]{2}-[0-9]{2})#.*-(.*)$', '$1$2')"></nz-option>
                </nz-select>
              </ng-template>
            </div>
          </div>
          <div class="form-group row">
            <label class="col-md-4 col-lg-3 form-control-label" translate>inventory.label.endOfLife</label>
            <div class="col-md-8 col-lg-9">
              <nz-input-group [nzAddOnAfter]="addOnAfterTemplate2">
                <input timevalidator maxlength="8" [hidden]="object.units !== 'HH:MM:SS'" nz-input autocomplete="off" type="text" name="endOfLife"
                       placeholder="{{'inventory.placeholder.endOfLife' | translate}}"
                       [(ngModel)]="object.endOfLife">
                <nz-input-number [hidden]="object.units === 'HH:MM:SS'" [nzMin]="1" nzPlaceHolder="{{'inventory.placeholder.endOfLife' | translate}}" name="endOfLife1" [(ngModel)]="object.endOfLife"
                                 ></nz-input-number>
              </nz-input-group>
              <ng-template #addOnAfterTemplate2>
                <nz-select name="units" [(ngModel)]="object.units" (ngModelChange)="changeUnit($event)" style="width: 220px">
                  <nz-option [nzLabel]="'inventory.label.milliseconds' | translate" nzValue="Milliseconds"></nz-option>
                  <nz-option [nzLabel]="'inventory.label.seconds' | translate" nzValue="Seconds"></nz-option>
                  <nz-option [nzLabel]="'inventory.label.minutes' | translate" nzValue="Minutes"></nz-option>
                  <nz-option [nzLabel]="'inventory.label.hours' | translate" nzValue="Hours"></nz-option>
                  <nz-option [nzLabel]="'inventory.label.days' | translate" nzValue="Days"></nz-option>
                  <nz-option [nzLabel]="'HH:MM:SS'" nzValue="HH:MM:SS"></nz-option>
                </nz-select>
              </ng-template>
            </div>
          </div>
        </ng-container>
        <ng-container *ngIf="type === 'LOCK'">
          <div class="form-group row">
            <label class="col-md-4 col-lg-3 form-control-label"
                   translate>inventory.label.limit</label>
            <div class="col-md-8 col-lg-9">
              <nz-input-number [nzMin]="0" [nzStep]="1" [nzPlaceHolder]="'inventory.placeholder.enterLimit' | translate"
                               name="limit" [(ngModel)]="object.limit"></nz-input-number>
            </div>
          </div>
        </ng-container>
        <ng-container *ngIf="type === 'SCHEDULE'">
          <div class="form-group row">
            <label class="col-md-4 col-lg-3 form-control-label" translate>inventory.label.workflowName</label>
            <div class="col-md-8 col-lg-9">
              <nz-tree-select
                name="workflowName"
                nzNoAnimation
                [nzAllowClear]="false"
                [nzNodes]="workflowTree"
                [nzHideUnMatched]="true"
                [nzDropdownStyle]="{ 'max-height': '300px' }"
                nzShowSearch
                [(ngModel)]="object.workflowName"
                (nzExpandChange)="onExpand($event, 'WORKFLOW')"
              >
                <ng-template #nzTreeTemplate let-node>
                  <div class="node-wrapper w-93" (click)="loadData(node, 'WORKFLOW', $event);">
                    <div class="node-content-wrapper" [class.node-content-wrapper-active]="node.origin.key == object.workflowName && object.workflowName">
                      <i *ngIf="!node.origin.type" nz-icon [nzType]="node.isExpanded ? 'folder-open' : 'folder'" class="w-14"></i>
                      <i *ngIf="node.origin.type" class="fa fa-circle-o text-xs w-11 m-t-xs"></i>
                      {{node.origin.name}}
                    </div>
                  </div>
                </ng-template>
              </nz-tree-select>
            </div>
          </div>
          <div class="form-group row">
            <label class="col-md-4 col-lg-3 block-ellipsis-job" translate>inventory.label.planOrderAutomatically</label>
            <div class="col-md-8 col-lg-9">
              <label nz-checkbox [(ngModel)]="object.planOrderAutomatically" name="planOrderAutomatically"></label>
            </div>
          </div>
          <div class="form-group row">
            <label class="col-md-4 col-lg-3 block-ellipsis-job" translate>inventory.label.submitOrderToControllerWhenPlanned</label>
            <div class="col-md-8 col-lg-9">
              <label nz-checkbox [(ngModel)]="object.submitOrderToControllerWhenPlanned" name="submitOrderToControllerWhenPlanned"></label>
            </div>
          </div>
        </ng-container>
        <ng-container *ngIf="type === 'CALENDAR'">
          <div class="form-group row">
            <label class="col-md-4 col-lg-3 form-control-label" translate>common.label.type</label>
            <div class="col-md-8 col-lg-9">
              <nz-select [(ngModel)]="object.type" name="cType">
                <nz-option nzValue="WORKINGDAYSCALENDAR" [nzLabel]="'runtime.label.workingDay' | translate"></nz-option>
                <nz-option nzValue="NONWORKINGDAYSCALENDAR" [nzLabel]="'runtime.label.nonWorkingDay' | translate"></nz-option>
              </nz-select>
            </div>
          </div>
          <div class="form-group row">
            <label class="col-md-3 col-md-4 col-lg-3 form-control-label" translate>runtime.label.validFrom</label>
            <div class="col-md-3 col-lg-3 col-xl-3 col-xxl-2">
              <nz-date-picker name="from"
                              [(ngModel)]="object.from" [nzFormat]="dateFormat"
                              [nzPlaceHolder]="'common.placeholder.setStartDate' | translate"></nz-date-picker>
            </div>
            <label class="col-md-3 col-lg-3 col-xl-2 col-xxl-2 form-control-label date-center" translate>runtime.label.validTo</label>
            <div class="col-md-3 col-lg-3 col-xl-3 col-xxl-2 date-right">
              <nz-date-picker id="to" name="to"
                              [(ngModel)]="object.to" [nzFormat]="dateFormat"
                              [nzPlaceHolder]="'common.placeholder.setEndDate' | translate"></nz-date-picker>
            </div>
          </div>
        </ng-container>
      </div>
      <div class="col-md-12" *ngIf="step === 2">
        <div class="min-ht-200" style="display: flex;justify-content: center;align-items: center;">
          <div class="text-md">
            <span class="_600" translate [translateParams]="{count: data.length}">inventory.updateObject.message.updateSuccessfully</span>
            <a class="text-primary p-l-xs" *ngIf="!(type === 'SCHEDULE' || type.match('Calendar'))" (click)="step = 3;" translate>inventory.updateObject.button.clickHereToDeploy</a>
            <a class="text-primary p-l-xs" *ngIf="(type === 'SCHEDULE' || type.match('Calendar'))" (click)="preferences.auditLog ? step = 3 : deploy(false)" translate>inventory.updateObject.button.clickHereToRelease</a>
          </div>
        </div>
      </div>
      <div class="col-md-12" *ngIf="step === 3">
        <div *ngIf="preferences.auditLog">
          <app-audit-log-input [comments]="comments" [sizeX]="3" [sizeY]="8"></app-audit-log-input>
        </div>
        <div class="form-group row" *ngIf="!(type === 'SCHEDULE' || type.match('Calendar'))">
          <label class="col-md-3 form-control-label">
            <label translate>inventory.label.controllers</label>
          </label>
          <div class="col-md-8">
            <nz-select
              nzMode="multiple"
              nzShowSearch
              name="schedulerIds"
              [(ngModel)]="selectedSchedulerIds">
              <ng-container *ngFor="let id of schedulerIds.controllerIds">
                <nz-option [nzValue]="id" [nzLabel]="id"></nz-option>
              </ng-container>
            </nz-select>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button type="submit" class="btn btn-primary btn-sm" [disabled]="!myForm.form.valid || submitted" *ngIf="step === 1" translate>
      <i *ngIf="submitted" class="fa fa-spin fa-spinner p-r-xs"></i>
      {{'common.button.submit' | translate}}
    </button>
    <button type="button" (click)="deploy(!(type === 'SCHEDULE' || type.match('Calendar')))" class="btn btn-primary btn-sm" [disabled]="!myForm.form.valid || submitted" *ngIf="step === 3" translate>
      <i *ngIf="submitted" class="fa fa-spin fa-spinner p-r-xs"></i>
      <span *ngIf="!(type === 'SCHEDULE' || type.match('Calendar'))" translate>inventory.button.deploy</span>
      <span *ngIf="(type === 'SCHEDULE' || type.match('Calendar'))" translate>inventory.button.release</span>
    </button>
    <button type="button" class="btn btn-grey btn-sm" *ngIf="step === 2" (click)="activeModal.close('Close')" translate>
      common.button.close
    </button>
    <button type="button" class="btn btn-grey btn-sm" [disabled]="submitted" *ngIf="step !== 2"
            (click)="activeModal.destroy()" translate>
      common.button.cancel
    </button>
  </div>
</form>
