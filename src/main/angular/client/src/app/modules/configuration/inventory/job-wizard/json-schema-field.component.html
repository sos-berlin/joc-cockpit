
  <div class="row">
    <div
      class="col-md-12">
  <div class="form-group row">
    <div class="col-md-3 form-control-label">
      <label class="control-label">{{ fieldName }}</label>
    </div>
    <div class="col-md-12">

      <!-- STRING INPUT -->
      <ng-container *ngIf="isStringField()">
        <input
          type="text"
          class="form-control"
          [value]="formControl.value"
          (input)="updateValue($event)"
          [placeholder]="fieldName"
        />
      </ng-container>
    </div>
    <div class="col-md-12">
      <!-- NUMBER INPUT -->
      <ng-container *ngIf="isNumberField()">
        <input
          type="number"
          class="form-control"
          [value]="formControl.value"
          (input)="updateValue($event)"
          [placeholder]="fieldName"
        />
      </ng-container>
    </div>
    <div class="col-md-12">
      <!-- BOOLEAN INPUT -->
      <ng-container *ngIf="isBooleanField()">
        <div class="checkbox">
          <label>
            <input
              type="checkbox"
              [checked]="formControl.value"
              (change)="updateBooleanValue($event)"
            />
          </label>
        </div>
      </ng-container>
    </div>
    <div class="col-md-12">
      <!-- MAP/DICTIONARY (object with additionalProperties) -->
      <ng-container *ngIf="isMapField()">
        <button
          type="button"
          class="btn btn-grey btn-xs"
          (click)="addMapEntry()">
          <i class="fa fa-plus"></i> Add Entry
        </button>
        <div style="margin-top:0.5rem">
          <div *ngFor="let entry of getMapEntries(); let i = index"
               style="display:flex; gap:0.5rem; margin-bottom:0.25rem">
            <input
              class="form-control"
              placeholder="Key"
              [value]="entry.get('key').value"
              (input)="updateMapKey(i, $event)"
              style="width:45%" />
            <input
              class="form-control"
              placeholder="Value"
              [value]="entry.get('value').value"
              (input)="updateMapValue(i, $event)"
              style="width:45%" />
            <button
              type="button"
              class="btn btn-grey btn-sm m-l-sm"
              (click)="removeMapEntry(i)">
              âœ•
            </button>
          </div>
        </div>
      </ng-container>
    </div>
    <div class="col-md-12">
      <ng-container *ngIf="isObjectField() && !isMapField()">
        <div class="well">
          <fieldset>
            <ng-container *ngFor="let childKey of getObjectProperties()">
              <json-schema-field
                *ngIf="getChildControl(childKey)"
                [propertyPath]="getChildPath(childKey)"
                [schema]="schema"
                [formControl]="getChildControl(childKey)"
                [parent]="parent">
              </json-schema-field>
            </ng-container>
          </fieldset>
        </div>
      </ng-container>
    </div>
    <div class="col-md-12">
      <!-- ARRAY -->
      <ng-container *ngIf="isArrayField()">
        <button
          type="button"
          class="btn btn-grey btn-xs"
          (click)="addArrayItem()">
          <i class="fa fa-plus"></i> Add Item
        </button>

        <div style="margin-top: 0.5rem;">
          <div *ngFor="let item of getArrayControls(); let i = index"
               style="margin-bottom: 1rem; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;">

            <!-- Array item header -->
            <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 0.5rem;">
              <strong>Item {{ i + 1 }}</strong>
              <button
                type="button"
                class="btn btn-grey btn-sm m-l-sm"
                (click)="removeArrayItem(i)">
                Remove
              </button>
            </div>

            <!-- Render array item content recursively -->
            <ng-container *ngIf="isArrayOfPrimitives(); else arrayOfObjects">
              <!-- Primitive array item -->
              <ng-container [ngSwitch]="getArrayItemType()">
                <input
                  *ngSwitchCase="'string'"
                  type="text"
                  class="form-control"
                  [value]="item.value"
                  (input)="updateArrayItemValue(i, $event)" />

                <input
                  *ngSwitchCase="'number'"
                  type="number"
                  class="form-control"
                  [value]="item.value"
                  (input)="updateArrayItemValue(i, $event)" />

                <input
                  *ngSwitchCase="'integer'"
                  type="number"
                  class="form-control"
                  [value]="item.value"
                  (input)="updateArrayItemValue(i, $event)" />

                <div *ngSwitchCase="'boolean'" class="checkbox">
                  <label>
                    <input
                      type="checkbox"
                      [checked]="item.value"
                      (change)="updateArrayItemBooleanValue(i, $event)" />
                  </label>
                </div>

                <input
                  *ngSwitchDefault
                  type="text"
                  class="form-control"
                  [value]="item.value"
                  (input)="updateArrayItemValue(i, $event)" />
              </ng-container>
            </ng-container>

            <!-- Array of objects template -->
            <ng-template #arrayOfObjects>
              <ng-container *ngFor="let objKey of getArrayItemObjectProperties()">
                <json-schema-field
                  *ngIf="getArrayItemChildControl(i, objKey)"
                  [propertyPath]="getArrayItemChildPath(i, objKey)"
                  [schema]="schema"
                  [formControl]="getArrayItemChildControl(i, objKey)"
                  [parent]="parent">
                </json-schema-field>
              </ng-container>
            </ng-template>
          </div>
        </div>
      </ng-container>

    </div>
  </div>

  <!-- Validation Messages -->
  <div *ngIf="formControl && formControl.invalid && (formControl.touched || formControl.dirty)"
       class="col-md-offset-3 col-md-6">
    <small class="text-danger" *ngIf="formControl.hasError('required')">
      {{ fieldName }} is required
    </small>
    <small class="text-danger" *ngIf="formControl.hasError('maxlength')">
      Max length exceeded ({{ formControl.getError('maxlength').actualLength }}/{{ formControl.getError('maxlength').requiredLength }})
    </small>
    <small class="text-danger" *ngIf="formControl.hasError('minlength')">
      Min length required ({{ formControl.getError('minlength').actualLength }}/{{ formControl.getError('minlength').requiredLength }})
    </small>
    <small class="text-danger" *ngIf="formControl.hasError('pattern')">
      Invalid format
    </small>
    <small class="text-danger" *ngIf="formControl.hasError('min')">
      Value must be at least {{ formControl.getError('min').min }}
    </small>
    <small class="text-danger" *ngIf="formControl.hasError('max')">
      Value must be at most {{ formControl.getError('max').max }}
    </small>
  </div>
</div>
</div>
