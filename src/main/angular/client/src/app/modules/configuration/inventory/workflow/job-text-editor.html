<div class="pos-abt" style="top: 9px; right: 18px">
  <ul class="nav navbar-nav navbar-nav-inline nav-active-border3 ">
    <li class="nav-item" [nz-tooltip]="'workflow.button.undo' | translate" >
      <a class="nav-link" [ngClass]="{'disable-link': history.length === 0}"
         (click)="undo()">
        <span class="nav-text"> <i nz-icon nzType="undo" nzTheme="outline"></i></span>
      </a>
    </li>
    <li class="nav-item" [nz-tooltip]="'workflow.button.redo' | translate">
      <a class="nav-link" [ngClass]="{'disable-link': history.length === 0 || indexOfNextAdd > history.length}"
         (click)="redo()">
        <span class="nav-text"> <i nz-icon nzType="redo" nzTheme="outline"></i></span>
      </a>
    </li>
  </ul>
</div>
<nz-tabset [(nzSelectedIndex)]="index" [nzAnimated]="false" (nzSelectChange)="tabChange($event)">
  <nz-tab [nzTitle]="'workflow.tab.jobProperties' | translate">
    <div class="job-property-editor" *ngIf="index === 0">
      <div class="form-group row">
        <label class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.name</label>
        <div class="col-md-8 col-lg-9" [ngClass]="{'has-error' : ((name.dirty || name.touched) && name.invalid)}">
          <label class="w-full">
            <input type="text" identifierValidation [appAutofocus]="true" autocomplete="off" required class="form-control"
                   placeholder="{{'common.placeholder.name' | translate}}" name="name" #name="ngModel" (blur)="checkJobInfo()"
                   [(ngModel)]="selectedNode.obj.jobName">
          </label>
          <div *ngIf="name.invalid && name.errors && (name.dirty || name.touched)"
               class="text-danger help-block">
            <div *ngIf="name.errors.required">
              <div translate>common.message.requiredError</div>
            </div>
            <div *ngIf="name.errors.invalidIdentifier" translate>common.message.invalid</div>
          </div>
        </div>
      </div>
      <div class="form-group row" >
        <label class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.label</label>
        <div class="col-md-8 col-lg-9" [ngClass]="{'has-error' : (obj.label || errorMsg || (label.dirty || label.touched) && label.invalid)}">
          <label class="w-full">
            <input type="text" labelValidation required autocomplete="off" (blur)="onBlur();errorMsg=''" maxlength="30" class="form-control"
                   name="label" #label="ngModel" [(ngModel)]="selectedNode.obj.label" [appAutofocus]="!!(obj.label || errorMsg)">
          </label>
          <div *ngIf="obj.label || errorMsg || label.invalid && (label.dirty || label.touched)"
               class="text-danger help-block">
            <div *ngIf="label.errors && label.errors.invalidIdentifier" translate>common.message.invalid</div>
            <div *ngIf="(label.errors && label.errors.required) || obj.label">
              <div translate>common.message.requiredError</div>
            </div>
            <div *ngIf="!label.errors && errorMsg">{{errorMsg | translate}}</div>
          </div>
        </div>
      </div>
      <div class="form-group row">
        <label class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.title</label>
        <div class="col-md-8 col-lg-9">
          <label class="w-full">
            <input type="text" autocomplete="off" [maxLength]="255" class="form-control" [(ngModel)]="selectedNode.job.title" (blur)="saveToHistory();"
                   placeholder="{{'common.placeholder.title' | translate}}" name="title">
          </label>
        </div>
      </div>
      <div class="form-group row">
        <label class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.agent</label>
        <div class="col-md-8 col-lg-9"
             [ngClass]="{'has-error' : (obj.agent || (agentName.dirty || agentName.touched) && agentName.invalid)}">
          <nz-select nzShowSearch name="agentName" nzPlaceHolder="{{'workflow.placeholder.selectAgentName' | translate}}"
                     [(ngModel)]="selectedNode.job.agentName" #agentName="ngModel" (ngModelChange)="onBlur();">
            <nz-option *ngFor="let agent of agents" [nzLabel]="agent" [nzValue]="agent"></nz-option>
          </nz-select>
          <div *ngIf="obj.agent || agentName.invalid && (agentName.dirty || agentName.touched)"
               class="text-danger help-block">
            <div *ngIf="(agentName.errors && agentName.errors.required) || obj.agent">
              <div translate>common.message.requiredError</div>
            </div>
          </div>
        </div>
      </div>
      <div class="form-group row">
        <label class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.jobResourceNames</label>
        <div class="col-md-8 col-lg-9">
          <nz-tree-select
            name="jobResource"
            #treeSelectCtrl
            nzNoAnimation
            nzMultiple
            [nzAllowClear]="false"
            [nzNodes]="jobResourcesTree"
            [nzHideUnMatched]="true"
            [nzDropdownStyle]="{ 'max-height': '300px' }"
            nzShowSearch
            [nzPlaceHolder]="'workflow.placeholder.selectJobResources' | translate"
            [(ngModel)]="selectedNode.job.jobResourceNames"
            (nzExpandChange)="onExpand($event, 'JOBRESOURCE')"
          >
            <ng-template #nzTreeTemplate let-node>
              <div style="width: 93%" class="node-wrapper" (click)="loadData(node, 'JOBRESOURCE', $event);">
                <div class="node-content-wrapper" [class.node-content-wrapper-active]="node.isSelected">
                  <i *ngIf="!node.origin.type" nz-icon [nzType]="node.isExpanded ? 'folder-open' : 'folder'" class="w-14"></i>
                  <i *ngIf="node.origin.type" class="fa fa-circle-o text-xs w-11 m-t-xs"></i>
                  {{node.origin.name}}
                </div>
              </div>
            </ng-template>
          </nz-tree-select>
        </div>
      </div>
      <div class="form-group row">
        <div class="col-md-4 col-lg-3" translate>workflow.label.returnCode</div>
        <div class="col-md-8 col-lg-9">
          <nz-radio-group [(ngModel)]="returnCodes.on" (ngModelChange)="saveToHistory();">
            <label nz-radio nzValue="success" (click)="selectedNode.job.returnCodeMeaning.success = selectedNode.job.returnCodeMeaning.failure;selectedNode.job.returnCodeMeaning.failure = ''"><span translate>workflow.label.onSuccess</span></label>
            <label nz-radio nzValue="failure" (click)="selectedNode.job.returnCodeMeaning.failure = selectedNode.job.returnCodeMeaning.success;selectedNode.job.returnCodeMeaning.success = ''"><span translate>workflow.label.onFailure</span></label>
          </nz-radio-group>
        </div>
      </div>
      <div class="form-group row" *ngIf="returnCodes.on === 'success'">
        <label class="col-md-4 col-lg-3 form-control-label"></label>
        <div class="col-md-8 col-lg-9"
             [ngClass]="{'has-error' : ((success.dirty || success.touched) && success.invalid)}">
          <label class="w-full">
            <input autocomplete="off" type="text" class="form-control" validateNumberArrayReqex (blur)="saveToHistory();"
                   placeholder="{{'workflow.placeholder.enterPositiveNumber' | translate}}"
                   name="success" #success="ngModel" [(ngModel)]="selectedNode.job.returnCodeMeaning.success">
          </label>
          <div *ngIf="success.invalid && (success.dirty || success.touched)"
               class="text-danger help-block">
            <div *ngIf="success.errors.validateNumberArrayRegex" translate>common.message.invalid</div>
          </div>
        </div>
      </div>
      <div class="form-group row" *ngIf="returnCodes.on === 'failure'">
        <label class="col-md-4 col-lg-3 form-control-label"></label>
        <div class="col-md-8 col-lg-9"
             [ngClass]="{'has-error' : ((failure.dirty || failure.touched) && failure.invalid)}">
          <label class="w-full">
            <input autocomplete="off" type="text" class="form-control" validateNumberArrayReqex (blur)="saveToHistory();"
                   placeholder="{{'workflow.placeholder.enterPositiveNumber' | translate}}"
                   #failure="ngModel" name="failure" [(ngModel)]="selectedNode.job.returnCodeMeaning.failure">
          </label>
          <div *ngIf="failure.invalid && (failure.dirty || failure.touched)"
               class="text-danger help-block">
            <div *ngIf="failure.errors.validateNumberArrayRegex" translate>common.message.invalid</div>
          </div>
        </div>
      </div>
      <div class="form-group row" *ngIf="selectedNode.job.executable">
        <label class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.jobClass</label>
        <div class="col-md-8 col-lg-9">
          <nz-select name="executableType" [(ngModel)]="selectedNode.job.executable.TYPE" (ngModelChange)="changeType($event)">
            <nz-option [nzLabel]="'workflow.label.shell' | translate" [nzValue]="'ScriptExecutable'"></nz-option>
            <nz-option [nzLabel]="'workflow.label.jitl' | translate" [nzValue]="'InternalExecutable'"></nz-option>
          </nz-select>
        </div>
      </div>
      <div class="form-group row" *ngIf="selectedNode.job.executable && selectedNode.job.executable.TYPE === 'ScriptExecutable'">
        <label class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.compatibleMode</label>
        <div class="col-md-8 col-lg-9">
          <nz-select name="v1Compatible" nzAllowClear [(ngModel)]="selectedNode.job.executable.v1Compatible" (ngModelChange)="saveToHistory();">
            <nz-option [nzLabel]="'workflow.label.branch1.x' | translate" [nzValue]="true"></nz-option>
          </nz-select>
        </div>
      </div>
      <div class="form-group row">
        <div class="col-md-12">
          <nz-tabset>
            <nz-tab [nzTitle]="'workflow.label.script' | translate" (nzClick)="reloadScript()" *ngIf="selectedNode.job.executable && selectedNode.job.executable.TYPE !== 'InternalExecutable'">
              <div class="row" *ngIf="isDisplay">
                <div class="col-md-12 role">
                  <i class="pos-abt cursor" nz-icon nzType="form" nzTheme="outline" (click)="fullScreen()" style="right: 15px;top:1px;font-size: 16px;z-index: 999"></i>
                  <div class="b-a" [ngClass]="{'invalid': obj.script || (script.invalid && (script.dirty && script.touched))}">
                    <ngx-codemirror required #script="ngModel" [(ngModel)]="selectedNode.job.executable.script"
                                    [options]="cmOption" (focusChange)="focusChange()" (focusout)="saveToHistory()"
                    ></ngx-codemirror>
                  </div>
                  <div *ngIf="obj.script || (script.invalid && (script.dirty && script.touched))"
                       class="text-danger help-block">
                    <div *ngIf="(script.errors && script.errors.required) || obj.script">
                      <div translate>common.message.requiredError</div>
                    </div>
                  </div>
                </div>
              </div>
            </nz-tab>
            <nz-tab [nzTitle]="'workflow.label.className' | translate" *ngIf="selectedNode.job.executable && selectedNode.job.executable.TYPE === 'InternalExecutable'">
              <div class="row">
                <div class="col-md-12" [ngClass]="{'has-error': obj.className || (className.invalid && (className.dirty && className.touched))}">
                  <label class="w-full">
                    <input autocomplete="off" type="text" class="form-control" name="className" required (blur)="onBlur();"
                             [(ngModel)]="selectedNode.job.executable.className" #className="ngModel" placeholder="{{'workflow.placeholder.className' | translate}}">
                  </label>
                  <div *ngIf="obj.className || (className.invalid && (className.dirty && className.touched))"
                       class="text-danger help-block">
                    <div *ngIf="(className.errors && className.errors.required) || obj.className">
                      <div translate>common.message.requiredError</div>
                    </div>
                  </div>
                </div>
              </div>
            </nz-tab>
            <nz-tab [nzTitle]="'workflow.label.arguments' | translate" *ngIf="selectedNode.job.executable && selectedNode.job.executable.TYPE === 'ScriptExecutable' && selectedNode.job.executable.v1Compatible">
              <div class="row">
                <div class="col-md-12" style="max-height: calc(100vh - 675px); overflow: auto">
                  <div class="form-group row m-b-0 m-l-12">
                    <div class="col-md-4 col-lg-5 m-b-sm" translate>common.label.name</div>
                    <div class="col-md-8 col-lg-6 m-b-sm" translate>common.label.value</div>
                  </div>
                  <div cdkDropList (cdkDropListDropped)="drop($event, selectedNode.job.defaultArguments)">
                    <div class="form-group row m-b-0 m-l-12" *ngFor="let argument of selectedNode.job.defaultArguments; let i = index" cdkDrag>
                      <div class="pos-abt" style="margin-left: -13px;font-size: 18px;margin-top: 2px;cursor: move" cdkDragHandle>
                        <i class="fa fa-bars" aria-hidden="true"></i>
                      </div>
                      <div class="col-md-5 col-lg-5 m-b-sm" [ngClass]="{'has-error' : ((aname.dirty || aname.touched) && aname.invalid)}">
                        <label class="w-full">
                          <input autocomplete="off" identifierValidation type="text" class="form-control" name="name{{i}}" [appAutofocus]="i == selectedNode.job.defaultArguments.length -1"
                                 [(ngModel)]="argument.name" #aname="ngModel" placeholder="{{'common.placeholder.name' | translate}} {{i+1}}" (blur)="isStringValid(argument, aname.invalid)">
                        </label>
                        <div *ngIf="aname.invalid && aname.errors && (aname.dirty || aname.touched)" class="text-danger help-block">
                          <div *ngIf="aname.errors.invalidIdentifier" translate>common.message.invalid</div>
                        </div>
                      </div>
                      <div class="col-md-6 col-lg-6 m-b-sm">
                        <label class="w-full">
                          <input autocomplete="off" type="text" class="form-control" name="value{{i}}" (keypress)="onKeyPress($event, 'default')"
                                 [(ngModel)]="argument.value" placeholder="{{'common.placeholder.value' | translate}} {{i+1}}">
                        </label>
                        <i class="pos-abt cursor" nz-icon nzType="form" nzTheme="outline" (click)="openEditor(argument)" style="right: 13px;top:1px;"></i>
                      </div>
                      <div class="col-md-1 col-lg-1 p-l-0">
                        <a><i (click)="removeVariable(i)" class="fa fa-times m-t-sm text-hover-color"></i></a>
                      </div>
                    </div>
                  </div>
                  <div class="form-group row">
                    <div class="col-sm-12" *ngIf="selectedNode.job.defaultArguments">
                      <a class="text-u-l" (click)="addVariable();saveToHistory()" translate>workflow.button.addArgument</a>
                    </div>
                  </div>
                </div>
              </div>
            </nz-tab>
            <nz-tab [nzTitle]="'workflow.label.environmentVariables' | translate" *ngIf="selectedNode.job.executable && selectedNode.job.executable.TYPE === 'ScriptExecutable'">
              <div class="row">
                <div class="col-md-12" style="max-height: calc(100vh - 675px); overflow: auto" *ngIf="selectedNode.job.executable.env">
                  <div class="form-group row m-b-0 m-l-12">
                    <div class="col-md-4 col-lg-5 m-b-sm" translate>common.label.name</div>
                    <div class="col-md-8 col-lg-6 m-b-sm" translate>common.label.value</div>
                  </div>
                  <div cdkDropList (cdkDropListDropped)="drop($event, selectedNode.job.executable.env)">
                    <div class="form-group row m-b-0 m-l-12" *ngFor="let env of selectedNode.job.executable.env; let i = index" cdkDrag>
                      <div class="pos-abt" style="margin-left: -13px;font-size: 18px;margin-top: 2px;cursor: move" cdkDragHandle>
                        <i class="fa fa-bars" aria-hidden="true"></i>
                      </div>
                      <div class="col-md-5 col-lg-5 m-b-sm " [ngClass]="{'has-error' : ((ename.dirty || ename.touched) && ename.invalid)}">
                        <label class="w-full">
                          <input nz-input envVariableValidation name="name{{i}}" class="form-control" [(ngModel)]="env.name" #ename="ngModel" (blur)="isStringValid(env, ename.invalid);upperCase(env)"
                                 placeholder="{{'common.placeholder.name' | translate}} {{i+1}}" [nzAutocomplete]="auto" (ngModelChange)="onChange($event)">
                        </label>
                        <nz-autocomplete #auto>
                          <nz-auto-option *ngFor="let list of filteredOptions" [nzValue]="list.name">{{list.name}}</nz-auto-option>
                        </nz-autocomplete>
                        <div *ngIf="ename.invalid && ename.errors && (ename.dirty || ename.touched)" class="text-danger help-block">
                          <div *ngIf="ename.errors.invalidIdentifier" translate>common.message.invalid</div>
                        </div>
                      </div>
                      <div class="col-md-6 col-lg-6 m-b-sm">
                        <nz-mention [nzSuggestions]="mentionValueList" [nzNotFoundContent]="'No data found'" [nzValueWith]="valueWith" [nzPrefix]="['$']">
                          <label class="w-full">
                            <input nz-input nzMentionTrigger autocomplete="off" class="form-control" [(ngModel)]="env.value" name="value{{i}}"
                                   placeholder="{{'common.placeholder.value' | translate}} {{i+1}}" />
                          </label>
                          <i class="pos-abt cursor" nz-icon nzType="form" nzTheme="outline" (click)="openEditor(env)" style="right: 13px;top:1px;"></i>
                          <ng-container *nzMentionSuggestion="let argu">
                            <span>{{ argu.name }}</span>
                          </ng-container>
                        </nz-mention>
                      </div>
                      <div class="col-md-1 col-lg-1 p-l-0">
                        <a><i (click)="removeEnv(i)" class="fa fa-times m-t-sm text-hover-color"></i></a>
                      </div>
                    </div>
                  </div>
                  <div class="form-group row">
                    <div class="col-sm-12">
                      <a class="text-u-l" (click)="addEnv();saveToHistory()" translate>order.button.addVariable</a>
                    </div>
                  </div>
                </div>
              </div>
            </nz-tab>
            <nz-tab [nzTitle]="'workflow.label.arguments' | translate" *ngIf="selectedNode.job.executable && selectedNode.job.executable.TYPE === 'InternalExecutable'">
              <div class="row">
                <div class="col-md-12" style="max-height: calc(100vh - 675px); overflow: auto" *ngIf="selectedNode.job.executable.arguments">
                  <div class="form-group row m-b-0 m-l-12">
                    <div class="col-md-4 col-lg-5 m-b-sm" translate>common.label.name</div>
                    <div class="col-md-8 col-lg-6 m-b-sm" translate>common.label.value</div>
                  </div>
                  <div cdkDropList (cdkDropListDropped)="drop($event, selectedNode.job.executable.arguments)">
                    <div class="form-group row m-b-0 m-l-12" *ngFor="let argu of selectedNode.job.executable.arguments; let i = index" cdkDrag>
                      <div class="pos-abt" style="margin-left: -13px;font-size: 18px;margin-top: 2px;cursor: move" cdkDragHandle>
                        <i class="fa fa-bars" aria-hidden="true"></i>
                      </div>
                      <div class="col-md-5 col-lg-5 m-b-sm " [ngClass]="{'has-error' : ((ename.dirty || ename.touched) && ename.invalid)}">
                        <label class="w-full">
                          <input nz-input identifierValidation name="name{{i}}" class="form-control" [(ngModel)]="argu.name" #ename="ngModel" (blur)="isStringValid(argu, ename.invalid)"
                                 placeholder="{{'common.placeholder.name' | translate}} {{i+1}}" [nzAutocomplete]="auto" (ngModelChange)="onChange($event)">
                        </label>
                        <nz-autocomplete #auto>
                          <nz-auto-option *ngFor="let list of filteredOptions" [nzValue]="list.name">{{list.name}}</nz-auto-option>
                        </nz-autocomplete>
                        <div *ngIf="ename.invalid && ename.errors && (ename.dirty || ename.touched)" class="text-danger help-block">
                          <div *ngIf="ename.errors.invalidIdentifier" translate>common.message.invalid</div>
                        </div>
                      </div>
                      <div class="col-md-6 col-lg-6 m-b-sm">
                        <label class="w-full">
                          <input type="text" class="form-control" [(ngModel)]="argu.value" name="value{{i}}" (keypress)="onKeyPress($event, 'argument')"
                                 placeholder="{{'common.placeholder.value' | translate}} {{i+1}}" />
                        </label>
                        <i class="pos-abt cursor" nz-icon nzType="form" nzTheme="outline" (click)="openEditor(argu)" style="right: 13px;top:1px;"></i>
                      </div>
                      <div class="col-md-1 col-lg-1 p-l-0">
                        <a><i (click)="removeArgu(i)" class="fa fa-times m-t-sm text-hover-color"></i></a>
                      </div>
                    </div>
                  </div>
                  <div class="form-group row">
                    <div class="col-sm-12">
                      <a class="text-u-l" (click)="addArgu();saveToHistory()" translate>order.button.addVariable</a>
                    </div>
                  </div>
                </div>
              </div>
            </nz-tab>
            <nz-tab [nzTitle]="'workflow.label.jobArguments' | translate" *ngIf="selectedNode.job.executable && (selectedNode.job.executable.TYPE === 'InternalExecutable')">
              <div class="row">
                <div class="col-md-12" style="max-height: calc(100vh - 675px); overflow: auto">
                  <div class="form-group row m-b-0 m-l-12">
                    <div class="col-md-4 col-lg-5 m-b-sm" translate>common.label.name</div>
                    <div class="col-md-8 col-lg-6 m-b-sm" translate>common.label.value</div>
                  </div>
                  <div cdkDropList (cdkDropListDropped)="drop($event, selectedNode.job.executable.jobArguments)">
                    <div class="form-group row m-b-0 m-l-12" *ngFor="let argument of selectedNode.job.executable.jobArguments; let i = index" cdkDrag>
                      <div class="pos-abt" style="margin-left: -13px;font-size: 18px;margin-top: 2px;cursor: move" cdkDragHandle>
                        <i class="fa fa-bars" aria-hidden="true"></i>
                      </div>
                      <div class="col-md-5 col-lg-5 m-b-sm" [ngClass]="{'has-error' : ((aname.dirty || aname.touched) && aname.invalid)}">
                        <label class="w-full">
                          <input autocomplete="off" identifierValidation type="text" class="form-control" name="name{{i}}" [appAutofocus]="i == selectedNode.job.executable.jobArguments.length -1"
                                [(ngModel)]="argument.name" #aname="ngModel" placeholder="{{'common.placeholder.name' | translate}} {{i+1}}" (blur)="isStringValid(argument, aname.invalid)">
                        </label>
                        <div *ngIf="aname.invalid && aname.errors && (aname.dirty || aname.touched)" class="text-danger help-block">
                          <div *ngIf="aname.errors.invalidIdentifier" translate>common.message.invalid</div>
                        </div>
                      </div>
                      <div class="col-md-6 col-lg-6 m-b-sm">
                        <label class="w-full">
                         <input autocomplete="off" type="text" class="form-control" name="value{{i}}" (blur)="checkString(argument, 'value')" (keypress)="onKeyPress($event, 'jobArgument')"
                                [(ngModel)]="argument.value" placeholder="{{'common.placeholder.value' | translate}} {{i+1}}">
                        </label>
                        <i class="pos-abt cursor" nz-icon nzType="form" nzTheme="outline" (click)="openEditor(argument)" style="right: 13px;top:1px;"></i>
                      </div>
                      <div class="col-md-1 col-lg-1 p-l-0">
                        <a><i (click)="removeJobArgument(i)" class="fa fa-times m-t-sm text-hover-color"></i></a>
                      </div>
                    </div>
                  </div>
                  <div class="form-group row">
                    <div class="col-sm-12" *ngIf="selectedNode.job.executable.jobArguments">
                      <a class="text-u-l" (click)="addJobArgument();saveToHistory()" translate>workflow.button.addArgument</a>
                    </div>
                  </div>
                </div>
              </div>
            </nz-tab>
          </nz-tabset>
        </div>
      </div>
    </div>
  </nz-tab>
  <nz-tab [nzTitle]="'workflow.tab.jobOptions' | translate">
    <div class="job-property-editor" *ngIf="index === 1">
      <div class="form-group row">
        <label class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.taskLimit</label>
        <div class="col-md-8 col-lg-9" [ngClass]="{'has-error' : ((taskLimit.dirty || taskLimit.touched) && taskLimit.invalid)}">
          <nz-input-number [nzMin]="0" [appAutofocus]="true" [nzStep]="1" required name="taskLimit" #taskLimit="ngModel" [(ngModel)]="selectedNode.job.taskLimit"></nz-input-number>
          <div *ngIf="taskLimit.invalid && (taskLimit.dirty || taskLimit.touched)"
               class="text-danger help-block">
            <div *ngIf="taskLimit.errors.required">
              <div translate>common.message.requiredError</div>
            </div>
          </div>
        </div>
      </div>
      <div class="form-group row">
        <label class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.timeout</label>
        <div class="col-md-8 col-lg-9" [ngClass]="{'has-error' : ((timeout.dirty || timeout.touched) && timeout.invalid)}">
          <label class="w-full">
            <input autocomplete="off" #timeout="ngModel" type="text" class="form-control" name="timeout" placeholder="{{'workflow.placeholder.duration' | translate}}"
                   validateDurtionReqex [(ngModel)]="selectedNode.job.timeout1">
          </label>
        </div>
      </div>
      <div class="form-group row">
        <label class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.graceTimeout</label>
        <div class="col-md-8 col-lg-9" [ngClass]="{'has-error' : ((graceTimeout.dirty || graceTimeout.touched) && graceTimeout.invalid)}">
          <label class="w-full">
            <input autocomplete="off" #graceTimeout="ngModel" type="text" class="form-control" name="graceTimeout" placeholder="{{'workflow.placeholder.duration' | translate}}"
                   validateDurtionReqex  [(ngModel)]="selectedNode.job.graceTimeout1">
          </label>
        </div>
      </div>
      <div class="form-group row">
        <label class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.criticality</label>
        <div class="col-md-8 col-lg-9">
          <nz-select name="criticality" nzAllowClear class="w-full" [nzPlaceHolder]="'inventory.placeholder.selectCriticality' | translate"
                     [(ngModel)]="selectedNode.job.criticality">
            <nz-option [nzValue]="'NORMAL'" [nzLabel]="'common.label.normal' | translate"></nz-option>
            <nz-option [nzValue]="'CRITICAL'" [nzLabel]="'common.label.critical' | translate"></nz-option>
          </nz-select>
        </div>
      </div>
      <div class="form-group row">
        <label class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.logLevel</label>
        <div class="col-md-8 col-lg-9">
          <nz-select name="logLevel" nzAllowClear class="w-full" [nzPlaceHolder]="'inventory.placeholder.selectLogLevel' | translate"
                     [(ngModel)]="selectedNode.job.logLevel">
            <nz-option [nzValue]="'INFO'" [nzLabel]="'log.label.info' | translate"></nz-option>
            <nz-option [nzValue]="'DEBUG'" [nzLabel]="'log.label.debug' | translate"></nz-option>
            <nz-option [nzValue]="'TRACE'" [nzLabel]="'log.label.trace' | translate"></nz-option>
          </nz-select>
        </div>
      </div>
      <div class="form-group row">
        <label class="col-md-4 col-lg-3 block-ellipsis-job" [nz-tooltip]="'workflow.label.failOnOutputErr' | translate" translate>workflow.label.failOnOutputErr</label>
        <div class="col-md-8 col-lg-9">
          <label nz-checkbox [(ngModel)]="selectedNode.job.failOnErrWritten" name="failOnErrWritten"></label>
        </div>
      </div>
    </div>
  </nz-tab>
  <nz-tab [nzTitle]="'workflow.tab.nodeProperties' | translate">
    <div class="job-property-editor" *ngIf="index === 2">
      <div class="form-group row">
        <label class="col-md-12 _600">{{'workflow.label.arguments' | translate}}</label>
        <div class="col-md-12" style="max-height: calc(100vh - 312px); overflow: auto;">
          <div class="form-group row m-b-0 m-l-12">
            <div class="col-md-4 col-lg-5 m-b-sm" translate>common.label.name</div>
            <div class="col-md-8 col-lg-6 m-b-sm" translate>common.label.value</div>
          </div>
          <div cdkDropList (cdkDropListDropped)="drop($event, selectedNode.obj.defaultArguments)">
              <div class="form-group row m-b-0 m-l-12" *ngFor="let argument of selectedNode.obj.defaultArguments; let i = index" cdkDrag>
                <div class="pos-abt" style="margin-left: -13px;font-size: 18px;margin-top: 2px;cursor: move" cdkDragHandle>
                <i class="fa fa-bars" aria-hidden="true"></i>
              </div>
              <div class="col-md-5 col-lg-5 m-b-sm" [ngClass]="{'has-error' : ((aname.dirty || aname.touched) && aname.invalid)}">
                <label class="w-full">
                  <input autocomplete="off" identifierValidation type="text" class="form-control" name="name{{i}}" [appAutofocus]="i == selectedNode.obj.defaultArguments.length -1"
                        [(ngModel)]="argument.name" #aname="ngModel" placeholder="{{'common.placeholder.name' | translate}} {{i+1}}" (blur)="isStringValid(argument, aname.invalid)">
                </label>
                <div *ngIf="aname.invalid && aname.errors && (aname.dirty || aname.touched)" class="text-danger help-block">
                  <div *ngIf="aname.errors.invalidIdentifier" translate>common.message.invalid</div>
                </div>
              </div>
              <div class="col-md-6 col-lg-6 m-b-sm">
                <nz-mention [nzSuggestions]="variableList" [nzNotFoundContent]="'No data found'" [nzValueWith]="valueWith" [nzPrefix]="['$']">
                  <label class="w-full">
                    <input nz-input nzMentionTrigger autocomplete="off" class="form-control" [(ngModel)]="argument.value" name="value{{i}}" (keypress)="onKeyPress($event, 'node')"
                           placeholder="{{'common.placeholder.value' | translate}} {{i+1}}" />
                  </label>
                  <i class="pos-abt cursor" nz-icon nzType="form" nzTheme="outline" (click)="openEditor(argument)" style="right: 13px;top:1px;"></i>
                  <ng-container *nzMentionSuggestion="let argu">
                    <span>{{ argu.name }}</span>
                  </ng-container>
                </nz-mention>
              </div>
              <div class="col-md-1 col-lg-1 p-l-0">
                <a><i (click)="removeArgument(i)" class="fa fa-times m-t-sm text-hover-color"></i></a>
              </div>
            </div>
          </div>
          <div class="form-group row" >
            <div class="col-sm-12" *ngIf="selectedNode.obj.defaultArguments">
              <a class="text-u-l" (click)="addArgument();saveToHistory()" translate>workflow.button.addArgument</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nz-tab>
</nz-tabset>
