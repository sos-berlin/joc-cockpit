<nz-tabset [(nzSelectedIndex)]="index" [nzAnimated]="false" (nzSelectChange)="tabChange($event)">
  <nz-tab [nzTitle]="'workflow.tab.jobProperties' | translate">
    <div class="job-property-editor">
      <div class="form-group row">
        <label class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.name</label>
        <div class="col-md-8 col-lg-9" [ngClass]="{'has-error' : ((name.dirty || name.touched) && name.invalid)}">
          <input type="text" identifierValidation [appAutofocus]="true" autocomplete="off" required class="form-control"
                 placeholder="{{'common.placeholder.name' | translate}}" name="name" #name="ngModel" (blur)="checkJobInfo()"
                 [(ngModel)]="selectedNode.obj.jobName">
          <div *ngIf="name.invalid && name.errors && (name.dirty || name.touched)"
               class="text-danger help-block">
            <div *ngIf="name.errors.required">
              <div translate>common.message.requiredError</div>
            </div>
            <div *ngIf="name.errors.invalidIdentifier" translate>common.message.invalid</div>
          </div>
        </div>
      </div>
      <div class="form-group row" >
        <label class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.label</label>
        <div class="col-md-8 col-lg-9" [ngClass]="{'has-error' : (obj.label || errorMsg || (label.dirty || label.touched) && label.invalid)}">
          <input type="text" labelValidation required autocomplete="off" (blur)="onBlur();errorMsg=''" maxlength="30" class="form-control"
                 name="label" #label="ngModel" [(ngModel)]="selectedNode.obj.label" [appAutofocus]="!!(obj.label || errorMsg)">
          <div *ngIf="obj.label || errorMsg || label.invalid && (label.dirty || label.touched)"
               class="text-danger help-block">
            <div *ngIf="label.errors && label.errors.invalidIdentifier" translate>common.message.invalid</div>
            <div *ngIf="(label.errors && label.errors.required) || obj.label">
              <div translate>common.message.requiredError</div>
            </div>
            <div *ngIf="!label.errors && errorMsg">{{errorMsg | translate}}</div>
          </div>
        </div>
      </div>
      <div class="form-group row">
        <label class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.title</label>
        <div class="col-md-8 col-lg-9">
          <input type="text" autocomplete="off" maxlength="255" class="form-control" [(ngModel)]="selectedNode.job.title"
                 placeholder="{{'common.placeholder.title' | translate}}" name="title">
        </div>
      </div>
      <div class="form-group row">
        <label class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.agent</label>
        <div class="col-md-8 col-lg-9"
             [ngClass]="{'has-error' : (obj.agent || (agentId.dirty || agentId.touched) && agentId.invalid)}">
          <nz-select nzShowSearch name="agentId" nzPlaceHolder="{{'workflow.placeholder.selectAgentName' | translate}}"
                     [(ngModel)]="selectedNode.job.agentId" #agentId="ngModel" (ngModelChange)="onBlur();">
            <nz-option *ngFor="let agent of agents" [nzLabel]="agent" [nzValue]="agent"></nz-option>
          </nz-select>
          <div *ngIf="obj.agent || agentId.invalid && (agentId.dirty || agentId.touched)"
               class="text-danger help-block">
            <div *ngIf="(agentId.errors && agentId.errors.required) || obj.agent">
              <div translate>common.message.requiredError</div>
            </div>
          </div>
        </div>
      </div>
      <div class="form-group row">
        <label class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.jobClass</label>
        <div class="col-md-8 col-lg-9">
          <nz-tree-select
            name="jobClass"
            #treeSelectCtrl2
            nzNoAnimation
            [nzNodes]="jobClassTree"
            [nzAsyncData]="true"
            [nzHideUnMatched]="true"
            [nzDropdownStyle]="{ 'max-height': '260px' }"
            nzShowSearch
            [nzPlaceHolder]="'workflow.placeholder.enterJobClass' | translate"
            [(ngModel)]="selectedNode.job.jobClass"
            (nzExpandChange)="onExpand($event, 'JOBCLASS')"
          >
            <ng-template #nzTreeTemplate let-node>
              <div style="width: 93%" class="node-wrapper" (click)="loadData(node, 'JOBCLASS', $event);">
                <div class="node-content-wrapper" [class.node-content-wrapper-active]="node.origin.path == selectedNode.job.jobClass">
                  <i *ngIf="!node.origin.type" nz-icon [nzType]="node.isExpanded ? 'folder-open' : 'folder'" class="w-14"></i>
                  <i *ngIf="node.origin.type" class="fa fa-circle-o text-xs w-11 m-t-xs"></i>
                  {{node.origin.name}}
                </div>
              </div>
            </ng-template>
          </nz-tree-select>
        </div>
      </div>
      <div class="form-group row">
        <div class="col-md-4 col-lg-3" translate>workflow.label.returnCode</div>
        <div class="col-md-8 col-lg-9">
          <nz-radio-group [(ngModel)]="returnCodes.on">
            <label nz-radio nzValue="success" (click)="selectedNode.job.returnCodeMeaning.success = selectedNode.job.returnCodeMeaning.failure;selectedNode.job.returnCodeMeaning.failure = ''"><span translate>workflow.label.onSuccess</span></label>
            <label nz-radio nzValue="failure" (click)="selectedNode.job.returnCodeMeaning.failure = selectedNode.job.returnCodeMeaning.success;selectedNode.job.returnCodeMeaning.success = ''"><span translate>workflow.label.onFailure</span></label>
          </nz-radio-group>
        </div>
      </div>
      <div class="form-group row" *ngIf="returnCodes.on === 'success'">
        <label class="col-md-4 col-lg-3 form-control-label"></label>
        <div class="col-md-8 col-lg-9"
             [ngClass]="{'has-error' : ((success.dirty || success.touched) && success.invalid)}">
          <input autocomplete="off" type="text" class="form-control" validateNumberArrayReqex
                 placeholder="{{'workflow.placeholder.enterPositiveNumber' | translate}}"
                 name="success" #success="ngModel" [(ngModel)]="selectedNode.job.returnCodeMeaning.success">
          <div *ngIf="success.invalid && (success.dirty || success.touched)"
               class="text-danger help-block">

          </div>
        </div>
      </div>
      <div class="form-group row" *ngIf="returnCodes.on === 'failure'">
        <label class="col-md-4 col-lg-3 form-control-label"></label>
        <div class="col-md-8 col-lg-9"
             [ngClass]="{'has-error' : ((failure.dirty || failure.touched) && failure.invalid)}">
          <input autocomplete="off" type="text" class="form-control" validateNumberArrayReqex
                 placeholder="{{'workflow.placeholder.enterPositiveNumber' | translate}}"
                 #failure="ngModel" name="failure" [(ngModel)]="selectedNode.job.returnCodeMeaning.failure">
          <div *ngIf="failure.invalid && (failure.dirty || failure.touched)"
               class="text-danger help-block">
          </div>
        </div>
      </div>
      <div class="form-group row">
        <label class="col-md-4 col-lg-3" translate>workflow.label.compatibleMode</label>
        <div class="col-md-8 col-lg-9">
          <label nz-checkbox [(ngModel)]="selectedNode.job.v1Compatible" name="v1Compatible"></label>
        </div>
      </div>
      <div class="form-group row">
        <div class="col-md-12">
          <nz-tabset>
            <nz-tab [nzTitle]="'workflow.label.script' | translate" (nzClick)="reloadScript()">
              <div class="row" *ngIf="isDisplay">
                <div class="col-md-12">
                  <div class="b-a p-a-xs" [ngClass]="{'invalid': obj.script || (script.invalid && (script.dirty && script.touched))}">
                    <ngx-codemirror required #script="ngModel" [(ngModel)]="selectedNode.job.executable.script"
                                    [options]="cmOption" (focusChange)="focusChange()"
                    ></ngx-codemirror>
                  </div>
                  <div *ngIf="obj.script || (script.invalid && (script.dirty && script.touched))"
                       class="text-danger help-block">
                    <div *ngIf="(script.errors && script.errors.required) || obj.script">
                      <div translate>common.message.requiredError</div>
                    </div>
                  </div>
                </div>
              </div>
            </nz-tab>
            <nz-tab [nzTitle]="'workflow.label.arguments' | translate">
              <div class="row">
                <div class="col-md-12" style="max-height: 450px; overflow: auto">
                  <div class="form-group row m-b-0" *ngFor="let argument of selectedNode.job.defaultArguments; let i = index">
                    <div class="col-md-4 col-lg-5 m-b-sm" *ngIf="i==0" translate>common.label.name</div>
                    <div class="col-md-8 col-lg-6 m-b-sm" *ngIf="i==0" translate>common.label.value</div>
                    <div class="col-md-5 col-lg-5 m-b-sm">
                      <nz-select nzShowSearch name="name{{i}}" nzPlaceHolder="{{'common.placeholder.selectVariable' | translate}}"
                                 [(ngModel)]="argument.name" (ngModelChange)="checkVariableType(argument)">
                        <nz-option *ngFor="let list of variableList" [nzDisabled]="list.isSelected" [nzLabel]="list.name" [nzValue]="list.name"></nz-option>
                      </nz-select>
                    </div>
                    <div class="col-md-6 col-lg-6 m-b-sm" [ngSwitch]="argument.type" [ngClass]="{'has-error' : argument.isRequired && (!argument.value && argument.value !== false)}">
                      <nz-input-number *ngSwitchCase="'Number'" [nzMin]="0" [nzStep]="1" nzPlaceHolder="{{'common.placeholder.enterNumber' | translate}}" name="value{{i}}"
                                       [(ngModel)]="argument.value"></nz-input-number>
                      <nz-select *ngSwitchCase="'Boolean'"  name="value{{i}}" [(ngModel)]="argument.value">
                        <nz-option [nzValue]="" [nzLabel]="'common.placeholder.selectValue' | translate"></nz-option>
                        <nz-option [nzLabel]="'true'" [nzValue]="true"></nz-option>
                        <nz-option [nzLabel]="'false'" [nzValue]="false"></nz-option>
                      </nz-select>
                      <input autocomplete="off" type="text" *ngSwitchDefault class="form-control"
                             name="value{{i}}" (keypress)="onKeyPress($event, 'default')"
                             [(ngModel)]="argument.value" placeholder="{{'common.placeholder.value' | translate}}">
                      <!--<div *ngIf="argument.isRequired && !argument.value" class="text-danger help-block"
                           translate>common.message.requiredError</div>-->
                    </div>
                    <div class="col-md-1 col-lg-1 p-l-0">
                      <a><i (click)="removeVariable(i)" class="fa fa-times m-t-sm text-hover-color"></i></a>
                    </div>
                  </div>
                  <div class="form-group row" >
                    <div class="col-sm-12" *ngIf="selectedNode.job.defaultArguments && variableList.length > selectedNode.job.defaultArguments.length">
                      <a class="text-u-l" *ngIf="selectedNode.job.defaultArguments.length>0" (click)="addVariable()" translate>workflow.button.addAnotherArgument</a>
                      <a class="text-u-l" *ngIf="selectedNode.job.defaultArguments.length==0" (click)="addVariable()" translate>workflow.button.addArgument</a>
                    </div>
                  </div>
                </div>
              </div>
            </nz-tab>
            <nz-tab [nzTitle]="'workflow.label.environmentVariables' | translate" [nzDisabled]="selectedNode.job.v1Compatible">
              <div class="row">
                <div class="col-md-12" style="max-height: 450px; overflow: auto">
                  <div class="form-group row m-b-0" *ngFor="let env of selectedNode.job.env; let i = index">
                    <div class="col-md-4 col-lg-5 m-b-sm" *ngIf="i==0" translate>common.label.name</div>
                    <div class="col-md-8 col-lg-6 m-b-sm" *ngIf="i==0" translate>common.label.value</div>
                    <div class="col-md-5 col-lg-5 m-b-sm select-input-both-without-border">
                      <input autocomplete="off" type="text" class="form-control" name="name{{i}}"
                             [(ngModel)]="env.name" placeholder="{{'common.placeholder.name' | translate}}">
                      <nz-select nzShowSearch nzAllowClear name="select{{i}}" [(ngModel)]="env.name1" (ngModelChange)="setValue(env)"
                                 (nzOnSearch)="nzOnSearch({text :$event, data: env})" (nzBlur)="upperCase(env)">
                        <nz-option *ngFor="let list of selectedNode.job.defaultArguments" [nzLabel]="list.name" [nzValue]="list.name"></nz-option>
                      </nz-select>
                    </div>
                    <div class="col-md-6 col-lg-6 m-b-sm">
                      <input autocomplete="off" type="text" class="form-control" name="value{{i}}" (keypress)="onKeyPress($event, 'env')"
                             [(ngModel)]="env.value" placeholder="{{'common.placeholder.value' | translate}}">
                    </div>
                    <div class="col-md-1 col-lg-1 p-l-0">
                      <a><i (click)="removeEnv(i)" class="fa fa-times m-t-sm text-hover-color"></i></a>
                    </div>
                  </div>
                  <div class="form-group row">
                    <div class="col-sm-12" *ngIf="selectedNode.job.env">
                      <a class="text-u-l" *ngIf="selectedNode.job.env.length>0" (click)="addEnv()" translate>order.button.addAnotherVariable</a>
                      <a class="text-u-l" *ngIf="selectedNode.job.env.length==0" (click)="addEnv()" translate>order.button.addVariable</a>
                    </div>
                  </div>
                </div>
              </div>
            </nz-tab>
          </nz-tabset>
        </div>
      </div>
    </div>
  </nz-tab>
  <nz-tab [nzTitle]="'workflow.tab.jobOptions' | translate">
    <div class="job-property-editor">
      <div class="form-group row">
        <label class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.taskLimit</label>
        <div class="col-md-8 col-lg-9" [ngClass]="{'has-error' : ((taskLimit.dirty || taskLimit.touched) && taskLimit.invalid)}">
          <nz-input-number [nzMin]="0" id="taskLimitId" [nzStep]="1" required name="taskLimit" #taskLimit="ngModel" [(ngModel)]="selectedNode.job.taskLimit"></nz-input-number>
          <div *ngIf="taskLimit.invalid && (taskLimit.dirty || taskLimit.touched)"
               class="text-danger help-block">
            <div *ngIf="taskLimit.errors.required">
              <div translate>common.message.requiredError</div>
            </div>
          </div>
        </div>
      </div>
      <div class="form-group row">
        <label class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.timeout</label>
        <div class="col-md-8 col-lg-9" [ngClass]="{'has-error' : ((timeout.dirty || timeout.touched) && timeout.invalid)}">
          <input autocomplete="off" #timeout="ngModel" type="text" class="form-control" name="timeout" placeholder="{{'workflow.placeholder.duration' | translate}}"
                 validateDurtionReqex [(ngModel)]="selectedNode.job.timeout1">
        </div>
      </div>
      <div class="form-group row">
        <label class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.graceTimeout</label>
        <div class="col-md-8 col-lg-9" [ngClass]="{'has-error' : ((graceTimeout.dirty || graceTimeout.touched) && graceTimeout.invalid)}">
          <input autocomplete="off" #graceTimeout="ngModel" type="text" class="form-control" name="graceTimeout" placeholder="{{'workflow.placeholder.duration' | translate}}"
                 validateDurtionReqex  [(ngModel)]="selectedNode.job.graceTimeout1">
        </div>
      </div>
      <div class="form-group row">
        <label class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.criticality</label>
        <div class="col-md-8 col-lg-9">
          <nz-select name="criticality" nzAllowClear class="w-full" [nzPlaceHolder]="'inventory.placeholder.selectCriticality' | translate"
                     [(ngModel)]="selectedNode.job.criticality">
            <nz-option [nzValue]="'NORMAL'" [nzLabel]="'common.label.normal' | translate"></nz-option>
            <nz-option [nzValue]="'CRITICAL'" [nzLabel]="'common.label.critical' | translate"></nz-option>
          </nz-select>
        </div>
      </div>
      <div class="form-group row">
        <label class="col-md-4 col-lg-3 form-control-label" translate>workflow.label.logLevel</label>
        <div class="col-md-8 col-lg-9">
          <nz-select name="logLevel" nzAllowClear class="w-full" [nzPlaceHolder]="'inventory.placeholder.selectLogLevel' | translate"
                     [(ngModel)]="selectedNode.job.logLevel">
            <nz-option [nzValue]="'INFO'" [nzLabel]="'log.label.info' | translate"></nz-option>
            <nz-option [nzValue]="'DEBUG'" [nzLabel]="'log.label.debug' | translate"></nz-option>
            <nz-option [nzValue]="'TRACE'" [nzLabel]="'log.label.trace' | translate"></nz-option>
          </nz-select>
        </div>
      </div>
    </div>
  </nz-tab>
  <nz-tab [nzTitle]="'workflow.tab.nodeProperties' | translate">
    <div class="job-property-editor">
      <div class="form-group row">
        <label class="col-md-12 _600">{{'workflow.label.arguments' | translate}}</label>
        <div class="col-md-12" style="max-height: calc(100vh - 312px); overflow: auto;">
          <div class="form-group row m-b-0" *ngFor="let argument of selectedNode.obj.defaultArguments; let i = index">
            <div class="col-md-4 col-lg-5 m-b-sm" *ngIf="i==0" translate>common.label.name</div>
            <div class="col-md-8 col-lg-6 m-b-sm" *ngIf="i==0" translate>common.label.value</div>
            <div class="col-md-5 col-lg-5 m-b-sm">
              <nz-select nzShowSearch name="name{{i}}" nzPlaceHolder="{{'common.placeholder.selectVariable' | translate}}"
                         [(ngModel)]="argument.name" (ngModelChange)="checkVariableType(argument)">
                <nz-option *ngFor="let list of variableList" [nzDisabled]="list.isSelected" [nzLabel]="list.name" [nzValue]="list.name"></nz-option>
              </nz-select>
            </div>
            <div class="col-md-6 col-lg-6 m-b-sm" [ngSwitch]="argument.type" [ngClass]="{'has-error' : argument.isRequired && (!argument.value && argument.value !== false)}">
              <nz-input-number *ngSwitchCase="'Number'" [nzMin]="0" [nzStep]="1" name="value{{i}}" nzPlaceHolder="{{'common.placeholder.enterNumber' | translate}}"
                               [(ngModel)]="argument.value"></nz-input-number>
              <nz-select *ngSwitchCase="'Boolean'" name="value{{i}}" [(ngModel)]="argument.value">
                <nz-option [nzValue]="" [nzLabel]="'common.placeholder.selectValue' | translate"></nz-option>
                <nz-option [nzLabel]="'true'" [nzValue]="true"></nz-option>
                <nz-option [nzLabel]="'false'" [nzValue]="false"></nz-option>
              </nz-select>
              <input autocomplete="off" type="text" *ngSwitchDefault class="form-control"
                     name="value{{i}}" (keypress)="onKeyPress($event, 'default')"
                     [(ngModel)]="argument.value" placeholder="{{'common.placeholder.value' | translate}}">
      <!--        <div *ngIf="argument.isRequired && !argument.value" class="text-danger help-block"
                   translate>common.message.requiredError</div>-->
            </div>
            <div class="col-md-1 col-lg-1 p-l-0">
              <a><i (click)="removeArgument(i)" class="fa fa-times m-t-sm text-hover-color"></i></a>
            </div>
          </div>
          <div class="form-group row" >
            <div class="col-sm-12" *ngIf="selectedNode.obj.defaultArguments && variableList.length > selectedNode.obj.defaultArguments.length">
              <a class="text-u-l" *ngIf="selectedNode.obj.defaultArguments.length>0" (click)="addArgument()" translate>workflow.button.addAnotherArgument</a>
              <a class="text-u-l" *ngIf="selectedNode.obj.defaultArguments.length==0" (click)="addArgument()" translate>workflow.button.addArgument</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nz-tab>
</nz-tabset>
