<div class="white box-shadow sub-header">
  <div class="row">
    <div class="col-md-12">
      <div class="padding">
        <div class="text-right">
          <div class="pull-left">
            <app-breadcrumbs></app-breadcrumbs>
          </div>
          <div class="inline">
            <span class="badge" [ngClass]="validConfig ? 'badge-success':'badge-danger'"
                  *ngIf="nodes && nodes.length > 0">
              <span *ngIf="validConfig" translate>xml.label.validate</span>
              <span *ngIf="!validConfig" translate>xml.label.nonValidate</span>
            </span>
            <span class="custom-icon badge m-l-12" [ngClass]="extraInfo.released ? 'badge-success' : 'badge-danger'"
                  *ngIf="objectType === 'NOTIFICATION' && nodes && nodes.length > 0">
              <span *ngIf="extraInfo.released" translate>xml.label.released</span>
              <span *ngIf="!extraInfo.released" translate>xml.label.notReleased</span>
            </span>
            <span class="custom-icon badge m-l-12" [ngClass]="extraInfo.sync ? 'badge-success' : 'badge-danger'"
                  *ngIf="objectType === 'YADE' && nodes && nodes.length > 0 && extraInfo.isExist">
              <span *ngIf="extraInfo.sync" translate>xml.label.sync</span>
              <span *ngIf="extraInfo.sync == false" translate>xml.label.notSync</span>
              <span *ngIf="extraInfo.sync === undefined" translate>xml.label.unknownSyncState</span>
            </span>
            <span class="custom-icon badge m-l-12" [ngClass]="extraInfo.deployed ? 'badge-success' : 'badge-danger'"
                  *ngIf="objectType === 'YADE' && nodes && nodes.length > 0 && extraInfo.isExist">
              <span *ngIf="extraInfo.deployed" translate>xml.label.deployed</span>
              <span *ngIf="!extraInfo.deployed" translate>xml.label.notDeployed</span>
            </span>
            <button class="btn btn-sm btn-grey m-l-12" (click)="newFile()" *ngIf="permission.joc && ((objectType === 'NOTIFICATION' && permission.joc.notification.manage) || (objectType === 'YADE' && permission.joc.fileTransfer.manage) ||
             (objectType === 'OTHER' && permission.joc.others.manage))">
              <i class="fa fa-file m-r-xs"></i>
              <span translate>xml.button.new</span>
            </button>
            <button class="btn btn-sm btn-grey m-l-12" *ngIf="objectType === 'NOTIFICATION' && nodes && nodes.length > 0 && permission.joc && permission.joc.notification.manage" [disabled]="!extraInfo.hasReleases"
                    (click)="removeConf()">
              <i class="fa fa-trash m-r-xs"></i>
              <span translate>xml.button.remove</span>
            </button>
            <button class="btn btn-sm btn-grey m-l-12" [disabled]="extraInfo.released" *ngIf="objectType === 'NOTIFICATION' && nodes && nodes.length > 0 && permission.joc && permission.joc.notification.manage"
              (click)="deleteConf()">
              <i class="fa fa-trash-o m-r-xs"></i>
              <span translate>xml.button.deleteDraft</span>
            </button>
            <button *ngIf="objectType === 'OTHER' && nodes && nodes.length > 0 && permission.joc && permission.joc.others.manage"
              (click)="reassignSchemaFunc()" class="btn btn-sm btn-grey m-l-12">
              <i class="fa fa-recycle m-r-xs"></i>
              <span translate>xml.button.reassignSchema</span>
            </button>
            <button *ngIf="nodes && nodes.length > 0 && objectType !== 'NOTIFICATION' && permission.joc && ((objectType === 'YADE' && permission.joc.fileTransfer.manage) ||
              (objectType === 'OTHER' && permission.joc.others.manage))"
                    class="btn btn-sm btn-grey m-l-12" (click)="deleteAllConf()">
              <i class="fa fa-trash m-r-xs"></i>
              <span translate>xml.button.deleteAll</span>
            </button>
            <button class="btn btn-sm btn-grey m-l-12" (click)="importXML()" *ngIf="permission.joc && ((objectType === 'NOTIFICATION' && permission.joc.notification.manage) || (objectType === 'YADE' && permission.joc.fileTransfer.manage) ||
              (objectType === 'OTHER' && permission.joc.others.manage))">
              <i class="fa fa-upload m-r-xs"></i>
              <span translate>xml.button.import</span>
            </button>
            <button class="btn btn-sm btn-grey m-l-12" *ngIf="nodes && nodes.length > 0"
                    (click)="save()">
              <i class="fa fa-download m-r-xs"></i>
              <span translate>xml.button.export</span>
            </button>
            <button class="btn btn-sm btn-grey m-l-12" (click)="showXml()"
             *ngIf="nodes && nodes.length > 0 && permission.joc && ((objectType === 'NOTIFICATION' && permission.joc.notification.manage) || (objectType === 'YADE' && permission.joc.fileTransfer.manage) ||
                    (objectType === 'OTHER' && permission.joc.others.manage))">
              <i class="fa fa-pencil m-r-xs"></i>
              <span translate>xml.button.editXML</span>
            </button>
            <button class="btn btn-sm btn-grey m-l-12" [ngClass]="validConfig ? 'btn-badge-success' : 'btn-badge-danger'" *ngIf="nodes && nodes.length > 0"
                    (click)="validate()">
              <i class="fa fa-check m-r-xs"></i>
              <span translate>xml.button.validate</span>
            </button>
            <button class="btn btn-sm btn-grey m-l-12" [ngClass]="extraInfo.released ? 'btn-badge-success' : 'btn-badge-danger'" *ngIf="objectType === 'NOTIFICATION' && nodes && nodes.length > 0
              && permission.joc && permission.joc.notification.manage" [disabled]="extraInfo.released"
                    (click)="releaseXML()">
              <i class="fa fa-rocket m-r-xs"></i>
              <span translate>xml.button.release</span>
            </button>
            <button class="btn btn-sm btn-grey m-l-12" [ngClass]="extraInfo.isExist ? extraInfo.sync ? 'btn-badge-success' : 'btn-badge-danger' : ''" [disabled]="!extraInfo.isExist" *ngIf="objectType === 'YADE' && nodes && nodes.length > 0"
              (click)="checkXML()">
              <i class="fa fa-check m-r-xs"></i>
              <span translate>xml.button.check</span>
            </button>
            <button class="btn btn-sm btn-grey m-l-12" [ngClass]="extraInfo.isExist ? extraInfo.deployed ? 'btn-badge-success' : 'btn-badge-danger' : ''" [disabled]="!extraInfo.isExist || !validConfig" *ngIf="objectType === 'YADE' && nodes && nodes.length > 0
                && permission.joc && permission.joc.fileTransfer.manage"
              (click)="deployXML()">
              <i class="fa fa-rocket m-r-xs"></i>
              <span translate>xml.button.deploy</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="sub-link">
  <div class="row">
    <div class="col-md-12">
      <div>
        <ul class="nav navbar-nav navbar-nav-inline nav-active-border nav-active-border2 b-primary">
          <li class="nav-item" *ngIf="permission.joc && permission.joc.inventory.view">
            <a class="nav-link" [routerLink]="['/configuration/inventory']" [routerLinkActive]="['active']">
              <span class="nav-text text-dark p-b-sm"><span translate>configuration.tab.inventory</span></span>
            </a>
          </li>
          <li class="nav-item dropdown-separator" *ngIf="permission.joc && permission.joc.fileTransfer.view && permission.joc.inventory.view">
            <span class="separator"></span>
          </li>
          <li class="nav-item" *ngIf="permission.joc && permission.joc.fileTransfer.view">
            <a class="nav-link" [routerLink]="['/configuration/file_transfer']" [routerLinkActive]="['active']">
              <span class="nav-text text-dark p-b-sm"><span translate>configuration.tab.fileTransfer</span></span>
            </a>
          </li>
          <li class="nav-item dropdown-separator" *ngIf="permission.joc && permission.joc.notification.view && (permission.joc.fileTransfer.view || permission.joc.inventory.view)">
            <span class="separator"></span>
          </li>
          <li class="nav-item" *ngIf="permission.joc && permission.joc.notification.view">
            <a class="nav-link" [routerLink]="['/configuration/notification']" [routerLinkActive]="['active']">
              <span class="nav-text text-dark p-b-sm"><span translate>configuration.tab.notification</span></span>
            </a>
          </li>
          <li class="nav-item dropdown-separator" *ngIf="permission.joc && permission.joc.others.view && (permission.joc.notification.view || permission.joc.fileTransfer.view || permission.joc.inventory.view)">
            <span class="separator"></span>
          </li>
          <li class="nav-item" *ngIf="permission.joc && permission.joc.others.view">
            <a class="nav-link" [routerLink]="['/configuration/other']" [routerLinkActive]="['active']">
              <span class="nav-text text-dark p-b-sm"><span translate>configuration.tab.others</span></span>
            </a>
          </li>
        </ul>
      </div>
      <div *ngIf="!isLoading && schemaIdentifier">
        <div class="pos-abt" style="right: 13px;margin-top: 10px">
          <span translate>xml.label.assignedSchema</span>:
          <i class="cursor fa fa-download p-l-sm" (click)="downloadSchema(objectType, schemaIdentifier)"></i>
          <span class="text-hover-primary cursor _600 p-l-xs" (click)="showXSD(objectType, schemaIdentifier)">{{schemaIdentifier}}</span>
      </div>
    </div>
  </div>
  </div>
  <div class="scroll-y max-ht2" style="min-height: 100px">
    <div class="m-t-lg" *ngIf="!isLoading && !schedulerIds.selected">
      <app-empty-data [title]="'error.message.noControllerFound'"></app-empty-data>
    </div>
    <div *ngIf="objectType !== 'NOTIFICATION' && tabsArray.length>0">
      <nz-tabset [nzType]="'line'" [nzSelectedIndex]="selectedTabIndex" [nzTabBarGutter]="3" [nzAnimated]="false">
        <nz-tab [nzForceRender]="true" *ngFor="let tab of tabsArray; let index= index" [nzTitle]="titleTemplate" (nzClick)="tabChange(tab, index)">
          <ng-template #titleTemplate>
            <div id="{{tab.id}}" style="width: 100%">
              <span class="text-hover-primary" (click)="renameTab(tab);$event.stopPropagation();"
                    *ngIf="activeTab && !tab.rename && activeTab.id === tab.id">{{tab.name}}</span>
              <span *ngIf="activeTab && activeTab.id !== tab.id">{{tab.name}}</span>
              <input id="rename-field" *ngIf="tab.rename" (keypress)="renameOnEnter($event, tab)"
                     class="form-control rename-field" (blur)="renameDone(tab)" type="text" [(ngModel)]="tab.name">
              <i *ngIf="tab.rename" class="fa fa-times pos-abt" style="top: 13px;right: 12px"
                 (click)="cancelRename(tab);$event.stopPropagation();"></i>
              <i nz-icon nzType="close" (click)="deleteConf(tab);$event.stopPropagation();" *ngIf="!tab.rename" class="ant-tabs-close-x m-l-sm"></i>
            </div>
          </ng-template>
        </nz-tab>
      </nz-tabset>
    </div>
    <div class="center-block open" [ngClass]="!submitXsd ? 'show': 'hide'" *ngIf="!isLoading">
      <div *ngIf="objectType === 'OTHER' && tabsArray.length>0">
        <div class="col-md-offset-2 col-md-8 m-t-md" *ngIf="showSelectSchema">
          <h1 class="text-center"><strong translate>xml.label.assignSchema</strong></h1>
          <hr>
        </div>
        <div class="col-md-offset-2 col-md-8 m-t-md">
            <span class="form-group">
              <span>
                <nz-select nzShowSearch class="w-full" name="schema" [(ngModel)]="selectedXsd"
                           (ngModelChange)="changeXSD(selectedXsd)">
                    <nz-option *ngFor="let xsd of otherSchema;" [nzValue]="xsd"
                               [nzLabel]="xsd"></nz-option>
                </nz-select>
            </span>
            <span class="pos-abt" style="right: -16px; top: 2px;">
                <i class="cursor fa fa-upload fa-lg p-t-sm" (click)="importXSD()" aria-hidden="true"></i>
            </span>
            </span>
        </div>
        <div class="col-md-offset-2 col-md-8 m-t-md">
          <button class="btn btn-primary btn-sm" [disabled]="!selectedXsd"
                  (click)="(!reassignSchema) ? othersSubmit(null) : changeSchema(null)" translate>xml.button.assign
          </button>
          <button type="button" class="btn btn-grey btn-sm m-l-sm" *ngIf="reassignSchema"
                  (click)="cancelReassignSchema()" translate>common.button.cancel
          </button>
        </div>
      </div>
      <div class="text-center h6 text-uppercase hide show" *ngIf="extraInfo.state === 'NO_CONFIGURATION_EXIST'">
        <app-empty-data [title]="'xml.message.noConfigurationFound'"></app-empty-data>
      </div>
    </div>
    <div class="inline w-full" [ngClass]="submitXsd ? 'show': 'hide'"
         [ngStyle]="{'margin-top': objectType !== 'NOTIFICATION' ? '-3px' : '12px'}">
      <div appResizable [sideView]="sideView.xml" class="sticky leftPanel editor" id="xmlLeftSidePanel" [ngStyle]="{'width': sideView.xml ? sideView.xml.width +'px' : 'auto'}">
        <div class="pl-20 m-l-xs editor-tree">
          <div class="row" *ngIf="nodes?.length > 0">
            <div class="col-12 p-l-sm">
              <a class="text" (click)="expandAll();" [nz-tooltip]="'common.tooltip.expandAll' | translate">
                <i class="fa fa-angle-double-down fa-lg"></i>
              </a>
              <a class="text m-l-xs" (click)="collapseAll();" [nz-tooltip]="'common.tooltip.collapseAll' | translate">
                <i class="fa fa-angle-double-up fa-lg"></i>
              </a>
              <a class="text resize-cursor a-1" style="position: absolute; right: 34px;">
                <i class="fa fa-angle-double-left fa-lg" (click)="hidePanel()"></i>
              </a>
              <a class="text resize-cursor a-3" style="position: absolute; right: 22px !important;">
                <i class="fa fa-angle-double-right fa-lg" (click)="showPanel()"></i>
              </a>
            </div>
          </div>
          <perfect-scrollbar class="tree-block" #scrollbar>
            <div class="fade-in">
              <nz-tree
                #treeCtrl
                nzNoAnimation
                [nzDraggable]="true"
                nzBlockNode
                (nzOnDragEnter)="dragEnter($event)"
                [nzBeforeDrop]="beforeDrop"
                (nzOnDrop)="dropData($event)"
                [nzShowExpand]="false"
                [nzData]="nodes"
                [nzExpandAll]="isExpandAll"
                [nzTreeTemplate]="nzTreeTemplate"
              ></nz-tree>
              <ng-template #nzTreeTemplate let-node>
                <div id="{{node.key}}" class="node-wrapper" [ngClass]="{'isDropable': dropCheck.status}">
                  <span
                    *ngIf="node.origin.children && node.origin.children.length > 0"
                    [class.toggle-children-wrapper-expanded]="node.isExpanded"
                    [class.toggle-children-wrapper-collapsed]="!node.isExpanded"
                    (click)="openFolder(node)" class="cursor w-14"
                    [ngClass]="{'m-l-0': node.origin.parent === '#'}" style="margin-top: -1px;">
                     <i *ngIf="!node.isExpanded && !node.origin.loading" nz-icon nzType="caret-right"
                        nzTheme="outline"></i>
                     <i *ngIf="node.isExpanded && !node.origin.loading" nz-icon nzType="caret-down"
                        nzTheme="outline"></i>
                     <i *ngIf="node.origin.loading"><nz-spin nzSimple [nzSize]="'small'"></nz-spin></i>
                  </span>
                  <span
                    *ngIf="(!node.children || node.children.length === 0) && node.origin.children && node.origin.children.length === 0"
                    class="w-14">
                    <span class="fa fa-lg p-l-xs"></span>
                  </span>
                  <button class="btn-drop more-option-h"
                          (click)="contextMenu(node, $event);">
                    <i class="fa fa-ellipsis-h"></i>
                  </button>
                  <div class="node-content-wrapper"
                       [ngClass]="{'node-content-wrapper-active': selectedNode && selectedNode.ref === node.origin.ref && selectedNode.uuid === node.origin.uuid}">
                    <ng-template #htmlContent>
                      <table style="padding: 3px;" *ngIf="node.origin && node.origin.attributes">
                        <tr *ngFor="let item of node.origin.attributes">
                          <td style="padding: 3px;"><span> {{item.name}}</span></td>
                          <td
                            style="padding: 3px;">{{(item.data && item.name !== 'password') ? item.data : passwordLabel(item.data)}}
                          </td>
                        </tr>
                      </table>
                      <table style="padding: 3px;" *ngIf="node.origin && node.origin.values">
                        <tr *ngFor="let item of node.origin.values">
                          <td style="padding: 3px;"><span> {{item.name}}</span></td>
                          <td style="padding: 3px;"
                              [innerHTML]="(item.data && ((item.name && item.name !== 'password') || (item.base && item.base !== 'password') || (item.parent && item.parent !== 'Password'))) ? (item.data | safeHtml) : passwordLabel(item.data)">
                          </td>
                        </tr>
                      </table>
                    </ng-template>
                    <span
                      (click)="selectNode(node);addContent(node.origin.values);"
                      [ngClass]="cutData && node.origin.uuid === copyItem.uuid? 'cut-row' : ''" nzTooltipPlacement="right" nzTooltipOverlayClassName="custom-tooltip"
                      [nz-tooltip]="((node.origin.attributes && node.origin.attributes.length>0) || (node.origin.values && node.origin.values.length>0)) ? (htmlContent) : ''">{{node.origin.ref}}
                      </span>
                    <span class="text-sm pl-2"
                          (click)="selectNode(node)"
                          [hidden]="!node.origin.attributes || (node.origin.attributes && node.origin.attributes.length==0)">
                        {{getFirstNotEmptyAttribute(node.origin.attributes)}}
                      </span>
                    <span class="text-sm pl-2"
                          (click)="selectNode(node);addContent(node.origin.values);"
                          *ngIf="(getFirstNotEmptyAttribute(node.origin.attributes) == '' && (node.origin.values && node.origin.values.length>0) && ((node.origin.values[0].base && node.origin.values[0].base !== 'password') || node.origin.values[0].parent !== 'Password'))">
                        {{node.origin.values[0].base === 'html' ? removeTag(node.origin.values[0]) : node.origin.values[0].data}}
                      </span>
                    <span class="text-sm pl-2"
                          (click)="selectNode(node);addContent(node.origin.values);"
                          *ngIf="(getFirstNotEmptyAttribute(node.origin.attributes) == '' && (node.origin.values && node.origin.values.length>0) && (node.origin.values[0].parent === 'Password' || node.origin.values[0].base === 'password'))">
                        {{passwordLabel(node.origin.values[0].data)}}
                      </span>
                  </div>
                  <span *ngIf="node.children && node.children.length > 0"
                        (click)="expandNode(node.origin);$event.stopPropagation()"> <i
                    class="expand-collapse fa fa-angle-double-down"></i> </span>
                  <span *ngIf="node.children && node.children.length > 0"
                        (click)="collapseNode(node.origin);$event.stopPropagation()"> <i
                    class="expand-collapse fa fa-angle-double-up"></i></span>
                </div>
              </ng-template>
            </div>
          </perfect-scrollbar>
          <div class="rg-right"><span></span></div>
        </div>
      </div>
      <div id="rightPanel" [ngStyle]="{'margin-left': sideView.xml ? (sideView.xml.width + 4) + 'px' : 'auto'}">
        <div class="row">
          <nav class="col-12" aria-label="breadcrumb" *ngIf="breadCrumbArray.length>0">
            <ol class="breadcrumb">
              <li class="breadcrumb-item" *ngFor="let crumb of breadCrumbArray; let i = index"
                  [ngClass]="i==breadCrumbArray.length-1? 'text-primary' : ''" aria-current="page"><a
                (click)="getData(crumb)">{{crumb.ref}}</a></li>
            </ol>
          </nav>
          <div *ngIf="selectedNode && selectedNode.ref" class="col-12">
            <div class="text-md m-b _600 b-b p-b-sm">{{selectedNode.ref}}
              <span class="text-dark text-sm _400" *ngIf="extraInfo.configurationDate"> -
                  <b translate>xml.label.configurationDate</b>
                  <i class="text-muted p-l-xs">{{extraInfo.configurationDate | stringToDate}}</i>
              </span>
              <span class="text-dark text-sm _400" *ngIf="extraInfo.modified"> -
                  <b translate>xml.label.modified</b>
                  <i class="text-muted p-l-xs">{{extraInfo.modified | stringToDate}}</i>
              </span>
            </div>
          </div>
          <div class="col-12">
            <div class="p-a box documents" *ngIf="selectedNode && selectedNode.ref && selectedNodeDoc && selectedNodeDoc.doc">
                <div class="text _600">
                  <span translate>xml.label.documentation</span>
                  <i id="expandIcon" class="fa fa-lg pull-left p-t-xs pointer"
                     (click)="hideDocumentation(selectedNode)"
                     [ngClass]="selectedNode.show ? 'fa-caret-up' : 'fa-caret-down'"
                     aria-hidden="true"></i>
                </div>
                <div id="doc" *ngIf="selectedNode.show">
                  <hr>
                  <div>
                    <div [innerHTML]="selectedNodeDoc.doc | safeHtml"></div>
                  </div>
                </div>
            </div>
          </div>
          <div class="col-12" id="attr">
            <div *ngIf="selectedNode">
              <div class="box p-a attr" *ngIf="selectedNode.attributes && selectedNode.attributes.length>0">
                <div *ngIf="selectedNode.attributes && selectedNode.attributes.length>0 && selectedNode.attributes[0].id"
                  class="_600 text m-b-sm" translate>xml.label.attributes
                </div>
                <div *ngFor="let node of selectedNode.attributes; let i= index" class="form-group">
                  <div class="row m-t">
                    <div class="col-md-4 col-lg-3 text-dark " [ngClass]="{'form-control-label' : !(node.values && node.values.length==0 && node.name && node.type === 'xs:boolean')}"><label
                      *ngIf="node.name && node.id">{{node.name}}
                      <sup *ngIf="node.use ==='required'" class="text-danger text-sm">*</sup>
                    </label></div>
                    <div class="col-sm-5">
                      <div *ngIf="node.name === 'job_resources'">
                        <nz-select
                          name="jobResourceNames"
                          [(ngModel)]="node.data"
                          nzShowSearch
                          [nzAllowClear]="false"
                          [nzDropdownClassName]="'group-list'"
                          nzMode="multiple"
                          (ngModelChange)="onChangeJobResource($event)"
                        >
                          <nz-option-group [nzLabel]="nzTreeTemplate" *ngFor="let item of jobResourcesTree">
                            <ng-template #nzTreeTemplate>
                              <div>
                                <i nz-icon [nzType]="'folder-open'" class="w-14 p-r-xs"></i>
                                  {{item.name}}
                              </div>
                            </ng-template>
                            <nz-option nzCustomContent *ngFor="let option of item.list" [nzValue]="option.name" [nzLabel]="option.name">
                              <div>
                                <i class="fa fa-circle-o text-xs w-11 m-t-xs"></i>
                                 {{option.name}}<span *ngIf="option.notFound" class="m-l-sm label bg-danger" translate>inventory.label.objectNotExist</span>
                              </div>
                            </nz-option>
                          </nz-option-group>
                        </nz-select>
                      </div>
                      <div *ngIf="node.name === 'name' && node.parent === 'JobResource'">
                        <nz-select
                          name="jobResourceName"
                          [(ngModel)]="node.data"
                          nzShowSearch
                          nzAllowClear
                          [nzDropdownClassName]="'group-list'"
                          (ngModelChange)="onChangeJobResource($event)"
                        >
                          <nz-option-group [nzLabel]="nzTreeTemplate" *ngFor="let item of jobResourcesTree">
                            <ng-template #nzTreeTemplate>
                              <div>
                                <i nz-icon [nzType]="'folder-open'" class="w-14 p-r-xs"></i>
                                  {{item.name}}
                              </div>
                            </ng-template>
                            <nz-option nzCustomContent *ngFor="let option of item.list" [nzValue]="option.name" [nzLabel]="option.name">
                              <div>
                                <i class="fa fa-circle-o text-xs w-11 m-t-xs"></i>
                                 {{option.name}}<span *ngIf="option.notFound" class="m-l-sm label bg-danger" translate>inventory.label.objectNotExist</span>
                              </div>
                            </nz-option>
                          </nz-option-group>
                        </nz-select>
                      </div>
                      <input class="form-control w-full" id="{{node.name}}" type="text"
                             [(ngModel)]="node.data"
                             (blur)="validateAttr(node.data, node)"
                             (focus)="hideError();previousName = node.data;"
                             (change)="submitData(node.data, node)"
                             *ngIf="node.values && node.values.length==0 && node.name && node.type === 'xs:string' && !node.refer && node.name !== 'job_resource' && node.name !== 'job_resources' && node.name !== 'time_zone'"
                             [ngClass]="error && errorName === node.name? 'invalid': ''"
                             [required]="node.use ==='required'"
                             xmlAutofocus>
                      <input class="form-control w-full" id="{{node.name}}" type="text"
                             [(ngModel)]="node.data"
                             (blur)="validateAttr(node.data, node)"
                             (focus)="hideError()"
                             (change)="submitData(node.data, node)"
                             *ngIf="node.values && node.values.length==0 && node.name && node.type === 'xs:NCName'"
                             [ngClass]="error && errorName === node.name? 'invalid': ''"
                             [required]="node.use ==='required'"
                             xmlAutofocus
                      >
                      <input id="{{node.name}}" type="text" class="form-control w-full"
                             [(ngModel)]="node.data"
                             (blur)="validateAttr(node.data, node)"
                             (change)="submitData(node.data, node)"
                             (focus)="hideError()"
                             xmlAutofocus
                             *ngIf="node.values && node.values.length==0 && node.name && node.name !== 'password' && !node.type && !node.refer"
                             [ngClass]="error && errorName === node.name? 'invalid': ''"
                             [required]="node.use ==='required'"
                      >
                      <input id="{{node.name}}"
                             [(ngModel)]="node.data"
                             (focus)="hideError()" (blur)="validateAttr(node.data, node)"
                             (change)="submitData(node.data, node)"
                             *ngIf="node.values && node.values.length==0 && (node.type=='password' || node.name=='password')"
                             [ngClass]="error && errorName === node.name? 'invalid': ''"
                             [required]="node.use ==='required'" class="form-control"
                             placeholder="{{!node.text ? 'Example input' : ''}}"
                             type="{{!node.pShow ? 'password' : 'text'}}"
                             xmlAutofocus>
                      <i class="fa password-hide-icon" [ngClass]="!node.pShow ? 'fa-eye' : 'fa-eye-slash'"
                         (click)="showPassword(node)"
                         *ngIf="node.values && node.values.length==0 && (node.type=='password' || node.name=='password')"
                         aria-hidden="true"></i>
                      <input id="{{node.name}}" type="text" class="form-control w-full"
                             [(ngModel)]="node.data"
                             (blur)="validateAttr(node.data, node);checkDupProfileId(node.data, node)"
                             (focus)="hideError()"
                             (keydown)="stopPressingSpace(node.name)"
                             (change)="submitData(node.data, node)"
                             *ngIf="node.name && node.type === 'xs:NMTOKEN' && !node.refer && node.name !== 'job_resources' &&
                             !(node.parent === 'JobResource' && (node.name === 'name' || node.name === 'variable' || node.name === 'environment_variable'))"
                             [ngClass]="error && errorName === node.name? 'invalid': ''"
                             [required]="node.use ==='required'"
                             xmlAutofocus>
                      <ng-container *ngIf="node.name && node.type === 'xs:NMTOKEN' && node.parent === 'JobResource' && node.name === 'variable'">
                        <input type="text" class="form-control w-full" identifierValidation autocomplete="off"
                              [(ngModel)]="node.data"
                              #aname="ngModel"
                              name="variable"
                              (blur)="validateAttr(node.data, node)"
                              (change)="submitData(node.data, node)"
                              [ngClass]="((error && errorName === node.name) || ((aname.dirty || aname.touched) && aname.invalid)) ? 'invalid': ''"
                              [required]="node.use ==='required'">
                        <div *ngIf="aname.invalid && aname.errors && (aname.dirty || aname.touched)"
                              class="text-danger help-block">
                          <div *ngIf="aname.errors.invalidIdentifier" translate>common.message.invalid</div>
                        </div>
                      </ng-container>
                      <ng-container  *ngIf="node.name && node.type === 'xs:NMTOKEN' && node.parent === 'JobResource' && node.name === 'environment_variable'">
                        <input type="text" class="form-control w-full" envVariableValidation autocomplete="off"
                              [(ngModel)]="node.data"
                              #envname="ngModel"
                              name="env_variable"
                              (blur)="upperCase(node);validateAttr(node.data, node)"
                              (change)="submitData(node.data, node)"
                              [ngClass]="((error && errorName === node.name) || ((envname.dirty || envname.touched) && envname.invalid)) ? 'invalid': ''"
                              [required]="node.use ==='required'">
                        <div *ngIf="envname.invalid && envname.errors && (envname.dirty || envname.touched)"
                              class="text-danger help-block">
                          <div *ngIf="envname.errors.invalidIdentifier" translate>common.message.invalid</div>
                        </div>
                      </ng-container>
                      <input id="{{node.name}}" type="url"
                             [(ngModel)]="node.data"
                             (blur)="validateAttr(node.data, node)"
                             (focus)="hideError()"
                             (change)="submitData(node.data, node)"
                             *ngIf="node.name && node.type === 'xs:anyURI' && !node.refer"
                             [ngClass]="error && errorName === node.name? 'invalid': ''"
                             [required]="node.use ==='required'" class="form-control w-full"
                             title="{{node.name}} should not contain spaces"
                             xmlAutofocus>
                      <nz-select class="w-full"
                                 [(ngModel)]="node.data"
                                 (nzBlur)="validateAttr(node.data, node)"
                                 (ngModelChange)="submitData(node.data, node)" (nzFocus)="getDataAttr(node.refer)"
                                 *ngIf="node.values && node.values.length==0 && node.name && (node.type === 'xs:NMTOKEN' || node.type === 'xs:string' || !node.type) && node.refer"
                                 [ngClass]="error && errorName === node.name? 'invalid': ''"
                                 [required]="node.use ==='required'"
                                 id="{{node.name}}">
                        <nz-option [nzValue]="key" *ngFor="let key of tempArr" [nzLabel]="key"></nz-option>
                      </nz-select>
                      <nz-select class="w-full"
                                 nzMode="multiple"
                                 [(ngModel)]="node.data1"
                                 (ngModelChange)="updateListData(node)"
                                 *ngIf="node.values && node.values.length>0 && node.type === 'xs:list'"
                                 [ngClass]="error && errorName === node.name? 'invalid': ''"
                                 [required]="node.use ==='required'"
                                 id="{{node.name}}">
                        <nz-option [nzValue]="key" *ngFor="let key of node.values"
                                   [nzLabel]="key"></nz-option>
                      </nz-select>
                      <nz-input-number class="w-full"
                                       (nzBlur)="validateAttr(node.data, node)"
                                       (nzFocus)="hideError()"
                                       (ngModelChange)="submitData(node.data, node)"
                                       [(ngModel)]="node.data"
                                       *ngIf="node.values && node.values.length==0 && node.name && node.type === 'xs:integer'"
                                       [ngClass]="error && errorName === node.name? 'invalid': ''"
                                       id="{{node.name}}" required
                                       xmlAutofocus>
                      </nz-input-number>
                      <nz-input-number class="w-full"
                                       (nzBlur)="validateAttr(node.data, node)"
                                       (nzFocus)="hideError()"
                                       [(ngModel)]="node.data"
                                       (ngModelChange)="submitData(node.data, node)"
                                       *ngIf="node.values && node.values.length==0 && node.name && node.type === 'xs:positiveInteger'"
                                       [ngClass]="error && errorName === node.name? 'invalid': ''"
                                       id="{{node.name}}" required [nzMin]="0"
                                       xmlAutofocus>
                      </nz-input-number>
                      <label class="md-check w"
                             *ngIf="node.values && node.values.length==0 && node.name && node.type === 'xs:boolean'">
                        <input type="checkbox"
                               (change)="submitData(node.data, node)"
                               [ngClass]="error && errorName === node.name? 'invalid': ''"
                               [(ngModel)]="node.data"
                               [required]="node.use ==='required'"
                               class="form-control"
                               id="{{node.name}}">
                        <i class="primary"></i>
                      </label>
                      <nz-select class="w-full"
                                 (nzBlur)="validateAttr(node.data, node)"
                                 (ngModelChange)="submitData(node.data, node)"
                                 *ngIf="node.values && node.values.length > 0 && node.type !== 'xs:list'"
                                 [ngClass]="error && errorName === node.name? 'invalid': ''"
                                 [(ngModel)]="node.data" [required]="node.use ==='required'"
                                 id="{{node.name}}">
                        <nz-option [nzValue]="key.value" *ngFor="let key of node.values"
                                   [nzLabel]="key.value"></nz-option>
                      </nz-select>
                      <div *ngIf="error && errorName === node.name" [innerText]="text" class="help-block text-danger"
                           id="{{node.name}}Alert" role="alert">
                      </div>
                      <nz-select id="{{node.name}}" class="w-full" nzShowSearch nzAllowClear [(ngModel)]="node.data"
                                 *ngIf="node.values && node.values.length==0 && node.name && node.type === 'xs:string' && node.name === 'time_zone'"
                                 (nzBlur)="validateAttr(node.data, node)"
                                 (ngModelChange)="submitData(node.data, node)"
                                 [ngClass]="error && errorName === node.name? 'invalid': ''"
                                 [required]="node.use ==='required'">
                        <nz-option *ngFor="let zone of zones" [nzValue]="zone" [nzLabel]="zone"></nz-option>
                      </nz-select>
                    </div>
                    <div class="col-sm-3 p-l-xs">
                      <span class=""
                        (click)="gotoKey(node);getIndividualData(selectedNode, undefined);expandParentNodesOfSelectedNode(selectedNode)"
                        *ngIf="node.refer"><a translate>xml.button.gotoKeyElement</a></span>
                      <span
                        (click)="gotoKeyref(node);getIndividualData(selectedNode, undefined);expandParentNodesOfSelectedNode(selectedNode)"
                        [ngClass]="{'v-align-link': !(node.text && node.text.doc && node.text.doc[0] && node.text.doc[0].innerHTML)}" *ngIf="node.refElement"
                      ><a translate>xml.button.gotoRefElement</a></span>
                      <span [ngClass]="(node.refer || node.refElement) ? 'm-l-xs' : ''"
                            *ngIf="node.text && node.text.doc && node.text.doc[0] && node.text.doc[0].innerHTML"
                            id="{{node.id}}" data-toggle="tooltip" data-placement="bottom" (mouseover)="getpos(node.id)" title="{{node.text.doc[0].innerHTML}}">
                          <i class="fa fa-info-circle m-t-sm"></i>
                      </span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="box p-a val" *ngIf="selectedNode.values && selectedNode.values.length>0">
                <div class="row">
                  <div class="col-md-12"><span translate>xml.label.value</span>
                    <sup *ngIf="!(selectedNode.values && selectedNode.values[0].use)"
                         class="text-danger text-sm">*</sup>
                  </div>
                  <div class="col-md-12 m-t-xs">
                    <input (blur)="validValue(selectedNode.values[0].data, selectedNode.ref, selectedNode.values[0])"
                           (change)="submitValue(selectedNode.values[0].data, selectedNode.ref, selectedNode.values[0])"
                           *ngIf="selectedNode && selectedNode.values && !selectedNode.values[0].values && selectedNode.values[0].base && selectedNode.values[0].base !== 'xs:boolean' && selectedNode.values[0].parent === selectedNode.ref && selectedNode.ref !== 'Message' && selectedNode.values[0].base == 'password'"
                           [ngClass]="error && errorName == selectedNode.ref ? 'invalid': ''"
                           [(ngModel)]="selectedNode.values[0].data"
                           class="form-control" id="{{selectedNode.ref}}"
                           type="{{!selectedNode.values[0].pShow ? 'password' : 'text'}}"
                           value="{{selectedNode.values[0].data? selectedNode.values[0].data:''}}"
                           xmlAutofocus>
                    <i class="fa password-hide-icon"
                       (click)="showPassword(selectedNode.values[0])"
                       [ngClass]="!selectedNode.values[0].pShow ? 'fa-eye' : 'fa-eye-slash'" aria-hidden="true"
                       *ngIf="selectedNode && selectedNode.values && !selectedNode.values[0].values && selectedNode.values[0].base && selectedNode.values[0].base !== 'xs:boolean' && selectedNode.values[0].parent === selectedNode.ref && selectedNode.ref !== 'Message' && selectedNode.values[0].base == 'password'"></i>
                    <textarea nz-input id="{{selectedNode.values[0].uuid}}"
                              [(ngModel)]="selectedNode.values[0].data"
                              (keydown)="checkForTab(selectedNode.values[0].uuid);"
                              [nzAutosize]="{ minRows: 3}"
                              (blur)="validValue(selectedNode.values[0].data, selectedNode.ref, selectedNode.values[0])"
                              (change)="submitValue(selectedNode.values[0].data, selectedNode.ref, selectedNode.values[0])"
                              *ngIf="selectedNode && selectedNode.values && !selectedNode.values[0].values && selectedNode.values[0].base  && (selectedNode.values[0].base !== 'xs:boolean' && selectedNode.values[0].base !== 'password')  && selectedNode.values[0].parent === selectedNode.ref && selectedNode.values[0].base !== 'html'"
                              [ngClass]="error && errorName == selectedNode.ref ? 'invalid': ''"
                              xmlAutofocus
                              class="form-control"
                              rows="1"></textarea>
                    <div *ngIf="selectedNode && selectedNode.values && selectedNode.values[0].base === 'html'" class="form-group"
                    [ngClass]="{'has-error': myckeditor.invalid && (myckeditor.touched || myckeditor.dirty)}">
                      <a class="btn btn-xs btn-default" style="box-shadow: none !important;" [ngClass]="{'text-primary': selectedNode.preview !== true}" (click)="selectedNode.preview = false;" translate>xml.button.sourceCode</a>
                      <a class="btn btn-xs btn-default b-l" style="box-shadow: none !important;" [ngClass]="{'text-primary': selectedNode.preview === true}" (click)="selectedNode.preview = true;" translate>xml.button.preview</a>
                      <textarea class="form-control" nz-input id="{{selectedNode.values[0].uuid}}" [hidden]="selectedNode.preview"
                                  [(ngModel)]="selectedNode.values[0].data"
                                  (keydown)="checkForTab(selectedNode.values[0].uuid);"
                                  [nzAutosize]="{ minRows: 5, maxRows:22}"
                                  #myckeditor="ngModel"
                                  required
                                  (blur)="validValue(selectedNode.values[0].data, selectedNode.ref, selectedNode.values[0])"
                                  (change)="submitValue(selectedNode.values[0].data, selectedNode.ref, selectedNode.values[0])"
                                  [ngClass]="error && errorName == selectedNode.ref ? 'invalid': ''"
                      ></textarea>
                      <div class="b-a" style="min-height: 104px;max-height: 450px;overflow: auto" *ngIf="selectedNode.preview">
                        <pre *ngIf="selectedNode.values[0].data" [innerHTML]="selectedNode.values[0].data | safeHtml"></pre>
                      </div>
                      <div *ngIf="!selectedNode.preview && myckeditor.invalid && (myckeditor.touched || myckeditor.dirty)" class="help-block" translate>
                        xml.message.requiredField
                      </div>
                    </div>
                    <nz-select [(ngModel)]="selectedNode.values[0].data"
                               (ngModelChange)="submitValue(selectedNode.values[0].data, selectedNode.ref, selectedNode.values[0])"
                               *ngIf="selectedNode && selectedNode.values && selectedNode.values[0].base === 'xs:boolean'"
                               [ngClass]="error && errorName == selectedNode.ref ? 'invalid': ''" class="w-full"
                               id="{{selectedNode.ref}}">
                      <nz-option [nzValue]="true" [nzLabel]="'True' | translate"></nz-option>
                      <nz-option [nzValue]="false" [nzLabel]="'False' | translate"></nz-option>
                    </nz-select>
                    <nz-select [(ngModel)]="selectedNode.values[0].data"
                               (ngModelChange)="submitValue(selectedNode.values[0].data, selectedNode.ref, selectedNode.values[0])"
                               *ngIf="selectedNode && selectedNode.values && selectedNode.values[0].values"
                               [ngClass]="error && errorName == selectedNode.ref ? 'invalid': ''"
                               class="w-full"
                               id="{{selectedNode.ref}}">
                      <nz-option *ngFor="let value of selectedNode.values[0].values" [nzValue]="value.value"
                                 [nzLabel]="value.value"></nz-option>
                    </nz-select>
                    <div *ngIf="error && errorName === selectedNode.ref" [innerText]="text"
                         class="help-block text-danger"
                         id="{{nodes.ref}}Alert"
                         role="alert">
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<nz-dropdown-menu #menu="nzDropdownMenu">
  <ul nz-menu *ngIf="menuNode.origin">
    <li nz-submenu [nzTitle]="'xml.button.addChild' | translate"
        [nzDisabled]="!(menuNode.origin.parent == '#' || childNode.length>0)">
      <ul *ngIf="childNode && childNode.length>0">
        <li nz-menu-item [ngClass]="getCustomCss(child,menuNode.origin)"
            *ngFor="let child of childNode; let i=index" (click)="addChild(child, menuNode.origin, true, i);addDefaultValue(child)">
          <a>
            <i class="fa fa-angle-right"></i>&nbsp;
            {{child.ref}}
          </a>
        </li>
      </ul>
    </li>
    <li nz-menu-divider>
    <li nz-menu-item  (click)="showAllChildNode(menuNode.origin)" [nzDisabled]="!(menuNode.origin.parent == '#' || childNode.length>0)">
      <a translate>xml.button.showAllChildNodes</a>
    </li>
    <li nz-menu-divider>
    <li nz-menu-item (click)="cutNode(menuNode.origin)" [nzDisabled]="cutData && menuNode.origin.uuid === copyItem.uuid" *ngIf="menuNode.origin && menuNode.origin.parent !=='#'">
      <a translate>xml.button.cut</a>
    </li>
    <li nz-menu-item (click)="copyNode(menuNode.origin)"><a translate>xml.button.copy</a></li>
    <li nz-menu-item (click)="pasteNode(menuNode.origin)" [nzDisabled]="!checkRule">
      <a translate>xml.button.paste</a>
    </li>
    <li nz-menu-divider>
    <li nz-menu-item (click)="removeNode(menuNode)" [nzDisabled]="!(menuNode.origin && menuNode.origin.parent !== '#')">
      <a translate>xml.button.remove</a>
    </li>
  </ul>
</nz-dropdown-menu>
<div class="spinner" *ngIf="isLoading">
  <div class="cssload-inner cssload-one"></div>
  <div class="cssload-inner cssload-two"></div>
  <div class="cssload-inner cssload-three"></div>
</div>
