<div class="white box-shadow sub-header">
  <div class="row">
    <div class="col-md-12">
      <div class="padding">
        <div class="text-right ">
          <div class="pull-left">
            <app-breadcrumbs></app-breadcrumbs>
          </div>
          <div class="inline" *ngIf="permission.joc && permission.joc.administration.controllers.manage">
            <ng-container *ngIf="object.mapOfCheckedId.size === 0 && object.mapOfCheckedId2.size === 0 && object.mapOfCheckedId3.size === 0 && isJOCActive">
              <div class="btn-group">
                <button (click)="loadAgents('ALL')" [ngClass]="{'btn-primary': agentsFilters.filter.state=='ALL'}"
                        class="btn btn-grey btn-sm" translate>agent.button.allAgent
                </button>
                <button (click)="loadAgents('IN_SYNC')" [ngClass]="{'btn-primary': agentsFilters.filter.state=='IN_SYNC'}"
                        class="btn btn-grey btn-sm text-capitalize" translate>IN_SYNC
                </button>
                <button (click)="loadAgents('NOT_IN_SYNC')" [ngClass]="{'btn-primary': agentsFilters.filter.state=='NOT_IN_SYNC'}"
                        class="btn btn-grey btn-sm text-capitalize" translate>NOT_IN_SYNC
                </button>
                <button (click)="loadAgents('NOT_DEPLOYED')"
                        [ngClass]="{'btn-primary': agentsFilters.filter.state=='NOT_DEPLOYED'}"
                        class="btn btn-grey btn-sm text-capitalize" translate>NOT_DEPLOYED
                </button>
                <button (click)="loadAgents('UNKNOWN')" [ngClass]="{'btn-primary': agentsFilters.filter.state=='UNKNOWN'}"
                        class="btn btn-grey btn-sm text-capitalize" translate>agent.button.unknown
                </button>
              </div>
              <button
                (click)="addController()"
                *ngIf="isJOCActive" class="btn btn-grey btn-sm m-l-12">
                <i class="fa fa-plus"></i>&nbsp;
                <span translate>controller.button.newController</span>
              </button>
            </ng-container>
            <div class="show-inline" *ngIf="(object.mapOfCheckedId.size>0 || object.mapOfCheckedId2.size > 0) && object.mapOfCheckedId3.size === 0">
              <button class="btn btn-grey btn-sm m-l-12" (click)="deployAll()" translate>inventory.button.deploy</button>
              <button class="btn btn-grey btn-sm m-l-12" (click)="revokeAll()" translate>agent.button.revoke</button>
              <button class="btn btn-grey btn-sm m-l-12" (click)="createToken(null)" translate>agent.button.createToken</button>
              <button class="btn btn-grey btn-sm m-l-12" *ngIf="object.mapOfCheckedId2.size == 0" (click)="disableAll()" translate>agent.button.disable</button>
<button class="btn btn-grey btn-sm m-l-12" *ngIf="object.mapOfCheckedId2.size == 0" (click)="enableAll()" translate>agent.button.enable</button>
              <button class="btn btn-grey btn-sm m-l-12" *ngIf="object.mapOfCheckedId2.size == 0" (click)="hideAll()" translate>agent.button.hide</button>
              <button class="btn btn-grey btn-sm m-l-12" *ngIf="object.mapOfCheckedId2.size == 0" (click)="resetAll()" translate>agent.button.reset</button>
              <button class="btn btn-grey btn-sm m-l-12" *ngIf="object.mapOfCheckedId2.size == 0" (click)="resetAll(true)" translate>agent.button.resetForced
              </button>
              <button class="btn btn-grey btn-sm m-l-12" (click)="deleteAll()" translate>common.button.delete</button>
            </div>
            <div class="show-inline" *ngIf="object.mapOfCheckedId3.size>0 && (object.mapOfCheckedId.size == 0 && object.mapOfCheckedId2.size == 0)">
              <button class="btn btn-grey btn-sm m-l-12" (click)="disableAllSubAgent()" translate>agent.button.disable</button>
              <button (click)="enableAllSubAgent()" class="btn btn-grey btn-sm m-l-12" translate>agent.button.enable
              </button>
              <button class="btn btn-grey btn-sm m-l-12" (click)="resetAllSubagent()" translate>agent.button.reset</button>
              <button class="btn btn-grey btn-sm m-l-12" (click)="resetAllSubagent(true)" translate>agent.button.resetForced</button>
              <button class="btn btn-grey btn-sm m-l-12" (click)="deleteAllSubagent()" translate>common.button.delete</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="sub-link">
  <div class="row">
    <div class="col-md-12 text-right">
      <button (click)="collapseDetails()"
              class="btn btn-sm btn-grey pull-right m-l-12" nz-tooltip="{{'common.tooltip.collapseDetails' | translate}}">
        <i class="fa fa-compress text"></i>
      </button>
      <button (click)="expandDetails()"
              class="btn btn-sm btn-grey pull-right m-l-12" nz-tooltip="{{'common.tooltip.expandDetails' | translate}}">
        <i class="fa fa-expand text"></i>
      </button>
      <div class="search-box-field pull-right">
        <label>
          <input (keyup)="searchInResult()" [(ngModel)]="agentsFilters.searchText" placeholder="{{'common.placeholder.search' | translate}}"
                 type="search">
        </label>
        <i (click)="agentsFilters.searchText = '';searchInResult()" [hidden]="!agentsFilters.searchText"
           class="fa fa-times search-close"></i>
      </div>
    </div>
  </div>
</div>
<div class="scroll-y max-ht">
  <div class="padding p-b-0">
    <div class="row m-b ">
      <div class="col-md-12">
        <div class="box p-a p-b-sm text-overflow">
          <div class="resizable" appResizable id="mainContainer">
            <div *ngFor="let controller of controllers; let id = index" class="box-body p-b-0"
                 [ngClass]="{'p-b-md': id == controllers.length-1}">
              <ng-container *ngIf="!currentSecurityLevel || currentSecurityLevel === controller.securityLevel">
                <div class="row">
                  <div class="col-sm-12">
                    <div class="btn-group dropdown pull-left m-r-sm"
                         *ngIf="permission.joc && permission.joc.administration.controllers.manage">
                      <button class="btn-drop more-option-h" nz-dropdown nzTrigger="click"
                              (nzVisibleChange)="onVisible($event)" [nzDropdownMenu]="menu" type="button">
                        <i class="fa fa-ellipsis-h"></i></button>
                      <nz-dropdown-menu #menu="nzDropdownMenu" role="menu">
                        <ul nz-menu>
                          <li *ngIf="isJOCActive" (click)="editController(controller.controllerId)" nz-menu-item>
                            <a translate>common.button.edit</a>
                          </li>
                          <li (click)="addAgent(controller)" nz-menu-item>
                            <a translate>agent.button.addAgent</a>
                          </li>
                          <li *ngIf="hasLicense" (click)="addClusterAgent(controller)" nz-menu-item>
                            <a translate>agent.button.addClusterAgent</a>
                          </li>
                          <li *ngIf="permission.joc.administration.certificates.manage"
                              (click)="createToken(controller)" nz-menu-item>
                            <a translate>agent.button.createToken</a>
                          </li>
                          <li nz-menu-divider></li>
                          <li (click)="exportAgents(controller)" nz-menu-item>
                            <a translate>agent.button.exportAgentConfiguration</a>
                          </li>
                          <li (click)="importAgents(controller)" nz-menu-item>
                            <a translate>agent.button.importAgentConfiguration</a>
                          </li>
                          <li nz-menu-divider></li>
                          <li (click)="deleteController(controller.controllerId)" nz-menu-item class="bg-hover-color">
                            <a translate>common.button.delete</a>
                          </li>
                        </ul>
                      </nz-dropdown-menu>
                    </div>
                    <h5 class="text-dark">
                      <a *ngIf="!currentSecurityLevel || currentSecurityLevel === controller.securityLevel"
                         (click)="editController(controller.controllerId)">
                        <i *ngIf="controller.compatibility" class="fa fa-check"
                           [nz-tooltip]="controller.compatibility | translate"
                           [ngClass]="controller.compatibility === 'COMPATIBLE' ? 'text-success' : controller.compatibility === 'NOT_COMPATIBLE' ? 'fa-exclamation-triangle text-danger' : 'fa-exclamation-triangle text-warn'"></i>
                        &nbsp;{{controller.controllerId}}
                      </a>
                      <span
                        *ngIf="currentSecurityLevel && currentSecurityLevel !== controller.securityLevel">{{controller.controllerId}}</span>
                      <i (click)="collapse(controller.controllerId);"
                         *ngIf="coreService.preferences.controllers.has(controller.controllerId)"
                         class="cursor fa fa-caret-up m-l-xs"></i>
                      <i (click)="expand(controller.controllerId);getAgents(controller, null)"
                         *ngIf="!coreService.preferences.controllers.has(controller.controllerId)"
                         class="cursor fa fa-caret-down m-l-xs"></i>
                      <span class="text-sm pull-right m-r-sm" *ngIf="controller.token && controller.token.validUntil">
                          <span translate>agent.label.validityDate</span>:
                        <i class="text-muted p-l-xs">{{controller.token.validUntil | stringToDate}}</i>
                        <a nz-popover nzPopoverTrigger="click"
                           [nzPopoverContent]="contentTemplate" class="primary-text-hover-color p-l-sm"><i
                          class="fa fa-key"></i></a>
                        <ng-template #contentTemplate>
                          <div>
                            <b translate>agent.label.url</b> :
                            <span>{{controller.token.URI}}</span>
                          </div>
                          <div>
                            <b translate>agent.label.token</b> :
                            <span>{{controller.token.UUID}} <i ngxClipboard [cbContent]="controller.token.UUID"
                                                               (click)="showCopyMessage()"
                                                               class="cursor primary-text-hover-color p-l-sm fa fa-copy"></i></span>
                          </div>
                          <div class="m-t-sm" *ngIf="controller.token.URI2">
                            <b translate>agent.label.url</b> :
                            <span>{{controller.token.URI2}}</span>
                          </div>
                          <div *ngIf="controller.token.URI2">
                            <b translate>agent.label.token</b> :
                            <span>{{controller.token.UUID2}} <i ngxClipboard [cbContent]="controller.token.UUID2"
                                                                (click)="showCopyMessage()"
                                                                class="cursor primary-text-hover-color p-l-sm fa fa-copy"></i></span>
                          </div>
                        </ng-template>
                      </span>
                    </h5>
                  </div>
                </div>
                <div *ngIf="coreService.preferences.controllers.has(controller.controllerId)" class="row">
                  <div class="col-md-12">
                    <div class="p-a-sm p-b-0">
                      <div class="p-b-xs" translate>
                        agent.label.agents
                        <i (click)="collapse(controller.controllerId + '$standalone$');"
                           *ngIf="coreService.preferences.controllers.has(controller.controllerId+ '$standalone$')"
                           class="cursor fa fa-caret-down m-l-xs"></i>
                        <i (click)="expand(controller.controllerId+'$standalone$');"
                           *ngIf="!coreService.preferences.controllers.has(controller.controllerId+ '$standalone$')"
                           class="cursor fa fa-caret-up m-l-xs"></i>
                      </div>
                      <nz-table
                        *ngIf="!coreService.preferences.controllers.has(controller.controllerId+ '$standalone$')"
                        #ajaxTable nzSize="small" [nzBordered]="true" [nzLoading]="controller.loading"
                        [nzData]="controller.agents | orderBy: controller.sortBy: controller.reverse"
                        [nzShowPagination]="false" [nzFrontPagination]="false">
                        <thead>
                        <tr>
                          <th *ngIf="permission.joc && permission.joc.administration.controllers.manage" class="chk"
                              [nzShowCheckbox]="true"
                              [nzDisabled]="object.mapOfCheckedId3.size > 0"
                              [(nzChecked)]="controller.checked"
                              [nzIndeterminate]="controller.indeterminate"
                              (nzCheckedChange)="checkAll($event, controller)"
                          ></th>
                          <th *ngIf="permission.joc && permission.joc.administration.controllers.manage" class="menu">
                            <span translate>common.label.action</span></th>
                          <th (click)="sort(controller, 'agentId')">
                            <a><span class="p-r-xs" translate>agent.label.agentId</span>
                              <i *ngIf="controller.sortBy == 'agentId' && !controller.reverse"
                                 class="fa fa-caret-up "></i>
                              <i *ngIf="controller.sortBy == 'agentId' && controller.reverse"
                                 class="fa fa-caret-down "></i></a>
                          </th>
                          <th (click)="sort(controller, 'agentName')">
                            <a><span class="p-r-xs" translate>agent.label.agentName</span>
                              <i *ngIf="controller.sortBy == 'agentName' && !controller.reverse"
                                 class="fa fa-caret-up "></i>
                              <i *ngIf="controller.sortBy == 'agentName' && controller.reverse"
                                 class="fa fa-caret-down "></i></a>
                          </th>
                          <th (click)="sort(controller, 'agentNameAliases')">
                            <a><span class="p-r-xs" translate>agent.label.agentNameAliases</span>
                              <i *ngIf="controller.sortBy == 'agentNameAliases' && !controller.reverse"
                                 class="fa fa-caret-up "></i>
                              <i *ngIf="controller.sortBy == 'agentNameAliases' && controller.reverse"
                                 class="fa fa-caret-down "></i></a>
                          </th>
                          <th (click)="sort(controller, 'url')">
                            <a><span class="p-r-xs" translate>agent.label.url</span>
                              <i *ngIf="controller.sortBy == 'url' && !controller.reverse"
                                 class="fa fa-caret-up "></i>
                              <i *ngIf="controller.sortBy == 'url' && controller.reverse"
                                 class="fa fa-caret-down "></i></a>
                          </th>
                          <th (click)="sort(controller, 'version')">
                            <a><span class="p-r-xs" translate>dashboard.label.version</span>
                              <i *ngIf="controller.sortBy == 'version' && !controller.reverse"
                                 class="fa fa-caret-up "></i>
                              <i *ngIf="controller.sortBy == 'version' && controller.reverse"
                                 class="fa fa-caret-down "></i></a>
                          </th>
                          <th (click)="sort(controller, 'processLimit')">
                            <a><span class="p-r-xs" translate>agent.label.processLimit</span>
                              <i *ngIf="controller.sortBy == 'processLimit' && !controller.reverse"
                                 class="fa fa-caret-up "></i>
                              <i *ngIf="controller.sortBy == 'processLimit' && controller.reverse"
                                 class="fa fa-caret-down "></i></a>
                          </th>
                          <th nzWidth="100px" (click)="sort(controller, 'syncState._text')">
                            <a><span class="p-r-xs" translate>common.label.status</span>
                              <i *ngIf="controller.sortBy == 'syncState._text' && !controller.reverse"
                                 class="fa fa-caret-up "></i>
                              <i *ngIf="controller.sortBy == 'syncState._text' && controller.reverse"
                                 class="fa fa-caret-down "></i></a>
                          </th>
                          <th nzWidth="100px" (click)="sort(controller, 'hidden')">
                            <a><span class="p-r-xs" translate>agent.label.hidden</span>
                              <i *ngIf="controller.sortBy == 'hidden' && !controller.reverse"
                                 class="fa fa-caret-up "></i>
                              <i *ngIf="controller.sortBy == 'hidden' && controller.reverse"
                                 class="fa fa-caret-down "></i></a>
                          </th>
                          <th nzWidth="100px" (click)="sort(controller, 'disabled')">
                            <a><span class="p-r-xs" translate>agent.label.disabled</span>
                              <i *ngIf="controller.sortBy == 'disabled' && !controller.reverse"
                                 class="fa fa-caret-up "></i>
                              <i *ngIf="controller.sortBy == 'disabled' && controller.reverse"
                                 class="fa fa-caret-down "></i></a>
                          </th>
                          <th nzWidth="140px" (click)="sort(controller, 'clusterWatcher')">
                            <a><span class="p-r-xs" translate>agent.label.clusterWatcher</span>
                              <i *ngIf="controller.sortBy == 'clusterWatcher' && !controller.reverse"
                                 class="fa fa-caret-up "></i>
                              <i *ngIf="controller.sortBy == 'clusterWatcher' && controller.reverse"
                                 class="fa fa-caret-down "></i></a>
                          </th>
                          <th nzWidth="150px" (click)="sort(controller, 'validityDate')">
                            <a><span class="p-r-xs" translate>agent.label.validityDate</span>
                              <i *ngIf="controller.sortBy == 'validityDate' && !controller.reverse"
                                 class="fa fa-caret-up "></i>
                              <i *ngIf="controller.sortBy == 'validityDate' && controller.reverse"
                                 class="fa fa-caret-down "></i></a>
                          </th>
                          <th nzWidth="140px" (click)="sort(controller, 'token.validUntil')">
                            <a><span class="p-r-xs" translate>agent.label.oneTimeToken</span>
                              <i *ngIf="controller.sortBy == 'token.validUntil' && !controller.reverse"
                                 class="fa fa-caret-up "></i>
                              <i *ngIf="controller.sortBy == 'token.validUntil' && controller.reverse"
                                 class="fa fa-caret-down "></i></a>
                          </th>
                        </tr>
                        </thead>
                        <tbody cdkDropList (cdkDropListDropped)="agentsReordering($event, controller.agents)">
                        <tr [ngClass]="{'disabled-row': agent.disabled}" *ngFor="let agent of ajaxTable.data"
                            class="cursor move-on-hover" cdkDrag>
                          <td class="chk" *ngIf="permission.joc && permission.joc.administration.controllers.manage"
                              [nzShowCheckbox]="true" [nzDisabled]="object.mapOfCheckedId3.size > 0" [nzChecked]="object.mapOfCheckedId.has(agent.agentId)"
                              (nzCheckedChange)="onItemChecked(controller, agent, $event)">
                            <div class="pos-abt move-icon text-16 cur-m t-1"
                                 style="left: -1px;overflow: hidden;max-width: 12px" cdkDragHandle>
                              <i class="fa fa-bars" aria-hidden="true"></i>
                            </div>
                          </td>
                          <td class="menu" *ngIf="permission.joc && permission.joc.administration.controllers.manage">
                            <div class="btn-group dropdown pull-left m-r-sm">
                              <button type="button" class="btn-drop more-option-h"
                                      [nzDisabled]="controller.checked || controller.indeterminate" nz-dropdown
                                      nzTrigger="click"
                                      [nzDropdownMenu]="option" (nzVisibleChange)="onVisible($event)"><i
                                class="fa fa-ellipsis-h"></i></button>
                              <nz-dropdown-menu #option="nzDropdownMenu" role="menu">
                                <ul nz-menu>
                                  <li (click)="editAgent(agent, controller)" nz-menu-item>
                                    <a translate>common.button.edit</a>
                                  </li>
                                  <li (click)="deployAgent(agent, controller, true)" nz-menu-item>
                                    <a translate>inventory.button.deploy</a>
                                  </li>
                                  <li nz-menu-item (click)="revoke(agent, controller, true)">
                                    <a translate>agent.button.revoke</a>
                                  </li>
                                  <li (click)="createToken(controller, agent)" nz-menu-item>
                                    <a translate>agent.button.createToken</a>
                                  </li>
                                  <li nz-menu-divider></li>
                                  <li (click)="disableEnableSubagent(agent, controller, false, true)" nz-menu-item
                                      *ngIf="!agent.disabled">
                                    <a translate>agent.button.disable</a>
                                  </li>
                                  <li (click)="disableEnableSubagent(agent, controller, true, true)" nz-menu-item
                                      *ngIf="agent.disabled">
                                    <a translate>agent.button.enable</a>
                                  </li>
                                  <li (click)="hideAgent(agent, controller)" nz-menu-item *ngIf="!agent.hidden">
                                    <a translate>agent.button.hide</a>
                                  </li>
                                  <li (click)="showAgent(agent, controller)" nz-menu-item *ngIf="agent.hidden">
                                    <a translate>agent.button.show</a>
                                  </li>
                                  <li (click)="resetAgent(agent, controller)" nz-menu-item>
                                    <a translate>agent.button.reset</a>
                                  </li>
                                  <li (click)="resetAgent(agent, controller, true)" nz-menu-item>
                                    <a translate>agent.button.resetForced</a>
                                  </li>
                                  <li nz-menu-divider></li>
                                  <li (click)="removeAgent(agent, controller)" nz-menu-item class="bg-hover-color">
                                    <a translate>common.button.delete</a>
                                  </li>
                                </ul>
                              </nz-dropdown-menu>
                            </div>
                          </td>
                          <td (click)="editAgent(agent, controller)">
                            <span [innerHtml]="agent.agentId | highlight : agentsFilters.searchText"></span>
                            <i *ngIf="agent.title"> - </i>
                            <i class="text-muted">{{agent.title}}</i>
                          </td>
                          <td (click)="editAgent(agent, controller)"><span [innerHtml]="agent.agentName | highlight : agentsFilters.searchText"></span></td>
                          <td [nzBreakWord] (click)="editAgent(agent, controller)"><span
                            [innerHtml]="agent.agentNameAliases || '-'"></span></td>
                          <td (click)="editAgent(agent, controller)"><span [innerHtml]="agent.url | highlight : agentsFilters.searchText"></span></td>
                          <td (click)="editAgent(agent, controller)">
                            <i *ngIf="agent.compatibility" class="fa fa-check"
                               [nz-tooltip]="agent.compatibility | translate"
                               [ngClass]="agent.compatibility === 'COMPATIBLE' ? 'text-success' : agent.compatibility === 'NOT_COMPATIBLE' ? 'fa-exclamation-triangle text-danger' : 'fa-exclamation-triangle text-warn'"></i>&nbsp;
                            <span [innerHtml]="agent.version"></span>
                          </td>
                          <td>{{agent.processLimit}}</td>
                          <td (click)="editAgent(agent, controller)">
                            <label class="label" *ngIf="agent.syncState"
                                   [ngClass]="coreService.getColor(agent.syncState.severity, 'bg')"
                                   [innerHtml]="agent.syncState._text | translate"></label>
                          </td>
                          <td
                            (click)="editAgent(agent, controller)">{{(agent.hidden ? 'common.label.yes' : 'common.label.no') | translate}}</td>
                          <td
                            (click)="editAgent(agent, controller)">{{(agent.disabled ? 'common.label.yes' : 'common.label.no') | translate}}</td>
                          <td
                            (click)="editAgent(agent, controller)">{{(agent.isClusterWatcher ? 'common.label.yes' : 'common.label.no') | translate}}</td>
                          <td>
                            <span *ngIf="!agent.token">-</span>
                            <span *ngIf="agent.token">{{agent.token.validUntil | stringToDate}}</span>
                          </td>
                          <td>
                            <div *ngIf="agent.token">
                              <a class="primary-text-hover-color" nz-popover nzPopoverTrigger="click"
                                 [nzPopoverContent]="contentTemplate"><i class="fa fa-key"></i></a>
                              <ng-template #contentTemplate>
                                <b translate>agent.label.token</b> :
                                <span>{{agent.token.UUID}} <i ngxClipboard [cbContent]="agent.token.UUID"
                                                              (click)="showCopyMessage()"
                                                              class="cursor primary-text-hover-color p-l-sm fa fa-copy"></i></span>
                              </ng-template>
                            </div>
                            <span *ngIf="!agent.token">-</span>
                          </td>
                        </tr>
                        </tbody>
                      </nz-table>
                      <div *ngIf="hasLicense" class="m-t p-b-xs" translate>
                        agent.label.agentGroups
                        <i (click)="collapse(controller.controllerId + '$cluster$');"
                           *ngIf="coreService.preferences.controllers.has(controller.controllerId+ '$cluster$')"
                           class="cursor fa fa-caret-down m-l-xs"></i>
                        <i (click)="expand(controller.controllerId+'$cluster$');"
                           *ngIf="!coreService.preferences.controllers.has(controller.controllerId+ '$cluster$')"
                           class="cursor fa fa-caret-up m-l-xs"></i>
                      </div>
                      <nz-table
                        *ngIf="hasLicense && !coreService.preferences.controllers.has(controller.controllerId+ '$cluster$')"
                        #agentClusterTable nzSize="small" [nzBordered]="true" [nzLoading]="controller.isLoading"
                        [nzData]="controller.agentClusters | orderBy: controller.sortBy2: controller.reverse2"
                        [nzShowPagination]="false" [nzFrontPagination]="false">
                        <thead>
                        <tr>
                          <th *ngIf="permission.joc && permission.joc.administration.controllers.manage" nzWidth="46px"
                              [nzShowCheckbox]="true"
                              [nzDisabled]="object.mapOfCheckedId3.size > 0"
                              [(nzChecked)]="controller.checked2"
                              [nzIndeterminate]="controller.indeterminate2"
                              (nzCheckedChange)="checkAll($event, controller, true)"
                          ></th>
                          <th class="menu"><span translate>common.label.action</span></th>
                          <th (click)="sort(controller, 'agentId', true)">
                            <a><span class="p-r-xs" translate>agent.label.agentId</span>
                              <i *ngIf="controller.sortBy2 == 'agentId' && !controller.reverse2"
                                 class="fa fa-caret-up "></i>
                              <i *ngIf="controller.sortBy2 == 'agentId' && controller.reverse2"
                                 class="fa fa-caret-down "></i></a>
                          </th>
                          <th nzWidth="15%" (click)="sort(controller, 'agentName', true)">
                            <a><span class="p-r-xs" translate>agent.label.agentName</span>
                              <i *ngIf="controller.sortBy2 == 'agentName' && !controller.reverse2"
                                 class="fa fa-caret-up "></i>
                              <i *ngIf="controller.sortBy2 == 'agentName' && controller.reverse2"
                                 class="fa fa-caret-down "></i></a>
                          </th>
                          <th (click)="sort(controller, 'agentNameAliases', true)">
                            <a><span class="p-r-xs" translate>agent.label.agentNameAliases</span>
                              <i *ngIf="controller.sortBy2 == 'agentNameAliases' && !controller.reverse2"
                                 class="fa fa-caret-up "></i>
                              <i *ngIf="controller.sortBy2 == 'agentNameAliases' && controller.reverse2"
                                 class="fa fa-caret-down "></i></a>
                          </th>
                          <th nzWidth="100px" (click)="sort(controller, 'syncState._text', true)">
                            <a><span class="p-r-xs" translate>common.label.status</span>
                              <i *ngIf="controller.sortBy2 == 'syncState._text' && !controller.reverse2"
                                 class="fa fa-caret-up "></i>
                              <i *ngIf="controller.sortBy2 == 'syncState._text' && controller.reverse2"
                                 class="fa fa-caret-down "></i></a>
                          </th>
                          <th (click)="sort(controller, 'version', true)">
                            <a><span class="p-r-xs" translate>dashboard.label.version</span>
                              <i *ngIf="controller.sortBy2 == 'version' && !controller.reverse2"
                                 class="fa fa-caret-up "></i>
                              <i *ngIf="controller.sortBy2 == 'version' && controller.reverse2"
                                 class="fa fa-caret-down "></i></a>
                          </th>
                          <th (click)="sort(controller, 'processLimit', true)">
                            <a><span class="p-r-xs" translate>agent.label.processLimit</span>
                              <i *ngIf="controller.sortBy2 == 'processLimit' && !controller.reverse2"
                                 class="fa fa-caret-up "></i>
                              <i *ngIf="controller.sortBy2 == 'processLimit' && controller.reverse2"
                                 class="fa fa-caret-down "></i></a>
                          </th>
                          <th nzWidth="140px" (click)="sort(controller, 'clusterWatcher', true)">
                            <a><span class="p-r-xs" translate>agent.label.clusterWatcher</span>
                              <i *ngIf="controller.sortBy2 == 'clusterWatcher' && !controller.reverse2"
                                 class="fa fa-caret-up "></i>
                              <i *ngIf="controller.sortBy2 == 'clusterWatcher' && controller.reverse2"
                                 class="fa fa-caret-down "></i></a>
                          </th>
                          <th nzWidth="150px" (click)="sort(controller, 'validityDate', true)">
                            <a><span class="p-r-xs" translate>agent.label.validityDate</span>
                              <i *ngIf="controller.sortBy2 == 'validityDate' && !controller.reverse2"
                                 class="fa fa-caret-up "></i>
                              <i *ngIf="controller.sortBy2 == 'validityDate' && controller.reverse2"
                                 class="fa fa-caret-down "></i></a>
                          </th>
                          <th nzWidth="140px" (click)="sort(controller, 'token.validUntil', true)">
                            <a><span class="p-r-xs" translate>agent.label.oneTimeToken</span>
                              <i *ngIf="controller.sortBy2 == 'token.validUntil' && !controller.reverse2"
                                 class="fa fa-caret-up "></i>
                              <i *ngIf="controller.sortBy2 == 'token.validUntil' && controller.reverse2"
                                 class="fa fa-caret-down "></i></a>
                          </th>
                        </tr>
                        </thead>
                        <tbody cdkDropList
                               (cdkDropListDropped)="clusterAgentsReordering($event, controller.agentClusters)">
                        <ng-container *ngFor="let clusterAgent of agentClusterTable.data; let i = index">
                          <tr [ngClass]="{'disabled-row': clusterAgent.disabled}" class="cursor move-on-hover" cdkDrag>
                            <td *ngIf="permission.joc && permission.joc.administration.controllers.manage"
                                [nzDisabled]="object.mapOfCheckedId3.size > 0"
                                [nzShowCheckbox]="true" [nzChecked]="object.mapOfCheckedId2.has(clusterAgent.agentId)"
                                (nzCheckedChange)="onItemChecked(controller, clusterAgent, $event, true)">
                              <div class="pos-abt move-icon text-16 cur-m t-1"
                                   style="left: -1px;overflow: hidden;max-width: 12px" cdkDragHandle>
                                <i class="fa fa-bars" aria-hidden="true"></i>
                              </div>
                            </td>
                            <td class="menu">
                              <div class="btn-group dropdown pull-left m-r-sm">
                                <button type="button" class="btn-drop more-option-h"
                                        (nzVisibleChange)="onVisible($event)"
                                        [nzDisabled]="controller.checked2 || controller.indeterminate2" nz-dropdown
                                        nzTrigger="click" [nzDropdownMenu]="option"><i class="fa fa-ellipsis-h"></i>
                                </button>
                                <nz-dropdown-menu #option="nzDropdownMenu" role="menu">
                                  <ul nz-menu>
                                    <li *ngIf="permission.joc && permission.joc.administration.controllers.manage"
                                        (click)="editAgent(clusterAgent, controller, true)" nz-menu-item>
                                      <a translate>common.button.edit</a>
                                    </li>
                                    <li *ngIf="permission.joc && permission.joc.administration.controllers.manage"
                                        (click)="addSubagent(clusterAgent, controller)" nz-menu-item>
                                      <a translate>agent.button.addSubagent</a>
                                    </li>
                                    <li (click)="navToController(controller.controllerId, clusterAgent.agentId)"
                                        nz-menu-item>
                                      <a translate>agent.button.manageCluster</a>
                                    </li>
                                    <li *ngIf="permission.joc.administration.certificates.manage"
                                        (click)="createToken(controller, clusterAgent)" nz-menu-item>
                                      <a translate>agent.button.createToken</a>
                                    </li>
                                    <li nz-menu-divider
                                        *ngIf="permission.joc && permission.joc.administration.controllers.manage"></li>
                                    <li *ngIf="permission.joc && permission.joc.administration.controllers.manage"
                                        (click)="deployAgent(clusterAgent, controller)" nz-menu-item>
                                      <a translate>inventory.button.deploy</a>
                                    </li>
                                    <li *ngIf="permission.joc && permission.joc.administration.controllers.manage"
                                        nz-menu-item (click)="revoke(clusterAgent, controller)">
                                      <a translate>agent.button.revoke</a>
                                    </li>
                                    <li nz-menu-divider
                                        *ngIf="permission.joc && permission.joc.administration.controllers.manage"></li>
                                    <li *ngIf="permission.joc && permission.joc.administration.controllers.manage"
                                        (click)="removeAgent(clusterAgent, controller, true)" nz-menu-item
                                        class="bg-hover-color">
                                      <a translate>common.button.delete</a>
                                    </li>
                                  </ul>
                                </nz-dropdown-menu>
                              </div>
                            </td>
                            <td>
                              <span class="show-in-single-line">
                                <i class="cursor fa fa-caret-down fa-lg"
                                   *ngIf="!clusterAgent.show"
                                   (click)="clusterAgent.show = true;$event.stopPropagation()"></i>
                                <i class="cursor fa fa-caret-up fa-lg"
                                   *ngIf="clusterAgent.show"
                                   (click)="clusterAgent.show = false;$event.stopPropagation()"></i>
                                <i class="cursor fa fa-list p-l-xs"
                                   [nz-tooltip]="'agent.button.manageCluster' | translate"
                                   (click)="navToController(controller.controllerId, clusterAgent.agentId)"></i>
                                <i class="cursor fa fa-plus p-l-xs"
                                   [nz-tooltip]="'agent.button.addSubagent' | translate"
                                   *ngIf="permission.joc && permission.joc.administration.controllers.manage"
                                   (click)="addSubagent(clusterAgent, controller)"></i>
                                <a class="text-dark p-l-xxs" (click)="editAgent(clusterAgent, controller, true)">
                                  <span [innerHtml]="clusterAgent.agentId | highlight : agentsFilters.searchText"></span>
                                  <i *ngIf="clusterAgent.title"> - </i>
                                  <i class="text-muted">{{clusterAgent.title}}</i>
                                </a>
                              </span>
                            </td>
                            <td (click)="editAgent(clusterAgent, controller, true)"><span
                              [innerHtml]="clusterAgent.agentName | highlight : agentsFilters.searchText"></span></td>
                            <td [nzBreakWord] (click)="editAgent(clusterAgent, controller, true)"><span
                              [innerHtml]="clusterAgent.agentNameAliases || '-'"></span></td>
                            <td (click)="editAgent(clusterAgent, controller, true)">
                              <label class="label" *ngIf="clusterAgent.syncState"
                                     [ngClass]="coreService.getColor(clusterAgent.syncState.severity, 'bg')"
                                     [innerHtml]="clusterAgent.syncState._text | translate"></label>
                            </td>
                            <td (click)="editAgent(clusterAgent, controller, true)">
                              <i *ngIf="clusterAgent.compatibility" class="fa fa-check"
                                 [nz-tooltip]="clusterAgent.compatibility | translate"
                                 [ngClass]="clusterAgent.compatibility === 'COMPATIBLE' ? 'text-success' : clusterAgent.compatibility === 'NOT_COMPATIBLE' ? 'fa-exclamation-triangle text-danger' : 'fa-exclamation-triangle text-warn'"></i>&nbsp;
                              <span [innerHtml]="clusterAgent.version"></span>
                            </td>
                            <td>{{clusterAgent.processLimit}}</td>
                            <td
                              (click)="editAgent(clusterAgent, controller, true)">{{(clusterAgent.isClusterWatcher ? 'common.label.yes' : 'common.label.no') | translate}}</td>
                            <td>
                              <span *ngIf="!clusterAgent.token">-</span>
                              <span *ngIf="clusterAgent.token">{{clusterAgent.token.validUntil | stringToDate}}</span>
                            </td>
                            <td>
                              <div *ngIf="clusterAgent.token">
                                <a class="primary-text-hover-color" nz-popover nzPopoverTrigger="click"
                                   [nzPopoverContent]="contentTemplate"><i class="fa fa-key"></i></a>
                                <ng-template #contentTemplate>
                                  <b translate>agent.label.token</b> :
                                  <span>{{clusterAgent.token.UUID}} <i ngxClipboard
                                                                       [cbContent]="clusterAgent.token.UUID"
                                                                       (click)="showCopyMessage()"
                                                                       class="cursor primary-text-hover-color p-l-sm fa fa-copy"></i></span>
                                </ng-template>
                              </div>
                              <span *ngIf="!clusterAgent.token">-</span>
                            </td>
                          </tr>
                          <tr *ngIf="clusterAgent.show">
                            <td colspan="11" style="padding: 0 !important;border-top: none!important;">
                              <nz-table class="m-a-0 inner-table" #subagentClusterTable nzSize="small"
                                        [nzBordered]="true"
                                        [nzData]="clusterAgent.subagents | orderBy: 'ordering'"
                                        [nzShowPagination]="false" [nzFrontPagination]="false">
                                <thead>
                                <tr class="order-history-template0">
                                  <th class="chk" *ngIf="permission.joc && permission.joc.administration.controllers.manage" nzWidth="46px"
                                      [nzShowCheckbox]="true"
                                      [nzDisabled]="object.mapOfCheckedId.size > 0 || object.mapOfCheckedId2.size > 0"
                                      [(nzChecked)]="clusterAgent.checked"
                                      [nzIndeterminate]="clusterAgent.indeterminate"
                                      (nzCheckedChange)="checkAllSubagent($event, clusterAgent)"
                                  ></th>
                                  <th nzWidth="56px"><span translate>common.label.action</span></th>
                                  <th><span translate>agent.label.subagentId</span></th>
                                  <th><span translate>agent.label.role</span></th>
                                  <th><span translate>agent.label.url</span></th>
                                  <th><span translate>dashboard.label.version</span></th>
                                  <th nzWidth="150px"><span translate>common.label.status</span></th>
                                  <th nzWidth="140px"><span translate>agent.label.disabled</span></th>
                                </tr>
                                </thead>
                                <tbody cdkDropList (cdkDropListDropped)="drop($event, clusterAgent)">
                                <tr class="order-history-template0 move-on-hover cursor" cdkDrag
                                    *ngFor="let sub of subagentClusterTable.data"
                                    [ngClass]="{'disabled-row': sub.disabled}">
                                  <td class="chk" *ngIf="permission.joc && permission.joc.administration.controllers.manage"
                                      [nzDisabled]="object.mapOfCheckedId.size > 0 || object.mapOfCheckedId2.size > 0"
                                      [nzShowCheckbox]="true" [nzChecked]="object.mapOfCheckedId3.has(sub.subagentId)"
                                      (nzCheckedChange)="onItemCheckedSubagent(clusterAgent, sub, $event)">
                                    <div class="pos-abt move-icon text-16 cur-m t-1" style="left: -1px;" cdkDragHandle>
                                      <i class="fa fa-bars" aria-hidden="true"></i>
                                    </div>
                                  </td>
                                  <td class="menu" *ngIf="permission.joc && permission.joc.administration.controllers.manage">
                                    <div class="btn-group dropdown pull-left m-r-sm">
                                      <button type="button" class="btn-drop more-option-h" nz-dropdown nzTrigger="click"
                                              [nzDisabled]="clusterAgent.checked || clusterAgent.indeterminate"
                                              (nzVisibleChange)="onVisible($event)" [nzDropdownMenu]="option"><i
                                        class="fa fa-ellipsis-h"></i></button>
                                      <nz-dropdown-menu #option="nzDropdownMenu" role="menu">
                                        <ul nz-menu>
                                          <li (click)="editSubagent(sub, clusterAgent, controller)" nz-menu-item>
                                            <a translate>common.button.edit</a>
                                          </li>
                                          <li nz-menu-divider></li>
                                          <li (click)="disableEnableSubagent(sub, controller, false)" nz-menu-item
                                              *ngIf="!sub.disabled">
                                            <a translate>agent.button.disable</a>
                                          </li>
                                          <li (click)="disableEnableSubagent(sub, controller, true)" nz-menu-item
                                              *ngIf="sub.disabled">
                                            <a translate>agent.button.enable</a>
                                          </li>
                                          <li (click)="resetSubagent(sub, clusterAgent, controller)" nz-menu-item>
                                            <a translate>agent.button.reset</a>
                                          </li>
                                          <li (click)="resetSubagent(sub, clusterAgent, controller, true)" nz-menu-item>
                                            <a translate>agent.button.resetForced</a>
                                          </li>
                                          <li nz-menu-divider></li>
                                          <li (click)="removeSubagent(sub, clusterAgent, controller)" nz-menu-item
                                              class="bg-hover-color">
                                            <a translate="">common.button.delete</a>
                                          </li>
                                        </ul>
                                      </nz-dropdown-menu>
                                    </div>
                                  </td>
                                  <td (click)="editSubagent(sub, clusterAgent, controller)">
                                    {{sub.subagentId}}
                                    <i *ngIf="sub.title"> - </i>
                                    <i class="text-muted">{{sub.title}}</i>
                                  </td>
                                  <td (click)="editSubagent(sub, clusterAgent, controller)">{{sub.isDirector | translate}}</td>
                                  <td (click)="editSubagent(sub, clusterAgent, controller)">{{sub.url}}</td>
                                  <td (click)="editSubagent(sub, clusterAgent, controller)">
                                    <i *ngIf="sub.compatibility" class="fa fa-check"
                                       [nz-tooltip]="sub.compatibility | translate"
                                       [ngClass]="sub.compatibility === 'COMPATIBLE' ? 'text-success' : sub.compatibility === 'NOT_COMPATIBLE' ? 'fa-exclamation-triangle text-danger' : 'fa-exclamation-triangle text-warn'"></i>&nbsp;
                                    <span [innerHtml]="sub.version"></span>
                                  </td>
                                  <td (click)="editSubagent(sub, clusterAgent, controller)">
                                    <label class="label" *ngIf="sub.syncState"
                                           [ngClass]="coreService.getColor(sub.syncState.severity, 'bg')"
                                           [innerHtml]="sub.syncState._text | translate"></label>
                                  </td>
                                  <td
                                    (click)="editSubagent(sub, clusterAgent, controller)">{{(sub.disabled ? 'common.label.yes' : 'common.label.no') | translate}}</td>
                                </tr>
                                </tbody>
                              </nz-table>
                            </td>
                          </tr>
                        </ng-container>
                        </tbody>
                      </nz-table>
            </div>
          </div>
        </div>
        <hr *ngIf="coreService.preferences.controllers.has(controller.controllerId)">
        </ng-container>
      </div>
    </div>
    <div *ngIf="controllers.length==0 && loading">
      <app-empty-data></app-empty-data>
    </div>
    <div class="m-a-lg text-center" *ngIf="!loading">
      <nz-spin nzSimple></nz-spin>
    </div>
    <div class="rg-bottom" *ngIf="controllers.length>0"><span></span></div>
  </div>
</div>
</div>
</div>
</div>
