<div class="box p-a">
  <div class="table-responsive">
    <nz-table
      #ajaxTable
      [nzBordered]="true"
      [nzData]="data | orderBy: filters.filter.sortBy: filters.filter.reverse"
      [nzLoading]="!isLoaded"
      [nzPageIndex]="filters.filter.currentPage"
      [nzPageSizeOptions]="[10, 25, 50, 100, +(preferences.maxEntryPerPage)]"
      [nzPageSize]="filters.filter.entryPerPage || preferences.entryPerPage || 25"
      [nzShowPagination]="data.length > 0"
      [nzShowSizeChanger]="true"
      [nzSize]="'small'"
    >
      <thead>
      <tr>
        <th (click)="sort('path')"><a><span class="p-r-xs" translate>common.label.name</span>
          @if (filters.filter.sortBy == 'path' && !filters.filter.reverse) {
            <i class="fa fa-caret-up "></i>
          }
          @if (filters.filter.sortBy == 'path' && filters.filter.reverse) {
            <i class="fa fa-caret-down "></i>
          }</a>
        </th>
        <th (click)="sort('controllerId')"><a><span class="p-r-xs" translate>common.label.controllerId</span>
          @if (filters.filter.sortBy == 'controllerId' && !filters.filter.reverse) {
            <i class="fa fa-caret-up "></i>
          }
          @if (filters.filter.sortBy == 'controllerId' && filters.filter.reverse) {
            <i class="fa fa-caret-down "></i>
          }</a>
        </th>
        <th (click)="sort('template')"><a><span class="p-r-xs" translate>reporting.label.template</span>
          @if (filters.filter.sortBy == 'template' && !filters.filter.reverse) {
            <i class="fa fa-caret-up "></i>
          }
          @if (filters.filter.sortBy == 'template' && filters.filter.reverse) {
            <i class="fa fa-caret-down "></i>
          }</a>
        </th>
        <th (click)="sort('state._text')"><a><span class="p-r-xs" translate>history.label.status</span>
          @if (filters.filter.sortBy == 'state._text' && !filters.filter.reverse) {
            <i class="fa fa-caret-up "></i>
          }
          @if (filters.filter.sortBy == 'state._text' && filters.filter.reverse) {
            <i class="fa fa-caret-down "></i>
          }</a>
        </th>
        <th (click)="sort('frequencies')"><a><span class="p-r-xs" translate>reporting.label.frequencies</span>
          @if (filters.filter.sortBy == 'frequencies' && !filters.filter.reverse) {
            <i class="fa fa-caret-up "></i>
          }
          @if (filters.filter.sortBy == 'frequencies' && filters.filter.reverse) {
            <i class="fa fa-caret-down "></i>
          }</a>
        </th>
        <th (click)="sort('numOfReports')"><a><span class="p-r-xs" translate>reporting.label.numOfReports</span>
          @if (filters.filter.sortBy == 'numOfReports' && !filters.filter.reverse) {
            <i class="fa fa-caret-up "></i>
          }
          @if (filters.filter.sortBy == 'numOfReports' && filters.filter.reverse) {
            <i class="fa fa-caret-down "></i>
          }</a>
        </th>
        <th (click)="sort('errorText')" nzWidth="20%" style="width: 20% !important;"><a>
          <span class="p-r-xs" translate>inventory.label.errorText</span>
          @if (filters.filter.sortBy == 'errorText' && !filters.filter.reverse) {
            <i class="fa fa-caret-up "></i>
          }
          @if (filters.filter.sortBy == 'errorText' && filters.filter.reverse) {
            <i class="fa fa-caret-down "></i>
          }</a>
        </th>
        <th (click)="sort('monthFrom')"><a><span class="p-r-xs" translate>reporting.label.monthFrom</span>
          @if (filters.filter.sortBy == 'monthFrom' && !filters.filter.reverse) {
            <i class="fa fa-caret-up "></i>
          }
          @if (filters.filter.sortBy == 'monthFrom' && filters.filter.reverse) {
            <i class="fa fa-caret-down "></i>
          }</a>
        </th>
        <th (click)="sort('monthTo')"><a><span class="p-r-xs" translate>reporting.label.monthTo</span>
          @if (filters.filter.sortBy == 'monthTo' && !filters.filter.reverse) {
            <i class="fa fa-caret-up "></i>
          }
          @if (filters.filter.sortBy == 'monthTo' && filters.filter.reverse) {
            <i class="fa fa-caret-down "></i>
          }</a>
        </th>
        <th (click)="sort('modified')"><a>
          <span class="p-r-xs" translate>inventory.label.lastModified</span>
          @if (filters.filter.sortBy == 'modified' && !filters.filter.reverse) {
            <i class="fa fa-caret-up "></i>
          }
          @if (filters.filter.sortBy == 'modified' && filters.filter.reverse) {
            <i class="fa fa-caret-down "></i>
          }</a>
        </th>

      </tr>
      </thead>
      <tbody>
        @for (item of ajaxTable.data; track item) {
          <tr>
            <td>
                <span class="w-full">
                  @if (permission.joc && permission.joc.inventory.view) {
                    <i (click)="coreService.navToInventoryTab(item.path, 'REPORT');"
                       class="cursor fa fa-pencil text-hover-primary p-r-xs"></i>
                  }
                  <span [innerHtml]="item.path | highlight : filters.searchText"></span>
                  @if (item.title) {
                    <i> - </i>
                  }
                  <i [innerHtml]="item.title" class="text-muted"></i>
                </span>
            </td>
            <td><span [innerHtml]="item.controllerId | highlight : filters.searchText"></span></td>
            <td><span [innerHtml]="getTranslatedText(item)| highlight : filters.searchText"></span></td>
            <td>
              @if (item.state) {
                <span [innerHtml]="item.state._text | translate" [ngClass]="coreService.getColor(item.state.severity,'bg')"
                      class="label"></span>
              }
            </td>
            <td>
              @for (frequency of item.frequencies; track frequency) {
                <div [innerHtml]="frequency | translate | highlight : filters.searchText"></div>
              }
            </td>
            <td><span>{{item.numOfReports}}</span></td>
            <td nzWidth="20%" style="width: 20% !important;" class="text-danger">
              <span [innerHtml]="item.errorText"></span>
            </td>
            <td><span [innerHtml]="item.monthFrom | highlight : filters.searchText"></span></td>
            <td><span [innerHtml]="item.monthTo | highlight : filters.searchText"></span></td>
            <td><span [innerHtml]="item.modified | stringToDate | highlight : filters.searchText"></span></td>
          </tr>
        }
      </tbody>
    </nz-table>
  </div>
  @if (ajaxTable.data.length >0) {
    <div class="w-half label-top"><span translate>common.label.total</span> {{data.length}}
      @if (ajaxTable.data.length >1) {
        <span translate>inventory.label.entriesFound</span>
      }
      @if (ajaxTable.data.length ==1) {
        <span translate>inventory.label.entryFound</span>
      }
    </div>
  }
</div>
