<ng-template #itemTemplate let-order>
  <ng-template #contentTemplate>
    <div class="p-l-sm">
      <span translate> order.label.state </span>:
      <span class="_600" [ngClass]="coreService.getColor(order.state.severity, 'text')"> {{order.state._text |  translate}}</span>
      <span class="_600" *ngIf="order.marked" [ngClass]="coreService.getColor(order.marked.severity, 'text')">/{{order.marked._text | translate}}</span>
    </div>
    <div class="p-l-sm" *ngIf="order.state._reason">
      <span translate> common.label.comment </span>:
      <span class="_600"> {{order.state._reason}}</span>
    </div>
    <div class="p-l-sm" *ngIf="order.question">
      <span translate> workflow.label.prompt </span>:
      <span class="_600"> {{order.question}}</span>
    </div>
    <div class="p-l-sm" *ngIf="order.obstacles && order.obstacles.length > 0">
      <div *ngFor="let obstacle of order.obstacles">
        <span translate> {{obstacle.type | translate}} </span>
        <span class="_600" *ngIf="obstacle.until">:&nbsp;{{obstacle.until | stringToDate}}</span>
      </div>
    </div>
    <div class="p-l-sm" *ngIf="order.lastOutcome">
      <span translate> order.label.lastOutcome </span>:
      <span class="_600" >{{order.lastOutcome.TYPE}}</span>
    </div>
    <div class="p-l-sm" *ngIf="!order.cyclicOrder">
      <span translate> order.label.scheduledFor </span>:
      <span class="_600" *ngIf="!order.scheduledNever">{{order.scheduledFor | stringToDate}}</span>
      <span class="_600" *ngIf="order.scheduledNever" translate>common.label.never</span>
    </div>
    <div class="p-l-sm" *ngIf="order.expectedNotices">
      <div class="_600 m-b-xxs">{{'order.label.expectedNotices' | translate}} :</div>
      <div class="p-l-sm" *ngFor="let notice of order.expectedNotices">
        {{notice.boardName}}
      </div>
    </div>

    <div class="m-a-sm m-t-0" *ngIf="order.cyclicOrder">
      <div class="_600 m-b-xs" translate>dailyPlan.label.cyclicOrder</div>
      <span class="_600 p-l-sm" translate>dailyPlan.label.begin</span>:
      {{order.cyclicOrder.firstStart | stringToDate}}
      <br>
      <span class="_600 p-l-sm" translate>dailyPlan.label.end</span>:
      {{order.cyclicOrder.lastStart | stringToDate}}
      <br>
      <span class="_600 p-l-sm" translate>order.label.orders</span>:
      {{order.cyclicOrder.count}}
    </div>
    <div class="m-a-sm m-t-0" *ngIf="order.cycleState">
      <div class="_600 m-b-xs" translate>order.cycleState.label.cycleState</div>
      <span *ngIf="order.cycleState.since">
        <span class="_600 p-l-sm" translate>order.cycleState.label.since</span>:
        {{order.cycleState.since | stringToDate}}
      </span>
      <span *ngIf="order.cycleState.next">
        <span class="_600 p-l-sm" translate>order.cycleState.label.next</span>:
        {{order.cycleState.next | stringToDate}}
      </span>
      <br>
      <span class="_600 p-l-sm" translate>order.cycleState.label.index</span>:
      {{order.cycleState.index}}
    </div>
  </ng-template>
  <div class="d-inline-block m-r">
    <app-order-action [order]="order" [schedulerId]="schedulerId" [permission]="permission" (isChanged)="changedHandler($event)"
                      [preferences]="preferences"></app-order-action>
    <span [nz-tooltip]="contentTemplate" (mouseover)="getObstacles(order)" style="position: relative;top:2px">
      <i *ngIf="!order.marked" class="fa fa-circle p-r-s" [ngClass]="coreService.getColor(order.state.severity, 'text')"></i>
      <span *ngIf="order.marked" class="half-circle half-circle-left" [ngClass]="coreService.getColor(order.state.severity, 'bg')"></span>
      <span *ngIf="order.marked" class="half-circle half-circle-right" [ngClass]="coreService.getColor(order.marked.severity, 'bg')"></span>
      <a *ngIf="order.state && (order.state._text !== 'SCHEDULED' && order.state._text !== 'PENDING')" class="text-hover-primary p-l-xs p-r-sm" (click)="showLog(order)">{{order.orderId}}</a>
      <span class="p-l-xs p-r-sm" *ngIf="!order.state || (order.state._text === 'SCHEDULED' || order.state._text === 'PENDING')">{{order.orderId}}</span>
      <i *ngIf="order.cyclicOrder" class="fa fa-repeat p-l-xs p-r-xs" aria-hidden="true"></i>
      <i class="text-sm text-muted" *ngIf="order.scheduledFor && !order.scheduledNever">{{order.scheduledFor | stringToDate}}</i>
      <i class="text-sm text-muted" *ngIf="order.scheduledNever" translate>common.label.never</i>
    </span>
  </div>
</ng-template>
<div *ngFor="let instruction of configuration.instructions">
  <ul class="m-b-0">
    <li >
      <a class="hover"
        *ngIf="instruction.TYPE === 'Fork' || instruction.TYPE === 'ForkList' || instruction.TYPE === 'If' || instruction.TYPE === 'Try' || instruction.TYPE === 'Retry' || instruction.TYPE === 'Cycle' || instruction.TYPE === 'Lock' || instruction.TYPE === 'StickySubagent' || instruction.TYPE === 'ConsumeNotices'">
        <div class="btn-group dropdown" style="margin-left: -10px" *ngIf="instruction.TYPE !== 'If' && instruction.TYPE !== 'Cycle'">
          <button class="btn-drop more-option-h" nz-dropdown nzTrigger="click" [nzDropdownMenu]="menu"
                  type="button">
            <i class="fa fa-ellipsis-h"></i>
          </button>
          <nz-dropdown-menu #menu="nzDropdownMenu" role="menu">
            <ul nz-menu>
              <li nz-menu-item *ngIf="permission.controllerDefaults && permission.controllerDefaults.orders.managePositions && (!instruction.state || (instruction.state._text !== 'STOPPED' && instruction.state._text !== 'STOPPED_AND_SKIPPED'))" (click)="stop(instruction);">
                <a>
                  <span translate>workflow.button.stop</span>
                </a>
              </li>
              <li nz-menu-item *ngIf="permission.controllerDefaults && permission.controllerDefaults.orders.managePositions && (instruction.state && (instruction.state._text === 'STOPPED' || instruction.state._text === 'STOPPED_AND_SKIPPED'))" (click)="unstop(instruction);">
                <a>
                  <span translate>workflow.button.unstop</span>
                </a>
              </li>
            </ul>
          </nz-dropdown-menu>
        </div>
        <div class="btn-group dropdown" style="margin-left: -10px" *ngIf="instruction.TYPE === 'If' || instruction.TYPE === 'Cycle'">
          <button class="btn-drop more-option-h" nz-dropdown nzTrigger="click" [nzDropdownMenu]="menu"
                  type="button">
            <i class="fa fa-ellipsis-h"></i>
          </button>
          <nz-dropdown-menu #menu="nzDropdownMenu" role="menu">
            <ul nz-menu>
              <li nz-menu-item *ngIf="permission.controllerDefaults && permission.controllerDefaults.orders.managePositions && (!instruction.state || (instruction.state._text !== 'STOPPED' && instruction.state._text !== 'STOPPED_AND_SKIPPED'))" (click)="stop(instruction);">
                <a>
                  <span translate>workflow.button.stop</span>
                </a>
              </li>
              <li nz-menu-item *ngIf="permission.controllerDefaults && permission.controllerDefaults.orders.managePositions && (instruction.state && (instruction.state._text === 'STOPPED' || instruction.state._text === 'STOPPED_AND_SKIPPED'))" (click)="unstop(instruction);">
                <a>
                  <span translate>workflow.button.unstop</span>
                </a>
              </li>
              <li nz-menu-item>
                <a (click)="showConfiguration(instruction);">
                  <span translate>common.button.showConfiguration</span>
                </a>
              </li>
            </ul>
          </nz-dropdown-menu>
        </div>
        <i (click)="collapse(instruction)" class="fa fa-plus pr-2" [ngClass]="{'fa-minus' : (instruction.show)}"></i>
        <span class="_600">
          <span *ngIf="instruction.TYPE !== 'If' && instruction.TYPE !== 'Cycle'">{{instruction.TYPE}}</span>
          <a class="cursor" (click)="showConfiguration(instruction);" *ngIf="instruction.TYPE === 'If' || instruction.TYPE === 'Cycle'">{{instruction.TYPE}}</a><span *ngIf="instruction.TYPE === 'Lock'">:</span>
         <i class="p-l-xs p-r-xs text-muted" *ngIf="instruction.label">({{instruction.label}})</i>
          <span class="text-muted" *ngIf="instruction.TYPE === 'Lock'">
            <span class="text-muted" *ngFor="let item of instruction.demands">
              <i *ngIf="permission.joc && permission.joc.inventory.view" (click)="coreService.navToInventoryTab(item.lockName, 'LOCK');$event.stopPropagation();"
                 class="cursor fa fa-pencil text-hover-primary p-l-sm p-r-xs"></i>
              <a class="text-hover-primary" [nz-tooltip]="lockItemTemplate" (click)="coreService.showLock(item.lockName);$event.stopPropagation();" >{{item.lockName}}</a>
              <ng-template #lockItemTemplate>
                <div>
                  <div class="p-l-sm">
                    <span translate> workflow.label.count </span>:
                    <span class="_600" >{{item.count}}</span>
                  </div>
                </div>
              </ng-template>
            </span>
          </span>
          <span class="text-muted" *ngIf="(instruction.TYPE === 'ConsumeNotices') && instruction.noticeBoardNames"
          [innerHTML]="coreService.getHtml(instruction.noticeBoardNames, permission) | safeHtml"></span>
        </span>
        <i class="p-l-xxs p-r-xs" *ngIf="instruction.state && instruction.state._text">-</i>
        <span *ngIf="instruction.state && instruction.state._text" class="label" [ngClass]="coreService.getColor(instruction.state.severity, 'bg')">{{instruction.state._text | translate}}</span>

        <span class="expand-collapse-btn">
          <i class="fa fa-lg fa-angle-double-down" (click)="expandNode(instruction)"></i>
          <i class="fa fa-lg fa-angle-double-up p-l-xs" (click)="collapseNode(instruction)"></i>
        </span>
        <span class="m-l" *ngIf="instruction.orders && instruction.orders.length> 0">
          <ng-template ngFor let-order [ngForOf]="instruction.orders | orderBy : 'scheduledFor': true | slice:0:3">
            <ng-container [ngTemplateOutlet]="itemTemplate" [ngTemplateOutletContext]="{ $implicit: order}"></ng-container>
          </ng-template>
          <span class="remaining-order-count" (click)="showOrders(instruction)" *ngIf="instruction.orders.length > 3">
            <i class="remaining-order-count-i" translate>workflow.label.showOther</i>
            <span class="remaining-order-count-span">{{instruction.orders.length - 3}}</span>
          </span>
        </span>
        <span class="order-count" (click)="showOrders(instruction)" *ngIf="instruction.orderCount > 0 && (!instruction.show && !expandAll)">{{instruction.orderCount}}</span>
      </a>
      <div *ngIf="instruction.TYPE === 'Job' || instruction.TYPE === 'AddOrder' || instruction.TYPE === 'Fail' || instruction.TYPE === 'Finish' || instruction.TYPE === 'ImplicitEnd'
       || instruction.TYPE === 'PostNotices' || instruction.TYPE === 'Prompt' || instruction.TYPE === 'ExpectNotices'" [ngClass]="{'m-t-xs m-l-n-40 text-primary': instruction.TYPE === 'ImplicitEnd'}">
        <div class="btn-group dropdown" style="margin-left: -10px" *ngIf="instruction.TYPE === 'Job'">
          <button class="btn-drop more-option-h" nz-dropdown nzTrigger="click" [nzDropdownMenu]="menu"
                  type="button">
            <i class="fa fa-ellipsis-h"></i>
          </button>
          <nz-dropdown-menu #menu="nzDropdownMenu" role="menu">
            <ul nz-menu>
              <li nz-menu-item *ngIf="permission.controllerDefaults && permission.controllerDefaults.orders.managePositions && (!instruction.state || (instruction.state._text !== 'SKIPPED' && instruction.state._text !== 'STOPPED_AND_SKIPPED'))" (click)="skip(instruction);">
                <a>
                  <span translate>workflow.button.skip</span>
                </a>
              </li>
              <li nz-menu-item *ngIf="permission.controllerDefaults && permission.controllerDefaults.orders.managePositions && (instruction.state && (instruction.state._text === 'SKIPPED' || instruction.state._text === 'STOPPED_AND_SKIPPED'))" (click)="unskip(instruction);">
                <a>
                  <span translate>workflow.button.unskip</span>
                </a>
              </li>
              <li nz-menu-item *ngIf="permission.controllerDefaults && permission.controllerDefaults.orders.managePositions && (!instruction.state || (instruction.state._text !== 'STOPPED' && instruction.state._text !== 'STOPPED_AND_SKIPPED'))" (click)="stop(instruction);">
                <a>
                  <span translate>workflow.button.stop</span>
                </a>
              </li>
              <li nz-menu-item *ngIf="permission.controllerDefaults && permission.controllerDefaults.orders.managePositions && (instruction.state && (instruction.state._text === 'STOPPED' || instruction.state._text === 'STOPPED_AND_SKIPPED'))" (click)="unstop(instruction);">
                <a>
                  <span translate>workflow.button.unstop</span>
                </a>
              </li>
              <li nz-menu-item (click)="showConfiguration(instruction);">
                <a>
                  <span translate>common.button.showConfiguration</span>
                </a>
              </li>
              <li nz-menu-item [nzDisabled]="!instruction.documentationName" (click)="coreService.showDocumentation(instruction.documentationName, preferences)">
                <a>
                  <span translate>common.button.viewDocumentation</span>
                </a>
              </li>
            </ul>
          </nz-dropdown-menu>
        </div>
        <div class="btn-group dropdown" style="margin-left: -10px" *ngIf="instruction.TYPE !== 'Job' && instruction.TYPE !== 'ImplicitEnd'">
          <button class="btn-drop more-option-h" nz-dropdown nzTrigger="click" [nzDropdownMenu]="menu"
                  type="button">
            <i class="fa fa-ellipsis-h"></i>
          </button>
          <nz-dropdown-menu #menu="nzDropdownMenu" role="menu">
            <ul nz-menu>
              <li nz-menu-item *ngIf="permission.controllerDefaults && permission.controllerDefaults.orders.managePositions && (!instruction.state || (instruction.state._text !== 'STOPPED' && instruction.state._text !== 'STOPPED_AND_SKIPPED'))" (click)="stop(instruction);">
                <a>
                  <span translate>workflow.button.stop</span>
                </a>
              </li>
              <li nz-menu-item *ngIf="permission.controllerDefaults && permission.controllerDefaults.orders.managePositions && (instruction.state && (instruction.state._text === 'STOPPED' || instruction.state._text === 'STOPPED_AND_SKIPPED'))" (click)="unstop(instruction);">
                <a>
                  <span translate>workflow.button.unstop</span>
                </a>
              </li>
            </ul>
          </nz-dropdown-menu>
        </div>
        <i *ngIf="instruction.TYPE === 'Job' && instruction.documentationName" (click)="coreService.showDocumentation(instruction.documentationName, preferences)" class="cursor fa fa-book p-l-xs p-r-xs"></i>
        <span class="cursor" *ngIf="instruction.TYPE === 'Job'" (click)="showConfiguration(instruction)">
          {{instruction.jobName}}
        </span>
        <span (click)="openWorkflowDependency(instruction);" [ngClass]="{'cursor' : (instruction.TYPE === 'PostNotices' || instruction.TYPE === 'AddOrder')}" *ngIf="instruction.TYPE !== 'Job'" [nz-tooltip]="instruction.question || instruction.message">
          {{instruction.TYPE | translate}}
          <i class="p-l-xs p-r-xs text-muted" *ngIf="instruction.label">({{instruction.label}})</i>
          <span *ngIf="(instruction.TYPE === 'PostNotices' || instruction.TYPE === 'ExpectNotices' || instruction.TYPE === 'AddOrder')">: </span>
          <span *ngIf="instruction.TYPE === 'PostNotices' && instruction.noticeBoardNames">
            <span class="text-muted" *ngFor="let board of instruction.noticeBoardNames">
              <i *ngIf="permission.joc && permission.joc.inventory.view" (click)="coreService.navToInventoryTab(board, 'NOTICEBOARD');$event.stopPropagation();"
                   class="cursor fa fa-pencil text-hover-primary p-l-sm p-r-xs"></i>
              <a class="text-hover-primary" (click)="coreService.showBoard(board);$event.stopPropagation();" >{{board}}</a>
            </span>
          </span>
          <span class="text-muted" *ngIf="(instruction.TYPE === 'ExpectNotices') && instruction.noticeBoardNames"
                [innerHTML]="coreService.getHtml(instruction.noticeBoardNames, permission) | safeHtml"></span>
          <span class="text-muted" *ngIf="instruction.TYPE === 'AddOrder'">
            <i *ngIf="permission.joc && permission.joc.inventory.view" (click)="coreService.navToInventoryTab(instruction.workflowName, 'WORKFLOW');$event.stopPropagation();"
               class="cursor fa fa-pencil text-hover-primary p-l-sm p-r-xs"></i>
            <a class="text-hover-primary" (click)="coreService.showWorkflow(instruction.workflowName);$event.stopPropagation();" >{{instruction.workflowName}}</a>
          </span>
        </span>
        <i class="p-l-xxs p-r-xs text-muted" *ngIf="instruction.label">({{instruction.label}})</i>
        <i class="p-l-xxs p-r-xs" *ngIf="instruction.state && instruction.state._text">-</i>
        <span *ngIf="instruction.state && instruction.state._text" class="label" [ngClass]="coreService.getColor(instruction.state.severity, 'bg')">{{instruction.state._text | translate}}</span>
        <span class="m-l-md" *ngIf="instruction.orders && instruction.orders.length> 0">
         <ng-template ngFor let-order [ngForOf]="instruction.orders | orderBy : 'scheduledFor': true | slice:0:3">
            <ng-container [ngTemplateOutlet]="itemTemplate" [ngTemplateOutletContext]="{ $implicit: order}"></ng-container>
          </ng-template>
          <span class="remaining-order-count" (click)="showOrders(instruction)" *ngIf="instruction.orders.length > 3">
            <i class="remaining-order-count-i" translate>workflow.label.showOther</i>
            <span class="remaining-order-count-span">{{instruction.orders.length - 3}}</span>
          </span>
        </span>
      </div>
      <div *ngIf="instruction.TYPE === 'ForkListEnd'" class="m-l-n-40">
        <span>
          <span class="_600" *ngIf="instruction.TYPE === 'ForkListEnd'">{{'workflow.label.forkListEnd' | translate}}</span>
        </span>
        <span class="m-l-md" *ngIf="instruction.orders && instruction.orders.length> 0">
         <ng-template ngFor let-order [ngForOf]="instruction.orders | orderBy : 'scheduledFor': true | slice:0:3">
            <ng-container [ngTemplateOutlet]="itemTemplate" [ngTemplateOutletContext]="{ $implicit: order}"></ng-container>
          </ng-template>
          <span class="remaining-order-count" (click)="showOrders(instruction)" *ngIf="instruction.orders.length > 3">
            <i class="remaining-order-count-i" translate>workflow.label.showOther</i>
            <span class="remaining-order-count-span">{{instruction.orders.length - 3}}</span>
          </span>
        </span>
      </div>
      <div *ngIf="instruction.TYPE === 'Fork' && (instruction.show)">
        <div *ngFor="let branch of instruction.branches">
          <div class="p-l-md">
            <a class="m-l" (click)="collapse(branch)">
              <i class="fa fa-plus pr-2" [ngClass]="{'fa-minus' : (branch.show)}"></i>
              <i class="_600">{{branch.id}}</i>
            </a>
            <span class="m-l-md" *ngIf="branch.orders && branch.orders.length> 0">
              <ng-template ngFor let-order [ngForOf]="branch.orders | orderBy : 'scheduledFor': true | slice:0:3">
                  <ng-container [ngTemplateOutlet]="itemTemplate" [ngTemplateOutletContext]="{ $implicit: order}"></ng-container>
              </ng-template>
              <span class="remaining-order-count" (click)="showOrders(branch)" *ngIf="branch.orders.length > 3">
                <i class="remaining-order-count-i" translate>workflow.label.showOther</i>
                <span class="remaining-order-count-span">{{branch.orders.length - 3}}</span>
              </span>
            </span>
            <span class="order-count" (click)="showOrders(branch)" *ngIf="branch.orderCount > 0 && (!branch.show && !expandAll)"> {{branch.orderCount}}</span>
            <div class="p-l" *ngIf="branch.instructions && (branch.show)">
              <app-type [timezone]="timezone" [workflowObj]="workflowObj" [expectedNoticeBoards]="expectedNoticeBoards" [addOrderToWorkflows]="addOrderToWorkflows" [postNoticeBoards]="postNoticeBoards" [recursiveCals]="recursiveCals" [permission]="permission" [preferences]="preferences" [schedulerId]="schedulerId"
                        [workflowFilters]="workflowFilters" [configuration]="branch" [jobs]="jobs" (isChanged)="changedHandler($event)" (isProcessing)="processingHandler($event)" [orderPreparation]="orderPreparation" [expandAll]="expandAll"></app-type>
            </div>
          </div>
        </div>
      </div>
      <div *ngIf="instruction.TYPE === 'If' && (instruction.show)">
        <div *ngIf="instruction.then && instruction.then.instructions">
          <app-type [timezone]="timezone" [workflowObj]="workflowObj" [expectedNoticeBoards]="expectedNoticeBoards" [addOrderToWorkflows]="addOrderToWorkflows" [postNoticeBoards]="postNoticeBoards" [recursiveCals]="recursiveCals" [permission]="permission" [preferences]="preferences" [schedulerId]="schedulerId"
                    [workflowFilters]="workflowFilters" [configuration]="instruction.then" [jobs]="jobs" (isChanged)="changedHandler($event)" (isProcessing)="processingHandler($event)" [orderPreparation]="orderPreparation" [expandAll]="expandAll"></app-type>
          <div class="p-l-md">
            <a class="m-l" *ngIf="instruction.else" (click)="collapse(instruction.else)">
              <i class="fa fa-plus pr-2" [ngClass]="{'fa-minus' : (instruction.else.show)}"></i>
              <span class="_600">Else</span>
            </a>
            <span class="m-l-md" *ngIf="instruction.else && instruction.else.orders && instruction.else.orders.length>0">
              <ng-template ngFor let-order [ngForOf]="instruction.else.orders | orderBy : 'scheduledFor': true | slice:0:3">
                  <ng-container [ngTemplateOutlet]="itemTemplate" [ngTemplateOutletContext]="{ $implicit: order }"></ng-container>
              </ng-template>
              <span class="remaining-order-count" (click)="showOrders(instruction.else)" *ngIf="instruction.else.orders.length > 3">
                <i class="remaining-order-count-i" translate>workflow.label.showOther</i>
                <span class="remaining-order-count-span">{{instruction.else.orders.length - 3}}</span>
              </span>
            </span>
            <span class="order-count" (click)="showOrders(instruction.else)" *ngIf="instruction.else && instruction.else.orderCount > 0 && (!instruction.else.show && !expandAll)">{{instruction.else.orderCount}}</span>
            <div class="p-l" *ngIf="instruction.else && (instruction.else.show)">
              <app-type [timezone]="timezone" [workflowObj]="workflowObj" [expectedNoticeBoards]="expectedNoticeBoards" [addOrderToWorkflows]="addOrderToWorkflows" [postNoticeBoards]="postNoticeBoards" [recursiveCals]="recursiveCals" [permission]="permission" [orderPreparation]="orderPreparation" [preferences]="preferences" [schedulerId]="schedulerId"
                        [workflowFilters]="workflowFilters" [configuration]="instruction.else" [jobs]="jobs" (isChanged)="changedHandler($event)" (isProcessing)="processingHandler($event)" [expandAll]="expandAll" *ngIf="instruction.else.instructions"></app-type>
            </div>
          </div>
        </div>
      </div>
      <div *ngIf="instruction.TYPE === 'Try' && (instruction.show)">
          <app-type [timezone]="timezone" [workflowObj]="workflowObj" [expectedNoticeBoards]="expectedNoticeBoards" [addOrderToWorkflows]="addOrderToWorkflows" [postNoticeBoards]="postNoticeBoards" [recursiveCals]="recursiveCals" [permission]="permission" [orderPreparation]="orderPreparation" [preferences]="preferences" [schedulerId]="schedulerId"
                    [workflowFilters]="workflowFilters" [configuration]="instruction" [jobs]="jobs" (isChanged)="changedHandler($event)" (isProcessing)="processingHandler($event)" [expandAll]="expandAll" *ngIf="instruction.instructions"></app-type>
          <div class="p-l-md">
            <a class="m-l" *ngIf="instruction.catch" (click)="collapse(instruction.catch)">
              <i class="fa fa-plus pr-2" [ngClass]="{'fa-minus' : (instruction.catch.show)}"></i>
              <span class="_600" translate>workflow.label.catch</span>
            </a>
            <span class="m-l-md" *ngIf="instruction.catch && instruction.catch.orders && instruction.catch.orders.length>0">
              <ng-template ngFor let-order [ngForOf]="instruction.catch.orders | orderBy  : 'scheduledFor': true | slice:0:3">
                  <ng-container [ngTemplateOutlet]="itemTemplate" [ngTemplateOutletContext]="{ $implicit: order}"></ng-container>
              </ng-template>
              <span class="remaining-order-count" (click)="showOrders(instruction.catch)" *ngIf="instruction.catch.orders.length > 3">
                <i class="remaining-order-count-i" translate>workflow.label.showOther</i>
                <span class="remaining-order-count-span">{{instruction.catch.orders.length - 3}}</span>
              </span>
            </span>
            <span class="order-count" (click)="showOrders(instruction.catch)" *ngIf="instruction.catch && instruction.catch.orderCount > 0 && (!instruction.catch.show && !expandAll)">{{instruction.catch.orderCount}}</span>
            <div class="m-l" *ngIf="instruction.catch && (instruction.catch.show)">
              <app-type [timezone]="timezone" [workflowObj]="workflowObj" [expectedNoticeBoards]="expectedNoticeBoards" [addOrderToWorkflows]="addOrderToWorkflows" [postNoticeBoards]="postNoticeBoards" [recursiveCals]="recursiveCals" [permission]="permission" [orderPreparation]="orderPreparation" [preferences]="preferences" [schedulerId]="schedulerId"
                        [workflowFilters]="workflowFilters" [configuration]="instruction.catch" [jobs]="jobs" (isChanged)="changedHandler($event)" (isProcessing)="processingHandler($event)" [expandAll]="expandAll" *ngIf="instruction.catch.instructions"></app-type>
            </div>
          </div>
      </div>
      <div *ngIf="(instruction.TYPE === 'Retry' || instruction.TYPE === 'Cycle' || instruction.TYPE === 'Lock' || instruction.TYPE === 'StickySubagent' || instruction.TYPE === 'ForkList' || instruction.TYPE === 'ConsumeNotices') && (instruction.show)">
        <div>
          <app-type [timezone]="timezone" [workflowObj]="workflowObj" [expectedNoticeBoards]="expectedNoticeBoards" [addOrderToWorkflows]="addOrderToWorkflows" [postNoticeBoards]="postNoticeBoards" [recursiveCals]="recursiveCals" [permission]="permission" [orderPreparation]="orderPreparation" [preferences]="preferences" [schedulerId]="schedulerId"
                    [workflowFilters]="workflowFilters" [configuration]="instruction" [jobs]="jobs" (isChanged)="changedHandler($event)" (isProcessing)="processingHandler($event)" [expandAll]="expandAll" *ngIf="instruction.instructions"></app-type>
        </div>
      </div>
      <div *ngIf="instruction.join">
        <span>
          <span class="_600">{{'workflow.label.join' | translate}}</span>
        </span>
        <span class="m-l-md" *ngIf="instruction.join.orders && instruction.join.orders.length> 0">
         <ng-template ngFor let-order [ngForOf]="instruction.join.orders | orderBy : 'scheduledFor': true | slice:0:3">
            <ng-container [ngTemplateOutlet]="itemTemplate" [ngTemplateOutletContext]="{ $implicit: order}"></ng-container>
          </ng-template>
          <span class="remaining-order-count" (click)="showOrders(instruction)" *ngIf="instruction.join.orders.length > 3">
            <i class="remaining-order-count-i" translate>workflow.label.showOther</i>
            <span class="remaining-order-count-span">{{instruction.join.orders.length - 3}}</span>
          </span>
        </span>
      </div>
    </li>
  </ul>
</div>
<div *ngIf="isFirst">
  <nz-drawer [nzVisible]="sideBar.isVisible" nzPlacement="right" (nzOnClose)="sideBar.isVisible = false">
    <ng-container *nzDrawerContent>
      <div class="close-btn" (click)="sideBar.isVisible = false"></div>
      <div class="p-l-sm p-r-sm">
        <app-order-list-sidebar [permission]="permission" [preferences]="preferences" [schedulerId]="schedulerId" [orders]="sideBar.orders"></app-order-list-sidebar>
      </div>
    </ng-container>
  </nz-drawer>
</div>
