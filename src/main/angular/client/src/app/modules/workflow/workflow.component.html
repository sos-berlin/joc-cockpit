@if (isProcessing) {
  <div class="operation-status-info">
    <div id='prog-bar-cont'>
      <div id="prog-bar">
        <div id="background"></div>
      </div>
    </div>
  </div>
}
<div class="white box-shadow sub-header">
  <div class="row">
    <div class="col-md-12">
      <div class="padding p-b-sm">
        <div class="text-right ">
          <div class="pull-left">
            <app-breadcrumbs></app-breadcrumbs>
          </div>
          <i (click)="helpPage('workflows')" [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'common.tooltip.help' | translate" class="help-info-common cur-point fa fa-info-circle text-20"></i>
          <div [ngClass]="{'hide': (object.mapOfCheckedId && object.mapOfCheckedId.size>0) || broadNames.size > 0}" class="inline m-b-xs">
            <div class="btn-group dropdown">
              <button (click)="openSelectbox()" [disabled]="savedFilter.selected"
                      [ngClass]="{ 'btn-primary' : workflowFilters.filter.agentNames?.length > 0}"
                      class="btn btn-grey btn-sm m-l-12 z-index">
                {{'deploymentService.label.agents' | translate}}
                <i class="caretDownIcon" nz-icon nzTheme="outline" nzType="caret-down"></i>
              </button>
              <nz-select [(ngModel)]="workflowFilters.filter.agentNames" [disabled]="savedFilter.selected"
                         [nzAllowClear]="false" [nzDropdownClassName]="'multi-select-dropdown-list'" class="multi-select-dropdown cursor"
                         id="agent-select"
                         (ngModelChange)="selectAgents($event)"
                         name="agentNames"
                         nzMode="multiple">
                @for (item of listOfAgents; track item; let i = $index) {
                  @for (group of [item]; track group) {
                    <nz-option-group [nzLabel]="groupTitle">
                      <ng-template #groupTitle>
                          <span class="_600">
                            {{ 'agent.label.' + group?.title | translate }}
                          </span>
                        @if (i == 0) {
                          <span (click)="selectAgents([])"
                                class="cursor text-primary-hover pos-rel pull-right font14 t-xs" nz-icon nzTheme="outline" nzType="close-circle"></span>
                        }
                      </ng-template>
                      @if (item.title == 'agents') {
                        @for (agent of group.children; track agent) {
                          <nz-option [nzLabel]="agent" [nzValue]="agent"></nz-option>
                        }
                      }
                      @if (item.title !== 'agents') {
                        @for (agent of group?.children; track agent) {
                          <nz-option [nzLabel]="agent.title" [nzValue]="agent.title">
                          </nz-option>
                        }
                      }
                    </nz-option-group>
                  }
                }
              </nz-select>
            </div>
            <div class="btn-group m-l-12 hidden-btn-group">
              @for (btn of filterState; track btn) {
                <button (click)="loadWorkflow(btn.state)" [disabled]="savedFilter.selected"
                        [ngClass]="{'btn-primary': workflowFilters.filter.states.includes(btn.state)}"
                        class="btn btn-grey btn-sm button-group-ellipsis" translate>filters.button.{{btn.text}}
                </button>
              }
            </div>
            <div class="btn-group dropdown hidden-dropdown">
              <button [disabled]="savedFilter.selected" [nzDropdownMenu]="anyState" [nzPlacement]="'bottomRight'" class="btn btn-grey btn-sm m-l-12"
                      nz-dropdown nzTrigger="click" translate type="button">
                common.label.status
                <i class="caretDownIcon" nz-icon nzTheme="outline" nzType="caret-down"></i>
              </button>
              <nz-dropdown-menu #anyState="nzDropdownMenu">
                <ul nz-menu>
                  @for (btn of filterState; track btn) {
                    <li (click)="loadWorkflow(btn.state)" [ngClass]="{'ant-select-dropdown-menu-item-active': workflowFilters.filter.status=== btn.state}"
                        nz-menu-item>
                      <a translate>filters.button.{{btn.text}}</a>
                    </li>
                  }
                </ul>
              </nz-dropdown-menu>
            </div>
          </div>
          <div [ngClass]="{'hide': (object.mapOfCheckedId && object.mapOfCheckedId.size>0) || broadNames.size > 0}" class="inline m-b-xs">
            <div class="btn-group dropdown">
              <button [nzDropdownMenu]="anyDate" [nzPlacement]="'bottomRight'" class="btn btn-grey btn-sm m-l-12" nz-dropdown
                      nzTrigger="click" type="button">
                <span translate>workflow.label.orderFilter</span>: <span
                class="text-primary">{{'filters.button.' + workflowFilters.filter.label | translate}}</span>... <i class="caretDownIcon" nz-icon nzTheme="outline" nzType="caret-down"></i>
              </button>
              <nz-dropdown-menu #anyDate="nzDropdownMenu">
                <ul nz-menu>
                  @for (btn of filterBtn; track btn) {
                    <li (click)="loadOrders(btn.date);workflowFilters.filter.label = btn.text;" [ngClass]="{'ant-select-dropdown-menu-item-active': workflowFilters.filter.date=== btn.date}"
                        nz-menu-item>
                      <a translate>filters.button.{{btn.text}}</a>
                    </li>
                  }
                </ul>
              </nz-dropdown-menu>
            </div>
            <button (click)="suspendAll(true)" class="btn btn-grey btn-sm m-l-12"><i
              class="fa fa-stop p-r-xs"></i>
              <span class="hidden-sm-down" translate>workflow.button.suspendAll</span></button>
            <button (click)="resumeAll(true)" class="btn btn-grey btn-sm m-l-12"><i
              class="fa fa-step-forward p-r-xs"></i> <span class="hidden-sm-down"
                                                           translate>workflow.button.resumeAll</span>
            </button>
            <div class="btn-group dropdown">
              <button [nzDropdownMenu]="sortBy" [nzPlacement]="'bottomRight'" class="btn btn-grey btn-sm m-l-12" nz-dropdown
                      nzTrigger="click">
                <span translate>common.label.sortBy</span>
                <span class="text-primary">
                  @if (workflowFilters.filter.sortBy ==='name') {
                    <span>
                      {{'common.label.name' | translate}}
                      @if (!workflowFilters.reverse) {
                        <i class="fa fa-caret-up"></i>
                      }
                      @if (workflowFilters.reverse) {
                        <i class="fa fa-caret-down"></i>
                      }
                    </span>
                  }
                  @if (workflowFilters.filter.sortBy ==='path1') {
                    <span>
                      {{'common.label.path' | translate}}
                      @if (!workflowFilters.reverse) {
                        <i class="fa fa-caret-up"></i>
                      }
                      @if (workflowFilters.reverse) {
                        <i class="fa fa-caret-down"></i>
                      }
                    </span>
                  }
                </span>
              </button>
              <nz-dropdown-menu #sortBy="nzDropdownMenu">
                <ul nz-menu>
                  <li (click)="sort('name')" nz-menu-item>
                    <a translate>common.label.name</a>
                  </li>
                  <li (click)="sort('path1')" nz-menu-item>
                    <a translate>common.label.path</a>
                  </li>
                </ul>
              </nz-dropdown-menu>
            </div>
            @if (permission.joc && permission.joc.administration.customization.view) {
              <div class="btn-group dropdown">
                <button [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="selectedFiltered.account" [nzDropdownMenu]="customization" [nzPlacement]="'bottomRight'"
                        class="btn btn-grey btn-sm m-l-12" nz-dropdown nzTrigger="click" type="button">
                  {{'customization.label.customizations' | translate}}
                  <span [innerHtml]="selectedFiltered.name" class="text-primary"></span>
                  <i class="caretDownIcon" nz-icon nzTheme="outline" nzType="caret-down"></i>
                </button>
                <nz-dropdown-menu #customization="nzDropdownMenu">
                  <ul nz-menu>
                    @if (permission.joc && permission.joc.administration.customization.manage) {
                      <li (click)="createCustomization()" nz-menu-item>
                        <a translate>customization.label.createCustomization</a>
                      </li>
                    }
                    @if (filterList.length>0) {
                      <li (click)="editFilters()" nz-menu-item>
                        <a translate>customization.label.editExistingCustomizations</a>
                      </li>
                    }
                    @if (filterList.length>0) {
                      <li nz-menu-divider></li>
                    }
                    @for (filter of filterList | orderBy: 'name'; track filter) {
                      <li (click)="changeFilter(filter)" [ngClass]="{'ant-select-dropdown-menu-item-active': (savedFilter.selected == filter.id)}"
                          nz-menu-item>
                        <a>
                          <span [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="filter.account">{{filter.name}}</span>
                          @if (savedFilter.selected == filter.id) {
                            <i (click)="changeFilter(null);$event.stopPropagation();"
                               [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'customization.tooltip.deactivateCustomization' | translate"
                               class="fa fa-times-circle-o remove"></i>
                          }
                        </a>
                      </li>
                    }
                  </ul>
                </nz-dropdown-menu>
              </div>
            }
            <button (click)="exportToExcel()" [disabled]="data.length===0"
                    [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'common.tooltip.exportInXLS' | translate" class="btn btn-grey btn-sm m-l-12">
              <i class="fa fa-share-square-o"></i></button>
            <app-toggle (messageEvent)="receiveMessage($event)"></app-toggle>
          </div>
          <div [ngClass]="{'show-block':object.mapOfCheckedId.size > 0}" class="hide">
            <button (click)="suspendAll()" [disabled]="!object.isSuspend" class="btn btn-grey btn-sm m-l-12"><i
              class="fa fa-stop p-r-xs"></i>
              <span class="hidden-sm-down" translate>order.button.suspend</span></button>
            <button (click)="resumeAll()" [disabled]="!object.isResume" class="btn btn-grey btn-sm m-l-12"><i
              class="fa fa-step-forward p-r-xs"></i> <span class="hidden-sm-down"
                                                           translate>order.button.resume</span>
            </button>
          </div>
          @if (broadNames.size > 0) {
            <div class="show-block">
              <button (click)="postAllNotices()" class="btn btn-grey btn-sm m-l-12"><i
                class="fa fa-sticky-note-o"></i>&nbsp; {{'resource.board.button.postAll' | translate}}
              </button>
            </div>
          }
        </div>
      </div>
    </div>
  </div>
</div>
<div class="scroll-y max-ht">
  <div class="padding p-b-0">
    <div class="row m-t-xs">
      <div class="col-lg-12">
        <div [sideView]="sideView" appResizable class="sticky leftPanel workflow" id="leftPanel">
          <div>
            <div class="editor-tree">
              <div class="pl-20" style="padding-right:20px">
                <nz-tabset class="custom-tab" [nzAnimated]="false" [(nzSelectedIndex)]="workflowFilters.selectedIndex" [nzType]="'line'">
                  <nz-tab class="ctm-pd" (nzClick)="switchToTagging('folders');workflowFilters.selectedIndex = 0" [nzTitle]="foldersTitle">
                    <ng-template #foldersTitle>
                      <span>{{ 'inventory.tab.folders' | translate }}</span>
                    </ng-template>
                  </nz-tab>
                  <nz-tab class="ctm-pd" (nzClick)="switchToTagging('workflowTags');workflowFilters.selectedIndex = 1;" [nzTitle]="workflowTagsTitle">
                    <ng-template #workflowTagsTitle>
                      <span>{{ 'inventory.tab.workflowTagging' | translate }}</span>
                    </ng-template>
                  </nz-tab>
                  <nz-tab class="ctm-pd" (nzClick)="switchToTagging('orderTags');workflowFilters.selectedIndex = 2;" [nzTitle]="orderTagsTitle">
                    <ng-template #orderTagsTitle>
                      <span [ngClass]="workflowFilters.filtersOrdersAsWell ? 'custom-tab-btn-background' : ''">{{ 'inventory.tab.orderTagging' | translate }}</span>
                    </ng-template>
                  </nz-tab>
                </nz-tabset>
              </div>

              @if (workflowFilters.tagType === 'workflowTags') {
                <div class="pl-20">
                  <a (click)="objectTreeSearch()" class="tree-search workflow-tree-search">
                    <i [nzType]="'search'" nz-icon nzTheme="outline"></i>
                  </a>
                  <div>
                    <input (blur)="clearSearchInput()" (ngModelChange)="onSearchInput($event)"
                           [(ngModel)]="searchTag.text"
                           [nzAutocomplete]="auto" [placeholder]="'workflow.placeholder.findNode' | translate"
                           class="input-tree-search"
                           id="objectTagSearch"
                           nz-input
                    />

                    <i [nzType]="searchTag.loading ? 'loading' : 'search'" class="tree-search-icon" nz-icon nzTheme="outline"></i>
                    <nz-autocomplete #auto>
                      @for (tag of searchTag.tags | orderBy: 'ordering'; track tag) {
                        <nz-auto-option (click)="selectTagOnSearch(tag)"
                                        [nzValue]="tag.name" class="min-ht-opt">
                          <div class="node-wrapper p-l-xs">
                            <div class="node-content-wrapper2"
                                 nzTooltipPlacement="right">
                              <span class="icon-color text-xs" nz-icon nzType="tag" nzTheme="outline"></span>
                              <span class="p-l-sm">{{tag.name}}</span>
                            </div>
                          </div>
                        </nz-auto-option>
                      }
                    </nz-autocomplete>
                  </div>
                  <a (click)="hideSidebarPanel()" class="text resize-cursor a-1 pos-abt r-22 z-index-99">
                    <i class="fa fa-angle-double-left fa-lg"></i>
                  </a>
                  <a (click)="showSidebarPanel()" class="text resize-cursor a-2 pos-abt r-22 z-index-99">
                    <i class="fa fa-angle-double-right fa-lg"></i>
                  </a>

                  <perfect-scrollbar class="tree-block m-t-0" style="height: calc(100vh - 192px);">
                    @if (workflowFilters.tagType === 'workflowTags') {
                      <div class="fade-in">
                        <div class="p-l-xxs m-b-12">
                          <a (click)="selectTags()" nz-tooltip="{{'workflow.label.selectTags' | translate}}">
                            <i class="font14" [nzType]="'plus'" nz-icon nzTheme="outline"></i>
                          </a>
                          <a (click)="selectAllTags();" class="p-l-12" nz-tooltip="{{'workflow.label.selectAllTags' | translate}}">
                            <i class="font14" nz-icon nzTheme="outline" nzType="plus-square"></i>
                          </a>
                          <a (click)="removeAllTags();" class="p-l-12" nz-tooltip="{{'workflow.label.removeAllTags' | translate}}">
                            <i class="font14" nz-icon nzTheme="outline" nzType="minus-square"></i>
                          </a>
                        </div>
                        @if (coreService.selectedTags && coreService.selectedTags.length > 0) {
                          <label nz-checkbox [(ngModel)]="coreService.allTagsSelected" (ngModelChange)="toggleSelectAllTags($event)" class="m-l-xs m-b-15">
                            {{ 'profile.label.selectAll' | translate }}
                          </label>
                        }
                        @for (tag of coreService.selectedTags | orderBy: 'ordering'; track tag) {
                          <div class="w-full">
                            <div class="node-wrapper p-l-xs p-b-xxs">
                              <span class="w-14 m-r-12">
                                <label nz-checkbox [nzChecked]="coreService.checkedTags.has(tag.name)"
                                       (nzCheckedChange)="onTagChecked(tag.name, $event)"></label>
                              </span>
                              <div class="node-content-wrapper" [ngClass]="{'node-content-wrapper-active': coreService.checkedTags.has(tag.name)}" (click)="selectTag(tag.name)">
                                <span class="icon-color" nz-icon nzType="tag" nzTheme="outline"></span>
                                <span class="p-l-xs">{{tag.name}}</span>
                              </div>
                            </div>
                          </div>
                        }
                      </div>
                    }
                    @if (workflowFilters.tagType === 'workflowTags' && coreService.selectedTags && coreService.selectedTags.length === 0) {
                      <div class="m-top-50">
                        <app-empty-data></app-empty-data>
                      </div>
                    }
                  </perfect-scrollbar>
                  <div class="rg-right"><span></span></div>
                </div>
              }

              @if (workflowFilters.tagType === 'orderTags') {
                <div class="pl-20">
                  <a (click)="objectOrderTreeSearch()" class="tree-search workflow-tree-search">
                    <i [nzType]="'search'" nz-icon nzTheme="outline"></i>
                  </a>
                  <div>
                    <input (blur)="clearOrderSearchInput()" (ngModelChange)="onOrderSearchInput($event)"
                           [(ngModel)]="searchOrderTag.text"
                           [nzAutocomplete]="auto" [placeholder]="'workflow.placeholder.findNode' | translate"
                           class="input-tree-search"
                           id="objectOrderTagSearch"
                           nz-input
                    />

                    <i [nzType]="searchOrderTag.loading ? 'loading' : 'search'" class="tree-search-icon" nz-icon nzTheme="outline"></i>
                    <nz-autocomplete #auto>
                      @for (tag of searchOrderTag.tags | orderBy: 'ordering'; track tag) {
                        <nz-auto-option (click)="selectOrderTagOnSearch(tag)"
                                        [nzValue]="tag.name" class="min-ht-opt">
                          <div class="node-wrapper p-l-xs">
                            <div class="node-content-wrapper2"
                                 nzTooltipPlacement="right">
                              <span class="icon-color text-xs" nz-icon nzType="tag" nzTheme="outline"></span>
                              <span class="p-l-sm">{{tag.name}}</span>
                            </div>
                          </div>
                        </nz-auto-option>
                      }
                    </nz-autocomplete>
                  </div>
                  <a (click)="hideSidebarPanel()" class="text resize-cursor a-1 pos-abt r-22 z-index-99">
                    <i class="fa fa-angle-double-left fa-lg"></i>
                  </a>
                  <a (click)="showSidebarPanel()" class="text resize-cursor a-2 pos-abt r-22 z-index-99">
                    <i class="fa fa-angle-double-right fa-lg"></i>
                  </a>

                  <perfect-scrollbar class="tree-block m-t-0" style="height: calc(100vh - 192px);">
                    @if (workflowFilters.tagType === 'orderTags') {
                      <div class="fade-in">
                        <div class="p-l-xxs m-b-12">
                          <a (click)="selectOrderTags()" nz-tooltip="{{'workflow.label.selectTags' | translate}}">
                            <i class="font14" [nzType]="'plus'" nz-icon nzTheme="outline"></i>
                          </a>
                          <a (click)="selectAllOrderTags();" class="p-l-12" nz-tooltip="{{'workflow.label.selectAllTags' | translate}}">
                            <i class="font14" nz-icon nzTheme="outline" nzType="plus-square"></i>
                          </a>
                          <a (click)="removeAllOrderTags();" class="p-l-12" nz-tooltip="{{'workflow.label.removeAllTags' | translate}}">
                            <i class="font14" nz-icon nzTheme="outline" nzType="minus-square"></i>
                          </a>
                        </div>
                        @if (coreService.selectedOrderTags && coreService.selectedOrderTags.length > 0) {
                          <label nz-checkbox [(ngModel)]="coreService.allOrderTagsSelected" (ngModelChange)="toggleSelectAllOrderTags($event)" class="m-l-xs m-b-15">
                            {{ 'profile.label.selectAll' | translate }}
                          </label>
                        }
                        <label nz-checkbox [(ngModel)]="workflowFilters.filtersOrdersAsWell" (change)="onToggleFiltersOrders($event)" class="m-l-xs m-b-15">
                          {{ 'workflow.label.filtersOrdersAsWell' | translate }}
                        </label>
                        @for (tag of coreService.selectedOrderTags | orderBy: 'ordering'; track tag) {
                          <div class="w-full">
                            <div class="node-wrapper p-l-xs p-b-xxs">
                              <span class="w-14 m-r-12">
                                <label nz-checkbox [nzChecked]="coreService.checkedOrderTags.has(tag.name)"
                                       (nzCheckedChange)="onOrderTagChecked(tag.name, $event)"></label>
                              </span>
                              <div class="node-content-wrapper" [ngClass]="{'node-content-wrapper-active': coreService.checkedOrderTags.has(tag.name)}" (click)="selectOrderTag(tag.name)">
                                <span class="icon-color" nz-icon nzType="tag" nzTheme="outline"></span>
                                <span class="p-l-xs">{{tag.name}}</span>
                              </div>
                            </div>
                          </div>
                        }
                      </div>
                    }
                    @if (workflowFilters.tagType === 'orderTags' && coreService.selectedOrderTags && coreService.selectedOrderTags.length === 0) {
                      <div class="m-top-50">
                        <app-empty-data></app-empty-data>
                      </div>
                    }
                  </perfect-scrollbar>
                  <div class="rg-right"><span></span></div>
                </div>
              }

              @if (workflowFilters.tagType === 'folders') {
                <div class="fade-in">
                  <app-tree-navigation (messageEvent)="receiveAction($event)" (selectObjectEvent)="selectObject($event)" [defaultExpandedKeys]="workflowFilters.expandedKeys"
                                       [defaultSelectedKeys]="workflowFilters.selectedkeys"
                                       [schedulerId]="schedulerIds.selected" [sideView]="sideView.workflow"
                                       [tree]="tree" [type]="'WORKFLOW'"></app-tree-navigation>
                </div>
              }
            </div>
          </div>
        </div>
        <div id="rightPanel">
          @if (!(object.checked && object.mapOfCheckedId.size > 0 && data.length > (workflowFilters.entryPerPage || preferences.entryPerPage))) {
            <div class="row m-b-12">
              <div class="col-lg-12">
                <button (click)="expandDetails()" [ngClass]="{'show-block':data.length>0 && pageView!='grid'}"
                        class="hide btn btn-sm btn-grey" nz-tooltip="{{'common.button.expandDetails' | translate}}">
                  <i class="fa fa-expand text"></i>
                </button>
                <button (click)="collapseDetails()"
                        [ngClass]="{'show-block':data.length>0 && pageView!='grid'}"
                        class="hide btn btn-sm btn-grey m-l-sm" nz-tooltip="{{'common.button.collapseDetails' | translate}}">
                  <i class="fa fa-compress text"></i>
                </button>
                <button (click)="resetPanel()"
                        [ngClass]="{'show-block':data.length>0 && pageView!='grid'}"
                        class="hide btn btn-sm btn-grey m-l-sm m-r-sm" nz-tooltip="{{'common.button.resetPanel' | translate}}">
                  <i class="fa fa-repeat text"></i>
                </button>
                <button (click)="toggleCompactView()" [ngClass]="{'btn-primary': workflowFilters.isCompact == true, 'show-block':data.length>0}"
                        class="hide btn btn-grey btn-sm"
                        nz-tooltip="{{'common.button.compactView' | translate}}">
                  <i class="fa fa-th-list text"></i>
                </button>

                <button (click)="inventorySearch()" class="btn btn-sm inline pull-right m-l-12 btn-grey">
                  <i class="fa fa-search"></i>&nbsp;
                  <span translate>common.button.search</span>
                </button>
                @if (!showSearchPanel) {
                  <button [hidden]="workflowFilters.tagType === 'workflowTags' && workflowFilters.tagType === 'orderTags'" (click)="advancedSearch()"
                          class="btn btn-sm inline pull-right m-l-12 btn-grey">
                    <span translate>common.button.advancedSearch</span>
                    <i class="fa fa-caret-down p-l-xs"></i>
                  </button>
                }
                @if (showSearchPanel) {
                  <button [hidden]="workflowFilters.tagType === 'workflowTags' && workflowFilters.tagType === 'orderTags'" (click)="cancel()" class="btn btn-sm inline pull-right m-l-12 btn-grey">
                    <span translate>common.button.advancedSearch</span>
                    <i class="fa fa-caret-down p-l-xs"></i>
                  </button>
                }
                <div class="search-box-field pull-right">
                  <label>
                    <input (keyup)="searchInResult()" [(ngModel)]="workflowFilters.searchText"
                           placeholder="{{'common.placeholder.search' | translate}}"
                           type="search">
                  </label>
                  <i (click)="workflowFilters.searchText = '';searchInResult()" [hidden]="!workflowFilters.searchText"
                     class="fa fa-times search-close"></i>
                </div>
              </div>
            </div>
          }
          @if (showSearchPanel) {
            <div class="row m-b">
              <div class="col-md-12">
                <div class="box p-a m-b-xs">
                  <app-form-template (onCancel)="cancel()" (onSearch)="search()" [allFilter]="filterList"
                                     [filter]="searchFilter"
                                     [isSearch]="true" [listOfAgents]="listOfAgents" [permission]="permission"
                                     [preferences]="preferences" [schedulerIds]="schedulerIds"></app-form-template>
                </div>
              </div>
            </div>
          }
          <div [ngClass]="{'show': isLoading}" class="hide">
            @if (data.length>0) {
              <h3 class="orders"><span translate>dashboard.label.orders</span></h3>
            }
            @if (data.length>0) {
              <div class="box p-t-sm p-b-6 text-overflow m-b-12">
                <div class="table-responsive">
                  <table class="w-full">
                    <tr class="text-center text-sm">
                      <td [width]="'9.09%'">
                        <span translate>order.label.allOrders</span>
                      </td>
                      <td [width]="'9.09%'">
                        <span translate>common.label.pending</span>
                      </td>
                      <td [width]="'9.09%'">
                        <span translate>common.label.scheduled</span>
                      </td>
                      <td [width]="'9.09%'">
                        <span translate>common.label.incomplete</span>
                      </td>
                      <td [width]="'9.09%'">
                        <span translate>common.label.running</span>
                      </td>
                      <td [width]="'9.09%'">
                        <span translate>common.label.suspended</span>
                      </td>
                      <td [width]="'9.09%'">
                        <span translate>common.label.completed</span>
                      </td>
                      <td [width]="'9.09%'">
                        <span translate>common.label.prompting</span>
                      </td>
                      <td [width]="'9.09%'">
                        <span translate>common.label.waiting</span>
                      </td>
                      <td [width]="'9.09%'">
                        <span translate>common.label.blocked</span>
                      </td>
                      <td [width]="'9.09%'">
                        <div translate>common.label.failed</div>
                      </td>
                    </tr>
                    <tr class="text-center">
                      <td [width]="'9.09%'" style="padding:0 !important;">
                        <span (click)="viewOrderState('ALL')"
                              [innerHtml]="(numOfAllOrders.pending || 0) + (numOfAllOrders.inProgress || 0) +
                                           (numOfAllOrders.running || 0) + (numOfAllOrders.suspended || 0) +
                                           (numOfAllOrders.terminated || 0) + (numOfAllOrders.waiting || 0) +
                                           (numOfAllOrders.scheduled || 0) + (numOfAllOrders.prompting || 0) +
                                           (numOfAllOrders.blocked || 0) + (numOfAllOrders.failed || 0)"
                              class="font14 _600 cursor text-black-lt"></span>
                      </td>
                      <td [width]="'9.09%'" style="padding:0 !important;">
                        <span (click)="viewOrderState('PENDING')"
                              [innerHtml]="numOfAllOrders.pending || 0"
                              [ngClass]="numOfAllOrders.pending > 0 ? coreService.getColor(10, 'text') : ''"
                              class="font14 _600 cursor"></span>
                      </td>
                      <td [width]="'9.09%'" style="padding:0 !important;">
                        <span (click)="viewOrderState('SCHEDULED')"
                              [innerHtml]="numOfAllOrders.scheduled || 0"
                              [ngClass]="numOfAllOrders.scheduled > 0 ? coreService.getColor(1, 'text') : ''"
                              class="font14 _600 cursor"></span>
                      </td>
                      <td [width]="'9.09%'" style="padding:0 !important;">
                        <span (click)="viewOrderState('INPROGRESS')"
                              [innerHtml]="numOfAllOrders.inProgress || 0"
                              [ngClass]="numOfAllOrders.inProgress > 0 ? coreService.getColor(3, 'text') : ''"
                              class="font14 _600 cursor"></span>
                      </td>
                      <td [width]="'9.09%'" style="padding:0 !important;">
                        <span (click)="viewOrderState('RUNNING')"
                              [innerHtml]="numOfAllOrders.running || 0"
                              [ngClass]="numOfAllOrders.running > 0 ? coreService.getColor(0, 'text') : ''"
                              class="font14 _600 cursor"></span>
                      </td>
                      <td [width]="'9.09%'" style="padding:0 !important;">
                        <span (click)="viewOrderState('SUSPENDED')"
                              [innerHtml]="numOfAllOrders.suspended || 0"
                              [ngClass]="numOfAllOrders.suspended > 0 ? coreService.getColor(5, 'text') : ''"
                              class="font14 _600 cursor"></span>
                      </td>
                      <td [width]="'9.09%'" style="padding:0 !important;">
                        <span (click)="viewOrderState('COMPLETED')"
                              [innerHtml]="numOfAllOrders.terminated || 0"
                              [ngClass]="numOfAllOrders.terminated > 0 ? coreService.getColor(6, 'text') : ''"
                              class="font14 _600 cursor"></span>
                      </td>
                      <td [width]="'9.09%'" style="padding:0 !important;">
                        <span (click)="viewOrderState('PROMPTING')"
                              [innerHtml]="numOfAllOrders.prompting || 0"
                              [ngClass]="numOfAllOrders.prompting > 0 ? coreService.getColor(12, 'text') : ''"
                              class="font14 _600 cursor"></span>
                      </td>
                      <td [width]="'9.09%'" style="padding:0 !important;">
                        <span (click)="viewOrderState('WAITING')"
                              [innerHtml]="numOfAllOrders.waiting || 0"
                              [ngClass]="numOfAllOrders.waiting > 0 ? coreService.getColor(8, 'text') : ''"
                              class="font14 _600 cursor"></span>
                      </td>
                      <td [width]="'9.09%'" style="padding:0 !important;">
                        <span (click)="viewOrderState('BLOCKED')"
                              [innerHtml]="numOfAllOrders.blocked || 0"
                              [ngClass]="numOfAllOrders.blocked > 0 ? coreService.getColor(7, 'text') : ''"
                              class="font14 _600 cursor"></span>
                      </td>
                      <td [width]="'9.09%'" style="padding:0 !important;">
                        <span (click)="viewOrderState('FAILED')"
                              [innerHtml]="numOfAllOrders.failed || 0"
                              [ngClass]="numOfAllOrders.failed > 0 ? coreService.getColor(2, 'text') : ''"
                              class="font14 _600 cursor"></span>
                      </td>
                    </tr>
                  </table>
                </div>
              </div>
            }
            @if (pageView=='grid' && data.length>0) {
              <div [hidden]="loading" class="row">
                @for (item of data | groupBy: 'path1'; track item) {
                  <div class="w-full">
                    <div class="col-sm-12 m-b-10">
                      <span class="text inline"><i class="fa fa-folder-o"></i> {{item.key}}</span>
                    </div>
                    @for (workflow of item.value; track workflow) {
                      <div class="col-xxl-3 col-lg-4 col-md-6 col-sm-12 col-xs-12">
                        <div class="box card">
                          <div class="box-body">
                            <div>
                              <label class="pos-abt">
                                <label nz-checkbox [nzChecked]="object.mapOfCheckedId.has(workflow.path)"
                                       (nzCheckedChange)="onItemChecked(workflow, $event)"></label>
                              </label>
                              <div class="text-left block-ellipsis m-l-md">
                                <i class="icon-workflows-icon"></i>&nbsp;
                                <i (click)="navToDetailView('list', workflow)" class="cursor fa fa-list"></i>
                                <i (click)="navToDetailView('grid', workflow)" class="cursor fa fa-th p-l-xs p-r-xs"></i>
                                @if (workflow.documentationName) {
                                  <i (click)="coreService.showDocumentation(workflow.documentationName, preferences)"
                                     class="cursor fa fa-book p-l-xs p-r-xs"></i>
                                }
                                <span [innerHtml]="workflow.name | highlight : workflowFilters.searchText"
                                      [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="workflow.title"></span>
                                @if (workflow.workflowTags?.length > 0) {
                                  <a [innerHTML]="coreService.getModifiedWorkflowTags(workflow, workflowFilters.searchText)">
                                  </a>
                                }
                              </div>
                              <div class="btn-group dropdown pull-right abt-dropdown ">
                                <app-workflow-action (isChanged)="changedHandler($event)"
                                                     [isDisabled]="object.checked || object.indeterminate" [permission]="permission"
                                                     [preferences]="preferences"
                                                     [schedulerId]="schedulerIds.selected" [workflow]="workflow"></app-workflow-action>
                              </div>
                            </div>
                            <div class="text-sm text-left text-muted p-t-sm block-ellipsis w-99">
                              <span translate>inventory.label.deploymentDate </span>:
                              <span [innerHtml]="workflow.versionDate | stringToDate | highlight : workflowFilters.searchText"
                                    class="text-black-dk"></span>
                            </div>
                            <div class="text-sm text-left text-muted p-t-xs">
                              <span translate>common.label.status </span>:
                              @if (workflow.state) {
                                <span [innerHtml]="workflow.state._text | translate | highlight : workflowFilters.searchText"
                                      [ngClass]="coreService.getColor(workflow.state.severity, 'text')"></span>
                              }
                              @if (workflow.state && (workflow.state._text === 'OUTSTANDING')) {
                                <app-tooltip-info [controllerId]="schedulerIds.selected"
                                                  [workflow]="workflow"></app-tooltip-info>
                              }
                            </div>
                            <div class="text-sm text-left text-muted p-t-xs">
                              <span>
                                <a (click)="viewOrders(workflow)"
                                   [innerHtml]="workflow.numOfOrders || 0"
                                   class="text-black _600 m-l text-hover-primary p-r-xs"></a>
                                @if (workflow.numOfOrders>1) {
                                  <span translate>order.label.orders</span>
                                }
                                @if (!workflow.numOfOrder || workflow.numOfOrders < 2) {
                                  <span translate>workflow.label.order</span>
                                }
                              </span>
                            </div>
                            @if (!workflowFilters.isCompact) {
                              <div class="text-sm text-left text-muted m-l p-t-xs">
                                <span [innerHtml]="workflow.ordersSummary.pending || 0"
                                      class="text-black _600 p-r-xs"></span>
                                <span [innerHtml]="'common.label.pending' | translate"></span>
                                <span [innerHtml]="workflow.ordersSummary.scheduled || 0"
                                      class="text-black _600 m-l p-r-xs"></span>
                                <span [innerHtml]="'common.label.scheduled' | translate"></span>
                                <span [innerHtml]="workflow.ordersSummary.inProgress || 0"
                                      class="text-black _600 m-l p-r-xs"></span>
                                <span [innerHtml]="'common.label.incomplete' | translate"></span>
                                <span [innerHtml]="workflow.ordersSummary.running || 0"
                                      class="text-black _600 m-l p-r-xs"></span>
                                <span [innerHtml]="'common.label.running' | translate"></span>
                              </div>
                            }
                            @if (!workflowFilters.isCompact) {
                              <div class="text-sm text-left text-muted m-l p-t-xs">
                                <span [innerHtml]="workflow.ordersSummary.suspended || 0"
                                      class="text-black _600 p-r-xs"></span>
                                <span [innerHtml]="'common.label.suspended' | translate"></span>
                                <span [innerHtml]="workflow.ordersSummary.prompting || 0"
                                      class="text-black _600 m-l p-r-xs"></span>
                                <span [innerHtml]="'common.label.prompting' | translate"></span>
                                <span [innerHtml]="workflow.ordersSummary.waiting || 0"
                                      class="text-black _600 m-l p-r-xs"></span>
                                <span [innerHtml]="'common.label.waiting' | translate"></span>
                                <span [innerHtml]="workflow.ordersSummary.blocked || 0"
                                      class="text-black _600 m-l p-r-xs"></span>
                                <span [innerHtml]="'common.label.blocked' | translate"></span>
                              </div>
                            }
                            @if (!workflowFilters.isCompact) {
                              <div class="text-sm text-left text-muted m-l p-t-xs">
                                <span [innerHtml]="workflow.ordersSummary.failed || 0"
                                      class="text-black _600 p-r-xs"></span>
                                <span [innerHtml]="'common.label.failed' | translate"></span>
                                <span [innerHtml]="workflow.ordersSummary.terminated || 0"
                                      class="text-black _600 m-l p-r-xs"></span>
                                <span [innerHtml]="'common.label.completed' | translate"></span>
                              </div>
                            }
                          </div>
                          <div class="box-footer b-t">
                            <div>
                              <a (click)="actionChild.addOrder(workflow);"
                                 [ngClass]="{'show-block':permission.currentController && permission.currentController.orders.create, 'disable-link': (!workflow.isCurrentVersion || workflow.state._text === 'NOT_IN_SYNC')}"
                                 class="hide text-left primary-text-hover-color">
                                <i class="fa fa-plus-square-o text-black-lt p-r-xs"></i>
                                <span class="text-black-lt" translate>workflow.button.addOrder</span>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    }
                  </div>
                }
              </div>
            }
            @if (object.checked && object.mapOfCheckedId.size > 0 && data.length > (workflowFilters.entryPerPage || preferences.entryPerPage)) {
              <div class="text-center font14 box p-a-10 m-b-12">
                @if (object.mapOfCheckedId.size !== data.length) {
                  <span [translateParams]="{count: object.mapOfCheckedId.size}"
                        translate>common.label.selectAllEntriesOfCurrentPage</span>
                }
                @if (object.mapOfCheckedId.size === data.length) {
                  <span [translateParams]="{count: data.length}"
                        translate>common.label.allEntriesSelected</span>
                }
                @if (object.mapOfCheckedId.size !== data.length) {
                  <a (click)="selectAll()" [translateParams]="{count: data.length}"
                     class="text-primary p-l-xs" translate>common.label.selectAllEntries</a>
                }
                @if (object.mapOfCheckedId.size === data.length) {
                  <a (click)="resetCheckBox()"
                     class="text-primary p-l-xs" translate>common.label.clearSelection</a>
                }
              </div>
            }
            @if (pageView!=='grid' && tree.length > 0) {
              <div class="box p-a m-t-xs m-b-0">
                <perfect-scrollbar (psScrollY)="scrollEnd($event)" [height]="resizerHeight" [path]="currentPath"
                                   [type]="'workflow'" appResizable class="resizable pos-init"
                                   id="workflowTableId">
                  <nz-table
                    #ajaxTable
                    (nzPageIndexChange)="pageIndexChange($event)"
                    (nzPageSizeChange)="pageSizeChange($event)"
                    [nzBordered]="true"
                    [nzData]="data"
                    [nzLoading]="loading"
                    [nzPageIndex]="workflowFilters.currentPage"
                    [nzPageSizeOptions]="[10, 25, 50, 100 , +(preferences.maxEntryPerPage)]"
                    [nzPageSize]="workflowFilters.entryPerPage || preferences.entryPerPage || 25"
                    [nzShowPagination]="data.length > 0"
                    [nzShowSizeChanger]="true"
                    [nzSize]="'small'"
                  >
                    <thead>
                    <tr>
                      <th [(nzChecked)]="object.checked" [nzIndeterminate]="object.indeterminate"
                          [nzShowCheckbox]="true" class="chk" (nzCheckedChange)="checkAll($event)"  rowspan="2"></th>
                      <th class="menu" rowspan="2"><span translate>common.label.action</span></th>
                      <th (click)="sort('name')" [nzWidth]="!workflowFilters.isCompact ? '150px' : 'auto'" rowspan="2">
                        <a><span class="p-r-xs" translate>common.label.name</span>
                          @if (workflowFilters.filter.sortBy == 'name' && !workflowFilters.reverse) {
                            <i class="fa fa-caret-up "></i>
                          }
                          @if (workflowFilters.filter.sortBy == 'name' && workflowFilters.reverse) {
                            <i class="fa fa-caret-down "></i>
                          }</a>
                      </th>
                      @if (isPathDisplay) {
                        <th (click)="sort('path1')" [nzWidth]="!workflowFilters.isCompact ? '150px' : 'auto'" rowspan="2">
                          <a><span class="p-r-xs" translate>common.label.path</span>
                            @if (workflowFilters.filter.sortBy == 'path1' && !workflowFilters.reverse) {
                              <i class="fa fa-caret-up "></i>
                            }
                            @if (workflowFilters.filter.sortBy == 'path1' && workflowFilters.reverse) {
                              <i class="fa fa-caret-down "></i>
                            }</a>
                        </th>
                      }
                      <th (click)="sort('versionDate')" [nzWidth]="workflowFilters.isCompact ? '150px' : 'auto'"
                          rowspan="2">
                        <a><span class="p-r-xs" translate>inventory.label.deploymentDate</span>
                          @if (workflowFilters.filter.sortBy == 'versionDate' && !workflowFilters.reverse) {
                            <i class="fa fa-caret-up "></i>
                          }
                          @if (workflowFilters.filter.sortBy == 'versionDate' && workflowFilters.reverse) {
                            <i class="fa fa-caret-down "></i>
                          }</a>
                      </th>
                      <th (click)="sort('state._text')" [nzWidth]="workflowFilters.isCompact ? '100px' : 'auto'"
                          rowspan="2">
                        <a><span class="p-r-xs" translate>common.label.status</span>
                          @if (workflowFilters.filter.sortBy == 'state._text' && !workflowFilters.reverse) {
                            <i class="fa fa-caret-up "></i>
                          }
                          @if (workflowFilters.filter.sortBy == 'state._text' && workflowFilters.reverse) {
                            <i class="fa fa-caret-down "></i>
                          }</a>
                      </th>
                      <th (click)="sort('numOfOrders')" [nzWidth]="workflowFilters.isCompact ? '100px' : 'auto'"
                          rowspan="2">
                        <a><span class="p-r-xs" translate>workflow.label.noOfOrders</span>
                          @if (workflowFilters.filter.sortBy == 'numOfOrders' && !workflowFilters.reverse) {
                            <i class="fa fa-caret-up "></i>
                          }
                          @if (workflowFilters.filter.sortBy == 'numOfOrders' && workflowFilters.reverse) {
                            <i class="fa fa-caret-down "></i>
                          }</a>
                      </th>
                      @if (!workflowFilters.isCompact) {
                        <th colspan="10"><span translate>workflow.label.order</span></th>
                      }
                    </tr>
                      @if (!workflowFilters.isCompact) {
                        <tr>
                          <th (click)="sort('ordersSummary.pending')">
                            <a><span class="p-r-xs" translate>common.label.pending</span>
                              @if (workflowFilters.filter.sortBy == 'ordersSummary.pending' && !workflowFilters.reverse) {
                                <i class="fa fa-caret-up "></i>
                              }
                              @if (workflowFilters.filter.sortBy == 'ordersSummary.pending' && workflowFilters.reverse) {
                                <i class="fa fa-caret-down "></i>
                              }</a>
                          </th>
                          <th (click)="sort('ordersSummary.scheduled')">
                            <a><span class="p-r-xs" translate>common.label.scheduled</span>
                              @if (workflowFilters.filter.sortBy == 'ordersSummary.scheduled' && !workflowFilters.reverse) {
                                <i class="fa fa-caret-up "></i>
                              }
                              @if (workflowFilters.filter.sortBy == 'ordersSummary.scheduled' && workflowFilters.reverse) {
                                <i class="fa fa-caret-down "></i>
                              }</a>
                          </th>
                          <th (click)="sort('ordersSummary.inprogress')">
                            <a><span class="p-r-xs" translate>common.label.incomplete</span>
                              @if (workflowFilters.filter.sortBy == 'ordersSummary.inprogress' && !workflowFilters.reverse) {
                                <i class="fa fa-caret-up "></i>
                              }
                              @if (workflowFilters.filter.sortBy == 'ordersSummary.inprogress' && workflowFilters.reverse) {
                                <i class="fa fa-caret-down "></i>
                              }</a>
                          </th>
                          <th (click)="sort('ordersSummary.running')">
                            <a><span class="p-r-xs" translate>common.label.running</span>
                              @if (workflowFilters.filter.sortBy == 'ordersSummary.running' && !workflowFilters.reverse) {
                                <i class="fa fa-caret-up "></i>
                              }
                              @if (workflowFilters.filter.sortBy == 'ordersSummary.running' && workflowFilters.reverse) {
                                <i class="fa fa-caret-down "></i>
                              }</a>
                          </th>
                          <th (click)="sort('ordersSummary.suspended')">
                            <a><span class="p-r-xs" translate>common.label.suspended</span>
                              @if (workflowFilters.filter.sortBy == 'ordersSummary.suspended' && !workflowFilters.reverse) {
                                <i class="fa fa-caret-up "></i>
                              }
                              @if (workflowFilters.filter.sortBy == 'ordersSummary.suspended' && workflowFilters.reverse) {
                                <i class="fa fa-caret-down "></i>
                              }</a>
                          </th>
                          <th (click)="sort('ordersSummary.prompting')">
                            <a><span class="p-r-xs" translate>common.label.prompting</span>
                              @if (workflowFilters.filter.sortBy == 'ordersSummary.prompting' && !workflowFilters.reverse) {
                                <i class="fa fa-caret-up "></i>
                              }
                              @if (workflowFilters.filter.sortBy == 'ordersSummary.prompting' && workflowFilters.reverse) {
                                <i class="fa fa-caret-down "></i>
                              }</a>
                          </th>
                          <th (click)="sort('ordersSummary.waiting')">
                            <a><span class="p-r-xs" translate>common.label.waiting</span>
                              @if (workflowFilters.filter.sortBy == 'ordersSummary.waiting' && !workflowFilters.reverse) {
                                <i class="fa fa-caret-up "></i>
                              }
                              @if (workflowFilters.filter.sortBy == 'ordersSummary.waiting' && workflowFilters.reverse) {
                                <i class="fa fa-caret-down "></i>
                              }</a>
                          </th>
                          <th (click)="sort('ordersSummary.blocked')">
                            <a><span class="p-r-xs" translate>common.label.blocked</span>
                              @if (workflowFilters.filter.sortBy == 'ordersSummary.blocked' && !workflowFilters.reverse) {
                                <i class="fa fa-caret-up "></i>
                              }
                              @if (workflowFilters.filter.sortBy == 'ordersSummary.blocked' && workflowFilters.reverse) {
                                <i class="fa fa-caret-down "></i>
                              }</a>
                          </th>
                          <th (click)="sort('ordersSummary.failed')">
                            <a><span class="p-r-xs" translate>common.label.failed</span>
                              @if (workflowFilters.filter.sortBy == 'failed' && !workflowFilters.reverse) {
                                <i class="fa fa-caret-up "></i>
                              }
                              @if (workflowFilters.filter.sortBy == 'failed' && workflowFilters.reverse) {
                                <i class="fa fa-caret-down "></i>
                              }</a>
                          </th>
                          <th (click)="sort('ordersSummary.terminated')">
                            <a><span class="p-r-xs" translate>common.label.completed</span>
                              @if (workflowFilters.filter.sortBy == 'ordersSummary.terminated' && !workflowFilters.reverse) {
                                <i class="fa fa-caret-up "></i>
                              }
                              @if (workflowFilters.filter.sortBy == 'ordersSummary.terminated' && workflowFilters.reverse) {
                                <i class="fa fa-caret-down "></i>
                              }</a>
                          </th>
                        </tr>
                      }
                    </thead>
                    <tbody>
                      @for (workflow of ajaxTable.data; track workflow) {
                        <tr [ngClass]="{'light-bg':workflow.show}">
                          <td [nzChecked]="object.mapOfCheckedId.has(workflow.path)"
                              [nzShowCheckbox]="true" (nzCheckedChange)="onItemChecked(workflow,$event)" ></td>
                          <td>
                            <div class="btn-group dropdown">
                              <app-workflow-action (isChanged)="changedHandler($event)"
                                                   [isDisabled]="object.checked || object.indeterminate" [permission]="permission"
                                                   [preferences]="preferences"
                                                   [schedulerId]="schedulerIds.selected" [workflow]="workflow"></app-workflow-action>
                            </div>
                          </td>
                          <td>
                          <span class="show-in-single-line">
                            @if (!workflow.show) {
                              <i (click)="workflow.isExpand = true;showPanelFuc(workflow)"
                                 [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'common.tooltip.expandAll' | translate"
                                 class="cursor fa fa-chevron-down p-l-xs p-r-xs t-n-1 pos-rel"></i>
                            }
                            @if (workflow.show) {
                              <i (click)="workflow.isExpand = false;hidePanelFuc(workflow)"
                                 [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'common.tooltip.collapseAll' | translate"
                                 class="cursor fa fa-chevron-up p-l-xs p-r-xs t-n-1 pos-rel"></i>
                            }
                            @if (!workflow.show) {
                              <i (click)="showPanelFuc(workflow)"
                                 class="cursor fa fa-caret-down fa-lg p-l-xxs t-n-1 pos-rel"></i>
                            }
                            @if (workflow.show) {
                              <i (click)="hidePanelFuc(workflow)"
                                 class="cursor fa fa-caret-up fa-lg p-l-xxs t-n-1 pos-rel"></i>
                            }
                            @if (permission.currentController && permission.currentController.orders.create && workflow.isCurrentVersion && workflow.state._text !== 'NOT_IN_SYNC') {
                              <i
                                (click)="addOrder(workflow)"
                                [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'workflow.button.addOrder' | translate" class="cursor fa fa-plus p-l-xs"></i>
                            }
                            <i (click)="navToDetailView('list', workflow)"
                               [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'workflow.button.showTabularView' | translate"
                               class="cursor fa fa-list p-l-xs"></i>
                            <i (click)="navToDetailView('grid', workflow)"
                               [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'workflow.button.showGraphicalView' | translate"
                               class="cursor fa fa-th p-l-xs p-r-xs"></i>
                            @if (workflow.hasExpectedNoticeBoards || workflow.hasConsumeNoticeBoards || workflow.hasPostNoticeBoards || workflow.hasAddOrderDependencies) {
                              <i
                                (click)="showDependency(workflow)"
                                [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'workflow.button.showDependency' | translate"
                                class="cursor fa fa-codepen p-l-xs p-r-xs"></i>
                            }
                            @if (workflow.documentationName) {
                              <i (click)="coreService.showDocumentation(workflow.documentationName, preferences)"
                                 class="cursor fa fa-book p-l-xs p-r-xs"></i>
                            }
                            @if (permission.joc && permission.joc.inventory.view && !isPathDisplay) {
                              <i (click)="coreService.navToInventoryTab(workflow.path, 'WORKFLOW');"
                                 class="cursor fa fa-pencil text-hover-primary p-l-xs p-r-xs"></i>
                            }
                            <a class="text-dark noExl">
                              <span (click)="showPanelFunc(workflow)" [innerHtml]="workflow.name | highlight : workflowFilters.searchText"
                                    class="cursor primary-text-hover-color"></span>
                              @if (workflow.title) {
                                <i> - </i>
                              }
                              <i [innerHtml]="workflow.title | stringToLink" class="text-muted"></i>
                            </a>
                            @if (workflow.workflowTags?.length > 0) {
                              <a [innerHTML]="coreService.getModifiedWorkflowTags(workflow, workflowFilters.searchText)">
                            </a>
                            }
                          </span>
                          </td>
                          @if (isPathDisplay) {
                            <td>
                            <span class="show-in-single-line">
                              @if (permission.joc && permission.joc.inventory.view) {
                                <i (click)="coreService.navToInventoryTab(workflow.path, 'WORKFLOW');"
                                   class="cursor fa fa-pencil text-hover-primary p-r-xs"></i>
                              }
                              <span [innerHtml]="workflow.path1 | highlight : workflowFilters.searchText"></span>
                            </span>
                            </td>
                          }
                          <td>
                          <span
                            [innerHtml]="workflow.versionDate | stringToDate | highlight : workflowFilters.searchText"></span>
                          </td>
                          <td>
                            @if (workflow.state) {
                              <a [innerHtml]="workflow.state._text | translate | highlight : workflowFilters.searchText"
                                 [ngClass]="coreService.getColor(workflow.state.severity, 'bg')"
                                 class="label"></a>
                            }
                            @if (workflow.state && (workflow.state._text === 'OUTSTANDING')) {
                              <app-tooltip-info [controllerId]="schedulerIds.selected"
                                                [workflow]="workflow"></app-tooltip-info>
                            }
                          </td>
                          <td>
                          <span (click)="viewOrders(workflow)" [innerHtml]="workflow.numOfOrders || 0"
                                class="remaining-order-count"></span>
                          </td>
                          @if (!workflowFilters.isCompact) {
                            <td>
                              <span [innerHtml]="workflow.ordersSummary.pending || 0"></span>
                            </td>
                          }
                          @if (!workflowFilters.isCompact) {
                            <td>
                              <span [innerHtml]="workflow.ordersSummary.scheduled || 0"></span>
                            </td>
                          }
                          @if (!workflowFilters.isCompact) {
                            <td>
                              <span [innerHtml]="workflow.ordersSummary.inprogress || 0"></span>
                            </td>
                          }
                          @if (!workflowFilters.isCompact) {
                            <td>
                              <span [innerHtml]="workflow.ordersSummary.running || 0"></span>
                            </td>
                          }
                          @if (!workflowFilters.isCompact) {
                            <td>
                              <span [innerHtml]="workflow.ordersSummary.suspended || 0"></span>
                            </td>
                          }
                          @if (!workflowFilters.isCompact) {
                            <td>
                              <span [innerHtml]="workflow.ordersSummary.prompting || 0"></span>
                            </td>
                          }
                          @if (!workflowFilters.isCompact) {
                            <td>
                              <span [innerHtml]="workflow.ordersSummary.waiting || 0"></span>
                            </td>
                          }
                          @if (!workflowFilters.isCompact) {
                            <td>
                              <span [innerHtml]="workflow.ordersSummary.blocked || 0"></span>
                            </td>
                          }
                          @if (!workflowFilters.isCompact) {
                            <td>
                              <span [innerHtml]="workflow.ordersSummary.failed || 0"></span>
                            </td>
                          }
                          @if (!workflowFilters.isCompact) {
                            <td>
                              <span [innerHtml]="workflow.ordersSummary.terminated || 0"></span>
                            </td>
                          }
                        </tr>
                        @if (workflow.show && workflow.fileOrderSources && workflow.fileOrderSources.length>0) {
                          <tr>
                            <td class="menu"></td>
                            <td [colSpan]="!workflowFilters.isCompact ? 17 : 6" style="padding:0 !important;">
                              <nz-table #innerChildTable [nzData]="workflow.fileOrderSources" [nzFrontPagination]="false"
                                        [nzShowPagination]="false" class="m-a-0 inner-table"
                                        nzSize="small">
                                <thead>
                                <tr>
                                  <th><span class="m-l-sm" translate>common.label.path</span></th>
                                  <th><span translate>inventory.label.deploymentDate</span></th>
                                  <th><span translate>common.label.status</span></th>
                                  <th><span translate>workflow.label.agent</span></th>
                                  <th><span translate>inventory.label.directory</span></th>
                                  <th><span translate>inventory.label.pattern</span></th>
                                  <th><span translate>common.label.timeZone</span></th>
                                  <th><span translate>workflow.label.delay</span></th>
                                </tr>
                                </thead>
                                <tbody>
                                  @for (order of innerChildTable.data; track order) {
                                    <tr>
                                      <td>
                                    <span class="show-in-single-line m-l-sm">
                                      @if (order.documentationName) {
                                        <i (click)="coreService.showDocumentation(order.documentationName, preferences)"
                                           class="cursor fa fa-book p-r-xs"></i>
                                      }
                                      <span class="text-dark">
                                        <i (click)="coreService.navToInventoryTab(order.path, 'FILEORDERSOURCE')"
                                           class="cursor fa fa-pencil text-hover-primary p-r-xs"></i>
                                        <span [innerHtml]="order.path"></span>
                                        @if (order.title) {
                                          <i> - </i>
                                        }
                                        <i class="text-muted">{{order.title}}</i>
                                      </span>
                                    </span>
                                      </td>
                                      <td>
                                        <span [innerHtml]="order.versionDate | stringToDate"></span>
                                      </td>
                                      <td>
                                        @if (order.state) {
                                          <span [innerHtml]="order.state._text | translate"
                                                [ngClass]="coreService.getColor(order.state.severity, 'bg')"
                                                class="label"></span>
                                        }
                                      </td>
                                      <td>{{order.agentName}}</td>
                                      <td>{{order.directoryExpr || order.directory}}</td>
                                      <td>{{order.pattern}}</td>
                                      <td>{{order.timeZone}}</td>
                                      <td>{{order.delay}}</td>
                                    </tr>
                                  }
                                </tbody>
                              </nz-table>
                            </td>
                          </tr>
                        }
                        @if (workflow.show) {
                          <tr id="{{workflow.path + workflow.versionId}}">
                            <td colspan="17">
                              <div class="m-a-sm">
                                <div class="hover">
                                  <a class="text-primary noExl" translate>workflow.label.start</a>
                                  <span class="expand-collapse-btn">
                                      <i (click)="workflow.isExpand = true;"
                                         [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'common.tooltip.expandAll' | translate"
                                         class="cursor fa fa-lg fa-angle-double-down"></i>
                                      <i (click)="workflow.isExpand = false;"
                                         [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'common.tooltip.collapseAll' | translate"
                                         class="cursor fa fa-lg fa-angle-double-up p-l-xs"></i>
                                    </span>
                                </div>
                                <app-type (bulkUpdate)="bulkUpdate($event)" [multiSelect]="true" [clearCheckboxes]="clearCheckboxes" (isChanged)="changedHandler($event)" (isDropdownChangedHandler)="dropdownChangedHandler($event)"
                                          (isProcessing)="processingHandler($event)"
                                          (onClick)="viewHistory($event)" (update)="updatePanelHeight()"
                                          [configuration]="workflow.configuration"
                                          [expandAll]="workflow.isExpand" [jobs]="workflow.configuration.jobs"
                                          [orderPreparation]="workflow.configuration.orderPreparation"
                                          [orderReload]="workflow.orderReload" [orders]="workflow.orders"
                                          [permission]="permission"
                                          [preferences]="preferences"
                                          [schedulerId]="schedulerIds.selected"
                                          [workflowFilters] = "workflowFilters"
                                          [searchText]="workflowFilters.searchText"
                                          [timezone]="workflow.configuration.timeZone" [workflowObj]="{path: workflow.configuration.path, versionId: workflow.configuration.versionId}"></app-type>
                              </div>
                            </td>
                          </tr>
                        }
                      }
                    </tbody>
                  </nz-table>
                  @if (ajaxTable.data.length >0) {
                    <div class="w-half label-top"><span translate>common.label.total</span> {{data.length}}
                      @if (ajaxTable.data.length >1) {
                        <span translate>workflow.label.workflowsFound</span>
                      }
                      @if (ajaxTable.data.length ==1) {
                        <span translate>workflow.label.workflowFound</span>
                      }
                    </div>
                  }
                </perfect-scrollbar>
                <div class="rg-bottom"><span></span></div>
              </div>
            }
            @if (pageView=='grid' && isLoading && !loading && data.length==0 && tree.length>0) {
              <div class="text-center m-t h6">
                <app-empty-data></app-empty-data>
              </div>
            }
            @if (showPanel) {
              <div [ngClass]="{'show': pageView!=='grid'}" class="row m-t hide">
                <div [hidden]="loading" class="col-md-12">
                  <div class="box white">
                    <div class="box-header">
                      <span class="text">{{showPanel.path}} @if (showPanel.title) {<i>-</i>} <i
                        class="text-sm text-muted">{{showPanel.title}}</i></span>
                    </div>
                    <div class="box-tool">
                      <ul class="nav text-muted text-md">
                        <li class="nav-item inline m-l-sm">
                          <a (click)="hidePanel()"><i class="fa fa-times"></i></a>
                        </li>
                      </ul>
                    </div>
                    <div class="box-body p-t-0 b-t">
                      <app-workflow-history [jobName]="showPanel.jobName"
                                            [workflow]="{name: showPanel.name, path: showPanel.path}"></app-workflow-history>
                    </div>
                  </div>
                </div>
              </div>
            }
          </div>
          @if (isLoading && tree.length==0 && !loading) {
            <div class="text-center m-t">
              <app-empty-data></app-empty-data>
            </div>
          }
        </div>
      </div>
    </div>
  </div>
</div>
<nz-drawer (nzOnClose)="sideBar.isVisible = false" [nzVisible]="sideBar.isVisible" nzPlacement="right">
  <ng-container *nzDrawerContent>
    <div (click)="sideBar.isVisible = false" class="close-btn"></div>
    <div class="p-l-sm p-r-sm">
      <app-order-list-sidebar #orderView [isSingleWorkflow]="!sideBar.state" [loading]="sideBar.loading" [orderPreparation]="sideBar.orderPreparation"
                              [orders]="sideBar.orders" [permission]="permission"
                              [preferences]="preferences" [schedulerId]="schedulerIds.selected"></app-order-list-sidebar>
    </div>
  </ng-container>
</nz-drawer>
<nz-drawer (nzOnClose)="closeSearch()" [nzVisible]="isSearchVisible" nzPlacement="right">
  <ng-container *nzDrawerContent>
    <div (click)="closeSearch()" class="close-btn"></div>
    <i (click)="helpPage('workflows-search')" [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'common.tooltip.help' | translate" class="help-info cur-point fa fa-info-circle text-20"></i>
    @if (isSearchVisible) {
      <div>
        <div class="text-center m-b-sm text"><span class="_600 b-b p-b-sm m-l-sm" translate>inventory.search.label.searchHeading</span>
        </div>
        <app-inventory-search (onCancel)="closeSearch()" (onNavigate)="onNavigate($event)" [controllerId]="schedulerIds.selected"
                              [isWorkflow]="true"></app-inventory-search>
      </div>
    }
  </ng-container>
</nz-drawer>
@if ((loading && pageView === 'grid') || !isLoading) {
  <div class="spinner">
    <div class="cssload-inner cssload-one"></div>
    <div class="cssload-inner cssload-two"></div>
    <div class="cssload-inner cssload-three"></div>
  </div>
}
@if (loading || reloadState == 'yes') {
  <div>
    <div (click)="reload()" class="bottom-btn">
      @if (reloadState == 'no') {
        <i class="fa fa-times"></i>
      }
      @if (reloadState == 'yes') {
        <i class="fa fa-refresh"></i>
      }
    </div>
  </div>
}
