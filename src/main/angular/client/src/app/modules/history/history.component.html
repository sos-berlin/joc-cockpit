<div class="white box-shadow sub-header">
  <div class="row">
    <div class="col-md-12">
      <div class="padding p-b-sm">
        <div class="text-right ">
          <div class="pull-left">
            <app-breadcrumbs></app-breadcrumbs>
          </div>
          <i (click)="helpPage()" [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'common.tooltip.help' | translate" class="help-info-common cur-point fa fa-info-circle text-20"></i>
          <div class="inline valign">
            <label [(ngModel)]="historyFilters.current" nz-checkbox (ngModelChange)="changeController()" >
              {{'common.label.currentController' | translate}}
            </label>
          </div>
          <div [ngClass]="{'show-block':historyFilters.type == 'ORDER'}" class="hide">
            <div class="btn-group m-l-12 hidden-btn-group">
              <button (click)="loadHistory('STATE','ALL')" [disabled]="savedHistoryFilter.selected"
                      [ngClass]="{'btn-primary': order.filter.historyStates=='ALL'}"
                      class="btn btn-grey btn-sm button-group-ellipsis" translate>common.button.allStatus
              </button>
              <button (click)="loadHistory('STATE','SUCCESSFUL')" [disabled]="savedHistoryFilter.selected"
                      [ngClass]="{'btn-primary': order.filter.historyStates=='SUCCESSFUL'}"
                      class="btn btn-grey btn-sm button-group-ellipsis" translate>
                common.button.successful
              </button>
              <button (click)="loadHistory('STATE','FAILED')" [disabled]="savedHistoryFilter.selected"
                      [ngClass]="{'btn-primary': order.filter.historyStates=='FAILED'}"
                      class="btn btn-grey btn-sm button-group-ellipsis" translate>common.button.failed
              </button>
              <button (click)="loadHistory('STATE','INCOMPLETE')" [disabled]="savedHistoryFilter.selected"
                      [ngClass]="{'btn-primary': order.filter.historyStates=='INCOMPLETE'}"
                      class="btn btn-grey btn-sm button-group-ellipsis" translate>
                common.button.incomplete
              </button>
            </div>
            <div class="btn-group dropdown hidden-dropdown">
              <button [nzDropdownMenu]="state" [nzPlacement]="'bottomRight'" class="btn btn-grey btn-sm m-l-12" nz-dropdown
                      nzTrigger="click" translate>common.label.state
                <i class="caretDownIcon" nz-icon nzTheme="outline" nzType="caret-down"></i>
              </button>
              <nz-dropdown-menu #state="nzDropdownMenu">
                <ul nz-menu>
                  <li (click)="loadHistory('STATE','ALL')" [ngClass]="{'ant-select-dropdown-menu-item-active': order.filter.historyStates=='ALL', 'disable-link':savedHistoryFilter.selected}"
                      nz-menu-item>
                    <a translate>common.button.allStatus</a>
                  </li>
                  <li (click)="loadHistory('STATE','SUCCESSFUL')" [ngClass]="{'ant-select-dropdown-menu-item-active': order.filter.historyStates=='SUCCESSFUL', 'disable-link':savedHistoryFilter.selected}"
                      nz-menu-item>
                    <a translate>common.button.successful</a>
                  </li>
                  <li (click)="loadHistory('STATE','FAILED')" [ngClass]="{'ant-select-dropdown-menu-item-active': order.filter.historyStates=='FAILED', 'disable-link':savedHistoryFilter.selected}"
                      nz-menu-item>
                    <a translate>common.button.failed</a>
                  </li>
                  <li (click)="loadHistory('STATE','INCOMPLETE')" [ngClass]="{'ant-select-dropdown-menu-item-active': order.filter.historyStates=='INCOMPLETE', 'disable-link':savedHistoryFilter.selected}"
                      nz-menu-item>
                    <a translate>common.button.incomplete</a>
                  </li>
                </ul>
              </nz-dropdown-menu>
            </div>
          </div>
          @if (historyFilters.type == 'ORDER') {
            <div class="inline m-b-xs">
              <div class="btn-group m-l-12 hidden-btn-group">
                @for (btn of filterBtn; track btn) {
                  <button (click)="loadHistory('DATE', btn.date)" [disabled]="savedHistoryFilter.selected"
                          [ngClass]="{'btn-primary': order.filter.date===btn.date}"
                          class="btn btn-grey btn-sm button-group-ellipsis" translate>filters.button.{{btn.text}}
                  </button>
                }
              </div>
              <div class="btn-group dropdown hidden-dropdown">
                <button [nzDropdownMenu]="anyDate" [nzPlacement]="'bottomRight'" class="btn btn-grey btn-sm m-l-12" nz-dropdown
                        nzTrigger="click" translate type="button">
                  common.label.anyDate
                  <i class="caretDownIcon" nz-icon nzTheme="outline" nzType="caret-down"></i>
                </button>
                <nz-dropdown-menu #anyDate="nzDropdownMenu">
                  <ul nz-menu>
                    @for (btn of filterBtn; track btn) {
                      <li (click)="loadHistory('DATE',btn.date)" [ngClass]="{'ant-select-dropdown-menu-item-active': order.filter.date==btn.date, 'disable-link':savedHistoryFilter.selected}"
                          nz-menu-item>
                        <a translate>filters.button.{{btn.text}}</a>
                      </li>
                    }
                  </ul>
                </nz-dropdown-menu>
              </div>
              @if (permission.joc && permission.joc.administration.customization.view) {
                <div class="btn-group dropdown">
                  <button [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="selectedFiltered1.account" [nzDropdownMenu]="customization" [nzPlacement]="'bottomRight'"
                          class="btn btn-grey btn-sm m-l-12" nz-dropdown nzTrigger="click" translate
                          type="button">{{'customization.label.customizations' | translate}}
                    <span [innerHtml]="selectedFiltered1.name" class="text-primary"></span>
                    <i class="caretDownIcon" nz-icon nzTheme="outline" nzType="caret-down"></i>
                  </button>
                  <nz-dropdown-menu #customization="nzDropdownMenu">
                    <ul nz-menu>
                      @if (permission.joc && permission.joc.administration.customization.manage) {
                        <li (click)="createCustomization()" nz-menu-item>
                          <a translate>customization.label.createCustomization</a>
                        </li>
                      }
                      @if (orderHistoryFilterList && orderHistoryFilterList.length>0) {
                        <li (click)="editFilters()" nz-menu-item>
                          <a translate>customization.label.editExistingCustomizations</a>
                        </li>
                      }
                      @if (orderHistoryFilterList && orderHistoryFilterList.length>0) {
                        <li nz-menu-divider></li>
                      }
                      @for (filter of orderHistoryFilterList | orderBy: 'name'; track filter) {
                        <li (click)="changeFilter(filter)"
                            [ngClass]="{'ant-select-dropdown-menu-item-active': (savedHistoryFilter.selected == filter.id)}"
                            nz-menu-item>
                          <a>
                            <span [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="filter.account">{{filter.name}}</span>
                            @if (savedHistoryFilter.selected == filter.id) {
                              <i (click)="changeFilter(null);$event.stopPropagation();"
                                 [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'customization.tooltip.deactivateCustomization' | translate"
                                 class="fa fa-times-circle-o remove"></i>
                            }
                          </a>
                        </li>
                      }
                    </ul>
                  </nz-dropdown-menu>
                </div>
              }
            </div>
          }
          <div [ngClass]="{'show-block':historyFilters.type == 'TASK'}" class="hide">
            <div class="btn-group m-l-12 hidden-btn-group">
              <button (click)="loadHistory('STATE','ALL')" [disabled]="savedJobHistoryFilter.selected"
                      [ngClass]="{'btn-primary': task.filter.historyStates=='ALL'}"
                      class="btn btn-grey btn-sm button-group-ellipsis" translate>common.button.allStatus
              </button>
              <button (click)="loadHistory('STATE','SUCCESSFUL')" [disabled]="savedJobHistoryFilter.selected"
                      [ngClass]="{'btn-primary': task.filter.historyStates=='SUCCESSFUL'}"
                      class="btn btn-grey btn-sm button-group-ellipsis" translate>
                common.button.successful
              </button>
              <button (click)="loadHistory('STATE','FAILED')" [disabled]="savedJobHistoryFilter.selected"
                      [ngClass]="{'btn-primary': task.filter.historyStates=='FAILED'}"
                      class="btn btn-grey btn-sm button-group-ellipsis" translate>common.button.failed
              </button>
              <button (click)="loadHistory('STATE','INCOMPLETE')" [disabled]="savedJobHistoryFilter.selected"
                      [ngClass]="{'btn-primary': task.filter.historyStates=='INCOMPLETE'}"
                      class="btn btn-grey btn-sm button-group-ellipsis" translate>
                common.button.incomplete
              </button>
            </div>
            <div class="btn-group dropdown hidden-dropdown">
              <button [nzDropdownMenu]="state2" [nzPlacement]="'bottomRight'" class="btn btn-grey btn-sm m-l-12" nz-dropdown
                      nzTrigger="click" translate>common.label.state
                <i class="caretDownIcon" nz-icon nzTheme="outline" nzType="caret-down"></i>
              </button>
              <nz-dropdown-menu #state2="nzDropdownMenu">
                <ul nz-menu>
                  <li (click)="loadHistory('STATE','ALL')" [ngClass]="{'ant-select-dropdown-menu-item-active': task.filter.historyStates=='ALL', 'disable-link':savedJobHistoryFilter.selected}"
                      nz-menu-item>
                    <a translate>common.button.allStatus</a>
                  </li>
                  <li (click)="loadHistory('STATE','SUCCESSFUL')" [ngClass]="{'ant-select-dropdown-menu-item-active': task.filter.historyStates=='SUCCESSFUL', 'disable-link':savedJobHistoryFilter.selected}"
                      nz-menu-item>
                    <a translate>common.button.successful</a>
                  </li>
                  <li (click)="loadHistory('STATE','FAILED')" [ngClass]="{'ant-select-dropdown-menu-item-active': task.filter.historyStates=='FAILED', 'disable-link':savedJobHistoryFilter.selected}"
                      nz-menu-item>
                    <a translate>common.button.failed</a>
                  </li>
                  <li (click)="loadHistory('STATE','INCOMPLETE')" [ngClass]="{'ant-select-dropdown-menu-item-active': task.filter.historyStates=='INCOMPLETE', 'disable-link':savedJobHistoryFilter.selected}"
                      nz-menu-item>
                    <a translate>common.button.incomplete</a>
                  </li>
                </ul>
              </nz-dropdown-menu>
            </div>
          </div>
          @if (historyFilters.type == 'TASK') {
            <div class="inline m-b-xs">
              <div class="btn-group m-l-12 hidden-btn-group">
                @for (btn of filterBtn; track btn) {
                  <button (click)="loadHistory('DATE', btn.date)" [disabled]="savedJobHistoryFilter.selected"
                          [ngClass]="{'btn-primary': task.filter.date===btn.date}"
                          class="btn btn-grey btn-sm button-group-ellipsis" translate>filters.button.{{btn.text}}
                  </button>
                }
              </div>
              <div class="btn-group dropdown hidden-dropdown">
                <button [nzDropdownMenu]="anyDate2" [nzPlacement]="'bottomRight'" class="btn btn-grey btn-sm m-l-12" nz-dropdown
                        nzTrigger="click" translate type="button">
                  common.label.anyDate
                  <i class="caretDownIcon" nz-icon nzTheme="outline" nzType="caret-down"></i>
                </button>
                <nz-dropdown-menu #anyDate2="nzDropdownMenu">
                  <ul nz-menu>
                    @for (btn of filterBtn; track btn) {
                      <li (click)="loadHistory('DATE',btn.date)" [ngClass]="{'ant-select-dropdown-menu-item-active': task.filter.date==btn.date, 'disable-link':savedJobHistoryFilter.selected}"
                          nz-menu-item>
                        <a translate>filters.button.{{btn.text}}</a>
                      </li>
                    }
                  </ul>
                </nz-dropdown-menu>
              </div>
              @if (permission.joc && permission.joc.administration.customization.view) {
                <div class="btn-group dropdown">
                  <button [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="selectedFiltered2.account" [nzDropdownMenu]="customization2" [nzPlacement]="'bottomRight'"
                          class="btn btn-grey btn-sm m-l-12" nz-dropdown nzTrigger="click" translate
                          type="button">
                    {{'customization.label.customizations' | translate}} <span [innerHtml]="selectedFiltered2.name"
                                                                               class="text-primary"></span>
                    <i class="caretDownIcon" nz-icon nzTheme="outline" nzType="caret-down"></i>
                  </button>
                  <nz-dropdown-menu #customization2="nzDropdownMenu">
                    <ul nz-menu>
                      @if (permission.joc && permission.joc.administration.customization.manage) {
                        <li (click)="createCustomization()" nz-menu-item>
                          <a translate>customization.label.createCustomization</a>
                        </li>
                      }
                      @if (jobHistoryFilterList && jobHistoryFilterList.length>0) {
                        <li (click)="editFilters()" nz-menu-item>
                          <a translate>customization.label.editExistingCustomizations</a>
                        </li>
                      }
                      @if (jobHistoryFilterList && jobHistoryFilterList.length>0) {
                        <li nz-menu-divider></li>
                      }
                      @for (filter of jobHistoryFilterList | orderBy: 'name'; track filter) {
                        <li (click)="changeFilter(filter)"
                            [ngClass]="{'ant-select-dropdown-menu-item-active': (savedJobHistoryFilter.selected == filter.id)}"
                            nz-menu-item>
                          <a>
                            <span [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="filter.account">{{filter.name}}</span>
                            @if (savedJobHistoryFilter.selected == filter.id) {
                              <i (click)="changeFilter(null);$event.stopPropagation();"
                                 [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'customization.tooltip.deactivateCustomization' | translate"
                                 class="fa fa-times-circle-o remove"></i>
                            }
                          </a>
                        </li>
                      }
                    </ul>
                  </nz-dropdown-menu>
                </div>
              }
            </div>
          }
          <div [ngClass]="{'show-block':historyFilters.type == 'YADE'}" class="hide">
            <div class="btn-group m-l-12 hidden-btn-group">
              <button (click)="loadHistory('STATE','ALL')" [disabled]="savedYadeHistoryFilter.selected"
                      [ngClass]="{'btn-primary': yade.filter.states=='ALL'}"
                      class="btn btn-grey btn-sm button-group-ellipsis" translate>common.button.allStatus
              </button>
              <button (click)="loadHistory('STATE','SUCCESSFUL')" [disabled]="savedYadeHistoryFilter.selected"
                      [ngClass]="{'btn-primary': yade.filter.states=='SUCCESSFUL'}"
                      class="btn btn-grey btn-sm button-group-ellipsis" translate>common.button.successful
              </button>
              <button (click)="loadHistory('STATE','FAILED')" [disabled]="savedYadeHistoryFilter.selected"
                      [ngClass]="{'btn-primary': yade.filter.states=='FAILED'}"
                      class="btn btn-grey btn-sm button-group-ellipsis" translate>common.button.failed
              </button>
              <button (click)="loadHistory('STATE','INCOMPLETE')" [disabled]="savedYadeHistoryFilter.selected"
                      [ngClass]="{'btn-primary': yade.filter.states=='INCOMPLETE'}"
                      class="btn btn-grey btn-sm button-group-ellipsis" translate>common.button.incomplete
              </button>
            </div>
            <div class="btn-group dropdown hidden-dropdown">
              <button [nzDropdownMenu]="state3" [nzPlacement]="'bottomRight'" class="btn btn-grey btn-sm m-l-12" nz-dropdown
                      nzTrigger="click" translate>label.state
                <i class="caretDownIcon" nz-icon nzTheme="outline" nzType="caret-down"></i>
              </button>
              <nz-dropdown-menu #state3="nzDropdownMenu">
                <ul nz-menu>
                  <li (click)="loadHistory('STATE','ALL')" [ngClass]="{'ant-select-dropdown-menu-item-active': yade.filter.states=='ALL', 'disable-link':savedYadeHistoryFilter.selected}"
                      nz-menu-item>
                    <a translate>common.button.allStatus</a>
                  </li>
                  <li (click)="loadHistory('STATE','SUCCESSFUL')" [ngClass]="{'ant-select-dropdown-menu-item-active':yade.filter.states=='SUCCESSFUL', 'disable-link':savedYadeHistoryFilter.selected}"
                      nz-menu-item>
                    <a translate>common.button.successful</a>
                  </li>
                  <li (click)="loadHistory('STATE','FAILED')" [ngClass]="{'ant-select-dropdown-menu-item-active': yade.filter.states=='FAILED', 'disable-link':savedYadeHistoryFilter.selected}"
                      nz-menu-item>
                    <a translate>common.button.failed</a>
                  </li>
                  <li (click)="loadHistory('STATE','INCOMPLETE')" [ngClass]="{'ant-select-dropdown-menu-item-active': yade.filter.states=='INCOMPLETE', 'disable-link':savedYadeHistoryFilter.selected}"
                      nz-menu-item>
                    <a translate>common.button.incomplete</a>
                  </li>
                </ul>
              </nz-dropdown-menu>
            </div>
            <div class="btn-group m-l-12 hidden-btn-group">
              @for (btn of filterBtn; track btn) {
                <button (click)="loadHistory('DATE', btn.date)" [disabled]="savedYadeHistoryFilter.selected"
                        [ngClass]="{'btn-primary': yade.filter.date===btn.date}"
                        class="btn btn-grey btn-sm button-group-ellipsis" translate>filters.button.{{btn.text}}
                </button>
              }
            </div>
            <div class="btn-group dropdown hidden-dropdown">
              <button [nzDropdownMenu]="anyDate" [nzPlacement]="'bottomRight'" class="btn btn-grey btn-sm m-l-12" nz-dropdown
                      nzTrigger="click" translate type="button">
                common.label.anyDate
                <i class="caretDownIcon" nz-icon nzTheme="outline" nzType="caret-down"></i>
              </button>
              <nz-dropdown-menu #anyDate="nzDropdownMenu">
                <ul nz-menu>
                  @for (btn of filterBtn; track btn) {
                    <li (click)="loadHistory('DATE',btn.date)" [ngClass]="{'ant-select-dropdown-menu-item-active': yade.filter.date==btn.date, 'disable-link':savedYadeHistoryFilter.selected}"
                        nz-menu-item>
                      <a translate>filters.button.{{btn.text}}</a>
                    </li>
                  }
                </ul>
              </nz-dropdown-menu>
            </div>
          </div>
          @if (historyFilters.type == 'YADE') {
            <div class="inline m-b-xs">
              @if (permission.joc && permission.joc.administration.customization.view) {
                <div class="btn-group dropdown">
                  <button [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="selectedFiltered3.account" [nzDropdownMenu]="customization3" [nzPlacement]="'bottomRight'"
                          class="btn btn-grey btn-sm m-l-12" nz-dropdown nzTrigger="click" translate
                          type="button">
                    {{'customization.label.customizations' | translate}} <span [innerHtml]="selectedFiltered3.name"
                                                                               class="text-primary"></span>
                    <i class="caretDownIcon" nz-icon nzTheme="outline" nzType="caret-down"></i>
                  </button>
                  <nz-dropdown-menu #customization3="nzDropdownMenu">
                    <ul nz-menu>
                      @if (permission.joc && permission.joc.administration.customization.manage) {
                        <li (click)="createCustomization()" nz-menu-item>
                          <a translate>customization.label.createCustomization</a>
                        </li>
                      }
                      @if (yadeHistoryFilterList && yadeHistoryFilterList.length>0) {
                        <li (click)="editFilters()" nz-menu-item>
                          <a translate>customization.label.editExistingCustomizations</a>
                        </li>
                      }
                      @if (yadeHistoryFilterList && yadeHistoryFilterList.length>0) {
                        <li nz-menu-divider></li>
                      }
                      @for (filter of yadeHistoryFilterList | orderBy: 'name'; track filter) {
                        <li (click)="changeFilter(filter)"
                            [ngClass]="{'ant-select-dropdown-menu-item-active': (savedYadeHistoryFilter.selected == filter.id)}"
                            nz-menu-item>
                          <a>
                            <span [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="filter.account">{{filter.name}}</span>
                            @if (savedYadeHistoryFilter.selected == filter.id) {
                              <i (click)="changeFilter(null);$event.stopPropagation();"
                                 [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'customization.tooltip.deactivateCustomization' | translate"
                                 class="fa fa-times-circle-o remove"></i>
                            }
                          </a>
                        </li>
                      }
                    </ul>
                  </nz-dropdown-menu>
                </div>
              }
            </div>
          }
          <div [ngClass]="{'show-block':historyFilters.type == 'DEPLOYMENT'}" class="hide">
            <div class="btn-group m-l-12 hidden-btn-group">
              <button (click)="loadHistory('STATE','ALL')"
                      [disabled]="savedDeploymentHistoryFilter.selected"
                      [ngClass]="{'btn-primary': deployment.filter.state=='ALL'}"
                      class="btn btn-grey btn-sm button-group-ellipsis" translate>history.button.allState
              </button>
              <button (click)="loadHistory('STATE','DEPLOYED')"
                      [disabled]="savedDeploymentHistoryFilter.selected"
                      [ngClass]="{'btn-primary': deployment.filter.state=='DEPLOYED'}"
                      class="btn btn-grey btn-sm button-group-ellipsis" translate>history.button.deployed
              </button>
              <button (click)="loadHistory('STATE','NOT_DEPLOYED')"
                      [disabled]="savedDeploymentHistoryFilter.selected"
                      [ngClass]="{'btn-primary': deployment.filter.state=='NOT_DEPLOYED'}"
                      class="btn btn-grey btn-sm button-group-ellipsis" translate>
                history.button.notDeployed
              </button>
            </div>
            <div class="btn-group dropdown hidden-dropdown">
              <button [nzDropdownMenu]="state" [nzPlacement]="'bottomRight'" class="btn btn-grey btn-sm m-l-12" nz-dropdown
                      nzTrigger="click" translate>common.label.state
                <i class="caretDownIcon" nz-icon nzTheme="outline" nzType="caret-down"></i>
              </button>
              <nz-dropdown-menu #state="nzDropdownMenu">
                <ul nz-menu>
                  <li (click)="loadHistory('STATE','ALL')" [ngClass]="{'ant-select-dropdown-menu-item-active': deployment.filter.state=='ALL', 'disable-link':savedDeploymentHistoryFilter.selected}"
                      nz-menu-item>
                    <a translate>history.button.allState</a>
                  </li>
                  <li (click)="loadHistory('STATE','DEPLOYED')" [ngClass]="{'ant-select-dropdown-menu-item-active': deployment.filter.state=='DEPLOYED', 'disable-link':savedDeploymentHistoryFilter.selected}"
                      nz-menu-item>
                    <a translate>history.button.deployed</a>
                  </li>
                  <li (click)="loadHistory('STATE','NOT_DEPLOYED')" [ngClass]="{'ant-select-dropdown-menu-item-active': deployment.filter.state=='NOT_DEPLOYED', 'disable-link':savedDeploymentHistoryFilter.selected}"
                      nz-menu-item>
                    <a translate>history.button.notDeployed</a>
                  </li>
                </ul>
              </nz-dropdown-menu>
            </div>
          </div>
          @if (historyFilters.type == 'DEPLOYMENT') {
            <div class="inline m-b-xs">
              <div class="btn-group m-l-12 hidden-btn-group">
                @for (btn of filterBtn; track btn) {
                  <button (click)="loadHistory('DATE', btn.date)"
                          [disabled]="savedDeploymentHistoryFilter.selected"
                          [ngClass]="{'btn-primary': deployment.filter.date===btn.date}"
                          class="btn btn-grey btn-sm button-group-ellipsis" translate>filters.button.{{btn.text}}
                  </button>
                }
              </div>
              <div class="btn-group dropdown hidden-dropdown">
                <button [nzDropdownMenu]="anyDate" [nzPlacement]="'bottomRight'" class="btn btn-grey btn-sm m-l-12" nz-dropdown
                        nzTrigger="click" translate type="button">
                  common.label.anyDate
                  <i class="caretDownIcon" nz-icon nzTheme="outline" nzType="caret-down"></i>
                </button>
                <nz-dropdown-menu #anyDate="nzDropdownMenu">
                  <ul nz-menu>
                    @for (btn of filterBtn; track btn) {
                      <li (click)="loadHistory('DATE',btn.date)" [ngClass]="{'ant-select-dropdown-menu-item-active': deployment.filter.date==btn.date, 'disable-link':savedDeploymentHistoryFilter.selected}"
                          nz-menu-item>
                        <a translate>filters.button.{{btn.text}}</a>
                      </li>
                    }
                  </ul>
                </nz-dropdown-menu>
              </div>
              @if (permission.joc && permission.joc.administration.customization.view) {
                <div class="btn-group dropdown">
                  <button [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="selectedFiltered4.account" [nzDropdownMenu]="customization" [nzPlacement]="'bottomRight'"
                          class="btn btn-grey btn-sm m-l-12" nz-dropdown nzTrigger="click" translate
                          type="button">
                    {{'customization.label.customizations' | translate}} <span [innerHtml]="selectedFiltered4.name"
                                                                               class="text-primary"></span>
                    <i class="caretDownIcon" nz-icon nzTheme="outline" nzType="caret-down"></i>
                  </button>
                  <nz-dropdown-menu #customization="nzDropdownMenu">
                    <ul nz-menu>
                      @if (permission.joc && permission.joc.administration.customization.manage) {
                        <li (click)="createCustomization()" nz-menu-item>
                          <a translate>customization.label.createCustomization</a>
                        </li>
                      }
                      @if (deploymentHistoryFilterList && deploymentHistoryFilterList.length>0) {
                        <li (click)="editFilters()" nz-menu-item>
                          <a translate>customization.label.editExistingCustomizations</a>
                        </li>
                      }
                      @if (deploymentHistoryFilterList && deploymentHistoryFilterList.length>0) {
                        <li nz-menu-divider></li>
                      }
                      @for (filter of deploymentHistoryFilterList | orderBy: 'name'; track filter) {
                        <li (click)="changeFilter(filter)"
                            [ngClass]="{'ant-select-dropdown-menu-item-active': (savedDeploymentHistoryFilter.selected == filter.id)}"
                            nz-menu-item>
                          <a>
                            <span [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="filter.account">{{filter.name}}</span>
                            @if (savedDeploymentHistoryFilter.selected == filter.id) {
                              <i (click)="changeFilter(null);$event.stopPropagation();"
                                 [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'customization.tooltip.deactivateCustomization' | translate"
                                 class="fa fa-times-circle-o remove"></i>
                            }
                          </a>
                        </li>
                      }
                    </ul>
                  </nz-dropdown-menu>
                </div>
              }
            </div>
          }
          <div [ngClass]="{'show-block':historyFilters.type == 'SUBMISSION'}" class="hide">
            <div class="btn-group m-l-12 hidden-btn-group">
              <button (click)="loadHistory('CATEGORY','ALL')"
                      [disabled]="savedSubmissionHistoryFilter.selected"
                      [ngClass]="{'btn-primary': submission.filter.category=='ALL'}"
                      class="btn btn-grey btn-sm button-group-ellipsis" translate>common.button.all
              </button>
              <button (click)="loadHistory('CATEGORY','SUBMITTED')"
                      [disabled]="savedSubmissionHistoryFilter.selected"
                      [ngClass]="{'btn-primary': submission.filter.category=='SUBMITTED'}"
                      class="btn btn-grey btn-sm button-group-ellipsis" translate>
                history.button.submitted
              </button>
              <button (click)="loadHistory('CATEGORY','NOT_SUBMITTED')"
                      [disabled]="savedSubmissionHistoryFilter.selected"
                      [ngClass]="{'btn-primary': submission.filter.category=='NOT_SUBMITTED'}"
                      class="btn btn-grey btn-sm button-group-ellipsis" translate>
                history.button.notSubmitted
              </button>
            </div>
            <div class="btn-group dropdown hidden-dropdown">
              <button [nzDropdownMenu]="state2" [nzPlacement]="'bottomRight'" class="btn btn-grey btn-sm m-l-12" nz-dropdown
                      nzTrigger="click" translate>common.label.type
                <i class="caretDownIcon" nz-icon nzTheme="outline" nzType="caret-down"></i>
              </button>
              <nz-dropdown-menu #state2="nzDropdownMenu">
                <ul nz-menu>
                  <li (click)="loadHistory('CATEGORY','ALL')" [ngClass]="{'ant-select-dropdown-menu-item-active': submission.filter.category=='ALL', 'disable-link':savedSubmissionHistoryFilter.selected}"
                      nz-menu-item>
                    <a translate>common.button.all</a>
                  </li>
                  <li (click)="loadHistory('CATEGORY','SUBMITTED')" [ngClass]="{'ant-select-dropdown-menu-item-active': submission.filter.category=='SUBMITTED', 'disable-link':savedSubmissionHistoryFilter.selected}"
                      nz-menu-item>
                    <a translate>history.button.submitted</a>
                  </li>
                  <li (click)="loadHistory('CATEGORY','NOT_SUBMITTED')" [ngClass]="{'ant-select-dropdown-menu-item-active': submission.filter.category=='NOT_SUBMITTED', 'disable-link':savedSubmissionHistoryFilter.selected}"
                      nz-menu-item>
                    <a translate>history.button.notSubmitted</a>
                  </li>
                </ul>
              </nz-dropdown-menu>
            </div>
          </div>
          @if (historyFilters.type == 'SUBMISSION') {
            <div class="inline m-b-xs">
              <div class="btn-group m-l-12 hidden-btn-group">
                @for (btn of subMissionFilterBtn; track btn) {
                  <button (click)="loadHistory('DATE', btn.date)"
                          [disabled]="savedSubmissionHistoryFilter.selected"
                          [ngClass]="{'btn-primary': submission.filter.date===btn.date}"
                          class="btn btn-grey btn-sm button-group-ellipsis" translate>filters.button.{{btn.text}}
                  </button>
                }
              </div>
              <div class="btn-group dropdown hidden-dropdown">
                <button [nzDropdownMenu]="anyDate" [nzPlacement]="'bottomRight'" class="btn btn-grey btn-sm m-l-12" nz-dropdown
                        nzTrigger="click" translate type="button">
                  common.label.anyDate
                  <i class="caretDownIcon" nz-icon nzTheme="outline" nzType="caret-down"></i>
                </button>
                <nz-dropdown-menu #anyDate="nzDropdownMenu">
                  <ul nz-menu>
                    @for (btn of subMissionFilterBtn; track btn) {
                      <li (click)="loadHistory('DATE',btn.date)" [ngClass]="{'ant-select-dropdown-menu-item-active': submission.filter.date==btn.date, 'disable-link':savedSubmissionHistoryFilter.selected}"
                          nz-menu-item>
                        <a translate>filters.button.{{btn.text}}</a>
                      </li>
                    }
                  </ul>
                </nz-dropdown-menu>
              </div>
              @if (permission.joc && permission.joc.administration.customization.view) {
                <div class="btn-group dropdown">
                  <button [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="selectedFiltered5.account" [nzDropdownMenu]="customization" [nzPlacement]="'bottomRight'"
                          class="btn btn-grey btn-sm m-l-12" nz-dropdown nzTrigger="click" translate
                          type="button">
                    {{'customization.label.customizations' | translate}} <span [innerHtml]="selectedFiltered5.name"
                                                                               class="text-primary"></span>
                    <i class="caretDownIcon" nz-icon nzTheme="outline" nzType="caret-down"></i>
                  </button>
                  <nz-dropdown-menu #customization="nzDropdownMenu">
                    <ul nz-menu>
                      @if (permission.joc && permission.joc.administration.customization.manage) {
                        <li (click)="createCustomization()" nz-menu-item>
                          <a translate>customization.label.createCustomization</a>
                        </li>
                      }
                      @if (submissionHistoryFilterList && submissionHistoryFilterList.length>0) {
                        <li (click)="editFilters()" nz-menu-item>
                          <a translate>customization.label.editExistingCustomizations</a>
                        </li>
                      }
                      @if (submissionHistoryFilterList && submissionHistoryFilterList.length>0) {
                        <li nz-menu-divider></li>
                      }
                      @for (filter of submissionHistoryFilterList | orderBy: 'name'; track filter) {
                        <li (click)="changeFilter(filter)"
                            [ngClass]="{'ant-select-dropdown-menu-item-active': (savedSubmissionHistoryFilter.selected == filter.id)}"
                            nz-menu-item>
                          <a>
                            <span [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="filter.account">{{filter.name}}</span>
                            @if (savedSubmissionHistoryFilter.selected == filter.id) {
                              <i (click)="changeFilter(null);$event.stopPropagation();"
                                 [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'customization.tooltip.deactivateCustomization' | translate"
                                 class="fa fa-times-circle-o remove"></i>
                            }
                          </a>
                        </li>
                      }
                    </ul>
                  </nz-dropdown-menu>
                </div>
              }
            </div>
          }
          @if (historyFilters.type === 'ORDER' || historyFilters.type === 'TASK') {
            <div class="btn-group dropdown">
              <button [nzDropdownMenu]="ignoreList" [nzPlacement]="'bottomRight'" class="btn btn-grey btn-sm m-l-12" nz-dropdown
                      nzTrigger="click">
                {{'history.label.ignoreList' | translate}}
                @if (savedIgnoreList.isEnable) {
                  <span [innerHtml]="'history.label.active' | translate" class="text-primary"></span>
                }
                <i class="caretDownIcon" nz-icon nzTheme="outline" nzType="caret-down"></i>
              </button>
              <nz-dropdown-menu #ignoreList="nzDropdownMenu">
                <ul nz-menu>
                  @if (savedIgnoreList.workflows.length > 0 && historyFilters.type == 'ORDER') {
                    <li (click)="editIgnoreList()" nz-menu-item>
                      <a translate>history.button.editIgnoreList</a>
                    </li>
                  }
                  @if (savedIgnoreList.jobs.length > 0 && historyFilters.type == 'TASK') {
                    <li (click)="editIgnoreList()" nz-menu-item>
                      <a translate>history.button.editIgnoreList</a>
                    </li>
                  }
                  @if (!savedIgnoreList.isEnable) {
                    <li (click)="enableDisableIgnoreList()" nz-menu-item>
                      <a translate>history.button.enableIgnoreList</a>
                    </li>
                  }
                  @if (savedIgnoreList.isEnable) {
                    <li (click)="enableDisableIgnoreList()" nz-menu-item>
                      <a translate>history.button.disableIgnoreList</a>
                    </li>
                  }
                  <li (click)="resetIgnoreList()" nz-menu-item>
                    <a translate>history.button.resetIgnoreList</a>
                  </li>
                </ul>
              </nz-dropdown-menu>
            </div>
          }
          <button (click)="exportToExcel()" [disabled]="data.length === 0"
                  [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'common.tooltip.exportInXLS' | translate"
                  class="btn btn-grey btn-sm m-l-12"><i class="fa fa fa-share-square-o"></i></button>
        </div>
      </div>
    </div>
  </div>
</div>
<div [ngClass]="showSearchPanel && historyFilters.type !== 'ORDER' && historyFilters.type !== 'TASK' ? 'scroll-y max-ht2' : ''">
  <div class="padding p-b-0">
    <div class="row m-b-12 m-t-xs">
      <div class="col-md-6 col-sm-6">
        <ul class="nav navbar-nav navbar-nav-inline nav-active-border nav-active-border2 b-primary">
          @if (permission.currentController && permission.currentController.orders.view) {
            <li class="nav-item">
              <a (click)="orderHistory(null,false)" [ngClass]="{'active': historyFilters.type=='ORDER'}" class="nav-link">
                <span class="nav-text text-dark p-b-sm"><span class="text" translate>history.tab.orders</span></span>
              </a>
            </li>
          }
          @if (permission.currentController && permission.currentController.orders.view) {
            <li class="nav-item dropdown-separator">
              <span class="separator"></span>
            </li>
          }
          @if (permission.currentController && permission.currentController.orders.view) {
            <li class="nav-item">
              <a (click)="taskHistory(null, false)" [ngClass]="{'active': historyFilters.type=='TASK'}" class="nav-link">
                <span class="nav-text text-dark p-b-sm"><span class="text" translate>history.tab.tasks</span></span>
              </a>
            </li>
          }
          @if (permission.currentController && permission.joc.fileTransfer.view && permission.currentController.orders.view) {
            <li class="nav-item dropdown-separator">
              <span class="separator"></span>
            </li>
          }
          @if (permission.currentController && permission.joc.fileTransfer.view) {
            <li class="nav-item">
              <a (click)="yadeHistory(null, false)" [ngClass]="{'active': historyFilters.type=='YADE'}" class="nav-link">
            <span class="nav-text text-dark p-b-sm"><span class="text"
                                                          translate>history.tab.fileTransfers</span></span>
              </a>
            </li>
          }
          @if (permission.currentController && permission.currentController.deployments.view && (permission.joc.fileTransfer.view || permission.currentController.orders.view)) {
            <li class="nav-item dropdown-separator">
              <span class="separator"></span>
            </li>
          }
          @if (permission.currentController && permission.currentController.deployments.view) {
            <li class="nav-item">
              <a (click)="deploymentHistory(null,false)" [ngClass]="{'active': historyFilters.type=='DEPLOYMENT'}"
                 class="nav-link">
                <span class="nav-text text-dark p-b-sm"><span class="text" translate>history.tab.deployments</span></span>
              </a>
            </li>
          }
          @if (permission.currentController && permission.joc.dailyPlan.view && (permission.currentController.deployments.view || permission.joc.fileTransfer.view || permission.currentController.orders.view)) {
            <li class="nav-item dropdown-separator">
              <span class="separator"></span>
            </li>
          }
          @if (permission.currentController && permission.joc.dailyPlan.view) {
            <li class="nav-item">
              <a (click)="submissionHistory(null, false)" [ngClass]="{'active': historyFilters.type=='SUBMISSION'}"
                 class="nav-link">
                <span class="nav-text text-dark p-b-sm"><span class="text" translate>history.tab.dailyPlan</span></span>
              </a>
            </li>
          }
        </ul>
      </div>
      <div class="col-md-6 col-sm-6">
        @if (historyFilters.type !== 'ORDER') {
          <button (click)="collapseDetails()"
                  class="btn btn-sm btn-grey m-l-12 pull-right" nz-tooltip="{{'common.tooltip.collapseDetails' | translate}}">
            <i class="fa fa-compress text"></i>
          </button>
        }
        @if (historyFilters.type !== 'ORDER') {
          <button (click)="expandDetails()"
                  class="btn btn-sm btn-grey m-l-12 pull-right" nz-tooltip="{{'common.tooltip.expandDetails' | translate}}">
            <i class="fa fa-expand text"></i>
          </button>
        }
        @if (!showSearchPanel) {
          <button (click)="advancedSearch()"
                  class="btn btn-sm inline pull-right m-l-12 btn-grey">
            <span translate>common.button.advancedSearch</span>
            <i class="fa fa-caret-down p-l-xs"></i>
          </button>
        }
        @if (showSearchPanel) {
          <button (click)="cancel()" class="btn btn-sm inline pull-right m-l-12 btn-grey">
            <span translate>common.button.advancedSearch</span>
            <i class="fa fa-caret-down p-l-xs"></i>
          </button>
        }
        <div class="search-box-field pull-right">
          <label>
            @if (historyFilters.type === 'ORDER') {
              <input (keyup)="searchInResult()" [(ngModel)]="order.searchText"
                     placeholder="{{'common.placeholder.search' | translate}}" type="search">
            }
          </label>
          @if (historyFilters.type === 'ORDER') {
            <i (click)="order.searchText = '';searchInResult()" [hidden]="!order.searchText"
               class="fa fa-times search-close"></i>
          }
          <label>
            @if (historyFilters.type === 'TASK') {
              <input (keyup)="searchInResult()" [(ngModel)]="task.searchText"
                     placeholder="{{'common.placeholder.search' | translate}}" type="search">
            }
          </label>
          @if (historyFilters.type === 'TASK') {
            <i (click)="task.searchText = '';searchInResult()" [hidden]="!task.searchText"
               class="fa fa-times search-close"></i>
          }
          <label>
            @if (historyFilters.type === 'YADE') {
              <input (keyup)="searchInResult()" [(ngModel)]="yade.searchText"
                     placeholder="{{'common.placeholder.search' | translate}}" type="search">
            }
          </label>
          @if (historyFilters.type === 'YADE') {
            <i (click)="yade.searchText = '';searchInResult()" [hidden]="!yade.searchText"
               class="fa fa-times search-close"></i>
          }
          <label>
            <label>
              @if (historyFilters.type === 'DEPLOYMENT') {
                <input (keyup)="searchInResult()" [(ngModel)]="deployment.searchText"
                       placeholder="{{'common.placeholder.search' | translate}}" type="search">
              }
            </label>
            @if (historyFilters.type === 'DEPLOYMENT') {
              <i (click)="deployment.searchText = '';searchInResult()" [hidden]="!deployment.searchText"
                 class="fa fa-times search-close"></i>
            }
            <label>
              @if (historyFilters.type === 'SUBMISSION') {
                <input (keyup)="searchInResult()" [(ngModel)]="submission.searchText"
                       placeholder="{{'common.placeholder.search' | translate}}" type="search">
              }
            </label>
            @if (historyFilters.type === 'SUBMISSION') {
              <i (click)="submission.searchText = '';searchInResult()" [hidden]="!submission.searchText"
                 class="fa fa-times search-close"></i>
            }
          </label>
        </div>
      </div>
    </div>
    @if (showSearchPanel && historyFilters.type !== 'ORDER' && historyFilters.type !== 'TASK') {
      <div class="row m-b">
        <div class="col-md-12">
          <div class="box p-a m-b-xs">
            @if (historyFilters.type === 'YADE') {
              <div>
                <app-file-transfer-form-template (onCancel)="cancel()" (onSearch)="search($event)"
                                                 [allFilter]="yadeHistoryFilterList"
                                                 [filter]="yadeSearch" [isHistory]="true"
                                                 [isSearch]="true"
                                                 [permission]="permission" [preferences]="preferences"
                                                 [schedulerIds]="schedulerIds"></app-file-transfer-form-template>
              </div>
            }
            @if (historyFilters.type === 'DEPLOYMENT') {
              <div>
                <app-deployment-form-template (onCancel)="cancel()" (onSearch)="search($event)"
                                              [allFilter]="deploymentHistoryFilterList"
                                              [filter]="deploymentSearch" [isSearch]="true"
                                              [permission]="permission" [preferences]="preferences"
                                              [schedulerIds]="schedulerIds"></app-deployment-form-template>
              </div>
            }
            @if (historyFilters.type === 'SUBMISSION') {
              <div>
                <app-submission-form-template (onCancel)="cancel()" (onSearch)="search($event)"
                                              [allFilter]="submissionHistoryFilterList"
                                              [filter]="submissionSearch" [isSearch]="true"
                                              [permission]="permission" [preferences]="preferences"
                                              [schedulerIds]="schedulerIds"></app-submission-form-template>
              </div>
            }
          </div>
        </div>
      </div>
    }

    <div class="row scroll-y max-ht2">
      <div class="col-sm-12">
        @if (historyFilters.type == 'ORDER' || historyFilters.type == 'TASK') {
          <div [sideView]="sideView.history" appResizable class="sticky leftPanel resource reports-tags" id="leftPanel">
            <div>
              <div class="editor-tree">
                <div class="pl-20" style="padding-right:20px">
                  <nz-tabset class="custom-tab" [nzAnimated]="false" [(nzSelectedIndex)]="historyFilters.selectedIndex" [nzType]="'line'">
                    <nz-tab class="ctm-pd" (nzClick)="switchToTagging('workflowTags');historyFilters.selectedIndex = 1;" [nzTitle]="workflowTagsTitle">
                      <ng-template #workflowTagsTitle>
                        <span>{{ 'inventory.tab.workflowTagging' | translate }}</span>
                      </ng-template>
                    </nz-tab>
                    <nz-tab class="ctm-pd" (nzClick)="switchToTagging('orderTags');historyFilters.selectedIndex = 2;" [nzTitle]="orderTagsTitle">
                      <ng-template #orderTagsTitle>
                        <span>{{ 'inventory.tab.orderTagging' | translate }}</span>
                      </ng-template>
                    </nz-tab>
                  </nz-tabset>
                </div>
                @if (historyFilters.tagType === 'workflowTags') {
                  <div class="pl-20">
                    <a (click)="objectTreeSearch()" class="tree-search workflow-tree-search">
                      <i [nzType]="'search'" nz-icon nzTheme="outline"></i>
                    </a>
                    <div>
                      <input (blur)="clearSearchInput()" (ngModelChange)="onSearchInput($event)"
                             [(ngModel)]="searchTag.text"
                             [nzAutocomplete]="auto" [placeholder]="'workflow.placeholder.findNode' | translate"
                             class="input-tree-search"
                             id="historyTagSearch"
                             nz-input
                      />

                      <i [nzType]="searchTag.loading ? 'loading' : 'search'" class="tree-search-icon" nz-icon nzTheme="outline"></i>
                      <nz-autocomplete #auto>
                        @for (tag of searchTag.tags | orderBy: 'ordering'; track tag) {
                          <nz-auto-option (click)="selectTagOnSearch(tag)" [nzValue]="tag.name" class="min-ht-opt">
                            <div class="node-wrapper p-l-xs">
                              <div class="node-content-wrapper2" nzTooltipPlacement="right">
                                <span class="icon-color text-xs" nz-icon nzType="tag" nzTheme="outline"></span>
                                <span class="p-l-sm">{{tag.name}}</span>
                              </div>
                            </div>
                          </nz-auto-option>
                        }
                      </nz-autocomplete>
                    </div>
                    <a (click)="hideSidebarPanel()" class="text resize-cursor a-1 pos-abt r-22 z-index-99">
                      <i class="fa fa-angle-double-left fa-lg"></i>
                    </a>
                    <a (click)="showSidebarPanel()" class="text resize-cursor a-2 pos-abt r-22 z-index-99">
                      <i class="fa fa-angle-double-right fa-lg"></i>
                    </a>

                    <perfect-scrollbar class="tree-block m-t-0" style="height: calc(100vh - 192px);">
                      @if (historyFilters.tagType === 'workflowTags') {
                        <div class="fade-in">
                          <div class="p-l-xxs m-b-12">
                            <a (click)="selectTags()" nz-tooltip="{{'workflow.label.selectTags' | translate}}">
                              <i class="font14" [nzType]="'plus'" nz-icon nzTheme="outline"></i>
                            </a>
                            <a (click)="selectAllTags();" class="p-l-12" nz-tooltip="{{'workflow.label.selectAllTags' | translate}}">
                              <i class="font14" nz-icon nzTheme="outline" nzType="plus-square"></i>
                            </a>
                            <a (click)="removeAllTags();" class="p-l-12" nz-tooltip="{{'workflow.label.removeAllTags' | translate}}">
                              <i class="font14" nz-icon nzTheme="outline" nzType="minus-square"></i>
                            </a>
                          </div>
                          @if (coreService.selectedTags && coreService.selectedTags.length > 0) {
                            <label nz-checkbox [(ngModel)]="coreService.allTagsSelected" (ngModelChange)="toggleSelectAllTags($event)" class="m-l-xs m-b-15">
                              {{ 'profile.label.selectAll' | translate }}
                            </label>
                          }
                          @for (tag of coreService.selectedTags | orderBy: 'ordering'; track tag) {
                            <div class="w-full">
                              <div class="node-wrapper p-l-xs p-b-xxs">
                            <span class="w-14 m-r-12">
                              <label nz-checkbox [nzChecked]="coreService.checkedTags.has(tag.name)"
                                     (nzCheckedChange)="onTagChecked(tag.name, $event)"></label>
                            </span>
                                <div class="node-content-wrapper" [ngClass]="{'node-content-wrapper-active': coreService.checkedTags.has(tag.name)}" (click)="selectTag(tag.name)">
                                  <span class="icon-color" nz-icon nzType="tag" nzTheme="outline"></span>
                                  <span class="p-l-xs">{{tag.name}}</span>
                                </div>
                              </div>
                            </div>
                          }
                        </div>
                      }
                      @if (historyFilters.tagType === 'workflowTags' && coreService.selectedTags && coreService.selectedTags.length === 0) {
                        <div class="m-top-50">
                          <app-empty-data></app-empty-data>
                        </div>
                      }
                    </perfect-scrollbar>
                    <div class="rg-right"><span></span></div>
                  </div>
                }
                @if (historyFilters.tagType === 'orderTags') {
                  <div class="pl-20">
                    <a (click)="objectOrderTreeSearch()" class="tree-search workflow-tree-search">
                      <i [nzType]="'search'" nz-icon nzTheme="outline"></i>
                    </a>
                    <div>
                      <input (blur)="clearOrderSearchInput()" (ngModelChange)="onOrderSearchInput($event)"
                             [(ngModel)]="searchOrderTag.text"
                             [nzAutocomplete]="auto" [placeholder]="'workflow.placeholder.findNode' | translate"
                             class="input-tree-search"
                             id="historyOrderTagSearch"
                             nz-input
                      />

                      <i [nzType]="searchOrderTag.loading ? 'loading' : 'search'" class="tree-search-icon" nz-icon nzTheme="outline"></i>
                      <nz-autocomplete #auto>
                        @for (tag of searchOrderTag.tags | orderBy: 'ordering'; track tag) {
                          <nz-auto-option (click)="selectOrderTagOnSearch(tag)" [nzValue]="tag.name" class="min-ht-opt">
                            <div class="node-wrapper p-l-xs">
                              <div class="node-content-wrapper2" nzTooltipPlacement="right">
                                <span class="icon-color text-xs" nz-icon nzType="tag" nzTheme="outline"></span>
                                <span class="p-l-sm">{{tag.name}}</span>
                              </div>
                            </div>
                          </nz-auto-option>
                        }
                      </nz-autocomplete>
                    </div>
                    <a (click)="hideSidebarPanel()" class="text resize-cursor a-1 pos-abt r-22 z-index-99">
                      <i class="fa fa-angle-double-left fa-lg"></i>
                    </a>
                    <a (click)="showSidebarPanel()" class="text resize-cursor a-2 pos-abt r-22 z-index-99">
                      <i class="fa fa-angle-double-right fa-lg"></i>
                    </a>

                    <perfect-scrollbar class="tree-block m-t-0" style="height: calc(100vh - 192px);">
                      @if (historyFilters.tagType === 'orderTags') {
                        <div class="fade-in">
                          <div class="p-l-xxs m-b-12">
                            <a (click)="selectOrderTags()" nz-tooltip="{{'workflow.label.selectTags' | translate}}">
                              <i class="font14" [nzType]="'plus'" nz-icon nzTheme="outline"></i>
                            </a>
                            <a (click)="selectAllOrderTags();" class="p-l-12" nz-tooltip="{{'workflow.label.selectAllTags' | translate}}">
                              <i class="font14" nz-icon nzTheme="outline" nzType="plus-square"></i>
                            </a>
                            <a (click)="removeAllOrderTags();" class="p-l-12" nz-tooltip="{{'workflow.label.removeAllTags' | translate}}">
                              <i class="font14" nz-icon nzTheme="outline" nzType="minus-square"></i>
                            </a>
                          </div>
                          @if (coreService.selectedOrderTags && coreService.selectedOrderTags.length > 0) {
                            <label nz-checkbox [(ngModel)]="coreService.allOrderTagsSelected" (ngModelChange)="toggleSelectAllOrderTags($event)" class="m-l-xs m-b-15">
                              {{ 'profile.label.selectAll' | translate }}
                            </label>
                          }
                          @for (tag of coreService.selectedOrderTags | orderBy: 'ordering'; track tag) {
                            <div class="w-full">
                              <div class="node-wrapper p-l-xs p-b-xxs">
                            <span class="w-14 m-r-12">
                              <label nz-checkbox [nzChecked]="coreService.checkedOrderTags.has(tag.name)"
                                     (nzCheckedChange)="onOrderTagChecked(tag.name, $event)"></label>
                            </span>
                                <div class="node-content-wrapper" [ngClass]="{'node-content-wrapper-active': coreService.checkedOrderTags.has(tag.name)}" (click)="selectOrderTag(tag.name)">
                                  <span class="icon-color" nz-icon nzType="tag" nzTheme="outline"></span>
                                  <span class="p-l-xs">{{tag.name}}</span>
                                </div>
                              </div>
                            </div>
                          }
                        </div>
                      }
                      @if (historyFilters.tagType === 'orderTags' && coreService.selectedOrderTags && coreService.selectedOrderTags.length === 0) {
                        <div class="m-top-50">
                          <app-empty-data></app-empty-data>
                        </div>
                      }
                    </perfect-scrollbar>
                    <div class="rg-right"><span></span></div>
                  </div>
                }
              </div>
            </div>
          </div>
        }
        <div id="rightPanel">
          @if (showSearchPanel && historyFilters.type !== 'YADE' && historyFilters.type !== 'DEPLOYMENT' && historyFilters.type !== 'SUBMISSION') {
            <div class="row m-b">
              <div class="col-md-12">
                <div class="box p-a m-b-xs">
                  @if (historyFilters.type === 'ORDER') {
                    <div>
                      <app-order-form-template (onCancel)="cancel()" (onSearch)="search($event)" [allFilter]="orderHistoryFilterList"
                                               [filter]="orderSearch" [isSearch]="true"
                                               [permission]="permission" [preferences]="preferences"
                                               [schedulerIds]="schedulerIds"></app-order-form-template>
                    </div>
                  }
                  @if (historyFilters.type === 'TASK') {
                    <div>
                      <app-task-form-template (onCancel)="cancel()" (onSearch)="search($event)" [allFilter]="jobHistoryFilterList"
                                              [filter]="jobSearch" [isSearch]="true"
                                              [permission]="permission" [preferences]="preferences"
                                              [schedulerIds]="schedulerIds"></app-task-form-template>
                    </div>
                  }
                </div>
              </div>
            </div>
          }
          @if (historyFilters.type == 'ORDER') {
            <div class="box p-a">
              <div class="table-responsive " id="orderTable">
                <nz-table
                  #ajaxOrderTable
                  (nzPageIndexChange)="pageIndexChange($event)"
                  (nzPageSizeChange)="pageSizeChange($event)"
                  [nzBordered]="true"
                  [nzData]="data"
                  [nzLoading]="!isLoading"
                  [nzPageIndex]="order.currentPage"
                  [nzPageSizeOptions]="[10, 25, 50, 100 , +(preferences.maxEntryPerPage)]"
                  [nzPageSize]="order.entryPerPage || preferences.entryPerPage || 25"
                  [nzShowPagination]="data.length > 0"
                  [nzShowSizeChanger]="true"
                  [nzSize]="'small'"
                >
                  <thead>
                  <tr>
                    <th class=" menu"><span translate>common.label.action</span></th>
                    @if (!historyFilters.current) {
                      <th (click)="sort('controllerId')" class="dynamic-thead-o">
                        <a><span class="p-r-xs" translate>common.label.controllerId</span>
                          @if (order.filter.sortBy == 'controllerId' && !order.reverse) {
                            <i class="fa fa-caret-up "></i>
                          }
                          @if (order.filter.sortBy == 'controllerId' && order.reverse) {
                            <i class="fa fa-caret-down "></i>
                          }</a>
                      </th>
                    }
                    <th (click)="sort('orderId')" class="dynamic-thead"><a><span class="p-r-xs"
                                                                                 translate>history.label.orderId</span>
                      @if (order.filter.sortBy == 'orderId' && !order.reverse) {
                        <i class="fa fa-caret-up "></i>
                      }
                      @if (order.filter.sortBy == 'orderId' && order.reverse) {
                        <i class="fa fa-caret-down "></i>
                      }</a>
                    </th>
                    <th (click)="sort('workflow')" class="dynamic-thead"><a><span class="p-r-xs" translate>history.label.workflow</span>
                      @if (order.filter.sortBy == 'workflow' && !order.reverse) {
                        <i class="fa fa-caret-up "></i>
                      }
                      @if (order.filter.sortBy == 'workflow' && order.reverse) {
                        <i class="fa fa-caret-down "></i>
                      }</a>
                    </th>
                    <th (click)="sort('label')" class="dynamic-thead"><a><span class="p-r-xs" translate>workflow.label.label</span>
                      @if (order.filter.sortBy == 'label' && !order.reverse) {
                        <i class="fa fa-caret-up "></i>
                      }
                      @if (order.filter.sortBy == 'label' && order.reverse) {
                        <i class="fa fa-caret-down "></i>
                      }</a>
                    </th>
                    <th (click)="sort('state._text')" class="dynamic-thead"><a><span class="p-r-xs" translate>history.label.status</span>
                      @if (order.filter.sortBy == 'state._text' && !order.reverse) {
                        <i class="fa fa-caret-up "></i>
                      }
                      @if (order.filter.sortBy == 'state._text' && order.reverse) {
                        <i class="fa fa-caret-down "></i>
                      }</a>
                    </th>
                    <th (click)="sort('orderState._text')" class="dynamic-thead"><a><span class="p-r-xs" translate>history.label.orderState</span>
                      @if (order.filter.sortBy == 'orderState._text' && !order.reverse) {
                        <i class="fa fa-caret-up "></i>
                      }
                      @if (order.filter.sortBy == 'orderState._text' && order.reverse) {
                        <i class="fa fa-caret-down "></i>
                      }</a>
                    </th>
                    <th (click)="sort('plannedTime')" class="dynamic-thead"><a><span class="p-r-xs" translate>history.label.plannedTime</span>
                      @if (order.filter.sortBy == 'plannedTime' && !order.reverse) {
                        <i class="fa fa-caret-up "></i>
                      }
                      @if (order.filter.sortBy == 'plannedTime' && order.reverse) {
                        <i class="fa fa-caret-down "></i>
                      }</a>
                    </th>
                    <th (click)="sort('startTime')" class="dynamic-thead"><a><span class="p-r-xs" translate>history.label.startTime</span>
                      @if (order.filter.sortBy == 'startTime' && !order.reverse) {
                        <i class="fa fa-caret-up "></i>
                      }
                      @if (order.filter.sortBy == 'startTime' && order.reverse) {
                        <i class="fa fa-caret-down "></i>
                      }</a>
                    </th>
                    <th (click)="sort('endTime')" class="dynamic-thead"><a><span class="p-r-xs"
                                                                                 translate>history.label.endTime</span>
                      @if (order.filter.sortBy == 'endTime' && !order.reverse) {
                        <i class="fa fa-caret-up "></i>
                      }
                      @if (order.filter.sortBy == 'endTime' && order.reverse) {
                        <i class="fa fa-caret-down "></i>
                      }</a>
                    </th>
                    <th (click)="sort('duration')" class="dynamic-thead">
                      <a><span class="p-r-xs" translate>history.label.duration</span>
                        @if (order.filter.sortBy == 'duration' && !order.reverse) {
                          <i class="fa fa-caret-up "></i>
                        }
                        @if (order.filter.sortBy == 'duration' && order.reverse) {
                          <i class="fa fa-caret-down "></i>
                        }</a>
                    </th>
                  </tr>
                  </thead>
                  <tbody>
                    @for (history of ajaxOrderTable.data; track history) {
                      <tr [ngClass]="{'light-bg':history.show}" class="cursor">
                        <td>
                          <div class="btn-group dropdown">
                            <button [nzDropdownMenu]="exportMenu" class="btn-drop more-option-h" nz-dropdown nzTrigger="click"
                                    type="button">
                              <i class="fa fa-ellipsis-h"></i>
                            </button>
                            <nz-dropdown-menu #exportMenu="nzDropdownMenu" role="menu">
                              <ul nz-menu>
                                <li (click)="addWorkflowToIgnoreList(history.workflow)" [nzDisabled]="(schedulerIds.selected != history.controllerId && history.controllerId)"
                                    nz-menu-item>
                                  <a translate>history.button.addWorkflowToIgnoreList</a>
                                </li>
                                <li nz-menu-divider></li>
                                <li (click)="showAllPanelFuc(history)" nz-menu-item>
                                  <a translate>history.button.expandAll</a>
                                </li>
                                <li (click)="hideAllPanelFuc(history)" nz-menu-item>
                                  <a translate>history.button.collapseAll</a>
                                </li>
                                <li (click)="coreService.copyArguments(history, 'arguments', message)" nz-menu-item [nzDisabled]="!history.arguments">
                                  <a translate>common.button.copyArguments</a>
                                </li>
                                <li nz-menu-divider></li>
                                <li (click)="coreService.copyLink('order',history.orderId, history.workflow)" nz-menu-item>
                                  <a translate>common.button.copyLinkToObject</a>
                                </li>
                                <li (click)="copyOrderId(history.orderId)" nz-menu-item>
                                  <a translate>common.button.copyOrderId</a>
                                </li>
                              </ul>
                            </nz-dropdown-menu>
                          </div>
                        </td>
                        @if (!historyFilters.current) {
                          <td>
                    <span (click)="coreService.showLogWindow(history,null,null,history.controllerId, null,null)"
                          class="show-in-single-line w-full">
                      @if (!history.show) {
                        <i (click)="showPanelFuc(history);$event.stopPropagation()"
                           class="cursor fa fa-caret-down fa-lg p-l-xs p-r-xs"></i>
                      }
                      @if (history.show) {
                        <i (click)="hidePanelFuc(history);$event.stopPropagation()"
                           class="cursor fa fa-caret-up fa-lg p-l-xs p-r-xs"></i>
                      }
                      <i (click)="downloadLog(history,history.controllerId);$event.stopPropagation()"
                         class="cursor fa fa-download text-hover-primary p-r-xs"></i>
                       <span [innerHtml]="history.controllerId | highlight : order.searchText"></span>
                      @if (!history.controllerId) {
                        <span [innerHtml]="orderSearch.controllerId"></span>
                      }
                    </span>
                          </td>
                        }
                        <td>
                  <span (click)="coreService.showLogWindow(history,null,null,history.controllerId,null,null)"
                        class="show-in-single-line w-full">
                    @if (!history.show && historyFilters.current) {
                      <i (click)="showPanelFuc(history);$event.stopPropagation()"
                         class="cursor fa fa-caret-down fa-lg p-l-xs p-r-xs"></i>
                    }
                    @if (history.show && historyFilters.current) {
                      <i (click)="hidePanelFuc(history);$event.stopPropagation()"
                         class="cursor fa fa-caret-up fa-lg p-l-xs p-r-xs"></i>
                    }
                    @if (historyFilters.current) {
                      <i (click)="downloadLog(history,history.controllerId);$event.stopPropagation()"
                         class="cursor fa fa-download text-hover-primary p-r-xs"></i>
                    }
                    <span [innerHtml]="coreService.getModifiedOrderId(history, order.searchText)"></span>
                  </span>
                        </td>
                        <td (click)="coreService.showLogWindow(history,null, null, history.controllerId, null,null)">
                  <span class="show-in-single-line w-full">
                    @if (permission.joc && permission.joc.inventory.view) {
                      <i (click)="navToWorkflowTab(history.workflow);$event.stopPropagation()"
                         class="cursor fa fa-pencil text-hover-primary p-r-xs"></i>
                    }
                    @if (!isPathDisplay) {
                      <span (click)="coreService.showWorkflow(history.workflow);$event.stopPropagation()"
                            [innerHtml]="getLastPartOfWorkflow(history.workflow) | highlight : order.searchText" class="text-hover-primary"></span>
                    }
                    @if (isPathDisplay) {
                      <span (click)="coreService.showWorkflow(history.workflow);$event.stopPropagation()"
                            [innerHtml]="history.workflow | highlight : order.searchText" class="text-hover-primary"></span>
                    }
                    @if (workflowTagsPerWorkflow && history.workflow) {
                      <div>
                        @if (workflowTagsPerWorkflow[getLastPartOfWorkflow(history.workflow)]?.length > 0) {
                          <span [innerHtml]="coreService.getModifiedWorkflowTags(workflowTagsPerWorkflow[getLastPartOfWorkflow(history.workflow)], order.searchText)" class="m-l-sm">
                          </span>
                        }
                      </div>
                    }
                  </span>
                        </td>
                        <td (click)="coreService.showLogWindow(history,null, null, history.controllerId, null,null)">
                          @if (history.label) {
                            <span class="cur-point" [innerHtml]="history.label" [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="history.position"></span>
                          }
                          @if (!history.label) {
                            <span [innerHtml]="history.position"></span>
                          }
                        </td>
                        <td (click)="coreService.showLogWindow(history,null, null, history.controllerId, null,null)">
                          @if (history.state) {
                            <span [innerHtml]="history.state._text | translate" [ngClass]="coreService.getColor(history.state.severity,'bg')"
                                  class="label"></span>
                          }
                        </td>
                        <td (click)="coreService.showLogWindow(history,null, null, history.controllerId, null,null)">
                          @if (history.orderState) {
                            <span [innerHtml]="(history.orderState._text === 'RUNNING'?'PROCESSING':history.orderState._text) | translate"
                                  [ngClass]="history.orderState.severity === 0?'bg-light-green cl-b':coreService.getColor(history.orderState.severity,'bg')"
                                  class="label"></span>
                          }
                        </td>
                        <td (click)="coreService.showLogWindow(history,null, null, history.controllerId, null,null)"
                            [innerHtml]="history.plannedTime | stringToDate | translate"></td>
                        <td (click)="coreService.showLogWindow(history,null, null, history.controllerId, null,null)"
                            [innerHtml]="history.startTime | stringToDate"></td>
                        <td (click)="coreService.showLogWindow(history,null, null, history.controllerId, null,null)"
                            [innerHtml]="history.endTime | stringToDate"></td>
                        <td (click)="coreService.showLogWindow(history,null, null, history.controllerId, null,null)"
                            [innerHtml]="history.startTime | duration:history.endTime"></td>
                      </tr>
                      @if (history.show && history.arguments) {
                        <tr>
                          <td></td>
                          <td colspan="10">
                            <app-order-variable [history]="true" [order]="history" [schedulerId]="schedulerIds.selected"
                                                [type]="'arguments'"></app-order-variable>
                          </td>
                        </tr>
                      }
                      @if (history.show) {
                        <tr>
                          <td colspan="11" style="padding:0 !important;">
                            <app-order-history-template [historyView]="historyFilters" [history]="history"
                                                        [orderSearch]="orderSearch" [permission]="permission"
                                                        [schedulerId]="schedulerIds.selected"
                                                        class="order-history-template0" style="display: block"
                            ></app-order-history-template>
                          </td>
                        </tr>
                      }
                    }
                  </tbody>
                </nz-table>
                @if (ajaxOrderTable.data.length >0) {
                  <div class="w-half label-top">
                    <span translate>common.label.total</span> {{data.length}}
                    @if (ajaxOrderTable.data.length >1) {
                      <span translate>history.label.historiesFound</span>
                    }
                    @if (ajaxOrderTable.data.length === 1) {
                      <span translate>history.label.historyFound</span>
                    }
                  </div>
                }
              </div>
            </div>
          }
          @if (historyFilters.type == 'TASK') {
            <div class="box p-a">
              <div class="table-responsive">
                <nz-table
                  #ajaxTable
                  (nzPageIndexChange)="pageIndexChange($event)"
                  (nzPageSizeChange)="pageSizeChange($event)"
                  [nzBordered]="true"
                  [nzData]="data"
                  [nzLoading]="!isLoading"
                  [nzPageIndex]="task.currentPage"
                  [nzPageSizeOptions]="[10, 25, 50, 100 , +(preferences.maxEntryPerPage)]"
                  [nzPageSize]="task.entryPerPage || preferences.entryPerPage || 25"
                  [nzShowPagination]="data.length > 0"
                  [nzShowSizeChanger]="true"
                  [nzSize]="'small'"
                >
                  <thead>
                  <tr>
                    <th class=" menu"><span translate>common.label.action</span></th>
                    @if (!historyFilters.current) {
                      <th (click)="sort1('controllerId')">
                        <a><span class="p-r-xs" translate>common.label.controllerId</span>
                          @if (task.filter.sortBy == 'controllerId' && !task.reverse) {
                            <i class="fa fa-caret-up "></i>
                          }
                          @if (task.filter.sortBy == 'controllerId' && task.reverse) {
                            <i class="fa fa-caret-down "></i>
                          }</a>
                      </th>
                    }
                    <th (click)="sort1('job')">
                      <a><span class="p-r-xs" translate>history.label.job</span>
                        @if (task.filter.sortBy == 'job' && !task.reverse) {
                          <i class="fa fa-caret-up "></i>
                        }
                        @if (task.filter.sortBy == 'job' && task.reverse) {
                          <i class="fa fa-caret-down "></i>
                        }</a>
                    </th>
                    <th (click)="sort1('workflow')">
                      <a><span class="p-r-xs" translate>history.label.workflow</span>
                        @if (task.filter.sortBy == 'workflow' && !task.reverse) {
                          <i class="fa fa-caret-up "></i>
                        }
                        @if (task.filter.sortBy == 'workflow' && task.reverse) {
                          <i class="fa fa-caret-down "></i>
                        }</a>
                    </th>
                    <th (click)="sort1('label')">
                      <a><span class="p-r-xs" translate>workflow.label.label</span>
                        @if (task.filter.sortBy == 'label' && !task.reverse) {
                          <i class="fa fa-caret-up "></i>
                        }
                        @if (task.filter.sortBy == 'label' && task.reverse) {
                          <i class="fa fa-caret-down "></i>
                        }</a>
                    </th>
                    <th (click)="sort1('state._text')">
                      <a><span class="p-r-xs" translate>history.label.status</span>
                        @if (task.filter.sortBy == 'state._text' && !task.reverse) {
                          <i class="fa fa-caret-up "></i>
                        }
                        @if (task.filter.sortBy == 'state._text' && task.reverse) {
                          <i class="fa fa-caret-down "></i>
                        }</a>
                    </th>
                    <th (click)="sort1('startTime')">
                      <a><span class="p-r-xs" translate>history.label.startTime</span>
                        @if (task.filter.sortBy == 'startTime' && !task.reverse) {
                          <i class="fa fa-caret-up "></i>
                        }
                        @if (task.filter.sortBy == 'startTime' && task.reverse) {
                          <i class="fa fa-caret-down "></i>
                        }</a>
                    </th>
                    <th (click)="sort1('endTime')">
                      <a><span class="p-r-xs" translate>history.label.endTime</span>
                        @if (task.filter.sortBy == 'endTime' && !task.reverse) {
                          <i class="fa fa-caret-up "></i>
                        }
                        @if (task.filter.sortBy == 'endTime' && task.reverse) {
                          <i class="fa fa-caret-down "></i>
                        }</a>
                    </th>
                    <th (click)="sort1('duration')">
                      <a><span class="p-r-xs" translate>history.label.duration</span>
                        @if (task.filter.sortBy == 'duration' && !task.reverse) {
                          <i class="fa fa-caret-up "></i>
                        }
                        @if (task.filter.sortBy == 'duration' && task.reverse) {
                          <i class="fa fa-caret-down "></i>
                        }</a>
                    </th>
                    <th (click)="sort1('criticality')">
                      <a><span class="p-r-xs" translate>history.label.criticality</span>
                        @if (task.filter.sortBy == 'criticality' && !task.reverse) {
                          <i class="fa fa-caret-up "></i>
                        }
                        @if (task.filter.sortBy == 'criticality' && task.reverse) {
                          <i class="fa fa-caret-down "></i>
                        }</a>
                    </th>
                    <th (click)="sort1('returnCode')">
                      <a><span class="p-r-xs" translate>history.label.returnCode</span>
                        @if (task.filter.sortBy == 'returnCode' && !task.reverse) {
                          <i class="fa fa-caret-up "></i>
                        }
                        @if (task.filter.sortBy == 'returnCode' && task.reverse) {
                          <i class="fa fa-caret-down "></i>
                        }</a>
                    </th>
                  </tr>
                  </thead>
                  <tbody>
                    @for (jobHistory of ajaxTable.data; track jobHistory) {
                      <tr [ngClass]="{'light-bg':jobHistory.show}" class="cursor">
                        <td>
                          <div class="btn-group dropdown">
                            <button [nzDropdownMenu]="export3" class="btn-drop more-option-h" nz-dropdown nzTrigger="click"
                                    type="button">
                              <i class="fa fa-ellipsis-h"></i>
                            </button>
                            <nz-dropdown-menu #export3="nzDropdownMenu" role="menu">
                              <ul nz-menu>
                                <li (click)="addJobToIgnoreList(jobHistory.job, jobHistory.workflow)" [nzDisabled]="(schedulerIds.selected != jobHistory.controllerId && jobHistory.controllerId)"
                                    nz-menu-item>
                                  <a translate>history.button.addJobToIgnoreList</a>
                                </li>
                                <li (click)="addJobToIgnoreList(null, jobHistory.workflow)" [nzDisabled]="(schedulerIds.selected != jobHistory.controllerId && jobHistory.controllerId)"
                                    nz-menu-item>
                                  <a translate>history.button.addWorkflowToIgnoreList</a>
                                </li>
                              </ul>
                            </nz-dropdown-menu>
                          </div>
                        </td>
                        @if (!historyFilters.current) {
                          <td (click)="coreService.showLogWindow(null,jobHistory,null,jobHistory.controllerId, null,null)">
                      <span class="show-in-single-line">
                        <i (click)="jobHistory.show=!jobHistory.show;;$event.stopPropagation()"
                           [ngClass]="jobHistory.show ? 'fa-caret-up' : 'fa-caret-down'"
                           class="cursor fa fa-caret-down fa-lg p-l-xs p-r-xs"></i>
                        <i (click)="downloadLog(jobHistory,jobHistory.controllerId);$event.stopPropagation()"
                           class="cursor fa fa-download  text-hover-primary p-r-xs"></i>
                        <span [innerHtml]="jobHistory.controllerId | highlight : task.searchText"></span>
                      </span>
                          </td>
                        }
                        <td (click)="coreService.showLogWindow(null,jobHistory, null, jobHistory.controllerId, null,null)">
                    <span class="show-in-single-line">
                      @if (historyFilters.current) {
                        <i (click)="downloadLog(jobHistory,jobHistory.controllerId);$event.stopPropagation()"
                           class="cursor fa fa-download  text-hover-primary p-r-xs"></i>
                      }
                      <span [innerHtml]="jobHistory.job | highlight : task.searchText"></span>
                    </span>
                        </td>
                        <td (click)="coreService.showLogWindow(null,jobHistory, null, jobHistory.controllerId, null,null)">
                    <span class="show-in-single-line w-full">
                      @if (permission.joc && permission.joc.inventory.view) {
                        <i (click)="navToWorkflowTab(jobHistory.workflow);$event.stopPropagation()"
                           class="cursor fa fa-pencil text-hover-primary p-r-xs"></i>
                      }
                      <span (click)="coreService.showWorkflow(jobHistory.workflow);$event.stopPropagation()"
                            [innerHtml]="jobHistory.workflow | highlight : task.searchText"
                            class="text-hover-primary"></span>
                      @if (workflowTagsPerWorkflow && jobHistory?.workflow && workflowTagsPerWorkflow[getLastPartOfWorkflow(jobHistory.workflow)]?.length > 0) {
                        <span [innerHtml]="coreService.getModifiedWorkflowTags(workflowTagsPerWorkflow[getLastPartOfWorkflow(jobHistory.workflow)], task?.searchText)"
                              class="m-l-sm">
                        </span>
                      }
                    </span>
                        </td>
                        <td (click)="coreService.showLogWindow(null,jobHistory, null, jobHistory.controllerId, null,null)">
                          @if (jobHistory.label) {
                            <span class="cur-point" [innerHtml]="jobHistory.label | highlight : task.searchText" [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="jobHistory.position"></span>
                          }
                          @if (!jobHistory.label) {
                            <span [innerHtml]="jobHistory.position | highlight : task.searchText"></span>
                          }
                        </td>
                        <td (click)="coreService.showLogWindow(null,jobHistory,null,jobHistory.controllerId,null,null)">
                    <span [innerHtml]="jobHistory.state._text | translate"
                          [ngClass]="coreService.getColor(jobHistory.state.severity,'bg')"
                          class="label"></span>
                        </td>
                        <td (click)="coreService.showLogWindow(null,jobHistory,null,jobHistory.controllerId,null,null)"
                            [innerHtml]="jobHistory.startTime | stringToDate"></td>
                        <td (click)="coreService.showLogWindow(null,jobHistory,null,jobHistory.controllerId,null,null)"
                            [innerHtml]="jobHistory.endTime | stringToDate"></td>
                        <td (click)="coreService.showLogWindow(null,jobHistory,null,jobHistory.controllerId,null,null)"
                            [innerHtml]="jobHistory.startTime | duration:jobHistory.endTime"></td>
                        <td (click)="coreService.showLogWindow(null,jobHistory,null,jobHistory.controllerId,null,null)"
                            [innerHtml]="jobHistory.criticality | translate | highlight : task.searchText"></td>
                        <td (click)="coreService.showLogWindow(null,jobHistory,null,jobHistory.controllerId,null,null)"
                            [innerHtml]="jobHistory.exitCode"></td>
                      </tr>
                      @if (jobHistory.show) {
                        <tr>
                          <td></td>
                          <td colspan="10">
                            <app-order-variable [history]="true" [order]="jobHistory" [schedulerId]="schedulerIds.selected"
                                                [type]="'arguments'"></app-order-variable>
                          </td>
                        </tr>
                      }
                    }
                  </tbody>
                </nz-table>
                @if (ajaxTable.data.length >0) {
                  <div class="w-half label-top">
                    <span translate>common.label.total</span> {{data.length}}
                    @if (ajaxTable.data.length >1) {
                      <span translate>history.label.historiesFound</span>
                    }
                    @if (ajaxTable.data.length === 1) {
                      <span translate>history.label.historyFound</span>
                    }
                  </div>
                }
              </div>
            </div>
          }
        </div>
      </div>
    </div>

    @if (historyFilters.type == 'YADE') {
      <div class="m-t-sm box p-a scroll-y max-ht2">
        <div class="table-responsive" id="fileTransferMainTable">
          <nz-table
            #ajaxYadeTable
            (nzPageIndexChange)="pageIndexChange($event)"
            (nzPageSizeChange)="pageSizeChange($event)"
            [nzBordered]="true"
            [nzData]="data"
            [nzLoading]="!isLoading"
            [nzPageIndex]="yade.currentPage"
            [nzPageSizeOptions]="[10, 25, 50, 100, +(preferences.maxEntryPerPage)]"
            [nzPageSize]="yade.entryPerPage || preferences.entryPerPage || 25"
            [nzShowPagination]="data.length > 0"
            [nzShowSizeChanger]="true"
            [nzSize]="'small'"
          >
            <thead>
            <tr class="main-header-row">
              @if (!historyFilters.current) {
                <th (click)="sort2('controllerId')"><a><span
                  translate>common.label.controllerId</span>
                  @if (yade.filter.sortBy == 'controllerId' && !yade.reverse) {
                    <i class="fa fa-caret-up "></i>
                  }
                  @if (yade.filter.sortBy == 'controllerId' && yade.reverse) {
                    <i class="fa fa-caret-down "></i>
                  }</a>
                </th>
              }
              <th (click)="sort2('state._text')"><a>
                <span class="p-r-xs" translate>fileTransfer.label.status</span>
                @if (yade.filter.sortBy == 'state._text' && !yade.reverse) {
                  <i class="fa fa-caret-up "></i>
                }
                @if (yade.filter.sortBy == 'state._text' && yade.reverse) {
                  <i class="fa fa-caret-down "></i>
                }</a>
              </th>
              <th (click)="sort2('profile')"><a>
                <span class="p-r-xs" translate>fileTransfer.label.profileName</span>
                @if (yade.filter.sortBy == 'profile' && !yade.reverse) {
                  <i class="fa fa-caret-up "></i>
                }
                @if (yade.filter.sortBy == 'profile' && yade.reverse) {
                  <i class="fa fa-caret-down "></i>
                }</a>
              </th>
              <th (click)="sort2('operation')"><a>
                <span class="p-r-xs" translate>fileTransfer.label.operation</span>
                @if (yade.filter.sortBy == 'operation' && !yade.reverse) {
                  <i class="fa fa-caret-up "></i>
                }
                @if (yade.filter.sortBy == 'operation' && yade.reverse) {
                  <i class="fa fa-caret-down "></i>
                }</a>
              </th>
              <th (click)="sort2('workflow')"><a>
                <span class="p-r-xs" translate>fileTransfer.label.workflow</span>
                @if (yade.filter.sortBy == 'workflow' && !yade.reverse) {
                  <i class="fa fa-caret-up "></i>
                }
                @if (yade.filter.sortBy == 'workflow' && yade.reverse) {
                  <i class="fa fa-caret-down "></i>
                }</a>
              </th>
              <th (click)="sort2('orderId')"><a>
                <span class="p-r-xs" translate>fileTransfer.label.order</span>
                @if (yade.filter.sortBy == 'orderId' && !yade.reverse) {
                  <i class="fa fa-caret-up "></i>
                }
                @if (yade.filter.sortBy == 'orderId' && yade.reverse) {
                  <i class="fa fa-caret-down "></i>
                }</a>
              </th>
              <th (click)="sort2('numOfFiles')" nzWidth="65px"><a>
                <span [nzTooltipMouseEnterDelay]="0.5" [nz-tooltip]="'fileTransfer.tooltip.totalNumberOfFiles' | translate" class="p-r-xs" translate>fileTransfer.label.total</span>
                @if (yade.filter.sortBy == 'numOfFiles' && !yade.reverse) {
                  <i class="fa fa-caret-up "></i>
                }
                @if (yade.filter.sortBy == 'numOfFiles' && yade.reverse) {
                  <i class="fa fa-caret-down "></i>
                }</a>

              </th>
              <th (click)="sort2('error.message')" nzWidth="20%" style="width: 20% !important;"><a>
                <span class="p-r-xs" translate>fileTransfer.label.lastErrorMessage</span>
                @if (yade.filter.sortBy == 'error.message' && !yade.reverse) {
                  <i class="fa fa-caret-up "></i>
                }
                @if (yade.filter.sortBy == 'error.message' && yade.reverse) {
                  <i class="fa fa-caret-down "></i>
                }</a>
              </th>
              <th (click)="sort2('start')"><a>
                <span class="p-r-xs" translate>fileTransfer.label.startTime</span>
                @if (yade.filter.sortBy == 'start' && !yade.reverse) {
                  <i class="fa fa-caret-up "></i>
                }
                @if (yade.filter.sortBy == 'start' && yade.reverse) {
                  <i class="fa fa-caret-down "></i>
                }</a>
              </th>
              <th (click)="sort2('end')"><a>
                <span class="p-r-xs" translate>fileTransfer.label.endTime</span>
                @if (yade.filter.sortBy == 'end' && !yade.reverse) {
                  <i class="fa fa-caret-up "></i>
                }
                @if (yade.filter.sortBy == 'end' && yade.reverse) {
                  <i class="fa fa-caret-down "></i>
                }</a>
              </th>
              <th (click)="sort2('duration')" nzWidth="100px"><a>
                <span class="p-r-xs" translate>common.label.duration</span>
                @if (yade.filter.sortBy == 'duration' && !yade.reverse) {
                  <i class="fa fa-caret-up "></i>
                }
                @if (yade.filter.sortBy == 'duration' && yade.reverse) {
                  <i class="fa fa-caret-down "></i>
                }</a>
              </th>
            </tr>
            </thead>
            <tbody>
              @for (transfer of ajaxYadeTable.data; track transfer) {
                <tr [ngClass]="{'light-bg':transfer.show}" class="cursor">
                  @if (!historyFilters.current) {
                    <td (click)="coreService.showLogWindow(null, transfer,null,transfer.controllerId,true,null)">
                <span class="show-in-single-line">
                @if (!transfer.show && !historyFilters.current) {
                  <i (click)="showTransferFuc(transfer);$event.stopPropagation()"
                     class="cursor fa fa-caret-down fa-lg"></i>
                }
                  @if (transfer.show && !historyFilters.current) {
                    <i (click)="transfer.show = false;$event.stopPropagation()"
                       class="cursor fa fa-caret-up fa-lg"></i>
                  }&nbsp;
                <span [innerHtml]="transfer.controllerId"></span>
                  @if (!transfer.controllerId) {
                    <span [innerHtml]="transfer.controllerId"></span>
                  }
                </span>
                    </td>
                  }
                  <td (click)="coreService.showLogWindow(null, transfer,null,transfer.controllerId,true,null)" noWrap>
              <span>
              @if (!transfer.show && historyFilters.current) {
                <i (click)="showTransferFuc(transfer);$event.stopPropagation()"
                   class="cursor fa fa-caret-down fa-lg"></i>
              }
                @if (transfer.show && historyFilters.current) {
                  <i (click)="transfer.show = false;$event.stopPropagation()"
                     class="cursor fa fa-caret-up fa-lg"></i>
                }&nbsp;
              <span [innerHtml]="transfer.state._text | translate | highlight : yade.searchText" [ngClass]="coreService.getColor(transfer.state.severity,'bg')"
                    class="label"></span>
              </span>
                  </td>
                  <td (click)="coreService.showLogWindow(null, transfer,null,transfer.controllerId,true,null)"
                      [innerHtml]="transfer.profile | highlight : yade.searchText"></td>
                  <td (click)="coreService.showLogWindow(null, transfer,null,transfer.controllerId,true,null)"
                      [innerHtml]="transfer._operation | highlight : yade.searchText"></td>
                  <td (click)="coreService.showLogWindow(null, transfer,null,transfer.controllerId,true,null)">
              <span class="show-in-single-line w-full">
                @if (permission.joc && permission.joc.inventory.view) {
                  <i (click)="navToWorkflowTab(transfer.workflowPath);$event.stopPropagation()"
                     class="cursor fa fa-pencil text-hover-primary p-r-xs"></i>
                }
                <span (click)="coreService.showWorkflow(transfer.workflowPath);$event.stopPropagation()"
                      [innerHtml]="transfer.workflowPath | highlight : yade.searchText"
                      class="text-hover-primary"></span>
              </span>
                  </td>
                  <td (click)="coreService.showLogWindow(null, transfer,null,transfer.controllerId,true,null)">
                    <span [innerHtml]="transfer.orderId | highlight : yade.searchText"></span>
                  </td>
                  <td (click)="coreService.showLogWindow(null, transfer,null,transfer.controllerId,true,null)"
                      [innerHtml]="transfer.numOfFiles | highlight : yade.searchText"></td>
                  <td (click)="coreService.showLogWindow(null, transfer,null,transfer.controllerId,true,null)"
                      class="text-danger"
                      style="width: 20% !important;">
                    @if (transfer.error) {
                      <span [innerHtml]="transfer.error.message"></span>
                    }
                  </td>
                  <td (click)="coreService.showLogWindow(null, transfer,null,transfer.controllerId,true,null)"
                      [innerHtml]="transfer.start | stringToDate"></td>
                  <td (click)="coreService.showLogWindow(null, transfer,null,transfer.controllerId,true,null)"
                      [innerHtml]="transfer.end | stringToDate"></td>
                  <td (click)="coreService.showLogWindow(null, transfer,null,transfer.controllerId,true,null)"
                      [innerHtml]="transfer.start | duration:transfer.end"></td>
                </tr>
                @if (transfer.show) {
                  <tr>
                    <td></td>
                    <td colspan="10" style="padding: 0 !important;border-bottom: none!important;">
                      <nz-table [nzData]="['']" [nzFrontPagination]="false" [nzShowPagination]="false" class="m-a-0 inner-table"
                                id="fileTransferTable" nzSize="small">
                        <thead>
                        <tr>
                          <th class="order-history-template0" colspan="4" style="border-bottom: 1px solid #eee;"><span translate>fileTransfer.label.source</span>
                          </th>
                          <th class="order-history-template1" colspan="4" style="border-bottom: 1px solid #eee;"><span translate>fileTransfer.label.target</span>
                          </th>
                          <th class="order-history-template2" colspan="4" style="border-bottom: 1px solid #eee;"><span translate>fileTransfer.label.jump</span>
                          </th>
                        </tr>
                        <tr class="sub-header">
                          <th class="order-history-template0 dynamic-thead"><span translate>fileTransfer.label.host</span></th>
                          <th class="order-history-template0 dynamic-thead"><span translate>fileTransfer.label.account</span></th>
                          <th class="order-history-template0 dynamic-thead"><span translate>fileTransfer.label.port</span></th>
                          <th class="order-history-template0 dynamic-thead"><span translate>fileTransfer.label.protocol</span></th>
                          <th class="order-history-template1 dynamic-thead"><span translate>fileTransfer.label.host</span></th>
                          <th class="order-history-template1 dynamic-thead"><span translate>fileTransfer.label.account</span></th>
                          <th class="order-history-template1 dynamic-thead"><span translate>fileTransfer.label.port</span></th>
                          <th class="order-history-template1 dynamic-thead"><span translate>fileTransfer.label.protocol</span></th>
                          <th class="order-history-template2 dynamic-thead"><span translate>fileTransfer.label.host</span></th>
                          <th class="order-history-template2 dynamic-thead"><span translate>fileTransfer.label.account</span></th>
                          <th class="order-history-template2 dynamic-thead"><span translate>fileTransfer.label.port</span></th>
                          <th class="order-history-template2 dynamic-thead"><span translate>fileTransfer.label.protocol</span></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                          <td>
                            @if (transfer.source) {
                              <span [innerHtml]="transfer.source.host"></span>
                            }
                          </td>
                          <td>
                            @if (transfer.source) {
                              <span [innerHtml]="transfer.source.account"></span>
                            }
                          </td>
                          <td>
                            @if (transfer.source) {
                              <span [innerHtml]="transfer.source.port"></span>
                            }
                          </td>
                          <td>
                            @if (transfer.source) {
                              <span [innerHtml]="transfer.source.protocol"></span>
                            }
                          </td>
                          <td>
                            @if (transfer.target) {
                              <span [innerHtml]="transfer.target.host"></span>
                            }
                          </td>
                          <td>
                            @if (transfer.target) {
                              <span [innerHtml]="transfer.target.account"></span>
                            }
                          </td>
                          <td>
                            @if (transfer.target) {
                              <span [innerHtml]="transfer.target.port"></span>
                            }
                          </td>
                          <td>
                            @if (transfer.target) {
                              <span [innerHtml]="transfer.target.protocol"></span>
                            }
                          </td>
                          <td>
                            @if (transfer.jump) {
                              <span [innerHtml]="transfer.jump.host"></span>
                            }
                          </td>
                          <td>
                            @if (transfer.jump) {
                              <span [innerHtml]="transfer.jump.account"></span>
                            }
                          </td>
                          <td>
                            @if (transfer.jump) {
                              <span [innerHtml]="transfer.jump.port"></span>
                            }
                          </td>
                          <td>
                            @if (transfer.jump) {
                              <span [innerHtml]="transfer.jump.protocol"></span>
                            }
                          </td>
                        </tr>
                        </tbody>
                      </nz-table>
                      <nz-table #innerChildTable [nzData]="transfer.files" [nzFrontPagination]="false" [nzLoading]="transfer.loading"
                                [nzShowPagination]="false"
                                [nzWidthConfig]="transfer.widthArr" class="m-a-0 inner-table" nzSize="small">
                        <thead>
                        <tr>
                          <th><span translate>fileTransfer.label.sourceFileName</span></th>
                          <th><span translate>fileTransfer.label.sourceFilePath</span></th>
                          <th><span translate>fileTransfer.label.targetFileName</span></th>
                          <th><span translate>fileTransfer.label.targetFilePath</span></th>
                          <th><span translate>fileTransfer.label.status</span></th>
                          <th><span translate>fileTransfer.label.size</span></th>
                          <th><span translate>fileTransfer.label.integrityHash</span></th>
                        </tr>
                        </thead>
                        <tbody>
                          @for (file of innerChildTable.data; track file) {
                            <tr>
                              <td>{{file.sourceName}}</td>
                              <td>{{file.sourcePath}}</td>
                              <td>{{file.targetName}}</td>
                              <td>{{file.targetPath}}</td>
                              <td>
                                @if (file.state) {
                                  <span [innerHtml]="file.state._text | translate" [ngClass]="coreService.getColor(file.state.severity,'bg')"
                                        class="label"></span>
                                }
                              </td>
                              <td>{{file.size | byteToSize}}</td>
                              <td>{{file.integrityHash}}</td>
                            </tr>
                            @if (file.error) {
                              <tr>
                                <td class="text-danger" colspan="7"><span>{{file.error.message}}</span></td>
                              </tr>
                            }
                          }
                        </tbody>
                      </nz-table>
                    </td>
                  </tr>
                }
              }
            </tbody>
          </nz-table>
          @if (ajaxYadeTable.data.length >0) {
            <div class="w-half label-top">
              <span translate>common.label.total</span> {{data.length}}
              @if (ajaxYadeTable.data.length >1) {
                <span translate>history.label.historiesFound</span>
              }
              @if (ajaxYadeTable.data.length === 1) {
                <span translate>history.label.historyFound</span>
              }
            </div>
          }
        </div>
      </div>
    }
    @if (historyFilters.type == 'DEPLOYMENT') {
      <div class="m-t-sm box p-a scroll-y max-ht2">
        <div class="table-responsive">
          <nz-table
            #ajaxTable
            (nzPageIndexChange)="pageIndexChange($event)"
            (nzPageSizeChange)="pageSizeChange($event)"
            [nzBordered]="true"
            [nzData]="data"
            [nzLoading]="!isLoading"
            [nzPageIndex]="deployment.currentPage"
            [nzPageSizeOptions]="[10, 25, 50, 100, +(preferences.maxEntryPerPage)]"
            [nzPageSize]="deployment.entryPerPage || preferences.entryPerPage || 25"
            [nzShowPagination]="data.length > 0"
            [nzShowSizeChanger]="true"
            [nzSize]="'small'"
          >
            <thead>
            <tr>
              @if (!historyFilters.current) {
                <th (click)="sort3('controllerId')" nzWidth="20%">
                  <a><span class="p-r-xs" translate>common.label.controllerId</span>
                    @if (deployment.filter.sortBy == 'controllerId' && !deployment.reverse) {
                      <i class="fa fa-caret-up "></i>
                    }
                    @if (deployment.filter.sortBy == 'controllerId' && deployment.reverse) {
                      <i class="fa fa-caret-down "></i>
                    }</a>
                </th>
              }
              <th (click)="sort3('deploymentDate')" nzWidth="20%">
                <a><span class="p-r-xs" translate>history.label.deploymentDate</span>
                  @if (deployment.filter.sortBy == 'deploymentDate' && !deployment.reverse) {
                    <i class="fa fa-caret-up "></i>
                  }
                  @if (deployment.filter.sortBy == 'deploymentDate' && deployment.reverse) {
                    <i class="fa fa-caret-down "></i>
                  }</a>
              </th>
              <th (click)="sort3('account')" nzWidth="20%">
                <a><span class="p-r-xs" translate>common.label.account</span>
                  @if (deployment.filter.sortBy == 'account' && !deployment.reverse) {
                    <i class="fa fa-caret-up "></i>
                  }
                  @if (deployment.filter.sortBy == 'account' && deployment.reverse) {
                    <i class="fa fa-caret-down "></i>
                  }</a>
              </th>
              <th (click)="sort3('state')" nzWidth="20%">
                <a><span class="p-r-xs" translate>history.label.state</span>
                  @if (deployment.filter.sortBy == 'state' && !deployment.reverse) {
                    <i class="fa fa-caret-up "></i>
                  }
                  @if (deployment.filter.sortBy == 'state' && deployment.reverse) {
                    <i class="fa fa-caret-down "></i>
                  }</a>
              </th>
              <th [nzWidth]="historyFilters.current ? '40%' : '20%'">
                <span translate>history.label.numberOfItems</span>
              </th>
            </tr>
            </thead>
            <tbody>
              @for (depHistory of ajaxTable.data; track depHistory) {
                <tr [ngClass]="{'light-bg':depHistory.show}">
                  @if (!historyFilters.current) {
                    <td>
                <span class="show-in-single-line w-full">
                  @if (!depHistory.show) {
                    <i (click)="showChildHistory(depHistory);"
                       class="cursor fa fa-caret-down fa-lg p-l-xs p-r-xs"></i>
                  }
                  @if (depHistory.show) {
                    <i (click)="depHistory.show = false;"
                       class="cursor fa fa-caret-up fa-lg p-l-xs p-r-xs"></i>
                  }
                  <span [innerHtml]="depHistory.controllerId | highlight : deployment.searchText"></span>
                  @if (!depHistory.controllerId) {
                    <span [innerHtml]="deploymentSearch.controllerId"></span>
                  }
                </span>
                    </td>
                  }
                  <td>
              <span class="show-in-single-line w-full">
                @if (!depHistory.show && historyFilters.current) {
                  <i (click)="showChildHistory(depHistory);"
                     class="cursor fa fa-caret-down fa-lg p-l-xs p-r-xs"></i>
                }
                @if (depHistory.show && historyFilters.current) {
                  <i (click)="depHistory.show = false;"
                     class="cursor fa fa-caret-up fa-lg p-l-xs p-r-xs"></i>
                }
                <span
                  [innerHtml]="depHistory.deploymentDate | stringToDate | highlight : deployment.searchText"></span>
              </span>
                  </td>
                  <td><span [innerHtml]="depHistory.account | highlight : deployment.searchText"></span></td>
                  <td><span [innerHtml]="depHistory.state | translate | highlight : deployment.searchText"
                            [ngClass]="{'bg-dark-blue' : depHistory.state=== 'DEPLOYED', 'bg-orange' : depHistory.state=== 'NOT_DEPLOYED'}"
                            class="label"></span></td>
                  <td>
                    @if (depHistory.workflowCount) {
                      <span class="p-r-sm">
                  <span translate>Workflows</span>:
                        {{depHistory.workflowCount}}
                </span>
                    }
                    @if (depHistory.fileOrderSourceCount) {
                      <span class="p-r-sm">
                  <span translate>File Order Sources</span>:
                        {{depHistory.fileOrderSourceCount}}
                </span>
                    }
                    @if (depHistory.jobResourceCount) {
                      <span class="p-r-sm">
                  <span translate>Job Resources</span>:
                        {{depHistory.jobResourceCount}}
                </span>
                    }
                    @if (depHistory.boardCount) {
                      <span class="p-r-sm">
                  <span translate>Boards</span>:
                        {{depHistory.boardCount}}
                </span>
                    }
                    @if (depHistory.lockCount) {
                      <span>
                  <span translate>Locks</span>:
                        {{depHistory.lockCount}}
                </span>
                    }
                  </td>
                </tr>
                @if (depHistory.errorMessage && depHistory.show) {
                  <tr>
                    <td colspan="5"><span class="text-danger">{{depHistory.errorMessage}}</span></td>
                  </tr>
                }
                @if (depHistory.show) {
                  <tr>
                    <td class="order-history-template0" colspan="5" style="padding:0 !important;">
                      <nz-table #innerChildTable [nzData]="depHistory.children" [nzFrontPagination]="false" [nzLoading]="depHistory.loading"
                                [nzShowPagination]="false" class="m-a-0 inner-table" nzSize="small">
                        <thead>
                        <tr>
                          <th nzWidth="19.95%"><span translate>history.label.deployType</span></th>
                          <th nzWidth="39.97%"><span translate>common.label.path</span></th>
                          <th nzWidth="19.95%"><span translate>history.label.operation</span></th>
                          <th nzWidth="19.95%"><span translate>history.label.date</span></th>
                        </tr>
                        </thead>
                        <tbody>
                          @for (child of innerChildTable.data; track child) {
                            <tr>
                              <td><span [innerHtml]="child.deployType | translate"></span></td>
                              <td>
                      <span class="show-in-single-line w-full">
                        @if (child.operation === 'UPDATE' && permission.joc && permission.joc.inventory.view) {
                          <i (click)="navToInventoryTab(child);$event.stopPropagation()"
                             class="cursor fa fa-pencil text-hover-primary p-r-xs"></i>
                        }
                        <span
                          (click)="coreService.showWorkflow(child.path);$event.stopPropagation()"
                          [innerHtml]="child.path"
                          [ngClass]="(child.deployType === 'Workflow' && child.operation === 'UPDATE') ? 'text-hover-primary' : ''"></span>

                      </span>
                              </td>
                              <td><span [innerHtml]="child.operation | translate"></span></td>
                              <td [innerHtml]="child.deploymentDate | stringToDate"></td>
                            </tr>
                          }
                        </tbody>
                      </nz-table>
                    </td>
                  </tr>
                }
              }
            </tbody>
          </nz-table>
          @if (ajaxTable.data.length >0) {
            <div class="w-half label-top">
              <span translate>common.label.total</span> {{data.length}}
              @if (ajaxTable.data.length >1) {
                <span translate>history.label.historiesFound</span>
              }
              @if (ajaxTable.data.length === 1) {
                <span translate>history.label.historyFound</span>
              }
            </div>
          }
        </div>
      </div>
    }

    @if (historyFilters.type == 'SUBMISSION') {
      <div class="m-t-sm box p-a scroll-y max-ht2">
        <div class="table-responsive">
          <nz-table
            #ajaxTable
            (nzPageIndexChange)="pageIndexChange($event)"
            (nzPageSizeChange)="pageSizeChange($event)"
            [nzBordered]="true"
            [nzData]="data"
            [nzLoading]="!isLoading"
            [nzPageIndex]="submission.currentPage"
            [nzPageSizeOptions]="[10, 25, 50, 100, +(preferences.maxEntryPerPage)]"
            [nzPageSize]="submission.entryPerPage || preferences.entryPerPage || 25"
            [nzShowPagination]="data.length > 0"
            [nzShowSizeChanger]="true"
            [nzSize]="'small'"
          >
            <thead>
            <tr>
              <th (click)="sort4('date')" style="width: 50%">
                <a><span class="p-r-xs" translate>history.label.dailyPlanDate</span>
                  @if (submission.filter.sortBy == 'date' && !submission.reverse) {
                    <i class="fa fa-caret-up "></i>
                  }
                  @if (submission.filter.sortBy == 'date' && submission.reverse) {
                    <i class="fa fa-caret-down "></i>
                  }</a>
              </th>
              <th (click)="sort4('countTotal')">
                <a><span class="p-r-xs" translate>history.label.countTotal</span>
                  @if (submission.filter.sortBy == 'countTotal' && !submission.reverse) {
                    <i class="fa fa-caret-up "></i>
                  }
                  @if (submission.filter.sortBy == 'countTotal' && submission.reverse) {
                    <i class="fa fa-caret-down "></i>
                  }</a>
              </th>
              <th (click)="sort4('countSubmitted')">
                <a><span class="p-r-xs" translate>history.label.countSubmitted</span>
                  @if (submission.filter.sortBy == 'countSubmitted' && !submission.reverse) {
                    <i class="fa fa-caret-up "></i>
                  }
                  @if (submission.filter.sortBy == 'countSubmitted' && submission.reverse) {
                    <i class="fa fa-caret-down "></i>
                  }</a>
              </th>
            </tr>
            </thead>
            <tbody>
              @for (submissionHistory of ajaxTable.data; track submissionHistory) {
                <tr [ngClass]="{'light-bg':submissionHistory.show}">
                  <td>
              <span class="show-in-single-line w-full">
                  @if (!submissionHistory.show) {
                    <i (click)="expandDailyPlan(submissionHistory)"
                       class="cursor fa fa-caret-down fa-lg p-l-xs p-r-xs"></i>
                  }
                @if (submissionHistory.show) {
                  <i (click)="submissionHistory.show = false;"
                     class="cursor fa fa-caret-up fa-lg p-l-xs p-r-xs"></i>
                }
                <span [innerHtml]="submissionHistory.date | stringToDate1"></span>
                </span>
                  </td>
                  <td>
                    {{submissionHistory.countTotal}}
                  </td>
                  <td>
                    {{submissionHistory.countSubmitted}}
                  </td>
                </tr>
                @if (submissionHistory.show) {
                  <tr>
                    <td colspan="3" style="padding:0 !important;">
                      <nz-table #innerChildTable [nzData]="submissionHistory.controllers" [nzFrontPagination]="false"
                                [nzLoading]="submissionHistory.loading"
                                [nzShowPagination]="false" class="m-a-0 inner-table"
                                nzSize="small">
                        <tbody>
                          @for (controller of innerChildTable.data; track controller) {
                            @if (!historyFilters.current) {
                              <tr>
                                <td class="custom-th" colspan="9">
                                  <span class="p-l" translate>common.label.controllerId</span>:
                                  <span [innerHtml]="controller.controllerId"></span>
                                </td>
                              </tr>
                            }
                            <tr>
                              <td class="custom-th" colspan="3"><span [ngClass]="{'p-l-md' : !historyFilters.current }" class="p-l"
                                                                      translate>history.label.submission</span></td>
                              <td class="custom-th" colspan="3"><span translate>history.label.submissionTotal</span></td>
                              <td class="custom-th" colspan="3"><span translate>history.label.countSubmitted</span></td>
                            </tr>
                            @for (child of controller.submissions | orderBy: 'submissionTime' : true; track child) {
                              <tr>
                                <td colspan="3">
                          <span [ngClass]="{'p-l-md' : !historyFilters.current }" class="p-l">
                            @if (!child.show) {
                              <i (click)="loadSubmissionOrders(submissionHistory, controller, child);child.show = true"
                                 class="cursor fa fa-caret-down fa-lg p-l-xs p-r-xs"></i>
                            }
                            @if (child.show) {
                              <i (click)="child.show = false;"
                                 class="cursor fa fa-caret-up fa-lg p-l-xs p-r-xs"></i>
                            }
                            <span [innerHtml]="child.submissionTime | stringToDate"></span>
                          </span>
                                </td>
                                <td colspan="3">
                                  {{child.countTotal}}
                                </td>
                                <td colspan="3">
                                  {{child.countSubmitted}}
                                </td>
                              </tr>
                              @if (child.show) {
                                @if (!child.orderIds) {
                                  <tr>
                                    <td class="text-center" colspan="9">
                                      <nz-spin nzSimple></nz-spin>
                                    </td>
                                  </tr>
                                }
                                @if (child.orderIds && child.orderIds.length > 0) {
                                  <tr>
                                    <td class="custom-th" colspan="3">
                                      <span [ngClass]="{'p-l-lg' : !historyFilters.current }" class="p-l-md" translate>history.label.orderId</span>
                                    </td>
                                    <td class="custom-th" colspan="3"><span translate>order.label.workflow</span></td>
                                    <td class="custom-th" colspan="2"><span translate>order.label.scheduledFor</span></td>
                                    <td class="custom-th"><span translate>common.label.status</span></td>
                                  </tr>
                                  @for (order of child.orderIds | filter: submission.searchText: ['workflowPath', 'orderId'] | orderBy: 'scheduledFor': true; track order) {
                                    <tr>
                                      <td colspan="3"><span [innerHtml]="coreService.getModifiedOrderId(order, submission.searchText)" [ngClass]="{'p-l-lg' : !historyFilters.current }"
                                                            class="p-l-md"></span></td>
                                      <td colspan="3">
                                        @if (order.workflowPath && permission.joc && permission.joc.inventory.view) {
                                          <i (click)="navToWorkflowTab(order.workflowPath);$event.stopPropagation()"
                                             class="cursor fa fa-pencil text-hover-primary p-r-xs"></i>
                                        }
                                        @if (order.workflowPath) {
                                          <span (click)="coreService.showWorkflow(order.workflowPath);$event.stopPropagation()"
                                                [innerHtml]="order.workflowPath | highlight: submission.searchText"
                                                class="text-hover-primary"></span>
                                        }
                                      </td>
                                      <td colspan="2"><span>{{order.scheduledFor | stringToDate}}</span></td>
                                      <td>
                                        @if (order.submitted) {
                                          <span class="label bg-orange" translate>{{'submitted' | translate}}</span>
                                        }
                                        @if (!order.submitted && order.workflowPath) {
                                          <span class="label bg-red" translate>{{'notSubmitted' | translate}}</span>
                                        }
                                      </td>
                                    </tr>
                                  }
                                  @if ((child.orderIds | filter: submission.searchText : ['workflowPath', 'orderId']).length === 0) {
                                    <tr>
                                      <td class="text-center" colspan="9">
                                        <span class="text-uppercase m-t-sm" translate>common.message.noDataMatched</span>
                                      </td>
                                    </tr>
                                  }
                                }
                                @if (child.warnMessages && child.warnMessages.length > 0) {
                                  <tr>
                                    <td class="custom-th" colspan="9"><span [ngClass]="{'p-l-lg' : !historyFilters.current }"
                                                                            class="p-l-md" translate>history.label.warnMessages</span>
                                    </td>
                                  </tr>
                                }
                                @for (msg of child.warnMessages; track msg) {
                                  <tr>
                                    <td colspan="9"><span [ngClass]="{'p-l-lg' : !historyFilters.current }"
                                                          class="p-l-md text-warn">{{msg}}</span></td>
                                  </tr>
                                }
                                @if (child.errorMessages && child.errorMessages.length > 0) {
                                  <tr>
                                    <td class="custom-th" colspan="9"><span [ngClass]="{'p-l-lg' : !historyFilters.current }"
                                                                            class="p-l-md" translate>history.label.errorMessages</span>
                                    </td>
                                  </tr>
                                }
                                @for (msg of child.errorMessages; track msg) {
                                  <tr>
                                    <td colspan="9"><span [ngClass]="{'p-l-lg' : !historyFilters.current }"
                                                          class="p-l-md text-danger">{{msg}}</span></td>
                                  </tr>
                                }
                              }
                            }
                          }
                        </tbody>
                      </nz-table>
                    </td>
                  </tr>
                }
              }
            </tbody>
          </nz-table>
          @if (ajaxTable.data.length >0) {
            <div class="w-half label-top">
              <span translate>common.label.total</span> {{data.length}}
              @if (ajaxTable.data.length >1) {
                <span translate>history.label.historiesFound</span>
              }
              @if (ajaxTable.data.length === 1) {
                <span translate>history.label.historyFound</span>
              }
            </div>
          }
        </div>
      </div>
    }
  </div>
</div>
@if (!isLoading || reloadState == 'yes' || isSubmissionLoading) {
  <div (click)="reload()" class="bottom-btn">
    @if (reloadState == 'no') {
      <i class="fa fa-times"></i>
    }
    @if (reloadState == 'yes') {
      <i class="fa fa-refresh"></i>
    }
  </div>
}
