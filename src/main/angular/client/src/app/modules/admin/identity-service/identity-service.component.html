<div class="row m-b-12">
  <div class="col-md-12">
    <div class="pull-left">

      <ul class="nav navbar-nav navbar-nav-inline nav-active-border nav-active-border2 b-primary">
        <li class="nav-item">
          <a (click)="adminFilter.isSession = false;adminFilter.isBlocklist = false;" [ngClass]="{'active': !adminFilter.isBlocklist && !adminFilter.isSession}"
             class="nav-link">
            <span class="nav-text text-dark p-b-sm"><span class="text"
                                                          translate>user.label.identityService</span></span>
          </a>
        </li>
        <li class="nav-item dropdown-separator">
          <span class="separator"></span>
        </li>
        <li class="nav-item">
          <a (click)="adminFilter.isBlocklist = true;adminFilter.isSession = false;" [ngClass]="{'active': adminFilter.isBlocklist && !adminFilter.isSession}"
             class="nav-link">
            <span class="nav-text text-dark p-b-sm"><span class="text" translate>user.label.blocklist</span></span>
          </a>
        </li>
        <li class="nav-item dropdown-separator">
          <span class="separator"></span>
        </li>
        <li class="nav-item">
          <a (click)="adminFilter.isSession = true;adminFilter.isBlocklist = false;" [ngClass]="{'active': adminFilter.isSession && !adminFilter.isBlocklist}"
             class="nav-link">
            <span class="nav-text text-dark p-b-sm"><span class="text" translate>user.label.sessions</span></span>
          </a>
        </li>
      </ul>
    </div>
    @if (!adminFilter.isBlocklist && !adminFilter.isSession) {
      <div class="search-box-field pull-right">
        <label>
          <input [(ngModel)]="filter.searchKey"
                 placeholder="{{'common.placeholder.search' | translate}}" type="search">
          @if (filter.searchKey) {
            <i (click)="filter.searchKey = '';" class="fa fa-times search-close"></i>
          }
        </label>
      </div>
    }
  </div>
</div>
@if (!adminFilter.isBlocklist && !adminFilter.isSession) {
  <div class="box p-a" style="padding-top: 24px">
    <div class="table-responsive">
      <nz-table
        #ajaxTable
        [nzBordered]="true"
        [nzData]="(identityServices | filter: filter.searchKey: ['identityServiceName', 'identityServiceType', 'serviceAuthenticationScheme']) | orderBy: filter.filter.sortBy:filter.filter.reverse"
        [nzLoading]="loading"
        [nzPageIndex]="filter.currentPage"
        [nzPageSizeOptions]="[10, 25, 50, 100 , +(preferences.maxEntryPerPage) || 500]"
        [nzPageSize]="preferences.entryPerPage || 25"
        [nzShowPagination]="(identityServices | filter: filter.searchKey : ['identityServiceName', 'identityServiceType', 'serviceAuthenticationScheme']).length > 0"
        [nzShowSizeChanger]="true"
        [nzSize]="'small'"
      >
        <thead>
        <tr>
          @if (permission.joc && permission.joc.administration.accounts.manage) {
            <th class="menu"><span translate>common.label.action</span></th>
          }
          <th (click)="sort('identityServiceName')">
            <a><span class="p-r-xs" translate>user.label.identityServiceName</span>
              @if (filter.filter.sortBy == 'identityServiceName' && !filter.filter.reverse) {
                <i class="fa fa-caret-up "></i>
              }
              @if (filter.filter.sortBy == 'identityServiceName' && filter.filter.reverse) {
                <i class="fa fa-caret-down "></i>
              }</a>
          </th>
          <th (click)="sort('identityServiceType')">
            <a><span class="p-r-xs" translate>user.label.identityServiceType</span>
              @if (filter.filter.sortBy == 'identityServiceType' && !filter.filter.reverse) {
                <i class="fa fa-caret-up "></i>
              }
              @if (filter.filter.sortBy == 'identityServiceType' && filter.filter.reverse) {
                <i class="fa fa-caret-down "></i>
              }</a>
          </th>
          <th (click)="sort('serviceAuthenticationScheme')">
            <a><span class="p-r-xs" translate>user.label.serviceAuthenticationScheme</span>
              @if (filter.filter.sortBy == 'serviceAuthenticationScheme' && !filter.filter.reverse) {
                <i class="fa fa-caret-up "></i>
              }
              @if (filter.filter.sortBy == 'serviceAuthenticationScheme' && filter.filter.reverse) {
                <i class="fa fa-caret-down "></i>
              }</a>
          </th>
          <th (click)="sort('secondFactor')">
            <a><span class="p-r-xs" translate>user.label.secondFactor</span>
              @if (filter.filter.sortBy == 'secondFactor' && !filter.filter.reverse) {
                <i class="fa fa-caret-up "></i>
              }
              @if (filter.filter.sortBy == 'secondFactor' && filter.filter.reverse) {
                <i class="fa fa-caret-down "></i>
              }</a>
          </th>
          <th (click)="sort('ordering')">
            <a><span class="p-r-xs" translate>user.label.identityServiceOrdering</span>
              @if (filter.filter.sortBy == 'ordering' && !filter.filter.reverse) {
                <i class="fa fa-caret-up "></i>
              }
              @if (filter.filter.sortBy == 'ordering' && filter.filter.reverse) {
                <i class="fa fa-caret-down "></i>
              }</a>
          </th>
          <th (click)="sort('disabled')">
            <a><span class="p-r-xs" translate>user.label.identityServiceDisabled</span>
              @if (filter.filter.sortBy == 'disabled' && !filter.filter.reverse) {
                <i class="fa fa-caret-up "></i>
              }
              @if (filter.filter.sortBy == 'disabled' && filter.filter.reverse) {
                <i class="fa fa-caret-down "></i>
              }</a>
          </th>
          <th (click)="sort('required')">
            <a><span class="p-r-xs" translate>user.label.identityServiceRequired</span>
              @if (filter.filter.sortBy == 'required' && !filter.filter.reverse) {
                <i class="fa fa-caret-up "></i>
              }
              @if (filter.filter.sortBy == 'required' && filter.filter.reverse) {
                <i class="fa fa-caret-down "></i>
              }</a>
          </th>
        </tr>
        </thead>
        <tbody (cdkDropListDropped)="drop($event)" cdkDropList>
          @for (identityService of ajaxTable.data; track identityService.identityServiceName) {
            <tr [ngClass]="{'opacity7': identityService.disabled}"
                cdkDrag class="cursor move-on-hover">
              @if (permission.joc && permission.joc.administration.accounts.manage) {
                <td class="menu">
                  @if (filter.filter.sortBy === 'ordering') {
                    <div cdkDragHandle class="pos-abt move-icon text-16 cur-m"
                         style="left: -1px">
                      <i aria-hidden="true" class="fa fa-bars"></i>
                    </div>
                  }
                  <div class="btn-group dropdown m-l-xs">
                    <button [nzDropdownMenu]="option" class="btn-drop more-option-h" nz-dropdown nzTrigger="click"
                            type="button"><i class="fa fa-ellipsis-h"></i></button>
                    <nz-dropdown-menu #option="nzDropdownMenu" role="menu">
                      <ul nz-menu>
                        @if (identityService.identityServiceType !== 'UNKNOWN') {
                          <li (click)="edit({identityService : identityService})" nz-menu-item>
                            <a translate>common.button.edit</a>
                          </li>
                        }
                        @if (identityService.identityServiceType !== 'JOC' && identityService.identityServiceType !== 'UNKNOWN' && identityService.identityServiceType !== 'CERTIFICATE') {
                          <li (click)="manageSetting({data : identityService})" nz-menu-item>
                            <a translate>user.button.manageSetting</a>
                          </li>
                        }
                        @if (!identityService.disabled && identityService.identityServiceType !== 'UNKNOWN') {
                          <li (click)="disable({identityService : identityService})" nz-menu-item>
                            <a translate>user.button.disable</a>
                          </li>
                        }
                        @if (identityService.disabled && identityService.identityServiceType !== 'UNKNOWN') {
                          <li (click)="enable({identityService : identityService})" nz-menu-item>
                            <a translate>user.button.enable</a>
                          </li>
                        }
                        <li (click)="delete({identityService : identityService})" [ngClass]="{'disable-link': identityServices.length === 1}" class="bg-hover-color"
                            nz-menu-item>
                          <a translate>common.button.delete</a>
                        </li>
                      </ul>
                    </nz-dropdown-menu>
                  </div>
                </td>
              }
              <td (click)="showUser({identityService : identityService})"><span
                [innerHtml]="identityService.identityServiceName | highlight: filter.searchKey"></span></td>
              <td (click)="showUser({identityService : identityService})"><span
                [innerHtml]="identityService.identityServiceType | highlight: filter.searchKey"></span></td>
              <td (click)="showUser({identityService : identityService})">
                @if (!identityService.secondFactor) {
                  <span [innerHtml]="identityService.serviceAuthenticationScheme | translate | highlight: filter.searchKey"></span>
                }
              </td>
              <td (click)="showUser({identityService : identityService})">
                <span>{{(identityService.secondFactor ? 'common.label.yes' : 'common.label.no') | translate}}</span></td>
              <td (click)="showUser({identityService : identityService})"><span [innerHtml]="identityService.ordering"></span>
              </td>
              <td (click)="showUser({identityService : identityService})">
                <span>{{(identityService.disabled ? 'common.label.yes' : 'common.label.no') | translate}}</span></td>
              <td (click)="showUser({identityService : identityService})">
                @if (!identityService.secondFactor) {
                  <span>{{(identityService.required ? 'common.label.yes' : 'common.label.no') | translate}}</span>
                }
              </td>
            </tr>
          }
        </tbody>
      </nz-table>
    </div>
    @if (ajaxTable.data.length >0) {
      <div class="w-half label-top">
        <span translate>common.label.total</span>
        <span> {{(identityServices | filter: filter.searchKey: ['identityServiceName', 'identityServiceType']).length}} </span>
        @if (ajaxTable.data.length >1) {
          <span translate>user.label.identityServicesFound</span>
        }
        @if (ajaxTable.data.length ===1) {
          <span translate>user.label.identityServiceFound</span>
        }
      </div>
    }
  </div>
}
@if (adminFilter.isBlocklist && !adminFilter.isSession) {
  <app-blocklist [permission]="permission"></app-blocklist>
}
@if (adminFilter.isSession && !adminFilter.isBlocklist) {
  <app-session-management [permission]="permission"></app-session-management>
}
