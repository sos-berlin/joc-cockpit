<div class="modal-header">
    <h4 class="modal-title">
      <span *ngIf="!data" translate>user.label.generalSetting</span>
      <span *ngIf="data">
        <span translate>user.label.settingFor</span>:
        {{data.identityServiceName}}
      </span>
    </h4>
    <button type="button" class="close" aria-label="Close" (click)="activeModal.destroy()">
      <span aria-hidden="true" class="fa fa-times-circle"></span>
    </button>
</div>
<form #myForm="ngForm" (ngSubmit)="onSubmit()">
    <div class="modal-body p-a">
        <div class="form-group row" *ngIf="!data" [ngClass]="{'has-error' : ((timeout.dirty || timeout.touched) && timeout.invalid)}">
            <label class="col-sm-4 form-control-label" translate>user.label.sessionTimeout</label>
            <div class="col-sm-6">
              <input type="text" class="form-control" required name="timeout" [placeholder]="'user.placeholder.sessionTimeout' | translate"
                                #timeout="ngModel" validateSessionTimeReqex [(ngModel)]="currentObj.sessionTimeout">
                <div *ngIf="timeout.invalid && (timeout.dirty || timeout.touched)" class="text-danger help-block">
                    <div *ngIf="timeout.errors.required">
                        <div translate>common.message.requiredError</div>
                    </div>
                </div>
            </div>
        </div>
        <div *ngIf="data && data.identityServiceType.match('VAULT')">
          <div class="form-group row">
            <label class="col-sm-4 form-control-label" translate>user.label.iamVaultUrl</label>
            <div class="col-sm-6">
              <input type="url" class="form-control" name="iamVaultUrl" [placeholder]="'user.placeholder.iamVaultUrl' | translate"
                     [(ngModel)]="currentObj.iamVaultUrl">
            </div>
          </div>
          <div class="form-group row">
            <label class="col-sm-4 form-control-label" translate>user.label.iamVaultAuthenticationMethodPath</label>
            <div class="col-sm-6">
              <input type="text" class="form-control" name="iamVaultAuthenticationMethodPath" [placeholder]="'user.placeholder.iamVaultAuthenticationMethodPath' | translate"
                     [(ngModel)]="currentObj.iamVaultAuthenticationMethodPath">
            </div>
          </div>
          <div class="form-group row">
            <label class="col-sm-4 form-control-label" translate>user.label.iamVaultKeystorePath</label>
            <div class="col-sm-6">
              <input type="text" class="form-control" name="iamVaultKeystorePath" [placeholder]="'user.placeholder.iamVaultKeystorePath' | translate"
                     [(ngModel)]="currentObj.iamVaultKeystorePath">
            </div>
          </div>
          <div class="form-group row">
            <label class="col-sm-4 form-control-label" translate>user.label.iamVaultKeystorePassword</label>
            <div class="col-sm-6">
              <input type="{{!passwordFields.first ? 'password' : 'text'}}" class="form-control" name="iamVaultKeystorePassword"
                     [(ngModel)]="currentObj.iamVaultKeystorePassword" [placeholder]="'user.placeholder.iamVaultKeystorePassword' | translate">
              <i class="fa pswd-hide-icon2" [ngClass]="!passwordFields.first ? 'fa-eye' : 'fa-eye-slash'"
                 (click)="passwordFields.first = !passwordFields.first"></i>
            </div>
          </div>
          <div class="form-group row">
            <label class="col-sm-4 form-control-label" translate>user.label.iamVaultKeyPassword</label>
            <div class="col-sm-6">
              <input type="{{!passwordFields.second ? 'password' : 'text'}}" class="form-control" name="iamVaultKeyPassword"
                     [(ngModel)]="currentObj.iamVaultKeyPassword" [placeholder]="'user.placeholder.iamVaultKeyPassword' | translate">
              <i class="fa pswd-hide-icon2" [ngClass]="!passwordFields.second ? 'fa-eye' : 'fa-eye-slash'"
                 (click)="passwordFields.second = !passwordFields.second"></i>
            </div>
          </div>
          <div class="form-group row">
            <label class="col-sm-4 form-control-label" translate>user.label.iamVaultKeyStoreType</label>
            <div class="col-sm-6">
              <nz-select
                name="iamVaultKeystoreType"
                nzShowSearch
                nzAllowClear
                nzPlaceHolder="{{'user.placeholder.iamVaultKeyStoreType' | translate}}"
                [(ngModel)]="currentObj.iamVaultKeystoreType">
                <nz-option *ngFor="let option of keyStoreTypes" [nzLabel]="option" [nzValue]="option"></nz-option>
              </nz-select>
            </div>
          </div>
          <div class="form-group row">
            <label class="col-sm-4 form-control-label" translate>user.label.iamVaultTrustStorePath</label>
            <div class="col-sm-6">
              <input type="text" class="form-control" name="iamVaultTruststorePath"
                     [(ngModel)]="currentObj.iamVaultTruststorePath" [placeholder]="'user.placeholder.iamVaultTrustStorePath' | translate">
            </div>
          </div>
          <div class="form-group row">
            <label class="col-sm-4 form-control-label" translate>user.label.iamVaultTrustStorePassword</label>
            <div class="col-sm-6">
              <input type="{{!passwordFields.third ? 'password' : 'text'}}" class="form-control" name="iamVaultTruststorePassword"
                     [(ngModel)]="currentObj.iamVaultTruststorePassword" [placeholder]="'user.placeholder.iamVaultTrustStorePassword' | translate">
              <i class="fa pswd-hide-icon2" [ngClass]="!passwordFields.third ? 'fa-eye' : 'fa-eye-slash'"
                 (click)="passwordFields.third = !passwordFields.third"></i>
            </div>
          </div>
          <div class="form-group row">
            <label class="col-sm-4 form-control-label" translate>user.label.iamVaultTrustStoreType</label>
            <div class="col-sm-6">
              <nz-select
                name="iamVaultTruststoreType"
                nzShowSearch
                nzAllowClear
                nzPlaceHolder="{{'user.placeholder.iamVaultTrustStoreType' | translate}}"
                [(ngModel)]="currentObj.iamVaultTruststoreType">
                <nz-option *ngFor="let option of keyStoreTypes" [nzLabel]="option" [nzValue]="option"></nz-option>
              </nz-select>
            </div>
          </div>
          <div class="form-group row">
            <label class="col-sm-4 form-control-label" translate>user.label.iamVaultApplicationToken</label>
            <div class="col-sm-6">
              <input type="text" class="form-control" name="iamVaultApplicationToken"
                     [(ngModel)]="currentObj.iamVaultApplicationToken" [placeholder]="'user.placeholder.iamVaultApplicationToken' | translate">
            </div>
          </div>
        </div>
        <div *ngIf="data && data.identityServiceType.match('LDAP')">
          <nz-tabset class="m-t-n-8">
            <nz-tab [nzTitle]="'user.tab.simpleMode' | translate">
              <div class="m-l-12 m-r-12">
                <div class="form-group row">
                  <label class="col-sm-4 form-control-label" translate>user.usermode.label.iamLdapHost</label>
                  <div class="col-sm-6" [ngClass]="{'has-error' : ((host.dirty || host.touched) && host.invalid)}">
                    <input type="text" class="form-control" name="iamLdapHost" required #host="ngModel" (blur)="changeField('Host')"
                           [(ngModel)]="userObj.iamLdapHost" [placeholder]="'user.usermode.placeholder.iamLdapHost' | translate">
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-sm-4 form-control-label" translate>user.usermode.label.iamLdapProtocol</label>
                  <div class="col-sm-6">
                    <nz-select name="iamLdapProtocol" [(ngModel)]="userObj.iamLdapProtocol" (ngModelChange)="changeConfiguration($event)">
                      <nz-option *ngFor="let option of iamLdapProtocols" [nzLabel]="'user.usermode.label.'+ option.text | translate"
                                 [nzValue]="option.value"></nz-option>
                    </nz-select>
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-sm-4 form-control-label" translate>user.usermode.label.iamLdapPort</label>
                  <div class="col-sm-6" [ngClass]="{'has-error' : ((port.dirty || port.touched) && port.invalid)}">
                    <nz-input-number name="iamLdapPort" required #port="ngModel" (nzBlur)="changeField('Port')"
                                     [(ngModel)]="userObj.iamLdapPort" [nzPlaceHolder]="'user.usermode.placeholder.iamLdapPort' | translate"></nz-input-number>
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-sm-4" translate>user.usermode.label.iamLdapAD</label>
                  <div class="col-sm-6">
                    <label nz-checkbox [(ngModel)]="userObj.iamLdapAD" (ngModelChange)="checkConfirmation($event, 'AD')" name="iamLdapAD"></label>
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-sm-4" translate>user.usermode.label.iamLdapADWithSamAccount</label>
                  <div class="col-sm-6">
                    <label nz-checkbox [nzDisabled]="!userObj.iamLdapAD" [(ngModel)]="userObj.iamLdapADwithSamAccount" (ngModelChange)="checkConfirmation($event, 'samAccount')" name="iamLdapADWithSamAccount"></label>
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-sm-4" translate>user.usermode.label.iamLdapWithMemberOf</label>
                  <div class="col-sm-6">
                    <label nz-checkbox [(ngModel)]="userObj.iamLdapWithMemberOf" (ngModelChange)="checkConfirmation($event, 'MemberOf')" name="iamLdapWithMemberOf"></label>
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-sm-4 form-control-label" translate>user.label.iamLdapSearchBase</label>
                  <div class="col-sm-6" [ngClass]="{'has-error' : ((searchBase.dirty || searchBase.touched) && searchBase.invalid)}">
                    <input type="text" class="form-control" name="iamLdapSearchBase" [required]="userObj.iamLdapWithMemberOf" #searchBase="ngModel"
                           [placeholder]="'user.placeholder.iamLdapSearchBase' | translate"
                           [(ngModel)]="currentObj.iamLdapSearchBase">
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-sm-4 form-control-label" translate>user.label.iamLdapUserSearchFilter</label>
                  <div class="col-sm-6">
                    <input type="text" class="form-control" name="iamLdapUserSearchFilter"
                           [placeholder]="'user.placeholder.iamLdapUserSearchFilter' | translate"
                           [(ngModel)]="currentObj.iamLdapUserSearchFilter">
                  </div>
                </div>
              </div>
            </nz-tab>
            <nz-tab [nzTitle]="'user.tab.expertMode' | translate">
              <div class="m-l-12 m-r-12">
                <div class="form-group row">
                  <div class="col-md-12" translate>user.label.general</div>
                </div>
                <div class="p-a b-a">
                  <div class="form-group row">
                    <label class="col-sm-4 form-control-label" translate>user.label.iamLdapServerUrl</label>
                    <div class="col-sm-6">
                      <input type="url" class="form-control" name="iamLdapServerUrl"
                             [placeholder]="'user.placeholder.iamLdapServerUrl' | translate"
                             [(ngModel)]="currentObj.iamLdapServerUrl">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-sm-4" translate>user.label.iamLdapUseStartTls</label>
                    <div class="col-sm-6">
                      <label nz-checkbox [(ngModel)]="currentObj.iamLdapUseStartTls" name="iamLdapUseStartTls"></label>
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-sm-4 form-control-label" translate>user.label.iamLdapHostNameVerification</label>
                    <div class="col-sm-6">
                      <nz-select nzAllowClear name="iamLdapHostNameVerification" [(ngModel)]="userObj.iamLdapHostNameVerification">
                        <nz-option [nzLabel]="'user.label.on' | translate" [nzValue]="'on'"></nz-option>
                        <nz-option [nzLabel]="'user.label.off' | translate" [nzValue]="'off'"></nz-option>
                      </nz-select>
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-sm-4 form-control-label" translate>user.label.iamLdapTrustStorePath</label>
                    <div class="col-sm-6">
                      <input type="text" class="form-control" name="iamLdapTruststorePath"
                             [(ngModel)]="currentObj.iamLdapTruststorePath" [placeholder]="'user.placeholder.iamLdapTrustStorePath' | translate">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-sm-4 form-control-label" translate>user.label.iamLdapTrustStorePassword</label>
                    <div class="col-sm-6">
                      <input type="{{!passwordFields.third ? 'password' : 'text'}}" class="form-control" name="iamLdapTruststorePassword"
                             [(ngModel)]="currentObj.iamLdapTruststorePassword" [placeholder]="'user.placeholder.iamLdapTrustStorePassword' | translate">
                      <i class="fa pswd-hide-icon2" [ngClass]="!passwordFields.third ? 'fa-eye' : 'fa-eye-slash'"
                         (click)="passwordFields.third = !passwordFields.third"></i>
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-sm-4 form-control-label" translate>user.label.iamLdapTrustStoreType</label>
                    <div class="col-sm-6">
                      <nz-select
                        name="iamLdapTruststoreType"
                        nzShowSearch
                        nzAllowClear
                        nzPlaceHolder="{{'user.placeholder.iamLdapTrustStoreType' | translate}}"
                        [(ngModel)]="currentObj.iamLdapTruststoreType">
                        <nz-option *ngFor="let option of keyStoreTypes" [nzLabel]="option" [nzValue]="option"></nz-option>
                      </nz-select>
                    </div>
                  </div>
                </div>
                <div class="form-group row m-t">
                  <div class="col-md-12" translate>user.label.authentication</div>
                </div>
                <div class="p-a b-a">
                  <div class="row">
                    <label class="col-sm-4 form-control-label" translate>user.label.iamLdapUserDnTemplate</label>
                    <div class="col-sm-6">
                      <input type="text" class="form-control" name="iamLdapUserDnTemplate"
                             [placeholder]="'user.placeholder.iamLdapUserDnTemplate' | translate"
                             [(ngModel)]="currentObj.iamLdapUserDnTemplate">
                    </div>
                  </div>
                </div>
                <div class="form-group row m-t" *ngIf="data.identityServiceType !== 'LDAP-JOC'">
                  <div class="col-md-12" translate>user.label.groupRolesMapping</div>
                </div>
                <div class="p-a b-a" *ngIf="data.identityServiceType !== 'LDAP-JOC'">
                  <div class="form-group row">
                    <label class="col-sm-4 form-control-label" translate>user.label.iamLdapSearchBase</label>
                    <div class="col-sm-6">
                      <input type="text" class="form-control" name="iamLdapSearchBase"
                             [placeholder]="'user.placeholder.iamLdapSearchBase' | translate"
                             [(ngModel)]="currentObj.iamLdapSearchBase">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-sm-4 form-control-label" translate>user.label.iamLdapGroupSearchBase</label>
                    <div class="col-sm-6">
                      <input type="text" [disabled]="userObj.iamLdapWithMemberOf" class="form-control" name="iamLdapGroupSearchBase"
                             [placeholder]="'user.placeholder.iamLdapGroupSearchBase' | translate"
                             [(ngModel)]="currentObj.iamLdapGroupSearchBase">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-sm-4 form-control-label" translate>user.label.iamLdapGroupSearchFilter</label>
                    <div class="col-sm-6">
                      <input type="text" [disabled]="userObj.iamLdapWithMemberOf" class="form-control" name="iamLdapGroupSearchFilter"
                             [placeholder]="'user.placeholder.iamLdapGroupSearchFilter' | translate"
                             [(ngModel)]="currentObj.iamLdapGroupSearchFilter">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-sm-4 form-control-label" translate>user.label.iamLdapUserSearchFilter</label>
                    <div class="col-sm-6">
                      <input type="text" class="form-control" name="iamLdapUserSearchFilter"
                             [placeholder]="'user.placeholder.iamLdapUserSearchFilter' | translate"
                             [(ngModel)]="currentObj.iamLdapUserSearchFilter">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-sm-4 form-control-label" translate>user.label.iamLdapGroupNameAttribute</label>
                    <div class="col-sm-6">
                      <input type="text" class="form-control" name="iamLdapGroupNameAttribute"
                             [placeholder]="'user.placeholder.iamLdapGroupNameAttribute' | translate"
                             [(ngModel)]="currentObj.iamLdapGroupNameAttribute">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-sm-4 form-control-label" translate>user.label.iamLdapUserNameAttribute</label>
                    <div class="col-sm-6">
                      <input type="text" class="form-control" name="iamLdapUserNameAttribute"
                             [placeholder]="'user.placeholder.iamLdapUserNameAttribute' | translate"
                             [(ngModel)]="currentObj.iamLdapUserNameAttribute">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-sm-12 _600" translate>user.label.iamLdapGroupRolesMap</label>
                  </div>
                  <div class="form-group row m-b-0"
                       *ngIf="currentObj.iamLdapGroupRolesMap && currentObj.iamLdapGroupRolesMap.items.length > 0">
                    <div class="col-md-5 m-b-sm" translate>user.label.group</div>
                    <div class="col-md-6 m-b-sm m-l-22" translate>user.label.roles</div>
                  </div>
                  <ng-container
                    *ngIf="currentObj.iamLdapGroupRolesMap && currentObj.iamLdapGroupRolesMap.items.length > 0">
                    <div class="form-group row m-b-0"
                         *ngFor="let items of currentObj.iamLdapGroupRolesMap.items; let i = index">
                      <div class="col-md-5 m-b-sm p-r-0"
                           [ngClass]="{'has-error' : ((group.dirty || group.touched) && group.invalid)}">
                        <input #group="ngModel" type="text" class="form-control" name="group{{i}}"
                               [(ngModel)]="items.ldapGroupDn" placeholder="{{'user.placeholder.group' | translate}}">
                      </div>
                      <div class="col-md-6 m-b-sm p-r-0">
                        <div class="row" *ngFor="let role of items.roles; let cIndex = index">
                          <div class="col-sm-1 p-r-0">
                            <a class="text-hover-primary" (click)="addRole(items.roles)"
                               *ngIf="cIndex === items.roles.length - 1"><i class="fa fa-plus m-t-sm text-muted"></i></a>
                          </div>
                          <div class="col-sm-10 p-l-0 m-b-sm"
                               [ngClass]="{'has-error' : ((roleModal.dirty || roleModal.touched) && roleModal.invalid)}">
                            <input type="text" class="form-control" [(ngModel)]="role.name"
                                   [required]="(items.ldapGroupDn && items.ldapGroupDn.length > 0 && cIndex === 0) ? true : false"
                                   name="role{{i+1}}{{cIndex+1}}" #roleModal="ngModel"
                                   placeholder="{{'user.placeholder.role' | translate}} {{cIndex+1}}">
                          </div>
                          <div class="col-sm-1 p-l-0">
                            <a *ngIf="items.roles.length>1" class="cursor" (click)="removeRole(items.roles, cIndex)">
                              <i class="fa fa-times m-t-sm text-muted"></i></a>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-1">
                        <a class="cursor" (click)="removeGroupRoles(i)"><i
                          class="fa fa-times m-t-sm text-hover-color"></i></a>
                      </div>
                    </div>
                  </ng-container>
                  <div class="row">
                    <div class="col-sm-12">
                      <a class="text-u-l" (click)="addGroupRoles()" translate>user.button.addGroupRole</a>
                    </div>
                  </div>
                </div>
              </div>
            </nz-tab>
          </nz-tabset>
        </div>
    </div>
    <div class="modal-footer">
        <button type="submit" class="btn btn-primary btn-sm" [disabled]="!myForm.form.valid || submitted">
            <i *ngIf="submitted" class="fa fa-spin fa-spinner p-r-xs"></i>
            {{'common.button.submit' | translate}}
        </button>
        <button type="button" class="btn btn-default btn-sm" *ngIf="data"
              (click)="copySetting()" translate>user.button.copySetting
        </button>
        <button type="button" class="btn btn-default btn-sm" *ngIf="isEnable"
              (click)="pasteSetting()" translate>user.button.pasteSetting
        </button>
        <button type="button" class="btn btn-grey btn-sm" (click)="activeModal.destroy()" translate>
          common.button.cancel
        </button>
    </div>
</form>
