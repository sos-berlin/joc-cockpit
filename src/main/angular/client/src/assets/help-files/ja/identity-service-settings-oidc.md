# IDサービス管理 - OIDC構成

IDサービスは、認証と認可によってJOCコックピットへのアクセスを管理します。[IDサービス管理](/identity-services) を参照してください。

IDサービスは、以下の設定が必要です：

-  **一般設定** は、すべての IDサービスで必要な項目を設定します。[IDサービス管理 - 設定](/identity-service-configuration) を参照。
- OIDC IDサービスタイプに固有の設定。

## 構成

以下の設定があります：

- **OIDC名** は、JOCコックピットのログインページのログインボタンに使用します。
- **OIDC認証URL** OIDC ID プロバイダーにログインするためのクライアントが使用します。この URL は、ログインのために呼び出され、OIDC アイデンティティプロバイダーからアクセストークンを返されます。同様に、*/.well-known/openid-configuration* URL で OIDC アイデンティティプロバイダーの設定を読み込む際にも使用され、トークン検証時に発行元として使用されます。
- **Flowタイプ**
  - **Authorization Code Flow** は、セキュリティで最も一般的に使用されるフローです。
  - **Implicit Flow** は、以前は安全でないと考えられていたフローです。
  - **Client Credentials Flow** は、ユーザーとのインタラクションを伴わないバッチ処理用の簡略化されたフローです。
- **OIDC クライアント ID** は、OIDC ID プロバイダーでのクライアントの識別子です。
- **OIDC クライアントシークレット** は、OIDC ID プロバイダーで *OIDC Client ID* に割り当てられたパスワードです。
- **OIDC ユーザー属性** は、OIDC IDサービスがユーザーアカウントを識別するために使用する項目です。
  - JOCコクピットアカウントへのマッピングに使用される属性を識別するために、以下が適用されます：
    - *<identity-provider\> /.well-known/openid-configuration* が呼び出されます。
    - 応答は、オブジェクト *claims_supported* について確認されます。
      - 利用可能でないか空の場合、*email* 属性が使用されます。
      - もし利用可能で、*preferred_username* 属性が含まれていれば、この属性が使用されます。
    - 属性が特定されなかった場合、*email* 属性が使用されます。
  - これによって識別可能なユーザアカウントが得られない場合、ユーザは name 属性を指定することができます。OIDC アイデンティティプロバイダは、*username* や *email* といった属性名をサポートすることがあります。
- **OIDCグループクレーム** は、JS7ロールへのマッピングに使用されるOIDCロールまたはグループを指定します。デフォルトのOIDCクレームには、ロールとグループが含まれます。
- **OIDCグループスコープ** は、OIDC IDサービスプロバイダーが返す範囲を指定します。デフォルトのOIDC範囲は、ロール、グループ、プロファイルが含まれます。
- **OIDCグループロールマップ** を使用すると、アカウントにロールを割り当てることができます。
  - OIDC IDプロバイダーで設定されているグループを含むクレームリストを指定可能です。利用可能なクレームは、登録時にJSON Webトークンを確認することで利用可能になります。
  - 割り当て処理では、OIDC IDプロバイダーから取得したグループが、IDサービスで設定されたロールに割り当てられます。各グループには任意の数のロールを割り当てることができます。
- **OIDCイメージ** はオプションでアップロードすることができ、ログインページに表示されます。ユーザーはこの画像をクリックして、OIDC アイデンティティサービスでログインすることができます。
- **OIDC トラストストアパス** は、IDプロバイダーのサーバ認証の拡張キー使用法に指定された X.509 証明書を含める必要があります。
  - Azure® などのよく知られた OIDC ID プロバイダへの接続の場合、ユーザーは JOCコックピットで使用される Java JDK に同梱されている Java *cacerts* トラストストアファイルへのパスを指定する必要があります。
  - トラストストアは、プライベート CA またはパブリック CA からの自己署名証明書を含む必要があります。通常、CA 証明書が使用されます。そうしないと、サーバー認証証明書の署名に関係する完全な証明書チェーンをトラストストアで利用できるようにする必要があるためです。
  - この設定が指定されていない場合、JOCコックピットは *JETTY_BASE/resources/joc/joc.properties* ファイルで構成されているトラストストアを使用します。これには、*OIDC Truststore Password* と *OIDC Truststore Type* の設定の使用も含まれます。
  - トラストストアのパスは、*JETTY_BASE/resources/joc* ディレクトリからの相対パスで指定できます。トラストストアがこのディレクトリにある場合、ファイル名のみが指定され、通常拡張子は.p12または.pfxです。トラストストアが *JETTY_BASE* ディレクトリにある場合は、 *../../joc-truststore.p12* のように相対パスを指定できます。
  - 絶対パスを指定することもできます。
- **OIDCトラストストアタイプ** は、PKCS12またはJKS（非推奨）のいずれかです。
- **OIDCトラストストアパスワード** は、Java JDKの *cacerts* トラストストアの場合、デフォルトのパスワードは*changeit*です。

## 参照

### コンテキストヘルプ

- [IDサービス管理 - 設定](/identity-service-configuration)
- [IDサービス管理](/identity-services)

###Product Knowledge Base

- [JS7 - Identity Services](https://kb.sos-berlin.com/display/JS7/JS7+-+Identity+Services)
- [JS7 - OIDC Identity Service](https://kb.sos-berlin.com/display/JS7/JS7+-+OIDC+Identity+Service)

