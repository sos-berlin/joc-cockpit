# 初期設定 - クラスターエージェント登録

初期設定は、コントローラー、エージェント、JOCコックピットのインストール後に行います。クラスターエージェントの登録は、[初期設定  - コントローラー登録](/initial-operation-register-controller) 完了後に行います。

クラスターエージェントの運用は、[JS7 - License](https://kb.sos-berlin.com/display/JS7/JS7+-+License) の商用ライセンス契約が必要です。

- スタンドアロンエージェントの使用
  - スタンドアロンエージェントの使用: オープンソースライセンスおよび商用ライセンス保有者が使用できます。
- クラスターエージェントの使用：
  - 商用ライセンスの契約が必要です、
  - 詳細は[JS7 - Management of Agent Clusters](https://kb.sos-berlin.com/display/JS7/JS7+-+Management+of+Agent+Clusters)

## アーキテクチャー

### エージェント

- **スタンドアロンエージェント** は、オンプレミスやVM/コンテナからリモートマシン上でジョブを実行します。エージェントは個別に運用され、コントローラーによって管理されます。
- **クラスターエージェント**
  - **ディレクターエージェント** は、クラスターエージェント内の *サブエージェント* を管理します。ディレクターエージェントはアクティブスタンバイクラスタリングで2つのインスタンスから運用され、コントローラーによって管理されます。
  - **サブエージェント** は、オンプレミスのリモートマシンやVM/コンテナからジョブを実行します。これらはクラスターエージェントのワーカーノードと考えることができ、*ディレクターエージェント* によって管理されます。

### 接続

- **スタンドアロンエージェント**、**ディレクターエージェント** は、コントローラーから接続されます。
- クラスターエージェント内の **サブエージェント** は、*ディレクターエージェント* から接続されます。

## クラスターエージェントの登録

クラスターエージェントの登録には、プライマリーとセカンダリーのディレクターエージェントの登録が必要です。後のサブエージェントの登録については [初期設定 - サブエージェント登録](/initial-operation-register-agent-subagent) を参照してください。

インストール前の前提条件

- JOCコックピット、コントローラー、およびすべてのディレクターエージェントには、有効な商用ライセンスキーが必要です。
- セカンダリーディレクターエージェントは、./config/agent.conf ファイルに次の設定が必要です。： *js7.journal.cluster.node.is-backup=yes*。
- プライマリーとセカンダリーのディレクターエージェントの両方が稼働している必要があります。

ユーザーは、コントローラーのサーバーから両方のディレクターエージェントのサーバーへのネットワーク接続が利用可能であること、およびファイアウォールルールがディレクターエージェントのポートへの接続を許可していることを確認する必要があります。

メインメニューバーのホイールアイコンから *コントローラー・エージェント管理* 画面を開き、コントローラーのアクションメニューから *クラスターエージェント追加* を選択します。これにより、クラスターエージェントの登録ポップアップウィンドウが表示されます。

ユーザーは以下の入力をします：

- **エージェントID** は、クラスターエージェントの一意な識別子で、クラスターの有効期間中は変更できません。*エージェントID* は、ジョブおよびワークフローでは表示されません。
- **エージェントクラスター名** は、クラスターエージェントの一意の名前です。ジョブにエージェントを割り当てる場合、*エージェントクラスター名* が使用されます。*エージェントクラスター名* を後で変更するには、*エイリアス名*から以前の*エージェントクラスタ名* を引き続き使用する必要があります。
- **タイトル** は、クラスターエージェントに追加できる説明です。
- **エイリアス名** は、同じクラスターエージェントの別名です。ジョブにエージェントを割り当てる場合、*エイリアス名* も提供されます。 *エイリアス名* は、例えばテスト環境が本番環境より少ないクラスターエージェントを含んでいる場合に使用できます。
- **プライマリディレクター**
  - **サブエージェントID** は、プライマリーディレクターエージェントの一意の識別子です。*サブエージェントID* は、ジョブおよびワークフローでは表示されません。
  - **タイトル** は、ディレクターエージェントに追加できる説明です。
  - **URL** は、プライマリーディレクターエージェントに接続するためにコントローラーが使用するプロトコル、ホスト、ポート番号から URL を指定します。例：http://localhost:4445
    - ディレクターエージェントが、HTTP を使用する場合、URL は *http* から開始します。ディレクターエージェントが HTTPS 用に設定されている場合は、*https* から開始します。
    - ディレクターエージェントがコントローラーと同じマシンにインストールされている場合、ホスト名は *localhost* になります。そうでない場合は、ディレクターエージェントのホストの FQDN を指定します。
    - ディレクターエージェントの *ポート番号* は、インストール中に設定されます。 
  - **サブエージェントクラスター作成** オプションで、各プライマリーとセカンダリーのディレクターエージェントにサブエージェントクラスターを作成します。[初期設定 - サブエージェントクラスター登録](/initial-operation-register-agent-subagent-cluster) を参照してください。
- **セカンダリディレクター**
  - **サブエージェントID** は、セカンダリーディレクターエージェントの一意の識別子です。*サブエージェンID* は、ジョブおよびワークフローでは表示されません。
  - **タイトル** は、ディレクターエージェントに追加できる説明です。
  - **URL** は、*プライマリディレクター* と同様に、コントローラーからセカンダリーディレクターエージェントに接続するためのプロトコル、ホスト、ポート番号の URL を指定します。

登録に成功すると、エージェントは[リソース - エージェント](/resources-agents) 画面に表示されます。

## 参照

### コンテキストヘルプ

- [ダッシュボード - システムステータス](/dashboard-product-status)
- [初期設定 - スタンドアロンエージェント登録](/initial-operation-register-agent-standalone)
- [初期設定 - サブエージェント登録](/initial-operation-register-agent-subagent)
- [初期設定 - サブエージェントクラスター登録](/initial-operation-register-agent-subagent-cluster)
- [初期設定 - コントローラー登録](/initial-operation-register-controller)

###Product Knowledge Base

- [JS7 - Agent Cluster](https://kb.sos-berlin.com/display/JS7/JS7+-+Agent+Cluster)
- [JS7 - License](https://kb.sos-berlin.com/display/JS7/JS7+-+License)
- [JS7 - How to troubleshoot Agent Initial Operation](https://kb.sos-berlin.com/display/JS7/JS7+-+How+to+troubleshoot+Agent+Initial+Operation)
- [JS7 - Management of Agent Clusters](https://kb.sos-berlin.com/display/JS7/JS7+-+Management+of+Agent+Clusters)

