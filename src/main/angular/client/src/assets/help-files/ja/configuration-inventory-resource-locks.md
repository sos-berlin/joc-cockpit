# ジョブ定義 - インベントリー - ロック

*ロック*では、ワークフローで使用するリソースロックを指定できます。

リソースロックはジョブや他のワークフロー命令の排他制御をします。リソースロックは信号機のようなもので、正確には [セマフォ](https://en.wikipedia.org/wiki/Semaphore_%28programming%29) のようなものです。 

- オーダーは、ワークフローを進めるためにロックを取得する必要があり、そうでない場合はロックが利用可能になるまで *待機* 状態に留まります。
- ロックを待つオーダーは、CPUなどのコンピューティングリソースを消費しません、
- オーダーのロック取得の試みは、ワークフローやエージェントにまたがるジョブや、その他のワークフロー命令に対して考慮されます。

リソースロックには以下の種類があります：

- **排他ロック** は、[JS7 - Lock Instruction](https://kb.sos-berlin.com/display/JS7/JS7+-+Lock+Instruction) によるロックの独占使用を許可します。
- **共有ロック** は、同じワークフローまたは異なるワークフローからの多数の *ロック命令* によるロックの並列使用を許可します。
  - 基本的なユースケースは、限られた数のジョブが同時にアクセスできるデータベーステーブルのようなリソースです。データベースのデッドロックを防ぐために、テーブルにアクセスするジョブ数は制限されています。
  - 各 *ロック命令* は、リソース・ロックの *制限* にカウントされる *ウェイト* を指定します。*ウェイト* が利用可能な *制限* と一致する場合、オーダーを進めることができ、そうでない場合、オーダーは必要な *制限* のシェアが利用可能になるまで待機します。

以下は、*ロック命令* によるリソースロックの使用に適用されます：

- *ロック命令* は、任意の数のジョブや他のワークフロー命令を生成できるワークフローで使用されるブロック命令です。
- *ロック命令* は、任意の数のレベルで入れ子にすることができます。
- ジョブがエラーになった場合、デフォルトではオーダーはロックを解除し *ロック命令* の先頭に移動します。失敗した*オーダーにロックの使用を継続させたいユーザーは、*失敗時停止* オプションに *false* を指定します。[JS7 - Options Instruction](https://kb.sos-berlin.com/display/JS7/JS7+-+Options+Instruction) 

リソースロックは以下のパネルで管理できます：

- ウィンドウの左側にある[ジョブ定義 - インベントリー - ナビゲーションパネル](/configuration-inventory-navigation) から、リソースロックのフォルダーごとにナビゲーションが可能です。また、このパネルではリソースロックに対する操作が可能です。
- ウィンドウの右側にある *リソースロックパネル* はリソースロックの設定の詳細を表示します。

## リソースロックパネル

リソースロックでは以下の入力が可能です：

- **名称** は、リソースロックのユニークな識別子で、[オブジェクト命名規則](/object-naming-rules) を参照してください。
- **タイトル** は、リソースロックの目的など説明を任意で入力します。
- **制限** は、並列 *ロック命令* の *ウェイト* の最大許容量を表す数値です：
  - *制限* が1の場合、リソースロックは *排他ロック* または *共有ロック* の *ロック命令* から独立して独占使用に制限されます。
  - *ウェイト*を大きくすると、*共有ロック* によるリソースロックの並列使用が可能になります。関連する *ロック命令* は、ロックの *制限* の使用を指定できます：
    - *排他* 使用は、その *制限* とは無関係に排他的にロックの取得を試みます。 
    - *共有* 使用は、*ロック命令* の *ウェイト* が残りの *制限* と一致するかどうかを確認します。

### リソースロックの操作

利用可能な操作については、[ジョブ定義 - インベントリー - ナビゲーションパネル](/configuration-inventory-navigation) を参照してください。

### オーダーの優先順位

リソースロックはオーダーの *優先度* を考慮します。[ジョブ定義 - インベントリー - 実行計画 - スケジュール](/configuration-inventory-schedules) からオーダーを追加するとき、および[ワークフロー - オーダー追加](/workflows-orders-add) を使用してアドホックオーダーを追加するとき、 *優先度* を指定することができます。

複数のオーダーがリソースロックの前で待機している場合、最も高い *優先度* を持つオー ダーが最初にリソースロックを取得します。

##参照

### コンテキストヘルプ

- [ジョブ定義 - インベントリー - ナビゲーションパネル](/configuration-inventory-navigation)
- [オブジェクト命名規則](/object-naming-rules)

### Product Knowlede Base

- [JS7 - Lock Instruction](https://kb.sos-berlin.com/display/JS7/JS7+-+Lock+Instruction)
- [JS7 - Options Instruction](https://kb.sos-berlin.com/display/JS7/JS7+-+Options+Instruction)
- [セマフォ](https://en.wikipedia.org/wiki/Semaphore_%28programming%29)

