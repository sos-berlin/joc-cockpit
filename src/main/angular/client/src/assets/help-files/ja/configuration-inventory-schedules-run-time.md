# ジョブ定義 - インベントリー - 実行計画 - スケジュール - ランタイム

*スケジュールパネル*では、[実行計画](/daily-plan) からオーダーを作成するための設定をすることができます。

*ランタイム* ボタンを押すと、ポップアップウィンドウからオーダーの開始時間を指定することができます。

## タイムゾーン

実行時間は、ユーザーの[プロファイル - 設定値](/profile-preferences) から入力された **タイムゾーン** から指定されます。入力には、*UTC*、*Asia/Tokyo* などのタイムゾーンが使用できます。タイムゾーンの完全なリストについては、[List of tz database time zones](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones) を参照してください。

- オーダーの開始時間は、指定されたタイムゾーンで使用されます。
- [設定 - Daily Plan](/settings-daily-plan) と異なるタイムゾーンをオーダー実行時間に使用することも可能です。ユーザーは以下の点を考慮する必要があります。 
  - オーダーには実行計画日が割り当てられます。
  - 開始時間はスケジュールのタイムゾーンから計算されます。
- その結果、実行計画では、前日または後日と重複する日付のオーダーを保持することができます。例えば
  - 実行計画のタイムゾーンをUTCとします、
  - スケジュールのタイムゾーンがアジア/カルカッタ(UTC+05:30)で、開始時間が *23:00* であるとします、
  - 火曜日の実行計画でオーダーが作成された場合、開始時刻は水曜日の *04:30* UTCとなります。この結果は正しいのですが、タイムゾーンに迷うユーザーにとっては混乱を招く可能性があります。

驚くことに、1日は24時間ではなく、最大50時間です。地球の自転に依存しているため、1日の長さは常に24時間です。しかし、任意のタイムゾーンでは、地球上のすべての可能な時間を含むように50時間の範囲があります。

## カレンダー割り当て

最初に、カレンダーを割り当てる必要があります：

- **営業日カレンダー** は、オーダーを作成する日を指定します。繰り返し使用される場合、営業日カレンダーごとに期間付きのランタイムエントリーが追加されます。
- **休業日カレンダー** は、オーダーを作成しない日を指定することができます。休業日カレンダーはいくつでも追加でき、統合されます。

##期間

次に、開始時刻の期間を1つ以上指定します。繰り返し間隔]には以下のオプションがあります：

- **シングルスタート** は１回のみの開始時間です。
  - **開始時間** は、*HH:MM:SS* で指定できます。
  - **休日** は、ある期間が休業日カレンダーの日に一致する場合の動作を指定します。
    - **実行しない** は、オーダーを作成しないデフォルトの動作です。
    - **休業日を無視** は、休業日カレンダーを上書きし、オーダーを作成します。
    - **直前営業日** は、休業日の前の営業日にオーダーを追加します。例えば
      - 営業日カレンダーは、月～木を営業日とします。 
      - 休業日カレンダーは、その年の特定の月曜日を休業日とします。
      - 休業日の前日は直前の日曜日になります。もし週末を除外して休業日カレンダーに追加する場合、その日は直前の金曜日になります。
    - **翌営業日** は、休業日の次の営業日にオーダーを追加します。例えば
      - 営業日カレンダーは、火～金を営業日と指定します。 
      - 休業日カレンダーは、その年の特定の金曜日を休業日とします。
      - その翌日は次の土曜日となります。週末を除外して休業日カレンダーに追加した場合、その翌日は次の月曜日となります。        
- **繰返** は、周期オーダーの繰返し期間を指定します。入力には次のように指定します： *HH:MM:SS*。
  - **繰返し間隔** は、2時間ごとのサイクルでは *02:00* のように、サイクル間の間隔です。
  - **開始** は最初のサイクルの開始時間です。例えば、*06:00* は午前6時です。
  - **終了** は最後のサイクルの終了時刻です。例えば、*22:00* が午後10時です。
  - **休日** は、ある期間が休業日によって指定された日に一致する場合にどうするかを指定します。設定方法は *シングルスタート* と同じです。

## 制限

*オーダー* が作成される日を制限します：

- 割り当てられた営業日カレンダーと休業日カレンダーを合わせて、*オーダー* によるワークフロー実行日が決定されます。
- さらに、[ジョブ定義 - インベントリー - 実行計画 - カレンダー](/configuration-inventory-calendars) と同様のルールを適用します：
  - **平日** は、曜日を指定します。
  - **特定曜日** は、月の最初または最後の月曜日のような相対的な平日を指定します。
  - **特定日** は、その年の特定日を指定します。
  - **日数** は、月の最初の日や最後の日など、月の相対的な日を指定します。
  - **毎** は、2日ごと、1週間ごと、3ヶ月ごとなどの定期的な期間を指定します。この場合、日数のカウントを開始する *有効な開始日* を指定する必要があります。
  - **国民の祝日** は、既知の祝祭日を指定します。
  - **休業日カレンダー** は、現在の休業日カレンダーから関連する日を除外します。

*制限* は、使用するカレンダーを制限することができます。月の初日などの特定のルールのために個別のカレンダーを作成する代わりに、ユーザーは1年のすべての日をカバーする標準カレンダーを適用し、希望の *制限* を適用することができます。

休業日カレンダーの使用は、*ランタイム* を割り当てた場合と *制限* を割り当てた場合で異なります：

- 例
  - 例：営業日カレンダーを月～金と仮定します。
  - スケジュールで、月の4日目を *制限* で設定します。
  - その結果、*営業日カレンダー* とカレンダーと月の4日目にオーダーは作成されます。
- スケジュールは、休業日カレンダーの参照もできます。
  - 休業日カレンダーは各スケジュールの *制限* の計算後に適用されます。
  - もしユーザーが特定の休業日をカレンダーから除外したい場合、以下のオプションがあります。
    - 営業日カレンダーの *除外* から休業日を指定します。
    - *制限* で指定する休業日カレンダーから、特定の日を指定します。

## 繰り返しオーダーとサイクル命令ワークフローの比較

繰り返しオーダーは、サイクルごとに個別のオーダーを作成します。繰り返し間隔を使用するスケジュールで作成される周期的オーダーに代わるものとして、[JS7 - Cycle Instruction](https://kb.sos-berlin.com/display/JS7/JS7+-+Cycle+Instruction) が、ワークフローで使用できます。

- 実行
  - *サイクル命令* は、スケジュールからサイクルオーダーを使用するのと同じように、完全なワークフローを生成します。
  - *サイクル命令* は、ワークフローの一部をサイクルで実行するために使用できます。
- 効率性
  - スケジュールは、繰り返しオーダーの各期間ごとに多数のオーダーを作成します。30秒ごとに1つのオーダーを実行すると、1日あたり2,880のオーダーが作成されます。
  - *サイクル命令* は、1つのオーダーからワークフローを周期的に実行します。
  - *サイクル命令* の処理は繰り返しオーダーの処理よりもはるかに効率的です。
- エラー処理
  - 失敗
    - 繰り返しオーダーの場合、ワークフロー内のジョブが失敗した場合、各オーダーごとに発生します。
    - *サイクル命令* 内のジョブが失敗した場合、エラー処理によっては、オーダーが *失敗* 状態にある間に発生するサイクルがスキップされます。
  - 通知
    - 失敗した各繰り返しオーダーに対して、通知が作成されます。
    - サイクル命令を含むワークフローの1つのオーダーに対して、1つの通知が作成されます。
  - 介入
    - 繰り返しオーダーの操作は、すべてのオーダーに適用されます。例えば障害後の実行再開などでは、以前にスケジュールされたオーダーが、全て並列に実行されます。
    - サイクル命令を含むワークフローでは、1つのオーダーがユーザーの介入を待ちます。
- ロギング
  - 繰り返しオーダーの各オーダーについて、[オーダー履歴](/history-orders) と[タスク履歴](/history-tasks) に個別のエントリが作成されます。
  - サイクル命令を含むワークフローでは、一つのオーダー履歴に各サイクルのログ出力が追加されます。ジョブ実行ごとの個別のエントリは、タスク履歴に追加されます。

## 参照

### コンテキストヘルプ

- [ジョブ定義 - インベントリー - 実行計画 - カレンダー](/configuration-inventory-calendars)
- [ジョブ定義 - インベントリー - 実行計画 - スケジュール](/configuration-inventory-schedules)
- [ジョブ定義 - インベントリー - ワークフロー](/configuration-inventory-workflows)
- [実行計画](/daily-plan)
- [デイリープランサービス](/service-daily-plan)
- [オブジェクト命名規則](/object-naming-rules)
- [オーダー履歴](/history-orders)
- [プロファイル - 設定値](/profile-preferences)
- [設定 - Daily Plan](/settings-daily-plan)
- [タスク履歴](/history-tasks)

###Product Knowledge Base

- [JS7 - Calendars](https://kb.sos-berlin.com/display/JS7/JS7+-+Calendars)
- [JS7 - Cycle Instruction](https://kb.sos-berlin.com/display/JS7/JS7+-+Cycle+Instruction)
- [JS7 - Schedules](https://kb.sos-berlin.com/display/JS7/JS7+-+Schedules)
- [タイムゾーン一覧](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones)

